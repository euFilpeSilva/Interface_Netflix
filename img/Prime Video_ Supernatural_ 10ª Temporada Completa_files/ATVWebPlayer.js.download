var WebPlayer=function(){'use strict';var t=function(){function e(){}return e.toString=function(){return"aborted"},e}(),o=function(){function e(){}return e.toString=function(){return"asinChanged"},e}(),i=function(){function e(e){this.position=e}return e.toString=function(){return"closed"},e}(),s=function(){function e(){}return e.toString=function(){return"playerCapabilities"},e}(),a=function(){function e(){}return e.toString=function(){return"playing"},e}(),l='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:{};function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,'default')?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}var c=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function r(e,t,i,n){(((this.is=this).a=this).an=this).baseName=e,this.target=t,this.targetName=i,(this.negated=n)||(this.not=new r(e,t,i,!0))}return r.of=function(i){return function(e,t){return new r(i,e,t)}},r.check=function(e,t){return new r(null,e,t)},r.prototype.function=function(){return this.checkType("Function")},r.prototype.object=function(){return this.checkType("Object")},r.prototype.number=function(){return this.checkType("Number")},r.prototype.string=function(){return this.checkType("String")},r.prototype.array=function(){return this.checkType("Array")},r.prototype.null=function(){return this.verify(null===this.target,"null")},r.prototype.undefined=function(){return this.verify(void 0===this.target,"undefined")},r.prototype.empty=function(){return this.verify(null===this.target||void 0===this.target||""===this.target||this.isType("Array")&&0===this.target.length||this.isType("Object")&&!this.hasProperties(),"empty")},r.prototype.exists=function(){return this.verify(void 0!==this.target&&null!==this.target,"defined and non-null")},r.prototype.true=function(){return this.verify(!0===this.target,"true")},r.prototype.false=function(){return this.verify(!1===this.target,"false")},r.prototype.checkType=function(e){return this.verify(this.isType(e),"a "+e)},r.prototype.isType=function(e){return Object.prototype.toString.call(this.target)==="[object "+e+"]"},r.prototype.hasProperties=function(){for(var e in this.target)if(this.target.hasOwnProperty(e))return!0;return!1},r.prototype.verify=function(e,t){if(this.negated?e:!e){var i=this.baseName?"["+this.baseName+"] ":"",n=this.targetName?this.targetName+" ("+this.target+")":""+this.target;throw new Error(i+"Check failed: "+n+" was "+(this.negated?"":"not ")+t)}return this.target},r}(),n=i.of,r=i.check;t.of=n,t.check=r});e(c);c.of,c.check;var r,u,b=n(function(B,q){(function(){var e=this,t=e._,n=Array.prototype,s=Object.prototype,i=Function.prototype,r=n.push,l=n.slice,p=s.toString,o=s.hasOwnProperty,a=Array.isArray,c=Object.keys,u=i.bind,h=Object.create,d=function(){},f=function(e){return e instanceof f?e:this instanceof f?void(this._wrapped=e):new f(e)};B.exports&&(q=B.exports=f),(q._=f).VERSION='1.8.3';var y=function(r,o,e){if(void 0===o)return r;switch(null==e?3:e){case 1:return function(e){return r.call(o,e)};case 2:return function(e,t){return r.call(o,e,t)};case 3:return function(e,t,i){return r.call(o,e,t,i)};case 4:return function(e,t,i,n){return r.call(o,e,t,i,n)}}return function(){return r.apply(o,arguments)}},g=function(e,t,i){return null==e?f.identity:f.isFunction(e)?y(e,t,i):f.isObject(e)?f.matcher(e):f.property(e)};f.iteratee=function(e,t){return g(e,t,1/0)};var m=function(l,c){return function(e){var t=arguments.length;if(t<2||null==e)return e;for(var i=1;i<t;i++)for(var n=arguments[i],r=l(n),o=r.length,s=0;s<o;s++){var a=r[s];c&&void 0!==e[a]||(e[a]=n[a])}return e}},v=function(e){if(!f.isObject(e))return{};if(h)return h(e);d.prototype=e;var t=new d;return d.prototype=null,t},E=function(t){return function(e){return null==e?void 0:e[t]}},_=Math.pow(2,53)-1,S=E('length'),T=function(e){var t=S(e);return'number'==typeof t&&0<=t&&t<=_};function b(a){return function(e,t,i,n){t=y(t,n,4);var r=!T(e)&&f.keys(e),o=(r||e).length,s=0<a?0:o-1;return arguments.length<3&&(i=e[r?r[s]:s],s+=a),function(e,t,i,n,r,o){for(;0<=r&&r<o;r+=a){var s=n?n[r]:r;i=t(i,e[s],s,e)}return i}(e,t,i,r,s,o)}}f.each=f.forEach=function(e,t,i){var n,r;if(t=y(t,i),T(e))for(n=0,r=e.length;n<r;n++)t(e[n],n,e);else{var o=f.keys(e);for(n=0,r=o.length;n<r;n++)t(e[o[n]],o[n],e)}return e},f.map=f.collect=function(e,t,i){t=g(t,i);for(var n=!T(e)&&f.keys(e),r=(n||e).length,o=Array(r),s=0;s<r;s++){var a=n?n[s]:s;o[s]=t(e[a],a,e)}return o},f.reduce=f.foldl=f.inject=b(1),f.reduceRight=f.foldr=b(-1),f.find=f.detect=function(e,t,i){var n;if(void 0!==(n=T(e)?f.findIndex(e,t,i):f.findKey(e,t,i))&&-1!==n)return e[n]},f.filter=f.select=function(e,n,t){var r=[];return n=g(n,t),f.each(e,function(e,t,i){n(e,t,i)&&r.push(e)}),r},f.reject=function(e,t,i){return f.filter(e,f.negate(g(t)),i)},f.every=f.all=function(e,t,i){t=g(t,i);for(var n=!T(e)&&f.keys(e),r=(n||e).length,o=0;o<r;o++){var s=n?n[o]:o;if(!t(e[s],s,e))return!1}return!0},f.some=f.any=function(e,t,i){t=g(t,i);for(var n=!T(e)&&f.keys(e),r=(n||e).length,o=0;o<r;o++){var s=n?n[o]:o;if(t(e[s],s,e))return!0}return!1},f.contains=f.includes=f.include=function(e,t,i,n){return T(e)||(e=f.values(e)),('number'!=typeof i||n)&&(i=0),0<=f.indexOf(e,t,i)},f.invoke=function(e,i){var n=l.call(arguments,2),r=f.isFunction(i);return f.map(e,function(e){var t=r?i:e[i];return null==t?t:t.apply(e,n)})},f.pluck=function(e,t){return f.map(e,f.property(t))},f.where=function(e,t){return f.filter(e,f.matcher(t))},f.findWhere=function(e,t){return f.find(e,f.matcher(t))},f.max=function(e,n,t){var i,r,o=-1/0,s=-1/0;if(null==n&&null!=e)for(var a=0,l=(e=T(e)?e:f.values(e)).length;a<l;a++)i=e[a],o<i&&(o=i);else n=g(n,t),f.each(e,function(e,t,i){r=n(e,t,i),(s<r||r===-1/0&&o===-1/0)&&(o=e,s=r)});return o},f.min=function(e,n,t){var i,r,o=1/0,s=1/0;if(null==n&&null!=e)for(var a=0,l=(e=T(e)?e:f.values(e)).length;a<l;a++)(i=e[a])<o&&(o=i);else n=g(n,t),f.each(e,function(e,t,i){((r=n(e,t,i))<s||r===1/0&&o===1/0)&&(o=e,s=r)});return o},f.shuffle=function(e){for(var t,i=T(e)?e:f.values(e),n=i.length,r=Array(n),o=0;o<n;o++)(t=f.random(0,o))!==o&&(r[o]=r[t]),r[t]=i[o];return r},f.sample=function(e,t,i){return null==t||i?(T(e)||(e=f.values(e)),e[f.random(e.length-1)]):f.shuffle(e).slice(0,Math.max(0,t))},f.sortBy=function(e,n,t){return n=g(n,t),f.pluck(f.map(e,function(e,t,i){return{value:e,index:t,criteria:n(e,t,i)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(n<i||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index}),'value')};var I=function(s){return function(n,r,e){var o={};return r=g(r,e),f.each(n,function(e,t){var i=r(e,t,n);s(o,e,i)}),o}};f.groupBy=I(function(e,t,i){f.has(e,i)?e[i].push(t):e[i]=[t]}),f.indexBy=I(function(e,t,i){e[i]=t}),f.countBy=I(function(e,t,i){f.has(e,i)?e[i]++:e[i]=1}),f.toArray=function(e){return e?f.isArray(e)?l.call(e):T(e)?f.map(e,f.identity):f.values(e):[]},f.size=function(e){return null==e?0:T(e)?e.length:f.keys(e).length},f.partition=function(e,n,t){n=g(n,t);var r=[],o=[];return f.each(e,function(e,t,i){(n(e,t,i)?r:o).push(e)}),[r,o]},f.first=f.head=f.take=function(e,t,i){if(null!=e)return null==t||i?e[0]:f.initial(e,e.length-t)},f.initial=function(e,t,i){return l.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))},f.last=function(e,t,i){if(null!=e)return null==t||i?e[e.length-1]:f.rest(e,Math.max(0,e.length-t))},f.rest=f.tail=f.drop=function(e,t,i){return l.call(e,null==t||i?1:t)},f.compact=function(e){return f.filter(e,f.identity)};var w=function(e,t,i,n){for(var r=[],o=0,s=n||0,a=S(e);s<a;s++){var l=e[s];if(T(l)&&(f.isArray(l)||f.isArguments(l))){t||(l=w(l,t,i));var c=0,u=l.length;for(r.length+=u;c<u;)r[o++]=l[c++]}else i||(r[o++]=l)}return r};function R(o){return function(e,t,i){t=g(t,i);for(var n=S(e),r=0<o?0:n-1;0<=r&&r<n;r+=o)if(t(e[r],r,e))return r;return-1}}function C(o,s,a){return function(e,t,i){var n=0,r=S(e);if('number'==typeof i)0<o?n=0<=i?i:Math.max(i+r,n):r=0<=i?Math.min(i+1,r):i+r+1;else if(a&&i&&r)return e[i=a(e,t)]===t?i:-1;if(t!=t)return 0<=(i=s(l.call(e,n,r),f.isNaN))?i+n:-1;for(i=0<o?n:r-1;0<=i&&i<r;i+=o)if(e[i]===t)return i;return-1}}f.flatten=function(e,t){return w(e,t,!1)},f.without=function(e){return f.difference(e,l.call(arguments,1))},f.uniq=f.unique=function(e,t,i,n){f.isBoolean(t)||(n=i,i=t,t=!1),null!=i&&(i=g(i,n));for(var r=[],o=[],s=0,a=S(e);s<a;s++){var l=e[s],c=i?i(l,s,e):l;t?(s&&o===c||r.push(l),o=c):i?f.contains(o,c)||(o.push(c),r.push(l)):f.contains(r,l)||r.push(l)}return r},f.union=function(){return f.uniq(w(arguments,!0,!0))},f.intersection=function(e){for(var t=[],i=arguments.length,n=0,r=S(e);n<r;n++){var o=e[n];if(!f.contains(t,o)){for(var s=1;s<i&&f.contains(arguments[s],o);s++);s===i&&t.push(o)}}return t},f.difference=function(e){var t=w(arguments,!0,!0,1);return f.filter(e,function(e){return!f.contains(t,e)})},f.zip=function(){return f.unzip(arguments)},f.unzip=function(e){for(var t=e&&f.max(e,S).length||0,i=Array(t),n=0;n<t;n++)i[n]=f.pluck(e,n);return i},f.object=function(e,t){for(var i={},n=0,r=S(e);n<r;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},f.findIndex=R(1),f.findLastIndex=R(-1),f.sortedIndex=function(e,t,i,n){for(var r=(i=g(i,n,1))(t),o=0,s=S(e);o<s;){var a=Math.floor((o+s)/2);i(e[a])<r?o=a+1:s=a}return o},f.indexOf=C(1,f.findIndex,f.sortedIndex),f.lastIndexOf=C(-1,f.findLastIndex),f.range=function(e,t,i){null==t&&(t=e||0,e=0),i=i||1;for(var n=Math.max(Math.ceil((t-e)/i),0),r=Array(n),o=0;o<n;o++,e+=i)r[o]=e;return r};var P=function(e,t,i,n,r){if(!(n instanceof t))return e.apply(i,r);var o=v(e.prototype),s=e.apply(o,r);return f.isObject(s)?s:o};f.bind=function(e,t){if(u&&e.bind===u)return u.apply(e,l.call(arguments,1));if(!f.isFunction(e))throw new TypeError('Bind must be called on a function');var i=l.call(arguments,2),n=function(){return P(e,n,t,this,i.concat(l.call(arguments)))};return n},f.partial=function(r){var o=l.call(arguments,1),s=function(){for(var e=0,t=o.length,i=Array(t),n=0;n<t;n++)i[n]=o[n]===f?arguments[e++]:o[n];for(;e<arguments.length;)i.push(arguments[e++]);return P(r,s,this,this,i)};return s},f.bindAll=function(e){var t,i,n=arguments.length;if(n<=1)throw new Error('bindAll must be passed function names');for(t=1;t<n;t++)e[i=arguments[t]]=f.bind(e[i],e);return e},f.memoize=function(n,r){var o=function(e){var t=o.cache,i=''+(r?r.apply(this,arguments):e);return f.has(t,i)||(t[i]=n.apply(this,arguments)),t[i]};return o.cache={},o},f.delay=function(e,t){var i=l.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},f.defer=f.partial(f.delay,f,1),f.throttle=function(i,n,r){var o,s,a,l=null,c=0;r||(r={});var u=function(){c=!1===r.leading?0:f.now(),l=null,a=i.apply(o,s),l||(o=s=null)};return function(){var e=f.now();c||!1!==r.leading||(c=e);var t=n-(e-c);return o=this,s=arguments,t<=0||n<t?(l&&(clearTimeout(l),l=null),c=e,a=i.apply(o,s),l||(o=s=null)):l||!1===r.trailing||(l=setTimeout(u,t)),a}},f.debounce=function(t,i,n){var r,o,s,a,l,c=function(){var e=f.now()-a;e<i&&0<=e?r=setTimeout(c,i-e):(r=null,n||(l=t.apply(s,o),r||(s=o=null)))};return function(){s=this,o=arguments,a=f.now();var e=n&&!r;return r||(r=setTimeout(c,i)),e&&(l=t.apply(s,o),s=o=null),l}},f.wrap=function(e,t){return f.partial(t,e)},f.negate=function(e){return function(){return!e.apply(this,arguments)}},f.compose=function(){var i=arguments,n=i.length-1;return function(){for(var e=n,t=i[n].apply(this,arguments);e--;)t=i[e].call(this,t);return t}},f.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},f.before=function(e,t){var i;return function(){return 0<--e&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}},f.once=f.partial(f.before,2);var A=!{toString:null}.propertyIsEnumerable('toString'),O=['valueOf','isPrototypeOf','toString','propertyIsEnumerable','hasOwnProperty','toLocaleString'];function N(e,t){var i=O.length,n=e.constructor,r=f.isFunction(n)&&n.prototype||s,o='constructor';for(f.has(e,o)&&!f.contains(t,o)&&t.push(o);i--;)(o=O[i])in e&&e[o]!==r[o]&&!f.contains(t,o)&&t.push(o)}f.keys=function(e){if(!f.isObject(e))return[];if(c)return c(e);var t=[];for(var i in e)f.has(e,i)&&t.push(i);return A&&N(e,t),t},f.allKeys=function(e){if(!f.isObject(e))return[];var t=[];for(var i in e)t.push(i);return A&&N(e,t),t},f.values=function(e){for(var t=f.keys(e),i=t.length,n=Array(i),r=0;r<i;r++)n[r]=e[t[r]];return n},f.mapObject=function(e,t,i){t=g(t,i);for(var n,r=f.keys(e),o=r.length,s={},a=0;a<o;a++)s[n=r[a]]=t(e[n],n,e);return s},f.pairs=function(e){for(var t=f.keys(e),i=t.length,n=Array(i),r=0;r<i;r++)n[r]=[t[r],e[t[r]]];return n},f.invert=function(e){for(var t={},i=f.keys(e),n=0,r=i.length;n<r;n++)t[e[i[n]]]=i[n];return t},f.functions=f.methods=function(e){var t=[];for(var i in e)f.isFunction(e[i])&&t.push(i);return t.sort()},f.extend=m(f.allKeys),f.extendOwn=f.assign=m(f.keys),f.findKey=function(e,t,i){t=g(t,i);for(var n,r=f.keys(e),o=0,s=r.length;o<s;o++)if(t(e[n=r[o]],n,e))return n},f.pick=function(e,t,i){var n,r,o={},s=e;if(null==s)return o;f.isFunction(t)?(r=f.allKeys(s),n=y(t,i)):(r=w(arguments,!1,!1,1),n=function(e,t,i){return t in i},s=Object(s));for(var a=0,l=r.length;a<l;a++){var c=r[a],u=s[c];n(u,c,s)&&(o[c]=u)}return o},f.omit=function(e,t,i){if(f.isFunction(t))t=f.negate(t);else{var n=f.map(w(arguments,!1,!1,1),String);t=function(e,t){return!f.contains(n,t)}}return f.pick(e,t,i)},f.defaults=m(f.allKeys,!0),f.create=function(e,t){var i=v(e);return t&&f.extendOwn(i,t),i},f.clone=function(e){return f.isObject(e)?f.isArray(e)?e.slice():f.extend({},e):e},f.tap=function(e,t){return t(e),e},f.isMatch=function(e,t){var i=f.keys(t),n=i.length;if(null==e)return!n;for(var r=Object(e),o=0;o<n;o++){var s=i[o];if(t[s]!==r[s]||!(s in r))return!1}return!0};var M=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof f&&(e=e._wrapped),t instanceof f&&(t=t._wrapped);var r=p.call(e);if(r!==p.call(t))return!1;switch(r){case'[object RegExp]':case'[object String]':return''+e==''+t;case'[object Number]':return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case'[object Date]':case'[object Boolean]':return+e==+t}var o='[object Array]'===r;if(!o){if('object'!=typeof e||'object'!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(f.isFunction(s)&&s instanceof s&&f.isFunction(a)&&a instanceof a)&&'constructor'in e&&'constructor'in t)return!1}n=n||[];for(var l=(i=i||[]).length;l--;)if(i[l]===e)return n[l]===t;if(i.push(e),n.push(t),o){if((l=e.length)!==t.length)return!1;for(;l--;)if(!M(e[l],t[l],i,n))return!1}else{var c,u=f.keys(e);if(l=u.length,f.keys(t).length!==l)return!1;for(;l--;)if(c=u[l],!f.has(t,c)||!M(e[c],t[c],i,n))return!1}return i.pop(),n.pop(),!0};f.isEqual=function(e,t){return M(e,t)},f.isEmpty=function(e){return null==e||(T(e)&&(f.isArray(e)||f.isString(e)||f.isArguments(e))?0===e.length:0===f.keys(e).length)},f.isElement=function(e){return!(!e||1!==e.nodeType)},f.isArray=a||function(e){return'[object Array]'===p.call(e)},f.isObject=function(e){var t=typeof e;return'function'===t||'object'===t&&!!e},f.each(['Arguments','Function','String','Number','Date','RegExp','Error'],function(t){f['is'+t]=function(e){return p.call(e)==='[object '+t+']'}}),f.isArguments(arguments)||(f.isArguments=function(e){return f.has(e,'callee')}),'function'!=typeof/./&&'object'!=typeof Int8Array&&(f.isFunction=function(e){return'function'==typeof e||!1}),f.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},f.isNaN=function(e){return f.isNumber(e)&&e!==+e},f.isBoolean=function(e){return!0===e||!1===e||'[object Boolean]'===p.call(e)},f.isNull=function(e){return null===e},f.isUndefined=function(e){return void 0===e},f.has=function(e,t){return null!=e&&o.call(e,t)},f.noConflict=function(){return e._=t,this},f.identity=function(e){return e},f.constant=function(e){return function(){return e}},f.noop=function(){},f.property=E,f.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},f.matcher=f.matches=function(t){return t=f.extendOwn({},t),function(e){return f.isMatch(e,t)}},f.times=function(e,t,i){var n=Array(Math.max(0,e));t=y(t,i,1);for(var r=0;r<e;r++)n[r]=t(r);return n},f.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},f.now=Date.now||function(){return(new Date).getTime()};var L={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','`':'&#x60;'},k=f.invert(L),x=function(t){var i=function(e){return t[e]},e='(?:'+f.keys(t).join('|')+')',n=RegExp(e),r=RegExp(e,'g');return function(e){return e=null==e?'':''+e,n.test(e)?e.replace(r,i):e}};f.escape=x(L),f.unescape=x(k),f.result=function(e,t,i){var n=null==e?void 0:e[t];return void 0===n&&(n=i),f.isFunction(n)?n.call(e):n};var D=0;f.uniqueId=function(e){var t=++D+'';return e?e+t:t},f.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var U=/(.)^/,F={"'":"'",'\\':'\\','\r':'r','\n':'n','\u2028':'u2028','\u2029':'u2029'},H=/\\|'|\r|\n|\u2028|\u2029/g,W=function(e){return'\\'+F[e]};f.template=function(o,e,t){!e&&t&&(e=t),e=f.defaults({},e,f.templateSettings);var i=RegExp([(e.escape||U).source,(e.interpolate||U).source,(e.evaluate||U).source].join('|')+'|$','g'),s=0,a="__p+='";o.replace(i,function(e,t,i,n,r){return a+=o.slice(s,r).replace(H,W),s=r+e.length,t?a+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":i?a+="'+\n((__t=("+i+"))==null?'':__t)+\n'":n&&(a+="';\n"+n+"\n__p+='"),e}),a+="';\n",e.variable||(a='with(obj||{}){\n'+a+'}\n'),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+'return __p;\n';try{var n=new Function(e.variable||'obj','_',a)}catch(e){throw e.source=a,e}var r=function(e){return n.call(this,e,f)},l=e.variable||'obj';return r.source='function('+l+'){\n'+a+'}',r},f.chain=function(e){var t=f(e);return t._chain=!0,t};var V=function(e,t){return e._chain?f(t).chain():t};f.mixin=function(i){f.each(f.functions(i),function(e){var t=f[e]=i[e];f.prototype[e]=function(){var e=[this._wrapped];return r.apply(e,arguments),V(this,t.apply(f,e))}})},f.mixin(f),f.each(['pop','push','reverse','shift','sort','splice','unshift'],function(t){var i=n[t];f.prototype[t]=function(){var e=this._wrapped;return i.apply(e,arguments),'shift'!==t&&'splice'!==t||0!==e.length||delete e[0],V(this,e)}}),f.each(['concat','join','slice'],function(e){var t=n[e];f.prototype[e]=function(){return V(this,t.apply(this._wrapped,arguments))}}),f.prototype.value=function(){return this._wrapped},f.prototype.valueOf=f.prototype.toJSON=f.prototype.value,f.prototype.toString=function(){return''+this._wrapped}}).call(l)}),p=(b._,c.of("Objects")),I=function(){function s(){}return s.withDefault=function(e,t){return this.isNullOrUndefined(e)?t:e},s.exists=function(e){return null!=e},s.isNullOrUndefined=function(e){return null==e},s.isUndefined=function(e){return void 0===e},s.isPropertyNullOrUndefined=function(e,t){return p(t,"propertyName").exists(),this.isNullOrUndefined(e)||this.isNullOrUndefined(e[t])},s.nestedValue=function(e,t,i){var n;if(void 0===i&&(i=null),p(t,"keys").exists(),0===(n="string"==typeof t?t.split("."):t).length)return i;var r=b.reduce(n,function(e,t){return s.isNullOrUndefined(e)?null:e[t]},e);return s.isNullOrUndefined(r)?i:r},s.deepTraverse=function(e,t){for(var i in e)e.hasOwnProperty(i)&&(t(e,i,e[i]),s.exists(e[i])&&"object"==typeof e[i]&&s.deepTraverse(e[i],t))},s.deepExtend=function(e,t){if(s.isNullOrUndefined(t))return s.withDefault(b.clone(e),null);if(s.isNullOrUndefined(e))return b.clone(t);for(var i={},n=0,r=b.union(b.keys(e),b.keys(t));n<r.length;n++){var o=r[n];b.isUndefined(e[o])?i[o]=b.clone(t[o]):b.isObject(e[o])&&b.isObject(t[o])&&!b.isArray(e[o])&&!b.isArray(t[o])?i[o]=this.deepExtend(e[o],t[o]):i[o]=t.hasOwnProperty(o)?t[o]:e[o]}return i},s}(),h=function(){};(u=r||(r={}))[u.Crash=1]="Crash",u[u.Fatal=2]="Fatal",u[u.NonFatal=3]="NonFatal",u[u.Retriable=4]="Retriable",u[u.NoImpact=5]="NoImpact";var d,f,y,g,m=r,v=l&&l.__extends||(d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),E=c.of("AbortEvent"),_=function(o){function e(e,t,i,n){void 0===i&&(i=m.Fatal);var r=o.call(this)||this;return r.errorName=E(e,"errorName").exists(),E(t,"errorOrErrorMessage").exists(),r.errorName=e,r.errorSeverity=i,r.template=I.isUndefined(n)?null:n,t instanceof Error?(r.errorMessage=t.message,r.error=t):(r.errorMessage=t,r.error=null),r}return v(e,o),e.prototype.getErrorName=function(){return this.errorName},e.prototype.getErrorMessage=function(){return this.errorMessage},e.prototype.getErrorSeverity=function(){return this.errorSeverity},e.prototype.getTemplate=function(){return this.template},e.prototype.getError=function(){return this.error},e.toString=function(){return"abort"},e}(h),S=function(){function e(){}return e.toString=function(){return"aborted"},e}(),T=l&&l.__extends||(f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}f(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),w=c.of("AsinChangedEvent"),R=function(i){function e(e){var t=i.call(this)||this;return t.asin=w(e,"asin").exists(),t}return T(e,i),e.toString=function(){return"asinChanged"},e}(h);(g=y||(y={}))[g.CacheMiss=0]="CacheMiss",g[g.CachePartialHit=1]="CachePartialHit",g[g.CacheHit=2]="CacheHit";var C,P,A=y;(P=C||(C={}))[P.High=0]="High",P[P.Medium=1]="Medium",P[P.Low=2]="Low";var O,N,M,L=C,k=l&&l.__extends||(O=function(e,t){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}O(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.toString=function(){return"close"},t}(h);(M=N||(N={}))[M.Enabled=0]="Enabled",M[M.Auto=1]="Auto",M[M.Disabled=2]="Disabled";var D,U,F=N;(U=D||(D={}))[U.PostMessage=0]="PostMessage",U[U.Http=1]="Http";var H,W,V,B=D,q=l&&l.__extends||(H=function(e,t){return(H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}H(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return q(t,e),t.toString=function(){return"contentEnd"},t}(h);(V=W||(W={}))[V.volume=0]="volume";var z,G,Y,K,X,Q,J,Z,$,ee,te,ie,ne,re,oe,se=W,ae=l&&l.__extends||(z=function(e,t){return(z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}z(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ae(t,e),t.toString=function(){return"firstFrame"},t}(h),ce=l&&l.__extends||(G=function(e,t){return(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}G(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ce(t,e),t.toString=function(){return"initialized"},t}(h),pe=l&&l.__extends||(Y=function(e,t){return(Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Y(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),he=c.of("NotificationCancelEvent"),de=function(i){function e(e){var t=i.call(this)||this;return t.notification=he(e,"notification").exists(),t}return pe(e,i),e.prototype.getNotification=function(){return this.notification},e.toString=function(){return"notificationCancel"},e}(h),fe=l&&l.__extends||(K=function(e,t){return(K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}K(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ye=c.of("NotificationEvent"),ge=function(s){function e(e,t,i,n,r){void 0===i&&(i=!1),void 0===n&&(n=5);var o=s.call(this)||this;return o.messageTemplate=ye(e,"messageTemplate").exists(),o.expandedMessageTemplate=t,o.closable=i,o.displayTimeSeconds=n,o.onDontShowAgain=r,o}return fe(e,s),e.prototype.getMessageTemplate=function(){return this.messageTemplate},e.prototype.getExpandedMessageTemplate=function(){return this.expandedMessageTemplate},e.prototype.getClosable=function(){return this.closable},e.prototype.getDisplayTimeSeconds=function(){return this.displayTimeSeconds},e.prototype.getOnDontShowAgain=function(){return this.onDontShowAgain},e.toString=function(){return"notification"},e}(h),me=function(){},ve=l&&l.__extends||(X=function(e,t){return(X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}X(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ee=function(i){function e(e){var t=i.call(this)||this;return t.pinValidationStartTimeMs=e,t}return ve(e,i),e.prototype.getPinValidationStartTimeMs=function(){return this.pinValidationStartTimeMs},e.toString=function(){return"pinAccepted"},e}(me),_e=l&&l.__extends||(Q=function(e,t){return(Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Q(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _e(t,e),t.toString=function(){return"pinDeclined"},t}(me),Te=l&&l.__extends||(J=function(e,t){return(J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}J(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),be=function(i){function e(e){var t=i.call(this)||this;return t.errorName=e,t}return Te(e,i),e.prototype.getErrorName=function(){return this.errorName},e.toString=function(){return"pinError"},e}(me),Ie=l&&l.__extends||(Z=function(e,t){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Z(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),we=function(o){function e(e,t,i,n){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===n&&(n=!1);var r=o.call(this)||this;return r.pinLength=e,r.requiresPINSetup=t,r.hidePlayer=n,r.requiresAgeVerification=i,r}return Ie(e,o),e.prototype.getHidePlayer=function(){return this.hidePlayer},e.prototype.getPINLength=function(){return this.pinLength},e.prototype.getRequiresAgeVerification=function(){return this.requiresAgeVerification},e.prototype.getRequiresPINSetup=function(){return this.requiresPINSetup},e.toString=function(){return"pinRequired"},e}(me),Re=l&&l.__extends||($=function(e,t){return($=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}$(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Re(t,e),t.toString=function(){return"paused"},t}(h),Pe=l&&l.__extends||(ee=function(e,t){return(ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ee(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Ae=c.of("PlayerCapabilitiesEvent"),Oe=function(i){function e(e){var t=i.call(this)||this;return t.capabilities=Ae(e,"playerCapabilities").exists(),t}return Pe(e,i),e.toString=function(){return"playerCapabilities"},e}(h),Ne=l&&l.__extends||(te=function(e,t){return(te=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}te(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Me=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ne(t,e),t.toString=function(){return"playing"},t}(h),Le=l&&l.__extends||(ie=function(e,t){return(ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ie(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Le(t,e),t.toString=function(){return"prepared"},t}(h),xe=l&&l.__extends||(ne=function(e,t){return(ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ne(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),De=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return xe(t,e),t.toString=function(){return"stopping"},t}(h);(oe=re||(re={}))[oe.Feature=0]="Feature",oe[oe.Trailer=1]="Trailer",oe[oe.Live=2]="Live",oe[oe.External=3]="External",oe[oe.VideoAds=4]="VideoAds";var Ue={AbortEvent:_,AbortedEvent:S,AsinChangedEvent:R,CacheType:A,CachePriority:L,CloseEvent:x,DiagnosticsState:F,DiagnosticsProtocol:B,EndOfContentEvent:j,ErrorSeverity:m,Features:se,FirstFrameEvent:le,InitializedEvent:ue,NotificationCancelEvent:de,NotificationEvent:ge,PINAcceptedEvent:Ee,PINDeclinedEvent:Se,PINEvent:me,PINErrorEvent:be,PINRequiredEvent:we,PausedEvent:Ce,PlayerCapabilitiesEvent:Oe,PlayingEvent:Me,PreparedEvent:ke,StoppingEvent:De,VideoType:re,WebPlayerEvent:h},Fe=n(function(e,n){!function(e){var u=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(){this._events={},this._conf&&t.call(this,this._conf)}function t(e){e&&((this._conf=e).delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function i(e){this._events={},this.newListener=!1,t.call(this,e)}function y(e,t,i,n){if(!i)return[];var r,o,s,a,l,c,u,p=[],h=t.length,d=t[n],f=t[n+1];if(n===h&&i._listeners){if('function'==typeof i._listeners)return e&&e.push(i._listeners),[i];for(r=0,o=i._listeners.length;r<o;r++)e&&e.push(i._listeners[r]);return[i]}if('*'===d||'**'===d||i[d]){if('*'===d){for(s in i)'_listeners'!==s&&i.hasOwnProperty(s)&&(p=p.concat(y(e,t,i[s],n+1)));return p}if('**'===d){for(s in(u=n+1===h||n+2===h&&'*'===f)&&i._listeners&&(p=p.concat(y(e,t,i,h))),i)'_listeners'!==s&&i.hasOwnProperty(s)&&('*'===s||'**'===s?(i[s]._listeners&&!u&&(p=p.concat(y(e,t,i[s],h))),p=p.concat(y(e,t,i[s],n))):p=s===f?p.concat(y(e,t,i[s],n+2)):p.concat(y(e,t,i[s],n)));return p}p=p.concat(y(e,t,i[d],n+1))}if((a=i['*'])&&y(e,t,a,n+1),l=i['**'])if(n<h)for(s in l._listeners&&y(e,t,l,h),l)'_listeners'!==s&&l.hasOwnProperty(s)&&(s===f?y(e,t,l[s],n+2):s===d?y(e,t,l[s],n+1):((c={})[s]=l[s],y(e,t,{'**':c},n+1)));else l._listeners?y(e,t,l,h):l['*']&&l['*']._listeners&&y(e,t,l['*'],h);return p}i.prototype.delimiter='.',i.prototype.setMaxListeners=function(e){this._events||a.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},i.prototype.event='',i.prototype.once=function(e,t){return this.many(e,1,t),this},i.prototype.many=function(e,t,i){var n=this;if('function'!=typeof i)throw new Error('many only accepts instances of Function');function r(){0==--t&&n.off(e,r),i.apply(this,arguments)}return r._origin=i,this.on(e,r),n},i.prototype.emit=function(){this._events||a.call(this);var e,t=arguments[0];if('newListener'===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var i=arguments.length,n=new Array(i-1),r=1;r<i;r++)n[r-1]=arguments[r];for(r=0,i=this._all.length;r<i;r++)this.event=t,this._all[r].apply(this,n)}if('error'===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(this.wildcard){e=[];var o='string'==typeof t?t.split(this.delimiter):t.slice();y.call(this,e,o,this.listenerTree,0)}else e=this._events[t];if('function'==typeof e){if(this.event=t,1===arguments.length)e.call(this);else if(1<arguments.length)switch(arguments.length){case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,n=new Array(i-1),r=1;r<i;r++)n[r-1]=arguments[r];e.apply(this,n)}return!0}if(e){for(i=arguments.length,n=new Array(i-1),r=1;r<i;r++)n[r-1]=arguments[r];var s=e.slice();for(r=0,i=s.length;r<i;r++)this.event=t,s[r].apply(this,n);return 0<s.length||!!this._all}return!!this._all},i.prototype.on=function(e,t){if('function'==typeof e)return this.onAny(e),this;if('function'!=typeof t)throw new Error('on only accepts instances of Function');if(this._events||a.call(this),this.emit('newListener',e,t),this.wildcard)return function(e,t){for(var i=0,n=(e='string'==typeof e?e.split(this.delimiter):e.slice()).length;i+1<n;i++)if('**'===e[i]&&'**'===e[i+1])return;for(var r=this.listenerTree,o=e.shift();o;){if(r[o]||(r[o]={}),r=r[o],0===e.length){if(r._listeners){if('function'==typeof r._listeners)r._listeners=[r._listeners,t];else if(u(r._listeners)&&(r._listeners.push(t),!r._listeners.warned)){var s=10;void 0!==this._events.maxListeners&&(s=this._events.maxListeners),0<s&&r._listeners.length>s&&(r._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",r._listeners.length),console.trace())}}else r._listeners=t;return!0}o=e.shift()}return!0}.call(this,e,t),this;if(this._events[e]){if('function'==typeof this._events[e])this._events[e]=[this._events[e],t];else if(u(this._events[e])&&(this._events[e].push(t),!this._events[e].warned)){var i=10;void 0!==this._events.maxListeners&&(i=this._events.maxListeners),0<i&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=t;return this},i.prototype.onAny=function(e){if('function'!=typeof e)throw new Error('onAny only accepts instances of Function');return this._all||(this._all=[]),this._all.push(e),this},i.prototype.addListener=i.prototype.on,i.prototype.off=function(e,t){if('function'!=typeof t)throw new Error('removeListener only takes instances of Function');var i,n=[];if(this.wildcard){var r='string'==typeof e?e.split(this.delimiter):e.slice();n=y.call(this,null,r,this.listenerTree,0)}else{if(!this._events[e])return this;i=this._events[e],n.push({_listeners:i})}for(var o=0;o<n.length;o++){var s=n[o];if(i=s._listeners,u(i)){for(var a=-1,l=0,c=i.length;l<c;l++)if(i[l]===t||i[l].listener&&i[l].listener===t||i[l]._origin&&i[l]._origin===t){a=l;break}if(a<0)continue;return this.wildcard?s._listeners.splice(a,1):this._events[e].splice(a,1),0===i.length&&(this.wildcard?delete s._listeners:delete this._events[e]),this}(i===t||i.listener&&i.listener===t||i._origin&&i._origin===t)&&(this.wildcard?delete s._listeners:delete this._events[e])}return this},i.prototype.offAny=function(e){var t,i=0,n=0;if(e&&this._all&&0<this._all.length){for(i=0,n=(t=this._all).length;i<n;i++)if(e===t[i])return t.splice(i,1),this}else this._all=[];return this},i.prototype.removeListener=i.prototype.off,i.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||a.call(this),this;if(this.wildcard)for(var t='string'==typeof e?e.split(this.delimiter):e.slice(),i=y.call(this,null,t,this.listenerTree,0),n=0;n<i.length;n++){i[n]._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},i.prototype.listeners=function(e){if(this.wildcard){var t=[],i='string'==typeof e?e.split(this.delimiter):e.slice();return y.call(this,t,i,this.listenerTree,0),t}return this._events||a.call(this),this._events[e]||(this._events[e]=[]),u(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},i.prototype.listenersAny=function(){return this._all?this._all:[]},n.EventEmitter2=i}()}),He=(Fe.EventEmitter2,c.of("BasicEventEmitter")),We={BasicEventEmitter:function(){function e(){this.eventEmitter=new Fe.EventEmitter2}return e.prototype.on=function(e,t){var i=this.getKey(e);this.eventEmitter.on(i,t)},e.prototype.onAny=function(e){this.eventEmitter.onAny(e)},e.prototype.once=function(e,t){var i=this.getKey(e);this.eventEmitter.once(i,t)},e.prototype.many=function(e,t,i){var n=this.getKey(e);this.eventEmitter.many(n,t,i)},e.prototype.off=function(e,t){var i=this.getKey(e);this.eventEmitter.off(i,t)},e.prototype.offAny=function(e){this.eventEmitter.offAny(e)},e.prototype.emit=function(e,t){var i=this.getKey(e),n=void 0!==t?t:e;this.eventEmitter.emit(i,n)},e.prototype.getKey=function(e){return He(e,"eventType").exists(),He(e.toString,"toString").is.a.function(),e.toString()},e}()},Ve=n(function(u){!function(e){var i,a={};a.VERSION="1.4.1";var n={},t=function(e,t){return function(){return t.apply(e,arguments)}},r=function(){var e,t,i=arguments,n=i[0];for(t=1;t<i.length;t++)for(e in i[t])e in n||!i[t].hasOwnProperty(e)||(n[e]=i[t][e]);return n},o=function(e,t){return{value:e,name:t}};a.DEBUG=o(1,'DEBUG'),a.INFO=o(2,'INFO'),a.TIME=o(3,'TIME'),a.WARN=o(4,'WARN'),a.ERROR=o(8,'ERROR'),a.OFF=o(99,'OFF');var s=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};s.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},getLevel:function(){return this.context.filterLevel},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},debug:function(){this.invoke(a.DEBUG,arguments)},info:function(){this.invoke(a.INFO,arguments)},warn:function(){this.invoke(a.WARN,arguments)},error:function(){this.invoke(a.ERROR,arguments)},time:function(e){'string'==typeof e&&0<e.length&&this.invoke(a.TIME,[e,'start'])},timeEnd:function(e){'string'==typeof e&&0<e.length&&this.invoke(a.TIME,[e,'end'])},invoke:function(e,t){i&&this.enabledFor(e)&&i(t,r({level:e},this.context))}};var l,c=new s({filterLevel:a.OFF});(l=a).enabledFor=t(c,c.enabledFor),l.debug=t(c,c.debug),l.time=t(c,c.time),l.timeEnd=t(c,c.timeEnd),l.info=t(c,c.info),l.warn=t(c,c.warn),l.error=t(c,c.error),l.log=l.info,a.setHandler=function(e){i=e},a.setLevel=function(e){for(var t in c.setLevel(e),n)n.hasOwnProperty(t)&&n[t].setLevel(e)},a.getLevel=function(){return c.getLevel()},a.get=function(e){return n[e]||(n[e]=new s(r({name:e},c.context)))},a.createDefaultHandler=function(r){(r=r||{}).formatter=r.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var o={},s=function(e,t){Function.prototype.apply.call(e,console,t)};return"undefined"==typeof console?function(){}:function(e,t){e=Array.prototype.slice.call(e);var i,n=console.log;t.level===a.TIME?(i=(t.name?'['+t.name+'] ':'')+e[0],'start'===e[1]?console.time?console.time(i):o[i]=(new Date).getTime():console.timeEnd?console.timeEnd(i):s(n,[i+': '+((new Date).getTime()-o[i])+'ms'])):(t.level===a.WARN&&console.warn?n=console.warn:t.level===a.ERROR&&console.error?n=console.error:t.level===a.INFO&&console.info?n=console.info:t.level===a.DEBUG&&console.debug&&(n=console.debug),r.formatter(e,t),s(n,e))}},a.useDefaults=function(e){a.setLevel(e&&e.defaultLevel||a.DEBUG),a.setHandler(a.createDefaultHandler(e))},u.exports?u.exports=a:(a._prevLogger=e.Logger,a.noConflict=function(){return e.Logger=a._prevLogger,a},e.Logger=a)}(l)}),Be=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=Ve.get("Timer"),n=function(){function e(e,t){this.now=void 0!==Date.now?Date.now:function(){return(new Date).getTime()},this.metrics=e,this.metricName=t,this.startTime=this.now(),this.elapsedTime=null}return e.prototype.end=function(){if(null===this.elapsedTime){this.elapsedTime=this.now()-this.startTime;try{this.metrics.putMetric(this.metricName,this.elapsedTime,"ms")}catch(e){i.error("An error occurred while stopping the timer for metric "+this.metricName+": "+e.name+": "+e.message,e)}i.info(this.metricName+" was "+this.elapsedTime+" ms")}return this.elapsedTime},e}();t.Timer=n});e(Be);Be.Timer;var qe=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=Ve.get("Metrics"),i=function(){function e(){this.handler=function(){},this.flusher=function(){}}return e.prototype.setHandler=function(e){this.handler=e},e.prototype.setFlusher=function(e){this.flush(),this.flusher=e},e.prototype.putMetric=function(t,e,i){try{this.handler(t,e,i)}catch(e){n.error("An error occurred while publishing metric "+t+": "+e.name+": "+e.message,e)}},e.prototype.flush=function(){try{this.flusher()}catch(e){n.error("An error occurred while flushing metrics",e)}},e.prototype.startTimer=function(e){return new Be.Timer(this,e)},e}();t.Metrics=i});e(qe);qe.Metrics;var je=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=new qe.Metrics;t.metrics=i});e(je);je.metrics;var ze,Ge,Ye=function(){function t(){}return t.isClassic=function(e){switch(e){case t.DE:case t.JP:case t.UK:case t.US:return!0}return!1},t.ROE_EU="A3K6Y4MI8GDYMT",t.ROW_EU="A2MFUE2XK8ZSSY",t.ROW_FE="A15PK738MTQHSO",t.ROW_NA="ART4WZ8MWBX2Y",t.DE="A1PA6795UKMFR9",t.JP="A1VC38T7YXB528",t.UK="A1F83G8C2ARO7P",t.US="ATVPDKIKX0DER",t}(),Ke=function(){function i(){}return i.isAmazon=function(e,t){return void 0===t&&(t=window),e=null==e?t.location.hostname:e,i.AMAZON_REGEX.test(e)},i.fromMarketplaceId=function(e){switch(e){case Ye.DE:return i.DE;case Ye.JP:return i.JP;case Ye.UK:return i.UK;case Ye.ROE_EU:case Ye.ROW_EU:case Ye.ROW_FE:case Ye.ROW_NA:return i.PRIME_VIDEO;case Ye.US:return i.US;default:throw new Error("Can't get AmazonFQDN for unknown MarketplaceId! Received: "+e)}},i.AMAZON_REGEX=/((.*\.|^)amazon\..*|(.*\.|^)primevideo\..*)/,i.DE="www.amazon.de",i.JP="www.amazon.co.jp",i.UK="www.amazon.co.uk",i.US="www.amazon.com",i.PRIME_VIDEO="www.primevideo.com",i}(),Xe=function(){function e(){}return e.SILVERLIGHT_PC="A63V4FRV3YUP9",e.SILVERLIGHT_MAC="A2G17C9GWLWFKO",e.HTML5="AOAGZA014O5RE",e}(),Qe=function(){function e(){}return e.BACKSPACE=8,e.DELETE=46,e.ESC=27,e.SHIFT=16,e.SPACE=32,e.TAB=9,e.LEFT_ARROW=37,e.UP_ARROW=38,e.RIGHT_ARROW=39,e.DOWN_ARROW=40,e.START_OF_NUMBER=48,e.END_OF_NUMBER=57,e.START_OF_NUMPAD=96,e.END_OF_NUMPAD=105,e.A=65,e.C=67,e.F=70,e.M=77,e}(),Je=function(){function r(){}return r.fromMarketplaceId=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=window);var n=r.getDomain(e,t,i);return r.PROTOCOL+r.getSubdomain(e,n)+n},r.getDomain=function(e,t,i){if(t){var n=i.location.host.match(r.DOMAIN_REGEX);if(null!==n)return n[1];if(e===Ye.US&&null!==(n=i.location.host.match(r.IMDB_REGEX)))return n[1]}return r.getDomainFromMarketplaceId(e)},r.getSubdomain=function(e,t){if(t===r.IMDB_DOMAIN)return r.IMDB_SUBDOMAIN;switch(e){case Ye.ROW_NA:case Ye.US:return r.US_SUBDOMAIN;case Ye.ROE_EU:case Ye.ROW_EU:case Ye.UK:case Ye.DE:return r.EU_SUBDOMAIN;case Ye.ROW_FE:case Ye.JP:return r.JP_SUBDOMAIN;default:throw new Error("Can't get PartnerServiceEndpoint for unknown MarketplaceId! Received: "+e)}},r.getDomainFromMarketplaceId=function(e){switch(e){case Ye.ROW_NA:case Ye.ROE_EU:case Ye.ROW_EU:case Ye.ROW_FE:return".primevideo.com";case Ye.DE:return".amazon.de";case Ye.JP:return".amazon.co.jp";case Ye.UK:return".amazon.co.uk";default:return".amazon.com"}},r.EU_SUBDOMAIN="atv-ps-eu",r.JP_SUBDOMAIN="atv-ps-fe",r.US_SUBDOMAIN="atv-ps",r.IMDB_DOMAIN=".imdb.com",r.IMDB_SUBDOMAIN="primevideo-dp-na",r.DOMAIN_REGEX=/.*(\.(amazon|primevideo)\..*)/,r.IMDB_REGEX=/.*(\.imdb\.com)/,r.PROTOCOL="https://",r}(),Ze=function(){function e(){}return e.DiagnosticsEndpointKey="diagnostics_url",e}(),$e=function(){function e(){}return e.EXTRA_SMALL_SCREEN_MAX_WIDTH=479,e.SMALL_SCREEN_MIN_WIDTH=480,e.MEDIUM_SCREEN_MIN_WIDTH=640,e.LARGE_SCREEN_MIN_WIDTH=1200,e.EXTRA_LARGE_SCREEN_MIN_WIDTH=1921,e.SCALE_FACTOR_EXTRA_SMALL=1,e.SCALE_FACTOR_SMALL=100/e.SMALL_SCREEN_MIN_WIDTH,e.SCALE_FACTOR_MEDIUM=100/e.MEDIUM_SCREEN_MIN_WIDTH,e.SCALE_FACTOR_LARGE=100/e.LARGE_SCREEN_MIN_WIDTH,e.SCALE_FACTOR_EXTRA_LARGE=100/e.EXTRA_LARGE_SCREEN_MIN_WIDTH,e.SCREEN_EXTRA_SMALL_MEDIA_QUERY="(max-width: "+e.EXTRA_SMALL_SCREEN_MAX_WIDTH+"px)",e.SCREEN_SMALL_MEDIA_QUERY="(min-width: "+e.SMALL_SCREEN_MIN_WIDTH+"px)",e.SCREEN_MEDIUM_MEDIA_QUERY="(min-width: "+e.MEDIUM_SCREEN_MIN_WIDTH+"px)",e.SCREEN_LARGE_MEDIA_QUERY="(min-width: "+e.LARGE_SCREEN_MIN_WIDTH+"px)",e.SCREEN_EXTRA_LARGE_MEDIA_QUERY="(min-width: "+e.EXTRA_LARGE_SCREEN_MIN_WIDTH+"px)",e}(),et=function(){function e(){}return e.getActiveWeblabs=function(){return[e.ATV_WEB_PLAYER_OAUTH,e.DISABLE_SILVERLIGHT,e.HTML5_CAROUSEL,e.HTML5_CASCADES_MATURITY_RATING_OVERLAY,e.HTML5_ENABLE_SAFARI_STARTOVER,e.HTML5_HASTUR_MATURITY_RATING_IMAGE_BADGE,e.HTML5_HEVC,e.HTML5_NETWORK_SEED,e.HTML5_NETWORK_STATUS_TOAST,e.HTML5_PICTUREINPICTURE,e.HTML5_REMOVE_BUFFER_SIZE_RATIO,e.HTML5_SAFARI_CVBR,e.HTML5_XRAY_ENCODER_TIMESTAMP_WEBLAB,e.HASTUR_CHROMIUM,e.HASTUR_EDGE,e.HASTUR_IE,e.HASTUR_SAFARI,e.LIVE_LOW_LATENCY_CHROME,e.LIVE_LOW_LATENCY_CHROMIUM,e.LIVE_LOW_LATENCY_EDGENEXT,e.LIVE_LOW_LATENCY_FIREFOX,e.LIVE_LOW_LATENCY_FIREFOX64,e.LIVE_LOW_LATENCY_OPERA]},e.ATV_WEB_PLAYER_OAUTH="ATV_WEB_PLAYER_OAUTH_74228",e.DISABLE_SILVERLIGHT="AIV_WEB_PLAYER_DISABLE_SILVERLIGHT_91138",e.HTML5_CAROUSEL="AIV_HTML5_MIRO_CAROUSEL_196734",e.HTML5_CASCADES_MATURITY_RATING_OVERLAY="AIV_HTML5_CASCADES_MATURITY_RATING_OVERLAY_356780",e.HTML5_ENABLE_SAFARI_STARTOVER="HTML5_ENABLE_SAFARI_STARTOVER_228094",e.HTML5_HASTUR_MATURITY_RATING_IMAGE_BADGE="AIV_HTML5_HASTUR_MATURITY_RATING_IMAGE_BADGE_353779",e.HTML5_HEVC="AIV_HTML5_HEVC_79711",e.HTML5_NETWORK_SEED="AIV_HTML5_NETWORK_SEED_95840",e.HTML5_NETWORK_STATUS_TOAST="AIV_HTML5_NETWORK_STATUS_TOAST_98636",e.HTML5_PICTUREINPICTURE="AIV_HTML5_PICTUREINPICTURE_LAUNCH_309146",e.HTML5_REMOVE_BUFFER_SIZE_RATIO="AIV_HTML5_REMOVE_BUFFER_SIZE_RATIO_99314",e.HTML5_SAFARI_CVBR="AIV_HTML5_SAFARI_CVBR_93874",e.HTML5_XRAY_ENCODER_TIMESTAMP_WEBLAB="AIV_XRAY_LIVE_ENCODER_TIMESTAMP_241326",e.HASTUR_CHROMIUM="AIV_HTML5_HASTUR_LAUNCH_CHROMIUM_227119",e.HASTUR_EDGE="AIV_HTML5_HASTUR_LAUNCH_EDGE_227134",e.HASTUR_IE="AIV_HTML5_HASTUR_LAUNCH_IE_227137",e.HASTUR_SAFARI="AIV_HTML5_HASTUR_LAUNCH_SAFARI_227138",e.HASTUR_CHROMEOS="AIV_HTML5_HASTUR_LAUNCH_CHROMEOS_257480",e.HASTUR_LINUX="AIV_HTML5_HASTUR_LAUNCH_LINUX_257479",e.LIVE_LOW_LATENCY_CHROME="AIV_HTML5_LIVE_LOW_LATENCY_CHROME_242583",e.LIVE_LOW_LATENCY_CHROMIUM="AIV_HTML5_LIVE_LOW_LATENCY_CHROMIUM_242584",e.LIVE_LOW_LATENCY_EDGENEXT="AIV_HTML5_LIVE_LOW_LATENCY_EDGENEXT_306349",e.LIVE_LOW_LATENCY_FIREFOX="AIV_HTML5_LIVE_LOW_LATENCY_FIREFOX_242581",e.LIVE_LOW_LATENCY_FIREFOX64="AIV_HTML5_LIVE_LOW_LATENCY_FIREFOX64_242582",e.LIVE_LOW_LATENCY_OPERA="AIV_HTML5_LIVE_LOW_LATENCY_OPERA_242580",e}();(Ge=ze||(ze={}))[Ge.C=0]="C",Ge[Ge.T1=1]="T1",Ge[Ge.T2=2]="T2",Ge[Ge.T3=3]="T3",Ge[Ge.T4=4]="T4",Ge[Ge.T5=5]="T5",Ge[Ge.T6=6]="T6",Ge[Ge.T7=7]="T7",Ge[Ge.T8=8]="T8",Ge[Ge.T9=9]="T9",Ge[Ge.T10=10]="T10",Ge[Ge.T11=11]="T11",Ge[Ge.T12=12]="T12",Ge[Ge.T13=13]="T13",Ge[Ge.T14=14]="T14",Ge[Ge.T15=15]="T15",Ge[Ge.T16=16]="T16",Ge[Ge.T17=17]="T17",Ge[Ge.T18=18]="T18",Ge[Ge.T19=19]="T19",Ge[Ge.T20=20]="T20";var tt={AmazonFQDN:Ke,DeviceTypeId:Xe,KeyCode:Qe,MarketplaceID:Ye,PartnerServiceEndpoint:Je,StorageKeys:Ze,Styling:$e,Weblabs:et,WeblabTreatment:ze},it=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=window),this.windowRef=e}return e.prototype.setImmediate=function(e){return this.windowRef.setImmediate(e)},e.prototype.clearImmediate=function(e){this.windowRef.clearImmediate(e)},e.isSupported=function(e){return void 0===e&&(e=window),null!=e&&b.isFunction(e.setImmediate)&&b.isFunction(e.clearImmediate)},e}();t.ImmediateComponentDirect=i});e(it);it.ImmediateComponentDirect;var nt=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function o(e,t){void 0===e&&(e=window),void 0===t&&(t="setImmediate-"+Math.random());var n=this;this.pendingHandlers={},this.nextId=1,this.onPostMessage=function(e){if(b.isString(e.data)&&0===e.data.indexOf(n.messageIdentifier)){var t=parseInt(e.data.substr(n.messageIdentifier.length)),i=n.pendingHandlers[t];null!=i&&(n.clearImmediate(t),i())}},this.windowRef=e,this.messageIdentifier=t;var i=e.location,r=i.port?":"+i.port:"";this.origin=this.isOriginValid(i.origin)?i.origin:i.protocol+"//"+i.hostname+r,e.addEventListener(o.MESSAGE_EVENT,this.onPostMessage)}return o.prototype.setImmediate=function(e){return b.isFunction(e)&&(this.pendingHandlers[this.nextId]=e,this.windowRef.postMessage(this.messageIdentifier+this.nextId,this.origin)),this.nextId++},o.prototype.clearImmediate=function(e){delete this.pendingHandlers[e]},o.isSupported=function(e){return void 0===e&&(e=window),null!=e&&b.isFunction(e.postMessage)&&b.isFunction(e.addEventListener)},o.prototype.isOriginValid=function(e){return null!=e&&-1!==e.indexOf("://")},o.MESSAGE_EVENT="message",o}();t.ImmediateComponentPostMessage=i});e(nt);nt.ImmediateComponentPostMessage;var rt=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=window),this.windowRef=e}return e.prototype.setImmediate=function(e){return this.windowRef.setTimeout(e,0)},e.prototype.clearImmediate=function(e){this.windowRef.clearTimeout(e)},e.isSupported=function(e){return void 0===e&&(e=window),null!=e&&b.isFunction(e.setTimeout)&&b.isFunction(e.clearTimeout)},e}();t.ImmediateComponentTimeout=i});e(rt);rt.ImmediateComponentTimeout;var ot=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=Ve.get("ImmediateComponentPromise"),i=function(){function e(e){void 0===e&&(e=window);var r=this;this.lastId=0,this.pendingIdMap={},this.pendingImmediate=!1,this.onNextMicrotask=function(){var e=r.pendingIdMap;r.pendingIdMap={},r.pendingImmediate=!1;for(var t=0,i=Object.keys(e);t<i.length;t++){var n=i[t];try{e[n]()}catch(e){o.warn("Unhandled handler exception",e)}}},this.promiseRef=e.Promise}return e.prototype.setImmediate=function(e){var t=this.lastId++;return this.pendingIdMap[t]=e,this.pendingImmediate||(this.pendingImmediate=!0,this.promiseRef.resolve().then(this.onNextMicrotask)),t},e.prototype.clearImmediate=function(e){delete this.pendingIdMap[e]},e.isSupported=function(e){return null!=e&&null!=e.Promise},e}();t.ImmediateComponentPromise=i});e(ot);ot.ImmediateComponentPromise;var st=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===e&&(e=[ot.ImmediateComponentPromise,it.ImmediateComponentDirect,nt.ImmediateComponentPostMessage,rt.ImmediateComponentTimeout]),void 0===t&&(t=window),this.windowRef=t;var i=b.find(e,function(e){return e.isSupported(t)});if(null==i)throw Error("No supported immediate component type");this.immediateComponent=new i}return e.prototype.setTimeout=function(e,t){return this.windowRef.setTimeout(e,t)},e.prototype.clearTimeout=function(e){this.windowRef.clearTimeout(e)},e.prototype.setInterval=function(e,t){return this.windowRef.setInterval(e,t)},e.prototype.clearInterval=function(e){this.windowRef.clearInterval(e)},e.prototype.setImmediate=function(e){return this.immediateComponent.setImmediate(e)},e.prototype.clearImmediate=function(e){this.immediateComponent.clearImmediate(e)},e}();t.Timer=i});e(st);st.Timer;var at=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=new st.Timer;t.timer=i});e(at);at.timer;var lt=je.metrics,ct=Fe.EventEmitter2,ut=Ve.get("EventEmitter"),pt=function(){function i(e,t,i){void 0===t&&(t=null),void 0===i&&(i=at.timer),this.eventEmitter=null===t?new ct(e):t,this.timer=i}return i.prototype.emit=function(t,e){try{this.eventEmitter.emit(this.getEventString(t),e)}catch(e){ut.error("An error occurred in a listener for the '"+t+"' event: "+e.name+": "+e.message,e),lt.putMetric(i.UNHANDLED_EVENT_LISTENER_ERROR_METRIC)}},i.prototype.emitAsync=function(e,t){var i=this;this.timer.setImmediate(function(){return i.emit(e,t)})},i.prototype.many=function(e,t,i){this.eventEmitter.many(this.getEventString(e),t,i)},i.prototype.off=function(e,t){this.eventEmitter.off(this.getEventString(e),t)},i.prototype.offAny=function(e){this.eventEmitter.offAny(e)},i.prototype.on=function(e,t){this.eventEmitter.on(this.getEventString(e),t)},i.prototype.onAny=function(e){this.eventEmitter.onAny(e)},i.prototype.once=function(e,t){this.eventEmitter.once(this.getEventString(e),t)},i.prototype.removeAllListeners=function(e){void 0===e&&(e=null),null===e?this.eventEmitter.removeAllListeners():this.eventEmitter.removeAllListeners(this.getEventString(e))},i.prototype.setMaxListeners=function(e){this.eventEmitter.setMaxListeners(e)},i.prototype.listeners=function(e){return this.eventEmitter.listeners(this.getEventString(e))},i.prototype.listenersAny=function(){return this.eventEmitter.listenersAny()},i.prototype.getEventString=function(e){return""+e},i.UNHANDLED_EVENT_LISTENER_ERROR_METRIC="UnhandledEventListenerError",i}(),ht=je.metrics,dt=c.of("MulticastCallback"),ft=Ve.get("MulticastCallback"),yt=function(){function r(){this.callbacks=[]}return r.prototype.add=function(e){dt(e,"callback").exists(),this.callbacks=b.union(this.callbacks,[e])},r.prototype.remove=function(e){dt(e,"callback").exists(),this.callbacks=b.without(this.callbacks,e)},r.prototype.removeAll=function(){this.callbacks=[]},r.prototype.invoke=function(e){for(var t=0,i=this.callbacks;t<i.length;t++){var n=i[t];try{n(e)}catch(e){ft.error("An error occurred in a callback",e),ht.putMetric(r.UNHANDLED_EVENT_LISTENER_ERROR_METRIC)}}},r.UNHANDLED_EVENT_LISTENER_ERROR_METRIC="UnhandledEventListenerError",r}(),gt=c.of("MultiplexedEventSource"),mt=(Ve.get("MultiplexedEventSource"),{EventEmitter:pt,MulticastCallback:yt,MultiplexedEventSource:function(){function e(e){void 0===e&&(e=!1),this.sources=[],this.allListeners=[],this.bufferedCallbacks=[],this.bufferInactiveEvents=e}return e.prototype.selectSource=function(t){gt(t,"id").exists();var e=b.find(this.sources,function(e){return e.id===t});gt(e,"entry with id "+t).exists(),this.active=e.source,this.reEmitEventsForSourceId(t)},e.prototype.addSource=function(t,i){var n=this;gt(t,"id").exists(),gt(i,"source").exists();var e=b.find(this.sources,function(e){return e.id===t});gt(e,"source with id "+t).not.exists(),this.sources.push({id:t,source:i}),b.each(this.allListeners,function(e){n.listenDownstream(t,i,e)})},e.prototype.removeSource=function(t){var i=this;gt(t,"id").exists();var e=b.partition(this.sources,function(e){return e.id===t});gt(e[0],"source with id "+t).is.not.empty(),this.sources=e[1];var n=e[0][0];b.each(this.allListeners,function(e){i.unlistenDownstream(t,n.source,e)}),this.active===n.source&&(this.active=null)},e.prototype.on=function(e,t){gt(e,"event").exists(),gt(t,"callback").is.a.function();var i={event:e,callback:t,downstreamListeners:[]};this.allListeners.push(i),this.listenAllDownstreams(i)},e.prototype.off=function(t,i){gt(t,"event").exists(),gt(i,"callback").is.a.function();var e=b.findIndex(this.allListeners,function(e){return e.event===t&&e.callback===i});if(-1!==e){var n=this.allListeners[e];this.allListeners.splice(e,1),b.each(n.downstreamListeners,function(e){e.source.off(n.event,e.callback)})}},e.prototype.listenAllDownstreams=function(t){var i=this;b.each(this.sources,function(e){i.listenDownstream(e.id,e.source,t)})},e.prototype.listenDownstream=function(n,r,o){var s=this,e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=function(){return o.callback.apply(s,e)};s.active===r?i():s.bufferInactiveEvents&&s.bufferCallbackForId(n,i)};o.downstreamListeners.push({source:r,callback:e}),r.on(o.event,e)},e.prototype.unlistenDownstream=function(e,t,i){i.downstreamListeners=b.reject(i.downstreamListeners,function(e){return e.source===t&&(t.off(i.event,e.callback),!0)});var n=this.getBufferedCallbacksForId(e);I.exists(n)&&(n.callbacks=[])},e.prototype.bufferCallbackForId=function(e,t){var i=this.getBufferedCallbacksForId(e);I.isNullOrUndefined(i)&&(i={id:e,callbacks:[]},this.bufferedCallbacks.push(i)),i.callbacks.push(t)},e.prototype.reEmitEventsForSourceId=function(e){if(this.bufferInactiveEvents){var t=this.getBufferedCallbacksForId(e);if(I.exists(t)&&!b.isEmpty(t.callbacks)){for(var i=0,n=t.callbacks;i<n.length;i++){(0,n[i])()}t.callbacks=[]}}},e.prototype.getBufferedCallbacksForId=function(t){return b.find(this.bufferedCallbacks,function(e){return e.id===t})},e}()}),vt=mt.EventEmitter,Et="change",_t={BasicStore:function(){function e(e){void 0===e&&(e=new vt),this.value=null,this.eventEmitter=e}return e.prototype.getValue=function(){return this.value},e.prototype.setValue=function(e){return this.value=e,this},e.prototype.commit=function(){this.eventEmitter.emitAsync(Et)},e.prototype.onChange=function(e){this.eventEmitter.on(Et,e)},e.prototype.offChange=function(e){this.eventEmitter.off(Et,e)},e.prototype.onceChange=function(e){this.eventEmitter.once(Et,e)},e}(),MergingStore:function(){function e(e,t,i){var n=this;this.defaultStore=e,this.backingStore=t,this.mergeFunction=i,this.defaultStore.onChange(function(){n.commit()})}return e.prototype.getValue=function(){return this.mergeFunction(this.defaultStore.getValue(),this.backingStore.getValue())},e.prototype.setValue=function(e){return this.backingStore.setValue(e),this},e.prototype.commit=function(){this.backingStore.commit()},e.prototype.onChange=function(e){this.backingStore.onChange(e)},e.prototype.offChange=function(e){this.backingStore.offChange(e)},e.prototype.onceChange=function(e){this.backingStore.onceChange(e)},e}()},St=n(function(e,l){var o={};o.hexTable=new Array(256);for(var t=0;t<256;++t)o.hexTable[t]='%'+((t<16?'0':'')+t.toString(16)).toUpperCase();l.arrayToObject=function(e,t){for(var i=t.plainObjects?Object.create(null):{},n=0,r=e.length;n<r;++n)void 0!==e[n]&&(i[n]=e[n]);return i},l.merge=function(e,t,i){if(!t)return e;if('object'!=typeof t)return Array.isArray(e)?e.push(t):'object'==typeof e?e[t]=!0:e=[e,t],e;if('object'!=typeof e)return e=[e].concat(t);Array.isArray(e)&&!Array.isArray(t)&&(e=l.arrayToObject(e,i));for(var n=Object.keys(t),r=0,o=n.length;r<o;++r){var s=n[r],a=t[s];Object.prototype.hasOwnProperty.call(e,s)?e[s]=l.merge(e[s],a,i):e[s]=a}return e},l.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g,' '))}catch(e){return t}},l.encode=function(e){if(0===e.length)return e;'string'!=typeof e&&(e=''+e);for(var t='',i=0,n=e.length;i<n;++i){var r=e.charCodeAt(i);45===r||46===r||95===r||126===r||48<=r&&r<=57||65<=r&&r<=90||97<=r&&r<=122?t+=e[i]:r<128?t+=o.hexTable[r]:r<2048?t+=o.hexTable[192|r>>6]+o.hexTable[128|63&r]:r<55296||57344<=r?t+=o.hexTable[224|r>>12]+o.hexTable[128|r>>6&63]+o.hexTable[128|63&r]:(++i,r=65536+((1023&r)<<10|1023&e.charCodeAt(i)),t+=o.hexTable[240|r>>18]+o.hexTable[128|r>>12&63]+o.hexTable[128|r>>6&63]+o.hexTable[128|63&r])}return t},l.compact=function(e,t){if('object'!=typeof e||null===e)return e;var i=(t=t||[]).indexOf(e);if(-1!==i)return t[i];if(t.push(e),Array.isArray(e)){for(var n=[],r=0,o=e.length;r<o;++r)void 0!==e[r]&&n.push(e[r]);return n}var s=Object.keys(e);for(r=0,o=s.length;r<o;++r){var a=s[r];e[a]=l.compact(e[a],t)}return e},l.isRegExp=function(e){return'[object RegExp]'===Object.prototype.toString.call(e)},l.isBuffer=function(e){return null!=e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}}),Tt=(St.arrayToObject,St.merge,St.decode,St.encode,St.compact,St.isRegExp,St.isBuffer,{delimiter:'&',depth:5,arrayLimit:20,parameterLimit:1e3,strictNullHandling:!1,plainObjects:!1,allowPrototypes:!1,allowDots:!1,parseValues:function(e,t){for(var i={},n=e.split(t.delimiter,t.parameterLimit===1/0?void 0:t.parameterLimit),r=0,o=n.length;r<o;++r){var s=n[r],a=-1===s.indexOf(']=')?s.indexOf('='):s.indexOf(']=')+1;if(-1===a)i[St.decode(s)]='',t.strictNullHandling&&(i[St.decode(s)]=null);else{var l=St.decode(s.slice(0,a)),c=St.decode(s.slice(a+1));Object.prototype.hasOwnProperty.call(i,l)?i[l]=[].concat(i[l]).concat(c):i[l]=c}}return i},parseObject:function(e,t,i){if(!e.length)return t;var n,r=e.shift();if('[]'===r)n=(n=[]).concat(Tt.parseObject(e,t,i));else{n=i.plainObjects?Object.create(null):{};var o='['===r[0]&&']'===r[r.length-1]?r.slice(1,r.length-1):r,s=parseInt(o,10),a=''+s;!isNaN(s)&&r!==o&&a===o&&0<=s&&i.parseArrays&&s<=i.arrayLimit?(n=[])[s]=Tt.parseObject(e,t,i):n[o]=Tt.parseObject(e,t,i)}return n},parseKeys:function(e,t,i){if(e){i.allowDots&&(e=e.replace(/\.([^\.\[]+)/g,'[$1]'));var n=/(\[[^\[\]]*\])/g,r=/^([^\[\]]*)/.exec(e),o=[];if(r[1]){if(!i.plainObjects&&Object.prototype.hasOwnProperty(r[1])&&!i.allowPrototypes)return;o.push(r[1])}for(var s=0;null!==(r=n.exec(e))&&s<i.depth;)++s,(i.plainObjects||!Object.prototype.hasOwnProperty(r[1].replace(/\[|\]/g,''))||i.allowPrototypes)&&o.push(r[1]);return r&&o.push('['+e.slice(r.index)+']'),Tt.parseObject(o,t,i)}}}),bt=function(e,t){if((t=t||{}).delimiter='string'==typeof t.delimiter||St.isRegExp(t.delimiter)?t.delimiter:Tt.delimiter,t.depth='number'==typeof t.depth?t.depth:Tt.depth,t.arrayLimit='number'==typeof t.arrayLimit?t.arrayLimit:Tt.arrayLimit,t.parseArrays=!1!==t.parseArrays,t.allowDots='boolean'==typeof t.allowDots?t.allowDots:Tt.allowDots,t.plainObjects='boolean'==typeof t.plainObjects?t.plainObjects:Tt.plainObjects,t.allowPrototypes='boolean'==typeof t.allowPrototypes?t.allowPrototypes:Tt.allowPrototypes,t.parameterLimit='number'==typeof t.parameterLimit?t.parameterLimit:Tt.parameterLimit,t.strictNullHandling='boolean'==typeof t.strictNullHandling?t.strictNullHandling:Tt.strictNullHandling,''===e||null==e)return t.plainObjects?Object.create(null):{};for(var i='string'==typeof e?Tt.parseValues(e,t):e,n=t.plainObjects?Object.create(null):{},r=Object.keys(i),o=0,s=r.length;o<s;++o){var a=r[o],l=Tt.parseKeys(a,i[a],t);n=St.merge(n,l,t)}return St.compact(n)},It=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=c.of("QueryString"),i=function(){function n(){}return n.getParameter=function(e,t){r(e,"name").exists();var i=n.getQueryString(t);return i.hasOwnProperty(e)?i[e]:null},n.getQueryString=function(e){if(null==e){if(void 0===location||void 0===location.search)return{};e=location.search}try{var t=bt(e.replace(/^\?/,""));return n.parseStrings(t)}catch(e){return{}}},n.parseStrings=function(e){if(b.isString(e)){if(/^true$/i.test(e))return!0;if(/^false$/i.test(e))return!1;if(/^null$/i.test(e))return null;if(/^undefined$/i.test(e))return;return/^\d+$/.test(e)?parseInt(e,10):e}if(b.isArray(e)||b.isObject(e)){var t=b.isArray(e)?[]:{};for(var i in e)e.hasOwnProperty(i)&&(t[i]=this.parseStrings(e[i]));return t}return e},n}();t.QueryString=i});e(It);It.QueryString;var wt,Rt,Ct=function(){function e(){}return e.prototype.fatalErrorOccurred=function(e){},e.prototype.nonFatalErrorOccurred=function(e){},e.prototype.appLoadStarted=function(){},e.prototype.appLoadCompleted=function(){return 0},e.prototype.playerInitializationStarted=function(){},e.prototype.playerInitializationCompleted=function(){},e.prototype.contentPreparationStarted=function(e,t){},e.prototype.contentPreparationSucceeded=function(){},e.prototype.contentPreparationFailed=function(){},e.prototype.playbackInitiated=function(e){},e.prototype.playbackStarted=function(e){return 0},e.prototype.pinDialogDisplayed=function(){},e.prototype.pinSubmitted=function(){},e.prototype.pinAccepted=function(){},e.prototype.pinDeclined=function(){},e.prototype.seekInitiated=function(){},e.prototype.seekCompleted=function(){},e.prototype.nextTitlePlaybackInitiated=function(){},e.prototype.hdToggled=function(e){},e.prototype.manifestDownloadStarted=function(){},e.prototype.manifestDownloaded=function(){},e.prototype.bufferingStarted=function(e,t){},e.prototype.bufferingComplete=function(e){},e.prototype.reportInitialBufferCompleted=function(e){},e.prototype.prepareClickstream=function(e,t){},e.prototype.clickstreamNextTitle=function(){},e.prototype.clickstreamPlaybackStarted=function(e){},e.prototype.reportClickstream=function(e){},e.prototype.fullScreenToggled=function(e,t,i){},e.prototype.prePlaybackModalStarted=function(e){},e.prototype.prePlaybackModalClosed=function(e){},e}();(Rt=wt||(wt={}))[Rt.Ad=0]="Ad",Rt[Rt.Main=1]="Main";var Pt,At,Ot,Nt=wt,Mt=c.of("AmazonUrlCreator"),Lt=function(){function o(e,t,i){void 0===i&&(i=window),this.marketplaceId=null,this.csUrlPathMap=null,this.marketplaceId=Mt(e,"marketplaceId").exists(),this.csUrlPathMap=Mt(t,"csUrlPathMap").exists(),this.windowRef=Mt(i,"windowRef").exists()}return o.prototype.createCSUrl=function(e){Mt(this.csUrlPathMap[e],"csUrlPathMap[csUrlPathKey]").exists();var t=this.windowRef.location.hostname,i=t,n=this.csUrlPathMap[e][i];(b.isNull(n)||b.isUndefined(n))&&(t=Ke.fromMarketplaceId(this.marketplaceId),i=this.marketplaceId);var r=this.csUrlPathMap[e][i];return(b.isNull(r)||b.isUndefined(r))&&(i=o.DEFAULT_ID),t+this.csUrlPathMap[e][i]},o.prototype.createDetailPageUrl=function(e){var t=this.windowRef.location.hostname;return Ke.isAmazon(t,this.windowRef)||(t=Ke.fromMarketplaceId(this.marketplaceId)),t+o.DETAIL_PAGE_BASE+e},o.DEFAULT_ID="*",o.DETAIL_PAGE_BASE="/dp/",o}(),kt=Ve.get("CookieStorage"),xt=function(){function e(e){void 0===e&&(e=document),this.document=e}return e.prototype.get=function(t){try{if(b.isUndefined(this.document.cookie)||b.isNull(this.document.cookie))return kt.warn("Cookie is unavailable."),null;var e=b.map(this.document.cookie.split(";"),function(e){return e.split("=")}),i=b.find(e,function(e){return e[0].trim()===t});return b.isUndefined(i)||b.isNull(i)?(kt.warn("Cannot find key "+t+" in storage"),null):(i.shift(),decodeURIComponent(i.join("=")))}catch(e){return kt.warn("Failed to retrieve key "+t+" from storage",e),null}},e}(),Dt=function(){function e(){}return e.getPlayerSize=function(e,t,i){return void 0===i&&(i=1),{width:e*i,height:t*i}},e}(),Ut=c.of("DOMUtils"),Ft=function(){function e(){}return e.getAttributeOrThrow=function(e,t){Ut(e,"element").exists(),Ut(t,"attribute").exists();var i=e.getAttribute(t);if(null===i)throw new Error("Unable to get attribute '"+t+"'");return i},e.querySelectOrThrow=function(e,t){Ut(e,"element").exists(),Ut(t,"query").exists();var i=e.querySelector(t);if(null===i)throw new Error("Unable to querySelect '"+t+"'");return i},e.querySelectAllOrThrow=function(e,t){Ut(e,"element").exists(),Ut(t,"query").exists();var i=e.querySelectorAll(t);if(null===i||0===i.length)throw new Error("Unable to querySelectAll '"+t+"'");return i},e.getAttributesInNamespace=function(e,t){var i=[];if(t+=":",e.hasAttributes())for(var n=0;n<e.attributes.length;n++)e.attributes[n].name.substr(0,t.length)===t&&i.push(e.attributes[n].name);return i},e.getAttributeWithoutNamespace=function(e){var t=e.match(/.*:(.*)/);return null===t||t.length<2?e:t[1]},e}(),Ht=Ve.get("EnumUtils"),Wt=function(){function e(){}return e.getEnumValue=function(t,e){if(null==t)return null;if(!b.isString(t))return Ht.warn("Value must be a string but was "+t),null;if(b.isEmpty(t))return Ht.warn("Value cannot be an empty string"),null;var i=[];for(var n in e)b.isNumber(e[n])&&i.push(n);var r=b.find(i,function(e){return e.toLowerCase()===t.toLowerCase()});return null==r?(Ht.warn("Value must be one of ["+i.join(",")+"], but was "+t),null):e[r]},e}(),Vt=function(){function e(e){this.ephemeralIds=[],this.logger=Ve.get(e)}return e.prototype.setLevel=function(e){this.logger.setLevel(e)},e.prototype.enabledFor=function(e){return this.logger.enabledFor(e)},e.prototype.log=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];(e=this.logger).log.apply(e,[this.getId()].concat(t))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.info=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];(e=this.logger).info.apply(e,[this.getId()].concat(t))},e.prototype.warn=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];(e=this.logger).warn.apply(e,[this.getId()].concat(t))},e.prototype.error=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];(e=this.logger).error.apply(e,[this.getId()].concat(t))},e.prototype.setId=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.ephemeralIds=e},e.prototype.getId=function(){return b.map(this.ephemeralIds,function(e){return"["+e+"]"}).join(" ")},e}(),Bt=c.of("HTMLElementUtils"),qt=function(){function t(){}return t.addClass=function(e,t){if(void 0!==e.className){var i=e.className.split(" ");void 0===b.find(i,function(e){return e===t})&&(e.className+=" "+t)}},t.removeClass=function(e,t){if(void 0!==e.className){var i=e.className.split(" ");void 0!==b.find(i,function(e){return e===t})&&(i=b.filter(i,function(e){return e!==t}),e.className=i.join(" "))}},t.getElementsByClassName=function(e,t){return b.isUndefined(e.getElementsByClassName)?e.querySelectorAll("."+t):e.getElementsByClassName(t)},t.clickedInElement=function(e,t){Bt(e,"element").exists(),Bt(t,"event").exists();var i=e.getBoundingClientRect();return i.left<t.clientX&&i.left+e.offsetWidth>t.clientX&&i.top<t.clientY&&i.top+e.offsetHeight>t.clientY},t.isScrollable=function(e){return e.scrollHeight>e.offsetHeight+t.SCROLLABLE_MARGIN_OF_ERROR_PX},t.SCROLLABLE_MARGIN_OF_ERROR_PX=1,t}(),jt="(\\d|[1-9]\\d|1\\d\\d|2([0-4]\\d|5[0-5]))",zt=new RegExp("^"+jt+"\\."+jt+"\\."+jt+"\\."+jt+"$"),Gt=function(){function e(){}return e.isValidIPv4Address=function(e){return zt.test(e)},e}(),Yt=Ve.get("WebStorage"),Kt=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.storage=e,this.namespace=t}return e.prototype.set=function(e,t){if(null!==this.storage){var i=this.getNamespacedKey(e);try{this.storage.setItem(i,t)}catch(e){Yt.warn("Failed to save key "+i+" to storage",e)}}else Yt.warn("Storage is unavailable.")},e.prototype.get=function(e){if(null===this.storage)return Yt.warn("Storage is unavailable."),null;var t=this.getNamespacedKey(e);try{var i=this.storage.getItem(t);return null!=i||null!=this.namespace&&null!=(i=this.storage.getItem(e))&&this.set(e,i),i}catch(e){return Yt.warn("Failed to retrieve key "+t+" from storage",e),null}},e.prototype.remove=function(e){if(null!==this.storage){var t=this.getNamespacedKey(e);try{this.storage.removeItem(t)}catch(e){Yt.warn("Failed to remove key "+t+" from storage",e)}}else Yt.warn("Storage is unavailable.")},e.prototype.removeAll=function(){if(null!==this.storage)try{this.storage.clear()}catch(e){Yt.warn("Failed to clear storage",e)}else Yt.warn("Storage is unavailable.")},e.prototype.getNamespacedKey=function(e){return null!=this.namespace?""+this.namespace+e:e},e}(),Xt=l&&l.__extends||(Pt=function(e,t){return(Pt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Pt(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Qt=function(t){function e(e){return void 0===e&&(e=window),t.call(this,void 0===e.localStorage?null:e.localStorage,"atvwebplayersdk_")||this}return Xt(e,t),e}(Kt),Jt=function(){function e(e){this.EXTENSION_REGEX=/(?:\.([^.]+))?$/,this.timeoutMillis=12e4,0<e&&(this.timeoutMillis=e)}return e.prototype.acquire=function(e,t){var i=this.getFileExtension(e);if("js"===i)this.acquireJavaScript(e,t);else{if("css"!==i)throw new Error("Unable to acquire non-JavaScript or CSS resource: "+e);this.acquireCSS(e,t)}},e.prototype.getFileExtension=function(e){return this.EXTENSION_REGEX.exec(e)[1]},e.prototype.acquireJavaScript=function(t,i){var e=this,n=document.createElement("script"),r=null,o=function(e){clearTimeout(r),n&&(n.onload=n.onerror=null),"function"==typeof i&&i(e)};r=setTimeout(function(){o(new Error("Timed out acquiring resource after "+e.timeoutMillis+"ms: "+t))},this.timeoutMillis),n.src=t,n.onload=function(){o()},n.onerror=function(e){o(new Error("Error acquiring resource (probably doesn't exist): "+t))},document.getElementsByTagName("head")[0].appendChild(n)},e.prototype.acquireCSS=function(e,t){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(i),"function"==typeof t&&t()},e}(),Zt=l&&l.__extends||(At=function(e,t){return(At=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}At(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),$t=function(i){function e(e){void 0===e&&(e=window);var t=e.sessionStorage;return void 0===t&&(t=null),i.call(this,t)||this}return Zt(e,i),e}(Kt),ei=c.of("ThrottledEventListener"),ti=function(){function e(){var e=this;this.callback=null,this.listenerType=null,this.eventTarget=null,this.pollingInterval=null,this.executeThrottledEvent=function(){e.eventTarget.removeEventListener(e.listenerType,e.executeThrottledEvent),setTimeout(function(){e.callback(),e.eventTarget.addEventListener(e.listenerType,e.executeThrottledEvent)},e.pollingInterval)}}return e.prototype.attachThrottledListener=function(e,t,i,n){ei(e,"eventTarget").exists(),ei(t,"listenerType").exists(),this.eventTarget=e,this.listenerType=t,this.pollingInterval=i,this.callback=n,e.addEventListener(t,this.executeThrottledEvent)},e.prototype.removeThrottledListener=function(){null!==this.eventTarget&&(this.eventTarget.removeEventListener(this.listenerType,this.executeThrottledEvent),this.eventTarget=null,this.listenerType=null,this.pollingInterval=null,this.callback=null)},e}(),ii=!1;try{var ni=new URL('b','http://a');ni.pathname='c%20d',ii='http://a/c%20d'===ni.href}catch(e){}if(ii)Ot=URL;else{var ri=Object.create(null);ri.ftp=21,ri.file=0,ri.gopher=70,ri.http=80,ri.https=443,ri.ws=80,ri.wss=443;var oi=Object.create(null);oi['%2e']='.',oi['.%2e']='..',oi['%2e.']='..',oi['%2e%2e']='..';var si=function(e){return void 0!==ri[e]},ai=function(){fi.call(this),this._isInvalid=!0},li=function(e){return''==e&&ai.call(this),e.toLowerCase()},ci=function(e){var t=e.charCodeAt(0);return 32<t&&t<127&&-1==[34,35,60,62,63,96].indexOf(t)?e:encodeURIComponent(e)},ui=void 0,pi=/[a-zA-Z]/,hi=/[a-zA-Z0-9\+\-\.]/,di=function(e,t,i){var n,r,o=t||'scheme start',s=0,a='',l=!1,c=!1;e:for(;(e[s-1]!=ui||0==s)&&!this._isInvalid;){var u=e[s];switch(o){case'scheme start':if(!u||!pi.test(u)){if(t)break e;a='',o='no scheme';continue}a+=u.toLowerCase(),o='scheme';break;case'scheme':if(u&&hi.test(u))a+=u.toLowerCase();else{if(':'!=u){if(t){if(ui==u)break e;break e}a='',s=0,o='no scheme';continue}if(this._scheme=a,a='',t)break e;si(this._scheme)&&(this._isRelative=!0),o='file'==this._scheme?'relative':this._isRelative&&i&&i._scheme==this._scheme?'relative or authority':this._isRelative?'authority first slash':'scheme data'}break;case'scheme data':'?'==u?(this._query='?',o='query'):'#'==u?(this._fragment='#',o='fragment'):ui!=u&&'\t'!=u&&'\n'!=u&&'\r'!=u&&(this._schemeData+=ci(u));break;case'no scheme':if(i&&si(i._scheme)){o='relative';continue}ai.call(this);break;case'relative or authority':if('/'!=u||'/'!=e[s+1]){o='relative';continue}o='authority ignore slashes';break;case'relative':if(this._isRelative=!0,'file'!=this._scheme&&(this._scheme=i._scheme),ui==u){this._host=i._host,this._port=i._port,this._path=i._path.slice(),this._query=i._query,this._username=i._username,this._password=i._password;break e}if('/'==u||'\\'==u)o='relative slash';else if('?'==u)this._host=i._host,this._port=i._port,this._path=i._path.slice(),this._query='?',this._username=i._username,this._password=i._password,o='query';else{if('#'!=u){var p=e[s+1],h=e[s+2];('file'!=this._scheme||!pi.test(u)||':'!=p&&'|'!=p||ui!=h&&'/'!=h&&'\\'!=h&&'?'!=h&&'#'!=h)&&(this._host=i._host,this._port=i._port,this._username=i._username,this._password=i._password,this._path=i._path.slice(),this._path.pop()),o='relative path';continue}this._host=i._host,this._port=i._port,this._path=i._path.slice(),this._query=i._query,this._fragment='#',this._username=i._username,this._password=i._password,o='fragment'}break;case'relative slash':if('/'!=u&&'\\'!=u){'file'!=this._scheme&&(this._host=i._host,this._port=i._port,this._username=i._username,this._password=i._password),o='relative path';continue}o='file'==this._scheme?'file host':'authority ignore slashes';break;case'authority first slash':if('/'!=u){o='authority ignore slashes';continue}o='authority second slash';break;case'authority second slash':if(o='authority ignore slashes','/'!=u)continue;break;case'authority ignore slashes':if('/'!=u&&'\\'!=u){o='authority';continue}break;case'authority':if('@'==u){l&&(a+='%40'),l=!0;for(var d=0;d<a.length;d++){var f=a[d];if('\t'!=f&&'\n'!=f&&'\r'!=f)if(':'!=f||null!==this._password){var y=ci(f);null!==this._password?this._password+=y:this._username+=y}else this._password=''}a=''}else{if(ui==u||'/'==u||'\\'==u||'?'==u||'#'==u){s-=a.length,a='',o='host';continue}a+=u}break;case'file host':if(ui==u||'/'==u||'\\'==u||'?'==u||'#'==u){2!=a.length||!pi.test(a[0])||':'!=a[1]&&'|'!=a[1]?(0==a.length||(this._host=li.call(this,a),a=''),o='relative path start'):o='relative path';continue}'\t'==u||'\n'==u||'\r'==u||(a+=u);break;case'host':case'hostname':if(':'!=u||c){if(ui==u||'/'==u||'\\'==u||'?'==u||'#'==u){if(this._host=li.call(this,a),a='',o='relative path start',t)break e;continue}'\t'!=u&&'\n'!=u&&'\r'!=u&&('['==u?c=!0:']'==u&&(c=!1),a+=u)}else if(this._host=li.call(this,a),a='',o='port','hostname'==t)break e;break;case'port':if(/[0-9]/.test(u))a+=u;else{if(ui==u||'/'==u||'\\'==u||'?'==u||'#'==u||t){if(''!=a){var g=parseInt(a,10);g!=ri[this._scheme]&&(this._port=g+''),a=''}if(t)break e;o='relative path start';continue}'\t'==u||'\n'==u||'\r'==u||ai.call(this)}break;case'relative path start':if(o='relative path','/'!=u&&'\\'!=u)continue;break;case'relative path':var m;if(ui!=u&&'/'!=u&&'\\'!=u&&(t||'?'!=u&&'#'!=u))'\t'!=u&&'\n'!=u&&'\r'!=u&&(a+=ci(u));else(m=oi[a.toLowerCase()])&&(a=m),'..'==a?(this._path.pop(),'/'!=u&&'\\'!=u&&this._path.push('')):'.'==a&&'/'!=u&&'\\'!=u?this._path.push(''):'.'!=a&&('file'==this._scheme&&0==this._path.length&&2==a.length&&pi.test(a[0])&&'|'==a[1]&&(a=a[0]+':'),this._path.push(a)),a='','?'==u?(this._query='?',o='query'):'#'==u&&(this._fragment='#',o='fragment');break;case'query':t||'#'!=u?ui!=u&&'\t'!=u&&'\n'!=u&&'\r'!=u&&(this._query+=(void 0,32<(r=(n=u).charCodeAt(0))&&r<127&&-1==[34,35,60,62,96].indexOf(r)?n:encodeURIComponent(n))):(this._fragment='#',o='fragment');break;case'fragment':ui!=u&&'\t'!=u&&'\n'!=u&&'\r'!=u&&(this._fragment+=u)}s++}},fi=function(){this._scheme='',this._schemeData='',this._username='',this._password=null,this._host='',this._port='',this._path=[],this._query='',this._fragment='',this._isInvalid=!1,this._isRelative=!1};if((Ot=function(e,t){void 0===t||t instanceof Ot||(t=new Ot(String(t))),this._url=e,fi.call(this);var i=e.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,'');di.call(this,i,null,t)}).prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var e='';return''==this._username&&null==this._password||(e=this._username+(null!=this._password?':'+this._password:'')+'@'),this.protocol+(this._isRelative?'//'+e+this.host:'')+this.pathname+this._query+this._fragment},set href(e){fi.call(this),di.call(this,e)},get protocol(){return this._scheme+':'},set protocol(e){this._isInvalid||di.call(this,e+':','scheme start')},get host(){return this._isInvalid?'':this._port?this._host+':'+this._port:this._host},set host(e){!this._isInvalid&&this._isRelative&&di.call(this,e,'host')},get hostname(){return this._host},set hostname(e){!this._isInvalid&&this._isRelative&&di.call(this,e,'hostname')},get port(){return this._port},set port(e){!this._isInvalid&&this._isRelative&&di.call(this,e,'port')},get pathname(){return this._isInvalid?'':this._isRelative?'/'+this._path.join('/'):this._schemeData},set pathname(e){!this._isInvalid&&this._isRelative&&(this._path=[],di.call(this,e,'relative path start'))},get search(){return this._isInvalid||!this._query||'?'==this._query?'':this._query},set search(e){!this._isInvalid&&this._isRelative&&((this._query='?')==e[0]&&(e=e.slice(1)),di.call(this,e,'query'))},get hash(){return this._isInvalid||!this._fragment||'#'==this._fragment?'':this._fragment},set hash(e){this._isInvalid||((this._fragment='#')==e[0]&&(e=e.slice(1)),di.call(this,e,'fragment'))},get origin(){var e;if(this._isInvalid||!this._scheme)return'';switch(this._scheme){case'data':case'file':case'javascript':case'mailto':return'null'}return(e=this.host)?this._scheme+'://'+e:''}},"undefined"!=typeof URL){var yi=URL;yi&&(Ot.createObjectURL=function(e){return yi.createObjectURL.apply(yi,arguments)},Ot.revokeObjectURL=function(e){yi.revokeObjectURL(e)})}}var gi,mi,vi=Ot,Ei=function(){function e(){}return e.prototype.decode=function(e){for(var t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),i=[],n=0;n<t.length;){var r=0,o=0,s=t[n++];if(240==(248&s))r=3,o=7&s;else if(224==(240&s))r=2,o=15&s;else if(192==(224&s))r=1,o=31&s;else{if(0!=(128&s))throw new TypeError("Failed to decode value: "+s.toString(16));r=0,o=127&s}for(;0<r&&n<t.length;)o<<=6,o|=63&t[n++],r--;if(0<r)throw new TypeError("Failed to decode value");if(65536<=o){var a=56320|1023&(o-=65536),l=55296|o>>10&1023;i.push(String.fromCharCode(l,a))}else i.push(String.fromCharCode(o))}return i.join("")},e}(),_i="undefined"!=typeof TextDecoder?function(){return new TextDecoder("utf-8")}:Ei,Si=c.of("Version"),Ti="unknown",bi={AmazonUrlCreator:Lt,CookieStorage:xt,Display:Dt,DOMUtils:Ft,EnumUtils:Wt,EphemeralJSLogger:Vt,HTMLElementUtils:qt,IPAddress:Gt,LocalStorage:Qt,ResourceAcquirer:Jt,SessionStorage:$t,ThrottledEventListener:ti,URL:vi,Utf8TextDecoder:_i,Version:function(){function t(e,t){Si(e,"segments").exists(),Si(0<e.length,"length > 0").is.true(),Si(t,"str").exists(),this.segments=e,this.str=t}return t.fromNumber=function(e){return Si(e,"version").exists(),new t([e],e.toString())},t.fromString=function(e){return Si(e,"version").exists(),new t(t.split(e),e)},t.createUnknownVersion=function(){return t.fromString(Ti)},t.prototype.isUnknownVersion=function(){return this.str===Ti},t.prototype.toString=function(){return this.str},t.prototype.equals=function(e){return 0===this.compareTo(e)},t.prototype.compareTo=function(e){if(this===e)return 0;if(b.isUndefined(e)||b.isNull(e))return 1;if(this.str===Ti&&e.str===Ti)return 0;for(var t=Math.min(this.segments.length,e.segments.length),i=0;i<t;i++){if(this.segments[i]<e.segments[i])return-1;if(this.segments[i]>e.segments[i])return 1}return this.isGreaterThanZero(e.segments.slice(this.segments.length))?-1:this.isGreaterThanZero(this.segments.slice(e.segments.length))?1:0},t.prototype.isGreaterThanZero=function(e){for(var t=0;t<e.length;t++)if(b.isString(e[t])&&0<e[t].length||b.isNumber(e[t])&&0<e[t])return!0},t.split=function(e){return b.map(e.toLowerCase().match(/\d+|[a-z]+/g),function(e){return/^\d+$/.test(e)?parseInt(e):e})},t}()};(mi=gi||(gi={})).GET="GET",mi.POST="POST",mi.PUT="PUT",mi.DELETE="DELETE",mi.HEAD="HEAD",mi.OPTIONS="OPTIONS";var Ii,wi,Ri=gi;(wi=Ii||(Ii={}))[wi.TIMEOUT=0]="TIMEOUT",wi[wi.INTERVAL=1]="INTERVAL",wi[wi.CLEAR=2]="CLEAR";var Ci=Ii,Pi=n(function(e){var i=Ve.get("WebWorkerBasedTimerClient"),t=function(){function e(){var n=this;this.callbackMap={},this.lastId=0,this.worker=null,this.onMessage=function(e){var t=e.data,i=n.callbackMap[t.id];b.isFunction(i)&&i(),t.type===Ci.TIMEOUT&&delete n.callbackMap[t.id]}}return e.prototype.initialize=function(e){if(b.isUndefined(e))try{var t=new Blob(["!function e(t,r,i){function n(o,a){if(!r[o]){if(!t[o]){var u=\"function\"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var c=new Error(\"Cannot find module '\"+o+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var f=r[o]={exports:{}};t[o][0].call(f.exports,function(e){var r=t[o][1][e];return n(r?r:e)},f,f.exports,e,t,r,i)}return r[o].exports}for(var s=\"function\"==typeof require&&require,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(e,t,r){\"use strict\";var i;!function(e){e[e.TIMEOUT=0]=\"TIMEOUT\",e[e.INTERVAL=1]=\"INTERVAL\",e[e.CLEAR=2]=\"CLEAR\"}(i||(i={})),t.exports=i},{}],2:[function(e,t,r){\"use strict\";var i=e(1),n=function(){function e(e){var t=this;this.timerMap={},this.onMessage=function(e){var r=e.data;r.type===i.CLEAR?t.clearTimer(r.id):r.type===i.INTERVAL?t.setWorkerInterval(r):r.type===i.TIMEOUT?t.setWorkerTimeout(r):console.warn(\"Received unknown message \"+r)},this.clearTimer=function(e){var t=this.timerMap[e];try{clearTimeout(t)}catch(r){clearInterval(t)}delete this.timerMap[e]},this.sendMessage=function(e){t.postMessageOverride?t.postMessageOverride(e):postMessage(e)},this.setWorkerTimeout=function(e){var t=this,r=setTimeout(function(){t.sendMessage(e),delete t.timerMap[e.id]},e.timeout);this.timerMap[e.id]=r},this.setWorkerInterval=function(e){var t=this,r=setInterval(function(){t.sendMessage(e)},e.timeout);this.timerMap[e.id]=r},this.postMessageOverride=e}return e}();t.exports=n},{1:1}],3:[function(e,t,r){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var i=e(2),n=new i;onmessage=n.onMessage},{2:2}]},{},[3]);"],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(t))}catch(e){i.warn("Unable to create a WebWorkerTimer, failing over to window timers.")}else this.worker=e;null!==this.worker&&this.worker.addEventListener("message",this.onMessage)},e.prototype.setTimeout=function(e,t){return this.setTimer(e,t,Ci.TIMEOUT)},e.prototype.setInterval=function(e,t){return this.setTimer(e,t,Ci.INTERVAL)},e.prototype.clearTimeout=function(e){this.clearTimer(e)},e.prototype.clearInterval=function(e){this.clearTimer(e)},e.prototype.clearTimer=function(t){if(this.worker)delete this.callbackMap[t],this.worker.postMessage({type:Ci.CLEAR,id:t});else try{clearTimeout(t)}catch(e){clearInterval(t)}},e.prototype.setTimer=function(e,t,i){if(this.worker){var n={type:i,id:++this.lastId,timeout:t};return this.callbackMap[n.id]=e,this.worker.postMessage(n),n.id}return i===Ci.INTERVAL?setInterval(e,t):i===Ci.TIMEOUT?setTimeout(e,t):void 0},e}();e.exports=t});e(Pi);var Ai=new Pi;Ai.initialize();var Oi,Ni,Mi=Ai,Li=function(){function r(e,t,i,n,r,o,s,a){var l=this;this.sizeBytes=0,this.status=e,this.headers={},Object.keys(t).forEach(function(e){l.headers[e.toLowerCase()]=t[e]}),this.arrayBuffer=i,this.blob=n,this.text=r,this.document=o,this.latencyMs=s.latencyMs,this.downloadMs=s.downloadMs,this.totalMs=s.totalMs,this.responseUrl=a;var c=parseInt(this.getHeader("Content-Length"));I.isNullOrUndefined(this.arrayBuffer)?b.isNaN(c)?this.sizeBytes=s.loadedBytes:this.sizeBytes=c:this.sizeBytes=this.arrayBuffer.byteLength}return r.createFromXMLHttpRequest=function(e,t){var i=r.parseHeaders(e.getAllResponseHeaders()),n=null;switch(b.isUndefined(e.responseURL)||(n=e.responseURL),I.withDefault(e.responseType,"").toLowerCase()){case"arraybuffer":return new r(e.status,i,e.response,null,null,null,t,n);case"blob":return new r(e.status,i,null,e.response,null,null,t,n);case"document":return new r(e.status,i,null,null,null,e.response,t,n);default:return new r(e.status,i,null,null,e.responseText,null,t,n)}},r.prototype.getStatus=function(){return this.status},r.prototype.getHeader=function(e){var t=this.headers[e.toLowerCase()];return b.isUndefined(t)?null:t},r.prototype.getHeaders=function(){return b.clone(this.headers)},r.prototype.getArrayBuffer=function(){return this.arrayBuffer},r.prototype.getBlob=function(){return this.blob},r.prototype.getText=function(){return this.text},r.prototype.getDocument=function(){return this.document},r.prototype.getLatencyMs=function(){return this.latencyMs},r.prototype.getDownloadMs=function(){return this.downloadMs},r.prototype.getTotalMs=function(){return this.totalMs},r.prototype.getResponseUrl=function(){return this.responseUrl},r.prototype.getMetrics=function(){return{requestStarted:!0,responseReceived:!0,loadedBytes:this.sizeBytes,totalBytes:this.sizeBytes,latencyMs:this.latencyMs,downloadMs:this.downloadMs,totalMs:this.totalMs}},r.parseHeaders=function(e){var i={};return e.split(/\r?\n/).forEach(function(e){var t=r.HEADER_REGEX.exec(e);t&&(i[t[1]]=t[2])}),i},r.HEADER_REGEX=/^\s*(.+?)\s*:\s*(.+?)\s*$/,r}();(Ni=Oi||(Oi={}))[Ni.ArrayBuffer=0]="ArrayBuffer",Ni[Ni.Blob=1]="Blob",Ni[Ni.Text=2]="Text",Ni[Ni.Document=3]="Document";var ki,xi,Di=Oi;(xi=ki||(ki={}))[xi.DEFAULT=1]="DEFAULT",xi[xi.LATENCY=2]="LATENCY";var Ui=ki,Fi=c.of("KeyValuePair"),Hi=function(){function e(e,t){this.key=Fi(e,"key").exists(),this.value=Fi(t,"value").exists()}return e.toUriEncodedString=function(e){return b.map(e,function(e){return e.toUriEncodedString()}).join("&")},e.toWwwFormUrlEncodedString=function(e){return b.map(e,function(e){return e.toWwwFormUrlEncodedString()}).join("&")},e.prototype.toUriEncodedString=function(){return encodeURIComponent(this.key)+"="+encodeURIComponent(this.value)},e.prototype.toWwwFormUrlEncodedString=function(){return this.encodeWwwFormUrlComponent(this.key)+"="+this.encodeWwwFormUrlComponent(this.value)},e.prototype.encodeWwwFormUrlComponent=function(e){return encodeURIComponent(e).replace(/%20/g,"+")},e}(),Wi=c.of("HttpRequest"),Vi=function(){function t(e,t,i,n){void 0===i&&(i=window.performance),this.queryString=null,this.xhrData=null,this.xhrFields=[],this.xhrRequestHeaders={},this.xhrResponseType=null,this.xhrTimeout=0,this.xhrWithCredentials=!1,this.latencyTimeoutId=null,this.latencyTimeoutMs=0,this.startTime=null,this.delayMs=0,this.delayTimeoutId=null,this.sent=!1,this.isAborted=!1,this.abortXhr=null,this.loadCallbacks=[],this.errorCallbacks=[],this.timeoutCallbacks=[],this.abortCallbacks=[],this.progressCallbacks=[],this.eventListeners=[],this.method=Wi(e,"method").exists(),this.url=Wi(t,"url").exists(),this.performance=i,this.xhrType=b.isUndefined(n)&&"undefined"!=typeof XMLHttpRequest?XMLHttpRequest:n}return t.isSupported=function(e){if(b.isUndefined(e)&&"undefined"!=typeof XMLHttpRequest&&(e=XMLHttpRequest),"undefined"==typeof JSON||void 0===e||b.isUndefined(Array.prototype.forEach))return!1;var t=new e;return!(b.isUndefined(t.abort)||b.isUndefined(t.addEventListener)||b.isUndefined(t.getAllResponseHeaders)||b.isUndefined(t.open)||b.isUndefined(t.readyState)||b.isUndefined(t.removeEventListener)||b.isUndefined(t.response)||b.isUndefined(t.responseText)||b.isUndefined(t.responseType)||b.isUndefined(t.send)||b.isUndefined(t.setRequestHeader)||b.isUndefined(t.status)||b.isUndefined(t.timeout)||b.isUndefined(t.withCredentials))},t.get=function(e){return Wi(e,"url").exists(),new t(Ri.GET,e)},t.post=function(e){return Wi(e,"url").exists(),new t(Ri.POST,e)},t.prototype.header=function(e,t){return Wi(e,"header").exists(),Wi(t,"value").exists(),Wi(this.sent,"this.sent").is.false(),this.xhrRequestHeaders[e]=t,this},t.prototype.headers=function(e){return Wi(e,"headers").exists(),Wi(this.sent,"this.sent").is.false(),b.extend(this.xhrRequestHeaders,e),this},t.prototype.contentType=function(e){return Wi(e,"mimeType").exists(),Wi(this.sent,"this.sent").is.false(),this.header("Content-Type",e),this},t.prototype.accept=function(e){return Wi(e,"mimeType").exists(),Wi(this.sent,"this.sent").is.false(),this.header("Accept",e),this},t.prototype.responseType=function(e){return Wi(e,"type").exists(),Wi(this.sent,"this.sent").is.false(),this.xhrResponseType=e,this},t.prototype.delay=function(e){return Wi(e,"delayMs").exists(),Wi(this.sent,"this.sent").is.false(),this.delayMs=e,this},t.prototype.timeout=function(e,t){return Wi(e,"timeoutMs").exists(),Wi(this.sent,"this.sent").is.false(),t===Ui.LATENCY?this.latencyTimeoutMs=e:this.xhrTimeout=e,this},t.prototype.withCredentials=function(){return Wi(this.sent,"this.sent").is.false(),this.xhrWithCredentials=!0,this},t.prototype.query=function(e){return Wi(e,"parameters").exists(),Wi(this.sent,"this.sent").is.false(),this.queryString=Hi.toUriEncodedString(b.map(e,function(e,t){return new Hi(t,e)})),this},t.prototype.body=function(e){return Wi(e,"data").exists(),Wi(this.sent,"this.sent").is.false(),Wi(this.xhrFields,"this.xhrFields").is.empty(),this.xhrData=e,this},t.prototype.json=function(e){return Wi(e,"data").exists(),Wi(this.sent,"this.sent").is.false(),Wi(this.xhrFields,"this.xhrFields").is.empty(),this.xhrData=JSON.stringify(e),this.contentType("application/json"),this},t.prototype.field=function(e,t){return Wi(e,"name").exists(),Wi(t,"value").exists(),Wi(this.sent,"this.sent").is.false(),Wi(this.xhrData,"this.xhrData").is.null(),this.xhrFields.push(new Hi(e,t)),this.contentType("application/x-www-form-urlencoded"),this},t.prototype.fields=function(e){var i=this;return Wi(e,"fields").exists(),Wi(this.sent,"this.sent").is.false(),Wi(this.xhrData,"this.xhrData").is.null(),b.each(e,function(e,t){i.xhrFields.push(new Hi(t,e))}),this.contentType("application/x-www-form-urlencoded"),this},t.prototype.bearerToken=function(e){return Wi(e,"token").exists(),Wi(this.sent,"this.sent").is.false(),this.header("Authorization","Bearer "+e),this},t.prototype.onLoad=function(e){return Wi(e,"callback").exists(),Wi(this.sent,"this.sent").is.false(),this.loadCallbacks=b.union(this.loadCallbacks,[e]),this},t.prototype.onProgress=function(e){return Wi(e,"callback").exists(),Wi(this.sent,"this.sent").is.false(),this.progressCallbacks=b.union(this.progressCallbacks,[e]),this},t.prototype.onError=function(e){return Wi(e,"callback").exists(),Wi(this.sent,"this.sent").is.false(),this.errorCallbacks=b.union(this.errorCallbacks,[e]),this},t.prototype.onTimeout=function(e){return Wi(e,"callback").exists(),Wi(this.sent,"this.sent").is.false(),this.timeoutCallbacks=b.union(this.timeoutCallbacks,[e]),this},t.prototype.onAbort=function(e){return Wi(e,"callback").exists(),Wi(this.sent,"this.sent").is.false(),this.abortCallbacks=b.union(this.abortCallbacks,[e]),this},t.prototype.abort=function(){this.isAborted=!0,null!==this.delayTimeoutId&&(Mi.clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null,this.handleAbort({requestStarted:!1,responseReceived:!1,loadedBytes:0,totalBytes:0,latencyMs:0,downloadMs:0,totalMs:0})),null!==this.abortXhr&&(this.abortXhr(),this.abortXhr=null)},t.prototype.send=function(){var e=this;return 0<this.delayMs?this.delayTimeoutId=Mi.setTimeout(function(){e.delayTimeoutId=null,e.sendRequest()},this.delayMs):this.sendRequest(),this},t.prototype.sendRequest=function(){var e=this;this.sent=!0;var t=Ri[this.method],i=b.isEmpty(this.queryString)?this.url:this.url+"?"+this.queryString,n=new this.xhrType;(0<this.loadCallbacks.length||0<this.progressCallbacks.length||0<this.errorCallbacks.length||0<this.timeoutCallbacks.length||0<this.abortCallbacks.length)&&this.addEventListeners(n),n.open(t,i,!0),b.each(this.xhrRequestHeaders,function(e,t){n.setRequestHeader(t,e)}),null!==this.xhrResponseType&&(n.responseType=Di[this.xhrResponseType].toLowerCase()),0<this.xhrTimeout&&(n.timeout=this.xhrTimeout),0<this.latencyTimeoutMs&&(this.latencyTimeoutMs<this.xhrTimeout||0===this.xhrTimeout)&&(this.latencyTimeoutId=Mi.setTimeout(function(){e.removeAllListeners(n),null!==e.abortXhr&&e.abortXhr(),e.abortXhr=null,e.handleTimeout(e.createTimeoutEvent(e.latencyTimeoutMs,e.startTime,null,Ui.LATENCY))},this.latencyTimeoutMs)),this.xhrWithCredentials&&(n.withCredentials=!0),this.abortXhr=function(){n.abort()},null!==this.xhrData?(n.send(this.xhrData),this.xhrData=null):b.isEmpty(this.xhrFields)?n.send():(n.send(Hi.toWwwFormUrlEncodedString(this.xhrFields)),this.xhrFields.length=0)},t.prototype.addEventListeners=function(i){var n=this,r=null;this.addEventListener(i,"loadstart",function(e){n.startTime=n.correctXHREventTimeStamp(e.timeStamp)});var t=function(e){i.readyState===n.xhrType.HEADERS_RECEIVED&&(r=n.correctXHREventTimeStamp(e.timeStamp),i.removeEventListener("readystatechange",t),Mi.clearTimeout(n.latencyTimeoutId))};this.addEventListener(i,"readystatechange",t),(0<this.loadCallbacks.length||0<this.errorCallbacks.length)&&this.addEventListener(i,"load",function(e){if(n.abortXhr=null,n.removeAllListeners(i),n.isAborted)n.handleAbort(n.createAbortEvent(n.startTime,r,e));else{var t=n.createLoadEvent(n.startTime,r,e);n.handleLoad(Li.createFromXMLHttpRequest(i,t))}}),0<this.progressCallbacks.length&&this.addEventListener(i,"progress",function(e){n.isAborted||n.handleProgress(n.createProgressEvent(n.startTime,r,e))}),0<this.errorCallbacks.length&&this.addEventListener(i,"error",function(e){n.abortXhr=null,n.removeAllListeners(i),n.isAborted?n.handleAbort(n.createAbortEvent(n.startTime,r,e)):n.handleError()}),(0<this.timeoutCallbacks.length||0<this.errorCallbacks.length)&&this.addEventListener(i,"timeout",function(e){n.abortXhr=null,n.removeAllListeners(i),n.isAborted?n.handleAbort(n.createAbortEvent(n.startTime,r,e)):n.handleTimeout(n.createTimeoutEvent(i.timeout,n.startTime,r,Ui.DEFAULT,e))}),0<this.abortCallbacks.length&&this.addEventListener(i,"abort",function(e){n.abortXhr=null,n.removeAllListeners(i),n.handleAbort(n.createAbortEvent(n.startTime,r,e))})},t.prototype.addEventListener=function(e,t,i){this.eventListeners.push({type:t,listener:i}),e.addEventListener(t,i)},t.prototype.removeAllListeners=function(t){this.eventListeners.forEach(function(e){t.removeEventListener(e.type,e.listener)}),this.eventListeners.length=0},t.prototype.handleLoad=function(t){if(200<=t.getStatus()&&t.getStatus()<400)this.loadCallbacks.forEach(function(e){e(t)});else{var i=new Error("Request to "+this.url+" resulted in HTTP status code "+t.getStatus());this.errorCallbacks.forEach(function(e){e(i,t)})}this.clearCallbacks()},t.prototype.handleProgress=function(t){this.progressCallbacks.forEach(function(e){e(t)})},t.prototype.handleError=function(){var t=new Error("An unknown network error occurred while attempting a request to "+this.url+" with query string "+this.queryString);this.errorCallbacks.forEach(function(e){e(t)}),Mi.clearTimeout(this.latencyTimeoutId),this.clearCallbacks()},t.prototype.handleTimeout=function(t){if(0<this.timeoutCallbacks.length)this.timeoutCallbacks.forEach(function(e){e(t)});else{var i=new Error("Request to "+this.url+" timed out after "+t.timeoutMs+" ms");this.errorCallbacks.forEach(function(e){e(i)})}this.clearCallbacks()},t.prototype.handleAbort=function(t){this.abortCallbacks.forEach(function(e){e(t)}),Mi.clearTimeout(this.latencyTimeoutId),this.clearCallbacks()},t.prototype.createProgressEvent=function(e,t,i){return b.extend({lengthComputable:i.lengthComputable},this.createHttpEvent(e,t,i))},t.prototype.createAbortEvent=function(e,t,i){return b.extend({requestStarted:!0},this.createHttpEvent(e,t,i))},t.prototype.createTimeoutEvent=function(e,t,i,n,r){return b.extend({timeoutMs:e,timeoutType:n},this.createHttpEvent(t,i,r))},t.prototype.createLoadEvent=function(e,t,i){return b.extend({},this.createHttpEvent(e,t,i),{lengthComputable:!0,loadedBytes:i.loaded,totalBytes:i.loaded})},t.prototype.createHttpEvent=function(e,t,i){var n=I.exists(i)&&i.lengthComputable;return{responseReceived:null!==t,loadedBytes:n?i.loaded:0,totalBytes:n?i.total:0,latencyMs:null!==t?t-e:0,downloadMs:I.exists(i)&&null!==t?this.correctXHREventTimeStamp(i.timeStamp)-t:0,totalMs:I.exists(i)&&null!==e?this.correctXHREventTimeStamp(i.timeStamp)-e:0}},t.prototype.clearCallbacks=function(){this.loadCallbacks.length=0,this.errorCallbacks.length=0,this.timeoutCallbacks.length=0,this.abortCallbacks.length=0,this.progressCallbacks.length=0},t.prototype.correctXHREventTimeStamp=function(e){return I.isNullOrUndefined(this.performance)?e:e-this.performance.now()<=1e3?e:this.performance.now()},t}(),Bi=c.of("HttpRequestBuilder"),qi=function(){function i(e,t,i){void 0===i&&(i=Vi),this.parameters={},this.xhrFields={},this.xhrRequestHeaders={},this.xhrResponseType=null,this.xhrWithCredentials=!1,this.bodyData=null,this.jsonData=null,this.timeoutMs=0,this.timeoutType=null,this.method=Bi(e,"method").exists(),this.url=Bi(t,"url").exists(),this.httpRequestType=i}return i.prototype.build=function(){var e=new this.httpRequestType(this.method,this.url);return b.isEmpty(this.parameters)||e.query(this.parameters),b.isEmpty(this.xhrFields)||e.fields(this.xhrFields),b.isEmpty(this.xhrRequestHeaders)||e.headers(this.xhrRequestHeaders),null!==this.xhrResponseType&&e.responseType(this.xhrResponseType),this.xhrWithCredentials&&e.withCredentials(),null!==this.bodyData&&e.body(this.bodyData),null!==this.jsonData&&e.json(this.jsonData),0!==this.timeoutMs&&e.timeout(this.timeoutMs,this.timeoutType),e},i.get=function(e,t){return void 0===t&&(t=Vi),Bi(e,"url").exists(),new i(Ri.GET,e,t)},i.post=function(e,t){return void 0===t&&(t=Vi),Bi(e,"url").exists(),new i(Ri.POST,e,t)},i.prototype.header=function(e,t){return Bi(e,"header").exists(),Bi(t,"value").exists(),this.xhrRequestHeaders[e]=t,this},i.prototype.headers=function(e){return Bi(e,"headers").exists(),b.extend(this.xhrRequestHeaders,e),this},i.prototype.contentType=function(e){return Bi(e,"mimeType").exists(),this.header("Content-Type",e),this},i.prototype.accept=function(e){return Bi(e,"mimeType").exists(),this.header("Accept",e),this},i.prototype.responseType=function(e){return this.xhrResponseType=Bi(e,"type").exists(),this},i.prototype.timeout=function(e,t){return this.timeoutMs=Bi(e,"timeoutMs").exists(),this.timeoutType=t,this},i.prototype.withCredentials=function(){return this.xhrWithCredentials=!0,this},i.prototype.query=function(e){return this.parameters=Bi(e,"parameters").exists(),this},i.prototype.body=function(e){return this.bodyData=Bi(e,"data").exists(),this},i.prototype.json=function(e){return this.jsonData=Bi(e,"data").exists(),this},i.prototype.field=function(e,t){return Bi(e,"name").exists(),Bi(t,"value").exists(),this.xhrFields[e]=t,this},i.prototype.fields=function(e){return Bi(e,"fields").exists(),b.extend(this.xhrFields,e),this},i.prototype.bearerToken=function(e){return Bi(e,"token").exists(),this.header("Authorization","Bearer "+e),this},i}(),ji={HttpMethod:Ri,HttpRequest:Vi,HttpRequestBuilder:qi,HttpResponse:Li,HttpResponseType:Di,HttpTimeoutType:Ui},zi=c.of("SampleAggregator"),Gi=function(){function r(){}return r.average=function(e){return zi(e,"values").exists(),zi(0<e.length,"length > 0").is.true(),e.reduce(function(e,t){return e+t},0)/e.length},r.stdDev=function(e){zi(e,"values").exists(),zi(0<e.length,"length > 0").is.true();var i=r.average(e),t=e.reduce(function(e,t){return e+(t-i)*(t-i)},0);return Math.sqrt(t/e.length)},r.lerp=function(e,t,i){return zi(e,"start").exists(),zi(t,"end").exists(),zi(i,"amount").exists(),e+(t-e)*Math.min(Math.max(i,0),1)},r.exponentialInterp=function(e,t,i,n){return zi(e,"exponentialFactor").exists(),zi(0!==e,"exponentialFactor !== 0").is.true(),zi(t,"start").exists(),zi(i,"end").exists(),zi(n,"amount").exists(),r.lerp(t,i,(Math.exp(e*Math.min(Math.max(n,0),1))-1)/(Math.exp(e)-1))},r.sinInterp=function(e,t,i){return zi(e,"start").exists(),zi(t,"end").exists(),zi(i,"amount").exists(),e+(t-e)*Math.sin(Math.PI/2*i)},r.isApprxEqual=function(e,t,i){return zi(e,"value").exists(),zi(t,"expected").exists(),zi(i,"delta").exists(),zi(0<=i,"delta >= 0").is.true(),Math.abs(t-e)<=i},r}(),Yi=c.of("CappedGeometricSequence"),Ki=function(){function e(e){void 0===e&&(e=Math.random),this.initialValue=0,this.exponentialFactor=1,this.randomizationFactor=0,this.maxValue=-1,this.random=e}return e.prototype.withInitialValue=function(e){return Yi(e).exists(),Yi(0<=e,"initialValue >= 0").is.true(),this.initialValue=e,this},e.prototype.withExponentialFactor=function(e){return Yi(0<e,"exponentialFactor > 0").is.true(),this.exponentialFactor=e,this},e.prototype.withRandomizationFactor=function(e){return Yi(e).exists(),Yi(0<=e,"randomizationFactor >= 0").is.true(),this.randomizationFactor=e,this},e.prototype.withMaxValue=function(e){return Yi(0<e,"maxValue > 0").is.true(),this.maxValue=e,this},e.prototype.getValue=function(e){Yi(0<e,"n > 0").is.true();var t=this.initialValue*Math.pow(this.exponentialFactor,e-1)+Math.floor(this.random()*this.randomizationFactor*e);return-1!==this.maxValue&&t>this.maxValue&&(t=this.maxValue),t},e}(),Xi=c.of("SampleAggregator"),Qi=function(){function e(e){Xi(0<e,"maxSamples > 0.").is.true(),this.maxSamples=e,this.reset()}return e.prototype.addSample=function(e){Xi(e,"sample").exists(),this.samples.length>=this.maxSamples&&this.samples.shift(),this.samples.push(e)},e.prototype.reset=function(){this.samples=[]},e.prototype.getAverage=function(e){Xi(0<e,"windowSize > 0").is.true();var t=this.getSamplesInWindow(e);return 0===t.length?0:Gi.average(t)},e.prototype.getStdDev=function(e){Xi(0<e,"windowSize > 0").is.true();var t=this.getSamplesInWindow(e);return 0===t.length?0:Gi.stdDev(t)},e.prototype.getSum=function(e){Xi(0<e,"windowSize > 0").is.true();var t=this.getSamplesInWindow(e);return 0===t.length?0:t.reduce(function(e,t){return e+t},0)},e.prototype.getMinimum=function(e){Xi(0<e,"windowSize > 0").is.true();var t=this.getSamplesInWindow(e);return 0===t.length?0:b.min(t)},e.prototype.getSamplesInWindow=function(e){return b.last(this.samples,Math.min(this.maxSamples,e))},e}(),Ji=c.of("LinearRegressionCalculator"),Zi=function(){function e(e){this.APPRX_ZERO=1e-6,Ji(0<e,"maxSamples > 0").is.true(),this.xSampleAggregator=new Qi(e),this.ySampleAggregator=new Qi(e)}return e.prototype.addPoint=function(e,t){Ji(e,"x").exists(),Ji(t,"y").exists(),this.xSampleAggregator.addSample(e),this.ySampleAggregator.addSample(t)},e.prototype.reset=function(){this.xSampleAggregator.reset(),this.ySampleAggregator.reset()},e.prototype.linearRegression=function(e){Ji(2<=e,"windowSize >= 2.").is.true();var t=this.xSampleAggregator.getSamplesInWindow(e),i=this.ySampleAggregator.getSamplesInWindow(e);Ji(t.length===i.length,"sample length equal").is.true();var n=t.length;if(n<2)return{slope:0,yIntercept:0,determinationCoefficient:0};for(var r=this.xSampleAggregator.getAverage(n),o=this.ySampleAggregator.getAverage(n),s=this.xSampleAggregator.getStdDev(n),a=this.ySampleAggregator.getStdDev(n),l=0,c=0,u=0;u<n;++u){var p=t[u]-r;l+=p*(i[u]-o),c+=p*p}if(0===c)return{slope:0,yIntercept:0,determinationCoefficient:0};var h,d=l/c;return{slope:d,yIntercept:o-d*r,determinationCoefficient:(h=Math.abs(a)<this.APPRX_ZERO?0:d/(a/s))*h}},e}(),$i=c.of("Arrays"),en=function(){function t(){}return t.binarySearchIndexOf=function(e,t){return this.binarySearch(e,t,!1)},t.binarySearchIndexOfClosestBelow=function(e,t){return this.binarySearch(e,t,!0)},t.binarySearch=function(e,t,i){$i(e,"array").exists(),$i(t,"compare").exists();for(var n,r,o=0,s=e.length-1;o<=s;){if(0===(r=t(e[n=Math.floor((s+o)/2)])))return n;r<0?s=n-1:o=n+1}return i?Math.max(s,0):-1},t.indexOfMinimum=function(e,t){$i(e,"array").exists(),$i(0<e.length,"length > 0").is.true(),$i(t,"compare").exists();for(var i=0,n=e[0],r=1;r<e.length;++r)t(e[r],n)<0&&(n=e[r],i=r);return i},t.indexOfMaximum=function(e,i){return $i(e,"array").exists(),$i(0<e.length,"length > 0").is.true(),$i(i,"compare").exists(),t.indexOfMinimum(e,function(e,t){return-1*i(e,t)})},t}(),tn=c.of("NumberLine"),nn=function(){function s(e){void 0===e&&(e=Number.MIN_VALUE),this.intervals=[],this.epsilon=e}return s.prototype.add=function(t){var i=this;tn(t,"interval").exists(),tn(t.start<t.end,"interval.start("+t.start+") < interval.end("+t.end+")").is.true();var e=en.binarySearchIndexOfClosestBelow(this.intervals,function(e){return i.compare(t.start,e.start)});for(e<this.intervals.length&&0<this.compare(t.start,this.intervals[e].start)&&e++,this.intervals.splice(e,0,{start:t.start,end:t.end}),0<e&&0<=this.compare(this.intervals[e-1].end,this.intervals[e].start)&&e--;e+1<this.intervals.length&&this.compare(this.intervals[e+1].start,this.intervals[e].end)<=0;)this.intervals[e].end=Math.max(this.intervals[e].end,this.intervals[e+1].end),this.intervals.splice(e+1,1)},s.prototype.remove=function(t){var e,i=this;tn(t,"interval").exists(),tn(t.start<t.end,"interval.start > interval.end").is.true();for(var n=en.binarySearchIndexOfClosestBelow(this.intervals,function(e){return i.compare(t.start,e.start)});n<this.intervals.length&&this.compare(this.intervals[n].start,t.end)<0;){var r=this.intervalDifference(this.intervals[n],t);(e=this.intervals).splice.apply(e,[n,1].concat(r)),n+=r.length}},s.prototype.find=function(t){var i=this;tn(t,"point").exists();var e=en.binarySearchIndexOf(this.intervals,function(e){return i.compare(t,e.start)<0?-1:0<i.compare(t,e.end)?1:0});return-1===e?null:this.intervals[e]},s.prototype.union=function(e){tn(e,"other").exists();for(var t=new s(this.epsilon),i=0,n=0,r=-1;i<e.intervals.length||n<this.intervals.length;){var o=null;o=n>=this.intervals.length||i<e.intervals.length&&this.compare(e.intervals[i].start,this.intervals[n].start)<0?e.intervals[i++]:this.intervals[n++],-1===r||this.compare(t.intervals[r].end,o.start)<0?(t.intervals.push({start:o.start,end:o.end}),r++):t.intervals[r].end=Math.max(t.intervals[r].end,o.end)}return t},s.prototype.intersection=function(e){tn(e,"other").exists();for(var t=new s(this.epsilon),i=0,n=0;i<this.intervals.length&&n<e.intervals.length;){var r=this.intervalIntersection(this.intervals[i],e.intervals[n]);I.exists(r)&&t.intervals.push(r),0<this.compare(this.intervals[i].end,e.intervals[n].end)?n++:i++}return t},s.prototype.shift=function(e){tn(e,"value").exists();for(var t=new s(this.epsilon),i=0,n=this.intervals;i<n.length;i++){var r=n[i];t.add({start:r.start+e,end:r.end+e})}return t},s.prototype.getIntervals=function(){return this.intervals},s.prototype.intervalIntersection=function(e,t){return this.compare(e.end,t.start)<=0?null:0<=this.compare(e.start,t.end)?null:{start:Math.max(e.start,t.start),end:Math.min(e.end,t.end)}},s.prototype.intervalDifference=function(e,t){return 0<=this.compare(e.start,t.end)||this.compare(e.end,t.start)<0?[e]:0<=this.compare(e.start,t.start)&&this.compare(e.end,t.end)<=0?[]:this.compare(e.start,t.start)<0&&0<this.compare(e.end,t.end)?[{start:e.start,end:t.start},{start:t.end,end:e.end}]:this.compare(e.start,t.start)<0?[{start:e.start,end:t.start}]:0<this.compare(e.end,t.end)?[{start:t.end,end:e.end}]:void 0},s.prototype.compare=function(e,t){var i=e-t;return i<-this.epsilon?-1:i>this.epsilon?1:0},s}(),rn=c.of("PiecewiseLinearFunction"),on=function(){function e(e){rn(e,"coordinates").exists(),rn(0<e.length,"length > 0").is.true();var t=b.unzip(e);this.xCoords=t[0],this.yCoords=t[1];for(var i=0;i<this.xCoords.length-1;++i)rn(this.xCoords[i]<this.xCoords[i+1],"x coordinates must be ordered and unique.").is.true()}return e.prototype.evaluate=function(e){if(rn(e,"xValue").exists(),e>=this.xCoords[this.xCoords.length-1])return this.yCoords[this.xCoords.length-1];for(var t=this.xCoords.length-2;0<=t;--t)if(e>=this.xCoords[t])return Gi.lerp(this.yCoords[t],this.yCoords[t+1],(e-this.xCoords[t])/(this.xCoords[t+1]-this.xCoords[t]));return this.yCoords[0]},e}(),sn=function(){function n(e){this.itemHeap=[],this.comparator=e}return n.prototype.push=function(e){this.itemHeap.push(e),this.float(this.itemHeap.length-1)},n.prototype.remove=function(e){var t=this.itemHeap.indexOf(e);return-1!==t&&(t===this.itemHeap.length-1?this.itemHeap.pop():(this.itemHeap[t]=this.itemHeap.pop(),this.comparator(this.itemHeap[t],e)?this.float(t):this.sink(t)),!0)},n.prototype.pop=function(){if(0===this.itemHeap.length)return null;if(1===this.itemHeap.length)return this.itemHeap.pop();var e=this.itemHeap[0];return this.itemHeap[0]=this.itemHeap.pop(),this.sink(0),e},n.prototype.size=function(){return this.itemHeap.length},n.prototype.float=function(e){if(0!==e){var t=n.parent(e),i=this.itemHeap[t];this.comparator(this.itemHeap[e],i)&&(this.itemHeap[t]=this.itemHeap[e],this.itemHeap[e]=i,this.float(t))}},n.prototype.sink=function(e){if(e!==this.itemHeap.length-1){var t=n.leftChild(e);if(!(t>=this.itemHeap.length)){var i=this.itemHeap[t];this.comparator(i,this.itemHeap[e])&&(this.itemHeap[t]=this.itemHeap[e],this.itemHeap[e]=i,this.sink(t))}}},n.leftChild=function(e){return 2*e+1},n.parent=function(e){return e%2==1?(e-1)/2:e/2},n}(),an=c.of("SlidingWindowEventTracker"),ln=function(){function e(e,t){void 0===t&&(t=b.now),this.eventTimestamps=[],an(0<e,"windowLengthMs > 0").is.true(),this.windowLengthMs=e,this.now=t}return e.prototype.recordEvent=function(e){(b.isNull(e)||b.isUndefined(e))&&(e=this.now()),an(0<e,"eventTimestamp > 0").is.true(),this.eventTimestamps.push(e)},e.prototype.getEventCountInWindow=function(){return this.purgeRecordsOutsideWindow(),this.eventTimestamps.length},e.prototype.purgeRecordsOutsideWindow=function(){var t=this,i=this.now();this.eventTimestamps=b.filter(this.eventTimestamps,function(e){return i-e<=t.windowLengthMs})},e}(),cn={CappedGeometricSequence:Ki,LinearRegressionCalculator:Zi,NumberLine:nn,PiecewiseLinearFunction:on,PriorityQueue:sn,SampleAggregator:Qi,SlidingWindowEventTracker:ln,stdDev:Gi.stdDev,average:Gi.average,lerp:Gi.lerp,exponentialInterp:Gi.exponentialInterp,isApprxEqual:Gi.isApprxEqual,sinInterp:Gi.sinInterp}.CappedGeometricSequence,un=c.of("ExponentialBackoffRetry"),pn=Ve.get("ExponentialBackoffRetry"),hn={ExponentialBackoffRetry:function(){function e(e){void 0===e&&(e=new cn);var n=this;this.isAborted=!1,this.handleRetry=function(e,t){if(n.isAborted)pn.error("Attempted to retry after aborted");else if(n.currentAttempt++,n.canStillRetry()){var i=n.delaySequence.getValue(n.currentAttempt);0!==i?n.retryTimeoutId=setTimeout(function(){return n.executeCode()},i):n.executeCode()}else I.isNullOrUndefined(e)&&(e=new Error("Reached retries limit, and callable did not specify a more specific error")),n.handleFail(e,t)},this.handleSuccess=function(t){n.isAborted?pn.error("Attempted to succeed after aborted"):b.forEach(n.successCallbacks,function(e){e(t)})},this.handleFail=function(t,i){n.isAborted?pn.error("Attempted to fail after aborted"):b.forEach(n.errorCallbacks,function(e){e(t,i)})},this.maxAttempts=-1,this.maxElapsedTimeMs=-1,this.delaySequence=e,this.started=!1,this.currentAttempt=0,this.successCallbacks=[],this.errorCallbacks=[]}return e.prototype.withMaxAttempts=function(e){return un(!this.started,"!this.started").is.true(),un(e,"maxAttempts").exists(),un(1<=e,"maxAttempts >= 1").is.true(),this.maxAttempts=e,this},e.prototype.withMaxElapsedTimeMs=function(e){return un(!this.started,"!this.started").is.true(),un(e,"maxElapsedTimeMs").exists(),un(0<e,"maxElapsedTimeMs > 0").is.true(),this.maxElapsedTimeMs=e,this},e.prototype.withInitialIntervalMs=function(e){return un(!this.started,"!this.started").is.true(),un(e,"initialIntervalMs").exists(),un(0<=e,"initialIntervalMs >= 0").is.true(),this.delaySequence.withInitialValue(e),this},e.prototype.withExponentialFactor=function(e){return un(!this.started,"!this.started").is.true(),un(e,"exponentialFactor").exists(),un(0<e,"exponentialFactor > 0").is.true(),this.delaySequence.withExponentialFactor(e),this},e.prototype.withRandomizationFactor=function(e){return un(!this.started,"!this.started").is.true(),un(e,"randomizationFactor").exists(),un(0<=e,"randomizationFactor >= 0").is.true(),this.delaySequence.withRandomizationFactor(e),this},e.prototype.withMaxDelayMs=function(e){return un(!this.started,"!this.started").is.true(),un(e,"maxDelayMs").exists(),un(0<e,"maxDelayMs > 0").is.true(),this.delaySequence.withMaxValue(e),this},e.prototype.onSuccess=function(e){return un(!this.started,"!this.started").is.true(),un(e,"callback").exists(),this.successCallbacks=b.union(this.successCallbacks,[e]),this},e.prototype.onError=function(e){return un(!this.started,"!this.started").is.true(),un(e,"callback").exists(),this.errorCallbacks=b.union(this.errorCallbacks,[e]),this},e.prototype.onAttempt=function(e){return un(!this.started,"!this.started").is.true(),un(e,"callable").exists(),this.callable=e,this},e.prototype.execute=function(){return un(!this.started,"!this.started").is.true(),un(this.callable,"this.callable").exists(),this.started=!0,this.startTime=(new Date).getTime(),this.executeCode(),this},e.prototype.abort=function(){this.isAborted=!0,clearTimeout(this.retryTimeoutId)},e.prototype.executeCode=function(){try{this.callable(this.currentAttempt,this.handleRetry,this.handleSuccess,this.handleFail)}catch(e){this.handleFail(e)}},e.prototype.canStillRetry=function(){return!(-1!==this.maxAttempts&&this.currentAttempt>=this.maxAttempts)&&!(-1!==this.maxElapsedTimeMs&&(new Date).getTime()-this.startTime>=this.maxElapsedTimeMs)},e}()},dn=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function t(){}return t.newError=function(e,t,i){var n=new Error(t);return n.name=e,void 0!==i&&null!=i&&(n.cause=i),n},t.newAuthenticationError=function(e){return t.newError("AuthenticationError",e)},t.newIllegalArgumentError=function(e){return t.newError("IllegalArgumentError",e)},t.newIllegalStateError=function(e){return t.newError("IllegalStateError",e)},t.getAllErrorNames=function(e){for(var t=[e.name];e.cause instanceof Error;)e=e.cause,t.push(e.name);return t},t}();t.Errors=i});e(dn);dn.Errors;var fn=n(function(e,t){var n,i=l&&l.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(a){function e(e,t,i,n,r,o){var s=a.call(this)||this;return s.code=e,s.domain=t,s.description=i,s.internalCode=n,s.message=r,s.name=o,s}return i(e,a),e}(Error);t.WebError=r});e(fn);fn.WebError;var yn=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Errors=dn.Errors,t.WebError=fn.WebError});e(yn);var gn,mn;yn.Errors,yn.WebError;(mn=gn||(gn={}))[mn.OAUTH=0]="OAUTH";var vn=gn,En=bi.LocalStorage,_n=yn.Errors,Sn=hn.ExponentialBackoffRetry,Tn=ji.HttpRequest,bn=tt.MarketplaceID,In=c.of("OAuthTokenClient"),wn=Ve.get("OAuthTokenClient"),Rn={OAuthTokenClient:function(){function l(e,t,i,n,r,o){void 0===n&&(n=new En),void 0===r&&(r=Tn),void 0===o&&(o=b.now),this.callbacks=[],this.requestInProgress=!1,this.config=e,this.onSuccessMetric=t,this.onErrorMetric=i,this.storage=n,this.httpRequest=r,this.now=o,I.isNullOrUndefined(this.config.token)||(this.token=this.config.token)}return l.prototype.getToken=function(e,t){var i=this;if(In(e,"onSuccess").exists(),In(t,"onError").exists(),this.callbacks.push({onSuccess:e,onError:t}),!this.requestInProgress){this.requestInProgress=!0;var n=this.now();if(I.isNullOrUndefined(this.token)){var r=JSON.parse(this.storage.get(l.STORAGE_KEY));this.validateStoredToken(r)&&(this.token=r)}I.isNullOrUndefined(this.token)||I.isNullOrUndefined(this.token.refresh)?this.getNewToken(function(e,t){return void 0===t&&(t=!1),i.onGetTokenSuccess(e,i.now()-n,t)},function(e){return i.onGetTokenError(e)}):this.refreshAndGetToken(this.token,function(e,t){return void 0===t&&(t=!1),i.onGetTokenSuccess(e,i.now()-n,t)},function(e){return i.onGetTokenError(e)})}},l.prototype.getType=function(){return vn.OAUTH},l.prototype.onGetTokenSuccess=function(e,t,i){void 0===i&&(i=!1),this.token=e,this.storage.set(l.STORAGE_KEY,JSON.stringify(this.token));for(var n=0,r=this.callbacks;n<r.length;n++){r[n].onSuccess({token:this.token.access,type:vn.OAUTH})}this.callbacks=[],this.requestInProgress=!1,i||I.isNullOrUndefined(this.onSuccessMetric)||this.onSuccessMetric(t)},l.prototype.onGetTokenError=function(e){for(var t=0,i=this.callbacks;t<i.length;t++){i[t].onError(e)}this.callbacks=[],this.requestInProgress=!1,I.isNullOrUndefined(this.onErrorMetric)||this.onErrorMetric(e)},l.prototype.refreshAndGetToken=function(e,i,n){var r=this;if(this.tokenHasExpired(e)){var t={app_name:this.config.appName,app_version:this.config.appVersion,requested_token_type:l.ACCESS_TOKEN_TYPE,source_token:this.token.refresh,source_token_type:l.REFRESH_TOKEN_TYPE};this.sendRequest(l.REFRESH_API,t,function(e){var t=r.validateTokenResponse(e);I.isNullOrUndefined(t)?i({access:e.access_token,expireTime:r.now()+1e3*parseInt(e.expires_in),refresh:r.token.refresh}):n(t)},n)}else i(e,!0)},l.prototype.getNewToken=function(i,n){var r=this;if(I.isNullOrUndefined(this.token)||this.tokenHasExpired(this.token)){var e={app_name:this.config.appName,app_version:this.config.appVersion,scope:[l.TOKEN_SCOPE]};this.sendRequest(l.COOKIES_API,e,function(e){var t=r.validateTokenResponse(e);I.isNullOrUndefined(t)?i({access:e.access_token,expireTime:r.now()+1e3*parseInt(e.expires_in)}):n(t)},n)}else i(this.token,!0)},l.prototype.tokenHasExpired=function(e){return e.expireTime-this.now()<0},l.prototype.validateTokenResponse=function(e){return I.isNullOrUndefined(e.access_token)?_n.newError(l.OAUTH_ERROR,"access_token was not in response."):I.isNullOrUndefined(e.expires_in)?_n.newError(l.OAUTH_ERROR,"expires_in was not in response."):I.isNullOrUndefined(e.token_type)||e.token_type!==l.BEARER_TOKEN_TYPE?_n.newError(l.OAUTH_ERROR,"token_type was not in response or the wrong type."):null},l.prototype.validateStoredToken=function(e){return!I.isNullOrUndefined(e)&&!I.isNullOrUndefined(e.access)&&!I.isNullOrUndefined(e.expireTime)},l.prototype.getEndpointForMarketplace=function(e){for(var t in l.ENDPOINTS)if(l.ENDPOINTS.hasOwnProperty(t)&&b.contains(l.ENDPOINTS[t],e))return t;return null},l.prototype.sendRequest=function(e,n,t,i){var r=this,o=this.getEndpointForMarketplace(this.config.marketplaceId);if(I.isNullOrUndefined(o))i(_n.newError(l.OAUTH_ERROR,"Invalid marketplace ID: "+this.config.marketplaceId));else{var a=o+e;(new Sn).withMaxAttempts(l.MAX_ATTEMPTS).withInitialIntervalMs(500).withExponentialFactor(2).withRandomizationFactor(200).onSuccess(t).onError(i).onAttempt(function(t,i,o,s){r.httpRequest.post(a).accept("application/json").json(n).onError(function(e){wn.error("Attempt "+(t+1)+" of "+l.MAX_ATTEMPTS+": "+e.message),i(e)}).onLoad(function(e){var t,i=e.getText();if(!I.isNullOrUndefined(i))try{t=JSON.parse(i)}catch(n){return void s(_n.newError(l.OAUTH_ERROR,"An error occurred while trying to parse JSON response: "+n))}var n=I.nestedValue(t,"response.error");if(I.isNullOrUndefined(n))I.isNullOrUndefined(t.error)&&I.isNullOrUndefined(t.error_description)?o(t):s(_n.newError(l.OAUTH_ERROR,"An error was returned by the service. "+t.error+": "+t.error_description));else{var r=I.isNullOrUndefined(n.detail)?n.message:n.message+" ("+n.detail+")";s(_n.newError(l.OAUTH_ERROR,"An error was returned by the service. "+n.code+": "+r))}}).withCredentials().send()}).execute()}},l.TOKEN_SCOPE="aiv:full",l.MAX_ATTEMPTS=4,l.OAUTH_ERROR="OAuthError",l.STORAGE_KEY="atvwebplayer_token",l.ACCESS_TOKEN_TYPE="access_token",l.BEARER_TOKEN_TYPE="bearer",l.REFRESH_TOKEN_TYPE="refresh_token",l.ENDPOINTS={"https://api.amazon.de/auth/":[bn.DE],"https://api.amazon.co.jp/auth/":[bn.JP,bn.ROW_FE],"https://api.amazon.co.uk/auth/":[bn.UK,bn.ROE_EU,bn.ROW_EU],"https://api.amazon.com/auth/":[bn.ROW_NA,bn.US]},l.REFRESH_API="token",l.COOKIES_API="token/cookies",l}(),TokenType:vn},Cn=tt.MarketplaceID,Pn=Rn.TokenType,An=ji.HttpRequest,On=yn.Errors,Nn=c.of("ClickstreamClient"),Mn=function(){function l(e,t,i,n,r,o,s,a){void 0===a&&(a=An),Nn(e,"partnerServiceEndpoint").exists(),this.clickstreamSessionId=Nn(t,"clickstreamSessionId").exists(),this.marketplaceId=Nn(i,"marketplaceId").exists(),this.customerId=Nn(n,"customerId").exists(),this.deviceId=Nn(r,"deviceId").exists(),this.deviceTypeId=Nn(o,"deviceTypeId").exists(),this.tokenClient=s,this.httpRequest=a,this.url=e.replace(/\/$/,"")+l.URL_PATH}return l.isSupported=function(e){return void 0===e&&(e=An),e.isSupported()},l.prototype.report=function(e,t,i){Nn(e,"event").exists();var n={gascEnabled:!Cn.isClassic(this.marketplaceId),deviceID:this.deviceId,deviceTypeID:this.deviceTypeId,firmware:"1"},r={EntryList:[e]},o=this.httpRequest.post(this.url).withCredentials().header("x-atv-session-id",this.clickstreamSessionId).header("x-retry-count","0").header("x-request-priority","NOTIFICATION").accept("application/json").timeout(l.HTTP_REQUEST_TIMEOUT_MS).json(r);I.isNullOrUndefined(t)||o.onLoad(function(e){t(e.getLatencyMs())}),I.isNullOrUndefined(i)||o.onError(function(e,t){I.isNullOrUndefined(t)?i(e):i(e,t.getLatencyMs())}),I.exists(this.tokenClient)?this.tokenClient.getToken(function(e){e.type===Pn.OAUTH&&o.bearerToken(e.token),o.query(n).send()},function(e){i(On.newError(l.CLICKSTREAM_ERROR,"An auth token error occured while trying to report clickstream: "+e))}):o.query(n).send()},l.CLICKSTREAM_ERROR="ClickstreamError",l.HTTP_REQUEST_TIMEOUT_MS=4e3,l.URL_PATH="/cdp/usage/Clickstream",l}(),Ln=tt.WeblabTreatment,kn={ClickstreamClient:Mn,ClickstreamEventBuilder:function(){function e(){this.event={}}return e.prototype.withAction=function(e){return this.event.action=e.toString(),this},e.prototype.withHitType=function(e){return this.event.hitType=e.toString(),this},e.prototype.withPageType=function(e){return this.event.pageType=e.toString(),this},e.prototype.withPageTypeId=function(e){return this.event.pageTypeId=e,this},e.prototype.withPageTypeIdSource=function(e){return this.event.pageTypeIdSource=e.toString(),this},e.prototype.withRefMarker=function(e){return this.event.refMarker=e,this},e.prototype.withSubPageType=function(e){return this.event.subPageType=e.toString(),this},e.prototype.withWeblabs=function(t){return this.event.Weblabs=b.chain(t).keys().map(function(e){return{weblabName:e,treatmentName:Ln[t[e]]}}).value(),b.isEmpty(this.event.Weblabs)&&delete this.event.Weblabs,this},e.prototype.withAnalyticsMap=function(e){return this.event=e,this},e.prototype.build=function(){return this.event.refMarker&&this.event.pageType?this.event:null},e}()},xn=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.name=e}return e.prototype.toString=function(){return this.name},e}();t.ClickstreamParameter=i});e(xn);xn.ClickstreamParameter;var Dn=n(function(e,t){var n,i=l&&l.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.PlayStream=new t("PlayStream"),t.PlayTrailer=new t("PlayTrailer"),t}(xn.ClickstreamParameter);t.Action=r});e(Dn);Dn.Action;var Un=n(function(e,t){var n,i=l&&l.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.PageHit=new t("PageHit"),t.PageTouch=new t("PageTouch"),t}(xn.ClickstreamParameter);t.HitType=r});e(Un);Un.HitType;var Fn=n(function(e,t){var n,i=l&&l.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.Player=new t("Player"),t}(xn.ClickstreamParameter);t.PageType=r});e(Fn);Fn.PageType;var Hn=n(function(e,t){var n,i=l&&l.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.ASIN=new t("ASIN"),t}(xn.ClickstreamParameter);t.PageTypeIdSource=r});e(Hn);Hn.PageTypeIdSource;var Wn=n(function(e,t){var i,n;Object.defineProperty(t,"__esModule",{value:!0}),(n=i||(i={}))[n.plr_hd_on=0]="plr_hd_on",n[n.plr_hd_off=1]="plr_hd_off",n[n.plr_nxt_ep=2]="plr_nxt_ep",n[n.plr_pin_ok=3]="plr_pin_ok",n[n.plr_b_fscrn_on=4]="plr_b_fscrn_on",n[n.plr_b_fscrn_off=5]="plr_b_fscrn_off",t.RefMarker=i});e(Wn);Wn.RefMarker;var Vn=n(function(e,t){var n,i=l&&l.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.Pin=new t("Pin"),t.PinError=new t("PinError"),t.Player=new t("Player"),t}(xn.ClickstreamParameter);t.SubPageType=r});e(Vn);Vn.SubPageType;var Bn=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Action=Dn.Action,t.ClickstreamParameter=xn.ClickstreamParameter,t.HitType=Un.HitType,t.PageType=Fn.PageType,t.PageTypeIdSource=Hn.PageTypeIdSource,t.RefMarker=Wn.RefMarker,t.SubPageType=Vn.SubPageType});e(Bn);Bn.Action,Bn.ClickstreamParameter,Bn.HitType,Bn.PageType,Bn.PageTypeIdSource,Bn.RefMarker,Bn.SubPageType;var qn=Bn.Action,jn=Bn.PageType,zn=Bn.RefMarker,Gn=Bn.SubPageType,Yn=Bn.HitType,Kn=kn.ClickstreamEventBuilder,Xn=je.metrics,Qn=c.of("DefaultMetricsContext"),Jn=Ve.get("MetricsContext"),Zn=function(){function r(e,t,i){void 0===i&&(i=Xn),this.createClickstreamClient=Qn(e,"createClickstreamClient").exists(),this.now=I.exists(t)?t:Date.now?Date.now:function(){return(new Date).getTime()},this.metricReporter=i,this.clickstreamClient=null,this.asin=null,this.refMarker=null,this.appLoadStartTime=null,this.contentPreparationStartTime=null,this.nextTitlePlaybackInitiatedTime=null,this.manifestDownloadStartTime=null,this.pinDialogDisplayedTime=null,this.pinEntryTime=0,this.playbackInitiatedTime=null,this.playerInitializationStartTime=null,this.prePlaybackModalStartedTime=null,this.prePlaybackModalClosedTime=null,this.seekInitiatedTime=null,this.bufferReasons={},this.bufferReasons[Nt.Ad]=null,this.bufferReasons[Nt.Main]=null,this.bufferTimers={},this.bufferTimers[Nt.Ad]=null,this.bufferTimers[Nt.Main]=null}return r.prototype.fatalErrorOccurred=function(e){this.nonFatalErrorOccurred(e),this.putMetric(r.FATAL_ERROR_METRIC)},r.prototype.nonFatalErrorOccurred=function(e){Qn(e,"error").exists(),e instanceof Error?this.putMetric(e.name):this.putMetric(e)},r.prototype.appLoadStarted=function(){null===this.appLoadStartTime?this.appLoadStartTime=this.now():Jn.error("appLoadStarted called when app load is already in progress")},r.prototype.appLoadCompleted=function(){if(null!==this.appLoadStartTime){var e=this.now()-this.appLoadStartTime;return this.putTime(r.APP_LOAD_TIME_METRIC,e),this.appLoadStartTime=null,e}Jn.error("appLoadCompleted called when app load is not in progress")},r.prototype.playerInitializationStarted=function(){null===this.playerInitializationStartTime?(this.reportRateBasedMetrics(),this.playerInitializationStartTime=this.now()):Jn.error("playerInitializationStarted called when player initialization is already in progress")},r.prototype.playerInitializationCompleted=function(){if(null!==this.playerInitializationStartTime){var e=this.now()-this.playerInitializationStartTime;this.putTime(r.INITIALIZE_TIME_METRIC,e),this.playerInitializationStartTime=null}else Jn.error("playerInitializationCompleted called when player initialization is not in progress")},r.prototype.contentPreparationStarted=function(e,t){this.asin=Qn(e,"asin").exists(),this.isTrailer=Qn(t,"isTrailer").exists(),null===this.contentPreparationStartTime?(this.contentPreparationStartTime=this.now(),this.pinDialogDisplayedTime=null):Jn.error("contentPreparationStarted called when content preparation is already in progress")},r.prototype.contentPreparationSucceeded=function(){if(null!==this.contentPreparationStartTime){var e=this.now()-this.contentPreparationStartTime;this.putTime(r.PREPARE_TIME_METRIC,e),this.contentPreparationStartTime=null}else Jn.error("contentPreparationSucceeded called when content preparation is not in progress")},r.prototype.contentPreparationFailed=function(){null!==this.contentPreparationStartTime?this.contentPreparationStartTime=null:Jn.error("contentPreparationFailed called when content preparation is not in progress")},r.prototype.playbackInitiated=function(e){Qn(e,"playbackInitiatedTime").exists(),null!==this.asin&&null!==this.isTrailer?null===this.playbackInitiatedTime?(this.putMetric(r.PLAY_METRIC),this.playbackInitiatedTime=e):Jn.error("playbackInitiated called when playback has already been initiated"):Jn.error("playbackStarted called without first preparing content")},r.prototype.playbackStarted=function(e){if(void 0===e&&(e=!1),null!==this.playbackInitiatedTime||null!==this.nextTitlePlaybackInitiatedTime){if(null===this.playbackInitiatedTime||null===this.nextTitlePlaybackInitiatedTime){var t=I.exists(this.playbackInitiatedTime)?r.TTFF_METRIC:r.NEXT_TITLE_TTFF_METRIC,i=this.calculateTimeToFirstFrame(I.withDefault(this.playbackInitiatedTime,this.nextTitlePlaybackInitiatedTime),e);return this.putTime(t,i),i}Jn.error("playbackStarted called when both playback and next title playback have been initiated")}else Jn.error("playbackStarted called when neither initial playback or next title playback has been initiated")},r.prototype.pinDialogDisplayed=function(){null===this.pinDialogDisplayedTime?(this.pinDialogDisplayedTime=this.now(),this.reportClickstreamPageType(jn.Player,Gn.Pin)):Jn.error("pinDialogDisplayed called when PIN dialog is already displayed")},r.prototype.pinSubmitted=function(){null!==this.pinDialogDisplayedTime?this.refMarker=zn[zn.plr_pin_ok]:Jn.error("pinSubmitted called when PIN dialog is not displayed")},r.prototype.pinAccepted=function(){null!==this.pinDialogDisplayedTime?(this.pinEntryTime=this.now()-this.pinDialogDisplayedTime,this.putTime(r.PIN_ENTRY_TIME_METRIC,this.pinEntryTime),this.pinDialogDisplayedTime=null):Jn.error("pinAccepted called when PIN dialog is not displayed")},r.prototype.pinDeclined=function(){null!==this.pinDialogDisplayedTime?this.reportClickstreamPageType(jn.Player,Gn.PinError):Jn.error("pinDeclined called when PIN dialog is not displayed")},r.prototype.seekInitiated=function(){this.seekInitiatedTime=this.now()},r.prototype.seekCompleted=function(){if(null!==this.seekInitiatedTime){var e=this.now()-this.seekInitiatedTime;this.putTime(r.SEEK_TIME_METRIC,e),this.seekInitiatedTime=null}else Jn.error("seekCompleted called when seek is not in progress")},r.prototype.nextTitlePlaybackInitiated=function(e){Qn(e,"playbackInitiatedTime").exists(),null===this.nextTitlePlaybackInitiatedTime?this.nextTitlePlaybackInitiatedTime=e:Jn.error("nextTitlePlaybackInitiated called when next title playback has already been initiated")},r.prototype.hdToggled=function(e){var t=(new Kn).withPageTypeId(this.asin).withRefMarker(e?zn[zn.plr_hd_on]:zn[zn.plr_hd_off]).withPageType(jn.Player).withSubPageType(Gn.Player).build();this.reportClickstream(t)},r.prototype.fullScreenToggled=function(e,t,i){var n=(new Kn).withPageTypeId(this.asin).withRefMarker(e?zn[zn.plr_b_fscrn_on]:zn[zn.plr_b_fscrn_off]).withPageType(t).withSubPageType(i).withHitType(Yn.PageTouch).build();this.reportClickstream(n)},r.prototype.manifestDownloadStarted=function(){this.manifestDownloadStartTime=this.now()},r.prototype.manifestDownloaded=function(){if(null!==this.manifestDownloadStartTime){var e=this.now()-this.manifestDownloadStartTime;this.putTime(r.MANIFEST_DOWNLOAD_TIME_METRIC,e),this.manifestDownloadStartTime=null}else Jn.error("manifestDownloaded called when manifest download has not been started")},r.prototype.bufferingStarted=function(e,t){I.isNullOrUndefined(e)?Jn.error("bufferingStarted called but no contentType was provided"):I.isNullOrUndefined(t)?Jn.error("bufferingStarted called but no bufferReason was provided"):(this.bufferReasons[e]=t,this.bufferTimers[e]=this.now())},r.prototype.bufferingComplete=function(e){if(I.isNullOrUndefined(e))Jn.error("bufferingComplete called but no contentType was provided");else{var t=this.bufferReasons[e],i=this.bufferTimers[e];if(null!==i){var n=this.now()-i;this.putTime(""+Nt[e]+r.BUFFER_TIME_METRIC+"."+t,n),this.bufferTimers[e]=null,this.bufferReasons[e]=null}}},r.prototype.reportInitialBufferCompleted=function(e){this.putMetric(r.INITIAL_BUFFER_COMPLETED,e)},r.prototype.prepareClickstream=function(e,t){I.isNullOrUndefined(e)?(Jn.error("No clickstreamSessionId was provided; Clickstream events will not be reported"),this.putMetric(r.MISSING_CLICKSTREAM_SESSION_ID_ERROR_METRIC)):I.isNullOrUndefined(t)?(Jn.error("No clickstreamRefMarker was provided; Clickstream events will not be reported"),this.putMetric(r.MISSING_CLICKSTREAM_REF_MARKER_ERROR_METRIC)):(this.clickstreamClient=this.createClickstreamClient(e),this.refMarker=t)},r.prototype.clickstreamNextTitle=function(){this.refMarker=zn[zn.plr_nxt_ep]},r.prototype.clickstreamPlaybackStarted=function(e){var t=this.isTrailer?qn.PlayTrailer:qn.PlayStream;this.reportClickstreamAction(t,jn.Player,e)},r.prototype.reportClickstream=function(e){var i=this;if(null!==this.clickstreamClient)if(null!==e)if(null!==e.refMarker)if(null!==e.pageTypeId)try{this.clickstreamClient.report(e,function(e){i.putTime(r.CLICKSTREAM_TIME_METRIC,e)},function(e,t){Jn.error("Unable to send Clickstream event: "+e,e),i.putMetric(r.CLICKSTREAM_ERROR_METRIC),I.isNullOrUndefined(t)||i.putTime(r.CLICKSTREAM_TIME_METRIC,t)})}catch(e){Jn.error("Failed to send ClickStream event: "+e,e)}else Jn.error("Attempted to report Clickstream with no pageTypeId");else Jn.error("Attempted to report a Clickstream page type without a ref marker");else Jn.error("Attempted to report a Clickstream page type with a null event");else Jn.error("Attempted to report a Clickstream page with a null Clickstream client reference")},r.prototype.prePlaybackModalStarted=function(e){Qn(e,"startTimeMs").exists(),this.prePlaybackModalStartedTime=I.withDefault(this.prePlaybackModalStartedTime,e)},r.prototype.prePlaybackModalClosed=function(e){Qn(e,"closeTimeMs").exists(),I.isNullOrUndefined(this.prePlaybackModalClosedTime)&&I.exists(this.prePlaybackModalStartedTime)&&(this.prePlaybackModalClosedTime=e)},r.prototype.reportRateBasedMetrics=function(){this.putMetric(r.PLAYBACK_STUCK_METRIC,0),this.putMetric(r.FATAL_ERROR_METRIC,0)},r.prototype.putMetric=function(t,i){try{this.metricReporter.putMetric(t,i)}catch(e){Jn.error("An error occurred while publishing metric "+t+": "+e.name+": "+(I.exists(i)?i+":":"")+" "+e.message,e)}},r.prototype.putTime=function(t,e){try{this.metricReporter.putMetric(t,e,r.MILLISECONDS)}catch(e){Jn.error("An error occurred while publishing metric "+t+": "+e.name+": "+e.message,e)}},r.prototype.reportClickstreamAction=function(e,t,i){var n=(new Kn).withAction(e).withPageType(t).withRefMarker(this.refMarker).withSubPageType(Gn.Player).withPageTypeId(this.asin).withWeblabs(i).build();this.refMarker=null,this.reportClickstream(n)},r.prototype.reportClickstreamPageType=function(e,t){if(null!==this.clickstreamClient){var i=(new Kn).withPageType(e).withSubPageType(t).withRefMarker(this.refMarker).withPageTypeId(this.asin).build();this.refMarker=null,this.reportClickstream(i)}},r.prototype.calculateTimeToFirstFrame=function(e,t){var i=this.now()-(t?this.pinEntryTime:0);return I.isNullOrUndefined(this.prePlaybackModalClosedTime)?i-=e:this.playbackInitiatedTime<this.prePlaybackModalStartedTime?i+=this.prePlaybackModalStartedTime-e-this.prePlaybackModalClosedTime:i-=this.prePlaybackModalClosedTime,this.nextTitlePlaybackInitiatedTime=null,this.pinEntryTime=0,this.playbackInitiatedTime=null,this.prePlaybackModalStartedTime=null,this.prePlaybackModalClosedTime=null,i},r.MILLISECONDS="ms",r.APP_LOAD_TIME_METRIC="AppLoadTime",r.BUFFER_TIME_METRIC="BufferTime",r.CLICKSTREAM_ERROR_METRIC="ClickstreamError",r.CLICKSTREAM_TIME_METRIC="ClickstreamTime",r.FATAL_ERROR_METRIC="FatalError",r.INITIAL_BUFFER_COMPLETED="InitialBufferCompleted",r.INITIALIZE_TIME_METRIC="InitializeTime",r.MANIFEST_DOWNLOAD_TIME_METRIC="ManifestDownloadTime",r.MISSING_CLICKSTREAM_REF_MARKER_ERROR_METRIC="MissingClickstreamRefMarkerError",r.MISSING_CLICKSTREAM_SESSION_ID_ERROR_METRIC="MissingClickstreamSessionIdError",r.NEXT_TITLE_TTFF_METRIC="NextTitleTTFF",r.PIN_ENTRY_TIME_METRIC="PinEntryTime",r.PLAY_METRIC="Play",r.PLAYBACK_STUCK_METRIC="PlaybackStuck",r.PREPARE_TIME_METRIC="PrepareTime",r.SEEK_TIME_METRIC="SeekTime",r.TTFF_METRIC="TTFF",r}(),$n=kn.ClickstreamClient,er=c.of("MetricsContextFactory"),tr=function(){function e(){}return e.prototype.createMetricsContext=function(t,i,n,r,o,s){er(t,"partnerServiceEndpoint").exists(),er(i,"deviceId").exists(),er(n,"deviceTypeId").exists(),er(r,"marketplaceId").exists();return new Zn(function(e){return $n.isSupported()&&I.exists(o)?new $n(t,e,r,o,i,n,s):null})},e}(),ir=function(){function e(){}return e.prototype.getRandom=function(){if(null!=window.crypto){var e=new Uint32Array(2);return window.crypto.getRandomValues(e),(e[0]*Math.pow(2,20)+(e[1]>>>12))*Math.pow(2,-52)}return Math.random()},e.prototype.getRandomValues=function(e){for(var t=0;t<e.length;t++)e[t]=this.getRandom()},e}(),nr={RandomEngine:ir,randomEngine:new ir},rr=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.v4=function(){for(var e=nr.randomEngine,t=new Uint8Array(16),i=0;i<16;i++)t[i]=256*e.getRandom();return t[6]=15&t[6]|64,t[8]=63&t[8]|128,this.bytesToUuid(t)},e.bytesToUuid=function(e){for(var t=[],i=0;i<256;i++)t[i]=(i+256).toString(16).substr(1);var n=0;return[t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],t[e[15]]].join("")},e}();t.UUID=i});e(rr);rr.UUID;var or=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.UUID=rr.UUID});e(or);or.UUID;var sr,ar,lr=function(e){this.timestampMs=Date.now(),this.payload=e};(ar=sr||(sr={}))[ar.BufferLengthChangedEvent=0]="BufferLengthChangedEvent",ar[ar.BufferingStartedEvent=1]="BufferingStartedEvent",ar[ar.ClientVersionReportedEvent=2]="ClientVersionReportedEvent",ar[ar.CDNSwitchEvent=3]="CDNSwitchEvent",ar[ar.DecodeMetricsEmittedEvent=4]="DecodeMetricsEmittedEvent",ar[ar.DiagnosticsSessionInformationEvent=5]="DiagnosticsSessionInformationEvent",ar[ar.FragmentDownloadedEvent=6]="FragmentDownloadedEvent",ar[ar.FragmentDownloadFailedEvent=7]="FragmentDownloadFailedEvent",ar[ar.LogEvent=8]="LogEvent",ar[ar.MaxBufferSelectedEvent=9]="MaxBufferSelectedEvent",ar[ar.OriginSwitchEvent=10]="OriginSwitchEvent",ar[ar.PositionChangedEvent=11]="PositionChangedEvent",ar[ar.PrepareAsinEvent=12]="PrepareAsinEvent",ar[ar.QualityLevelChangedEvent=13]="QualityLevelChangedEvent",ar[ar.StateChangedEvent=14]="StateChangedEvent",ar[ar.VolumeChangedEvent=15]="VolumeChangedEvent";var cr,ur,pr=sr;(ur=cr||(cr={}))[ur.RealTime=0]="RealTime",ur[ur.Storage=1]="Storage";var hr,dr,fr=cr;(dr=hr||(hr={}))[dr.DEBUG=0]="DEBUG",dr[dr.INFO=1]="INFO",dr[dr.WARN=2]="WARN",dr[dr.ERROR=3]="ERROR";var yr,gr,mr,vr=hr,Er=l&&l.__extends||(yr=function(e,t){return(yr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}yr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),_r=function(n){function e(e,t){void 0===t&&(t=vr.INFO);var i=n.call(this,e)||this;return i.type=pr.LogEvent,i.version="1.0",i.priority=fr.RealTime,i.logLevel=t,i}return Er(e,n),e}(lr);(mr=gr||(gr={}))[mr.Expected=0]="Expected",mr[mr.Unexpected=1]="Unexpected";var Sr,Tr,br=gr;(Tr=Sr||(Sr={}))[Tr.Audio=0]="Audio",Tr[Tr.Video=1]="Video";var Ir,wr,Rr,Cr,Pr,Ar,Or,Nr,Mr,Lr,kr,xr,Dr,Ur,Fr,Hr,Wr,Vr=Sr,Br=function(){},qr=l&&l.__extends||(Ir=function(e,t){return(Ir=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ir(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),jr=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.BufferingStartedEvent,t.priority=fr.RealTime,t.version="1.0",t}return qr(e,i),e}(lr),zr=l&&l.__extends||(wr=function(e,t){return(wr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}wr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Gr=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.BufferLengthChangedEvent,t.priority=fr.RealTime,t.version="1.0",t}return zr(e,i),e}(lr),Yr=l&&l.__extends||(Rr=function(e,t){return(Rr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Rr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Kr=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.CDNSwitchEvent,t.priority=fr.RealTime,t.version="1.0",t}return Yr(e,i),e}(lr),Xr=l&&l.__extends||(Cr=function(e,t){return(Cr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Cr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Qr=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.ClientVersionReportedEvent,t.priority=fr.RealTime,t.version="1.0",t}return Xr(e,i),e}(lr),Jr=l&&l.__extends||(Pr=function(e,t){return(Pr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Pr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Zr=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.DecodeMetricsEmittedEvent,t.priority=fr.RealTime,t.version="1.0",t}return Jr(e,i),e}(lr),$r=l&&l.__extends||(Ar=function(e,t){return(Ar=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ar(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),eo=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.DiagnosticsSessionInformationEvent,t.priority=fr.RealTime,t.version="1.0",t}return $r(e,i),e}(lr),to=l&&l.__extends||(Or=function(e,t){return(Or=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Or(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),io=function(n){function e(e,t){var i=n.call(this,t)||this;return i.type=pr.FragmentDownloadedEvent,i.priority=fr.RealTime,i.version="1.0",i.fragmentType=e,i.bandwidthBps=t.sizeBytes/t.downloadTransferTimeMs*1e3*8,i.isSuccessful=!0,i}return to(e,n),e}(lr),no=l&&l.__extends||(Nr=function(e,t){return(Nr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Nr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ro=function(n){function e(e,t){var i=n.call(this,t)||this;return i.type=pr.FragmentDownloadFailedEvent,i.priority=fr.RealTime,i.version="1.0",i.fragmentType=e,i.isSuccessful=!1,i}return no(e,n),e}(lr),oo=l&&l.__extends||(Mr=function(e,t){return(Mr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Mr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),so=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.MaxBufferSelectedEvent,t.priority=fr.RealTime,t.version="1.0",t}return oo(e,i),e}(lr),ao=l&&l.__extends||(Lr=function(e,t){return(Lr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Lr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),lo=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.OriginSwitchEvent,t.priority=fr.RealTime,t.version="1.0",t}return ao(e,i),e}(lr),co=l&&l.__extends||(kr=function(e,t){return(kr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}kr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),uo=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.PositionChangedEvent,t.priority=fr.RealTime,t.version="1.0",t}return co(e,i),e}(lr),po=l&&l.__extends||(xr=function(e,t){return(xr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}xr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ho=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.PrepareAsinEvent,t.priority=fr.RealTime,t.version="1.0",t}return po(e,i),e}(lr),fo=l&&l.__extends||(Dr=function(e,t){return(Dr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Dr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),yo=function(o){function e(e,t,i,n){var r=o.call(this,n)||this;return r.type=pr.QualityLevelChangedEvent,r.priority=fr.RealTime,r.version="1.0",r.fragmentType=e,r.bandwidths=t,r.streamId=i,r}return fo(e,o),e}(lr),go=l&&l.__extends||(Ur=function(e,t){return(Ur=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ur(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),mo=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.StateChangedEvent,t.priority=fr.RealTime,t.version="1.0",t}return go(e,i),e}(lr),vo=l&&l.__extends||(Fr=function(e,t){return(Fr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Fr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Eo=function(i){function e(e){var t=i.call(this,e)||this;return t.type=pr.VolumeChangedEvent,t.version="1.0",t.priority=fr.RealTime,t}return vo(e,i),e}(lr),_o={BufferingStartedEvent:jr,BufferingType:br,BufferLengthChangedEvent:Gr,CDNSwitchEvent:Kr,ClientVersionReportedEvent:Qr,DecodeMetricsEmittedEvent:Zr,DiagnosticsSessionData:Br,DiagnosticsSessionInformationEvent:eo,EventPriority:fr,EventType:pr,FragmentDownloadedEvent:io,FragmentDownloadFailedEvent:ro,FragmentType:Vr,LogEvent:_r,LogLevels:vr,MaxBufferSelectedEvent:so,OriginSwitchEvent:lo,PositionChangedEvent:uo,PrepareAsinEvent:ho,QualityLevelChangedEvent:yo,StateChangedEvent:mo,VolumeChangedEvent:Eo};(Wr=Hr||(Hr={}))[Wr.Connect=0]="Connect",Wr[Wr.Disconnect=1]="Disconnect";var So,To,bo=Hr;(To=So||(So={}))[To.Unknown=0]="Unknown",To[To.AmazonWebView=1]="AmazonWebView",To[To.Android=2]="Android",To[To.AppleWebKit=3]="AppleWebKit",To[To.BlackBerry=4]="BlackBerry",To[To.Chrome=5]="Chrome",To[To.Chromium=6]="Chromium",To[To.Edge=7]="Edge",To[To.EdgeNext=8]="EdgeNext",To[To.Firefox=9]="Firefox",To[To.Firefox64=10]="Firefox64",To[To.IE=11]="IE",To[To.Opera=12]="Opera",To[To.Safari=13]="Safari",To[To.SeaMonkey=14]="SeaMonkey",To[To.Silk=15]="Silk";var Io,wo,Ro=So,Co=bi.Version,Po=function(){function s(e,t){this.type=e,this.version=null!=t?t:null}return s.fromUserAgent=function(e){for(var t=0,i=s.REGEXES;t<i.length;t++){var n=i[t],r=n.regex.exec(e);if(r){var o=r[1]?Co.fromString(r[1]):null;return new s(n.type,o)}}return new s(Ro.Unknown)},s.prototype.getType=function(){return this.type},s.prototype.getVersion=function(){return this.version},s.prototype.toString=function(){var e=Ro[this.type];return null!==this.version&&(e+=" "+this.version),e},s.prototype.equals=function(e){return this.type===e.type&&(null===this.version?null===e.version:this.version.equals(e.version))},s.UNKNOWN=new s(Ro.Unknown),s.REGEXES=[{regex:/(?:Camino|Chimera|hpwOS|webOS|Play[Ss]tation)\//,type:Ro.Unknown},{regex:/Silk\/(\d+[.0-9\-]+)/,type:Ro.Silk},{regex:/(?:BlackBerry|BB10).*Version\/(\d+[.0-9]*)/,type:Ro.BlackBerry},{regex:/(?:OPR\/|Opera |Opera.*Version\/)(\d+[.0-9]*)/,type:Ro.Opera},{regex:/(?:Edg)\/(\d+[.0-9]*)/,type:Ro.EdgeNext},{regex:/(?:Edge)\/(\d+[.0-9]*)/,type:Ro.Edge},{regex:/(?:MSIE |Trident.*rv:)(\d+[.0-9]*)/,type:Ro.IE},{regex:/Chromium\/(\d+[.0-9]*)/,type:Ro.Chromium},{regex:/(?:Chrome|CriOS)\/(\d+[.0-9]*)/,type:Ro.Chrome},{regex:/SeaMonkey\/(\d+[.0-9]*)/,type:Ro.SeaMonkey},{regex:/x64;.*Firefox\/(\d+[.0-9]*)/,type:Ro.Firefox64},{regex:/Firefox\/(\d+[.0-9]*)/,type:Ro.Firefox},{regex:/(?:Amazon.com|Windowshop|Amazon)\/(\d+[.0-9]*)/,type:Ro.AmazonWebView},{regex:/Android[ \-/](\d+[.0-9a-z\-]*)/,type:Ro.Android},{regex:/Version\/(\d+[.0-9]*).*Safari/,type:Ro.Safari},{regex:/AppleWebKit\/(\d+[.0-9]*)/,type:Ro.AppleWebKit}],s}();(wo=Io||(Io={}))[wo.Unknown=0]="Unknown",wo[wo.Android=1]="Android",wo[wo.BlackBerry=2]="BlackBerry",wo[wo.ChromeOS=3]="ChromeOS",wo[wo.FirefoxOS=4]="FirefoxOS",wo[wo.GoogleTV=5]="GoogleTV",wo[wo.iOS=6]="iOS",wo[wo.Linux=7]="Linux",wo[wo.Mac=8]="Mac",wo[wo.MacPPC=9]="MacPPC",wo[wo.Windows=10]="Windows",wo[wo.WindowsPhone=11]="WindowsPhone",wo[wo.WindowsRT=12]="WindowsRT",wo[wo.XboxOne=13]="XboxOne";var Ao,Oo,No,Mo,Lo=Io,ko=l&&l.__extends||(Ao=function(e,t){return(Ao=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ao(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),xo=bi.Version;(Mo=No||(No={}))[Mo.Windows2000=0]="Windows2000",Mo[Mo.WindowsXP=1]="WindowsXP",Mo[Mo.WindowsVista=2]="WindowsVista",Mo[Mo.Windows7=3]="Windows7",Mo[Mo.Windows8=4]="Windows8",Mo[Mo.Windows8_1=5]="Windows8_1",Mo[Mo.Windows10=6]="Windows10";var Do,Uo,Fo,Ho={"5.0":No.Windows2000,5.1:No.WindowsXP,5.2:No.WindowsXP,"6.0":No.WindowsVista,6.1:No.Windows7,6.2:No.Windows8,6.3:No.Windows8_1,6.4:No.Windows10,"10.0":No.Windows10,10.1:No.Windows10,10.2:No.Windows10},Wo=((Oo={})[No.Windows2000]="2000",Oo[No.WindowsXP]="XP",Oo[No.WindowsVista]="Vista",Oo[No.Windows7]="7",Oo[No.Windows8]="8",Oo[No.Windows8_1]="8.1",Oo[No.Windows10]="10",Oo),Vo=function(t){function i(e){return t.call(this,[e],Wo[e])||this}return ko(i,t),i.fromKernelVersion=function(e){var t=Ho[e];if(null==t)throw new Error("Unexpected Windows kernel version: "+e);return new i(t)},i.WINDOWS_2000=new i(No.Windows2000),i.WINDOWS_XP=new i(No.WindowsXP),i.WINDOWS_VISTA=new i(No.WindowsVista),i.WINDOWS_7=new i(No.Windows7),i.WINDOWS_8=new i(No.Windows8),i.WINDOWS_8_1=new i(No.Windows8_1),i.WINDOWS_10=new i(No.Windows10),i}(xo),Bo=bi.Version,qo=((Do={})[Lo.Unknown]="Unknown",Do[Lo.Android]="Android",Do[Lo.BlackBerry]="BlackBerry",Do[Lo.ChromeOS]="Chrome OS",Do[Lo.FirefoxOS]="Firefox OS",Do[Lo.GoogleTV]="Google TV",Do[Lo.iOS]="iOS",Do[Lo.Linux]="Linux",Do[Lo.Mac]="Mac OS X",Do[Lo.MacPPC]="Mac OS PPC",Do[Lo.Windows]="Windows",Do[Lo.WindowsPhone]="Windows Phone",Do[Lo.WindowsRT]="Windows RT",Do[Lo.XboxOne]="Xbox One",Do),jo=function(){function o(e,t,i){this.family=e,this.version=null!=t?t:Bo.createUnknownVersion(),this.kernelVersion=null!=i?i:this.version}return o.fromUserAgent=function(e){for(var t=0,i=o.REGEXES;t<i.length;t++){var n=i[t],r=n.regex.exec(e);if(r)return n.handler(r)}return new o(Lo.Unknown)},o.prototype.getFamily=function(){return this.family},o.prototype.getFamilyName=function(){return qo[this.family]||null},o.prototype.getVersion=function(){return this.version},o.prototype.getKernelVersion=function(){return this.kernelVersion},o.prototype.toString=function(){var e=qo[this.family];return null===this.version||this.version.isUnknownVersion()||(e+=" "+this.version),e},o.prototype.equals=function(e){return this.family===e.family&&(null===this.version?null===e.version:this.version.equals(e.version))},o.UNKNOWN=new o(Lo.Unknown),o.MAC_OS_X_YOSEMITE=new o(Lo.Mac,Bo.fromString("10.10")),o.WINDOWS_2000=new o(Lo.Windows,Vo.WINDOWS_2000),o.WINDOWS_XP=new o(Lo.Windows,Vo.WINDOWS_XP),o.WINDOWS_VISTA=new o(Lo.Windows,Vo.WINDOWS_VISTA),o.WINDOWS_7=new o(Lo.Windows,Vo.WINDOWS_7),o.WINDOWS_8=new o(Lo.Windows,Vo.WINDOWS_8),o.WINDOWS_8_1=new o(Lo.Windows,Vo.WINDOWS_8_1),o.WINDOWS_10=new o(Lo.Windows,Vo.WINDOWS_10),o.REGEXES=[{regex:/Windows ?Mobile|Xbox(?!.*One)|Play[Ss]tation/,handler:function(){return new o(Lo.Unknown)}},{regex:/Windows Phone(?: (?:OS[ /])?(\d+[.0-9]*))?/,handler:function(e){var t=e[1]?Bo.fromString(e[1]):null;return new o(Lo.WindowsPhone,t)}},{regex:/Xbox One(?: (?:OS[ /])?(\d+[.0-9]*))?/,handler:function(e){var t=e[1]?Bo.fromString(e[1]):null;return new o(Lo.XboxOne,t)}},{regex:/(?:BB10|BlackBerry)(?:.*Version\/(\d+[.0-9]*))?/,handler:function(e){var t=e[1]?Bo.fromString(e[1]):null;return new o(Lo.BlackBerry,t)}},{regex:/GoogleTV(?:[ /]([0-9a-b]+[.0-9]*))?/,handler:function(e){var t=e[1]?Bo.fromString(e[1]):null;return new o(Lo.GoogleTV,t)}},{regex:/Android(?:[ \-/](\d+[.0-9a-z\-]*))?|\bSilk\b/,handler:function(e){var t=e[1]?Bo.fromString(e[1]):null;return new o(Lo.Android,t)}},{regex:/CrOS(?: i686 (\d+[.0-9]*))?/,handler:function(e){var t=e[1]?Bo.fromString(e[1]):null;return new o(Lo.ChromeOS,t)}},{regex:/(?:iPad|iPhone|iPod)(?:.*OS (\d+[_.0-9]*))?/,handler:function(e){var t=e[1]?Bo.fromString(e[1].replace(/_/g,".")):null;return new o(Lo.iOS,t)}},{regex:/Intel Mac OS X(?: (\d+[_.0-9]*))?/,handler:function(e){var t=e[1]?Bo.fromString(e[1].replace(/_/g,".")):null;return new o(Lo.Mac,t)}},{regex:/PPC Mac OS(?: X)?(?: (\d+[_.0-9]*))?/,handler:function(e){var t=e[1]?Bo.fromString(e[1].replace(/_/g,".")):null;return new o(Lo.MacPPC,t)}},{regex:/Windows NT(?: (5\.[012]|6\.[01234]))?.*ARM/,handler:function(e){var t=e[1],i=t?Vo.fromKernelVersion(t):null,n=t?Bo.fromString(t):null;return new o(Lo.WindowsRT,i,n)}},{regex:/Windows NT(?: (5\.[012]|6\.[01234]|10\.[012]))?/,handler:function(e){var t=e[1],i=t?Vo.fromKernelVersion(t):null,n=t?Bo.fromString(t):null;return new o(Lo.Windows,i,n)}},{regex:/Linux/,handler:function(){return new o(Lo.Linux)}},{regex:/Mozilla\/5.0 \((?:Mobile|Tablet); (?:[0-9A-Za-z .\-]+; )?rv:\d+[.0-9]*\) Gecko\/\d+[.0-9]* Firefox\/\d+[.0-9]*/,handler:function(){return new o(Lo.FirefoxOS)}}],o}(),zo={Browser:Po,BrowserType:Ro,OperatingSystem:jo,OperatingSystemFamily:Lo,WindowsVersion:Vo,getBrowser:function(e){return void 0===e&&(e=navigator.userAgent),Po.fromUserAgent(e)},getOperatingSystem:function(e){return void 0===e&&(e=navigator.userAgent),jo.fromUserAgent(e)}};(Fo=Uo||(Uo={}))[Fo.Unknown=0]="Unknown",Fo[Fo.iPad=1]="iPad",Fo[Fo.iPhone=2]="iPhone",Fo[Fo.iPod=3]="iPod";var Go,Yo,Ko,Xo,Qo=Uo,Jo=bi.Version,Zo=c.of("Model"),$o=function(){function r(e,t,i){this.type=Zo(e,"type").exists(),this.version=I.isNullOrUndefined(t)?null:t,this.name=I.isNullOrUndefined(i)?Qo[e]:i}return r.fromMashCookie=function(e){var t=I.isNullOrUndefined(e.modelVersion)?null:Jo.fromString(e.modelVersion);return I.isNullOrUndefined(Qo[e.model])?new r(Qo.Unknown,t,e.model):new r(Qo[e.model],t)},r.fromUserAgent=function(e){for(var t=0;t<r.REGEXES.length;t++){var i=r.REGEXES[t].regex.exec(e);if(i){var n=i[1]?Jo.fromString(i[1]):null;return new r(r.REGEXES[t].type,n)}}return new r(Qo.Unknown)},r.prototype.getType=function(){return this.type},r.prototype.getVersion=function(){return this.version},r.prototype.getModelName=function(){return this.name},r.prototype.toString=function(){var e=this.name;return null!==this.version&&(e+=" "+this.version),e},r.prototype.equals=function(e){return(this.type===e.type||this.name===e.name)&&(null===this.version?null===e.version:this.version.equals(e.version))},r.UNKNOWN=new r(Qo.Unknown),r.REGEXES=[{regex:/iPad/,type:Qo.iPad},{regex:/iPhone/,type:Qo.iPhone},{regex:/iPod/,type:Qo.iPod}],r}(),es=zo.Browser,ts=zo.BrowserType,is=function(){function s(){}return s.fromMashCookie=function(e){var t=new s;return t.applicationName=e.applicationName,t.applicationVersion=e.applicationVersion,t.productLine=e.productLine,t.model=$o.fromMashCookie(e),t.manufacturer=e.manufacturer,t.serialNumber=e.deviceSerialNumber,t.deviceTypeId=e.deviceTypeId,t.serviceProvider=e.serviceProvider,t.connectionType=e.connectionType,t},s.fromUserAgent=function(e,t){void 0===t&&(t=es);var i=t.fromUserAgent(e),n=i.getType(),r=i.getVersion(),o=new s;return o.model=$o.fromUserAgent(e),o.applicationName=ts[n],null!=r&&(o.applicationVersion=r.toString()),o},s.prototype.equals=function(e){return b.isEqual(this,e)},s.UNKNOWN=new s,s}(),ns=function(){function e(e,t,i,n){this.browser=e,this.operatingSystem=t,this.device=i,this.displayInformation=n}return e.prototype.equals=function(e){return this.browser.equals(e.browser)&&this.operatingSystem.equals(e.operatingSystem)&&this.device.equals(e.device)&&this.displayInformation.equals(e.displayInformation)},e}(),rs=function(){function t(e,t){this.height=e,this.width=t}return t.fromMashCookie=function(e){return new t(e.displayHeight,e.displayWidth)},t.fromBrowser=function(e){return void 0===e&&(e=window.screen),new t(e.height,e.width)},t.prototype.equals=function(e){return b.isEqual(this,e)},t.UNKNOWN=new t(null,null),t}(),os=function(){function e(e){this.applicationName=e.an,this.applicationVersion=e.av,this.operatingSystem=e.os,this.operatingSystemVersion=e.ov,this.productLine=e.di.pr,this.model=e.di.md,this.modelVersion=e.di.v,this.manufacturer=e.di.mf,this.deviceSerialNumber=e.di.dsn,this.deviceTypeId=e.di.dti,this.serviceProvider=e.di.ca,this.connectionType=e.di.ct,this.displayHeight=e.dm.h,this.displayWidth=e.dm.w}return e.prototype.getSimulatedUserAgent=function(){return this.applicationName+"/"+this.applicationVersion+" ("+this.operatingSystem+"/"+this.operatingSystemVersion+"/"+this.model+")"},e}(),ss=zo.Browser,as=zo.OperatingSystem,ls=Ve.get("MashDeviceInformationFactory"),cs=function(){function e(){}return e.fromCookie=function(t,e,i,n,r){void 0===e&&(e=ss),void 0===i&&(i=as),void 0===n&&(n=is),void 0===r&&(r=rs);try{var o=new os(JSON.parse(t.slice(t.indexOf("{")))),s=e.fromUserAgent(o.getSimulatedUserAgent()),a=i.fromUserAgent(o.getSimulatedUserAgent()),l=n.fromMashCookie(o),c=r.fromMashCookie(o);return new ns(s,a,l,c)}catch(e){return ls.warn("Error parsing the MASH cookie. Returning unknown browser and operating system. Cookie format: "+t,e),new ns(ss.UNKNOWN,as.UNKNOWN,is.UNKNOWN,rs.UNKNOWN)}},e}(),us=zo.Browser,ps=zo.OperatingSystem,hs=function(){function e(){}return e.fromBrowser=function(e,t,i,n,r,o){void 0===e&&(e=window.navigator),void 0===t&&(t=window.screen),void 0===i&&(i=us),void 0===n&&(n=ps),void 0===r&&(r=is),void 0===o&&(o=rs);var s=i.fromUserAgent(e.userAgent),a=n.fromUserAgent(e.userAgent),l=r.fromUserAgent(e.userAgent,i),c=o.fromBrowser(t);return new ns(s,a,l,c)},e}(),ds=bi.CookieStorage,fs=function(){function e(){}return e.getDeviceInformation=function(e,t){void 0===e&&(e=window.navigator),void 0===t&&(t=new ds);var i=t.get("amzn-app-ctxt");return I.isNullOrUndefined(i)?hs.fromBrowser(e):cs.fromCookie(i)},e}(),ys=function(){function e(){}return e.getInstance=function(){return I.isNullOrUndefined(this.deviceInformation)&&(this.deviceInformation=fs.getDeviceInformation()),this.deviceInformation},e}(),gs=mt.EventEmitter,ms=function(){function e(e){void 0===e&&(e=new gs),this.eventEmitter=e,this.errorCount=0}return e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.emit=function(e,t){this.eventEmitter.emit(e,t)},e}(),vs=l&&l.__extends||(Go=function(e,t){return(Go=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Go(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Es=zo.BrowserType,_s=Ve.get("PostMessageHandler"),Ss=function(s){function t(e,t,i,n){void 0===t&&(t=window),void 0===n&&(n=ys.getInstance());var r=s.call(this,i)||this;r.configurationStore=e,r.windowRef=t,r.deviceInformationRef=n;var o=r.configurationStore.getValue();return r.diagnosticsWindow=o.diagnosticsSessionConfiguration.window,I.exists(r.diagnosticsWindow)&&!r.diagnosticsWindow.closed&&r.emit(bo.Connect),r}return vs(t,s),t.prototype.open=function(){var e=this;if(I.isNullOrUndefined(this.diagnosticsWindow)||this.diagnosticsWindow.closed){this.errorCount=0;var t=this.configurationStore.getValue(),i=t.diagnosticsSessionConfiguration,n=this.deviceInformationRef.browser,r=I.exists(n)&&(n.getType()===Es.Edge||n.getType()===Es.IE);this.diagnosticsWindow=r?this.windowRef.open("/"):this.windowRef.open(i.endpointURI),t.diagnosticsSessionConfiguration.window=this.diagnosticsWindow,this.configurationStore.setValue(t),this.configurationStore.commit(),I.exists(this.diagnosticsWindow)?(r&&this.diagnosticsWindow.location.assign(i.endpointURI),setTimeout(function(){e.emit(bo.Connect)},1e3)):_s.error("Diagnostics Error - The diagnostics window did not open correctly.")}else this.emit(bo.Connect)},t.prototype.report=function(e){try{!(I.isNullOrUndefined(this.diagnosticsWindow)||this.diagnosticsWindow.closed)&&this.errorCount<=t.MAX_RETRY_COUNT?this.diagnosticsWindow.postMessage(e,"*"):(this.emit(bo.Disconnect),this.diagnosticsWindow=null),this.errorCount=0}catch(e){this.errorCount++,_s.error("Error Posting Message "+e)}},t.MAX_RETRY_COUNT=500,t}(ms),Ts=l&&l.__extends||(Yo=function(e,t){return(Yo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Yo(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),bs=ji.HttpRequestBuilder,Is=Ve.get("HttpMessageHandler"),ws=function(o){function t(e,t,i){void 0===i&&(i=bs);var n=o.call(this,t)||this;n.configurationStore=e;var r=n.configurationStore.getValue().diagnosticsSessionConfiguration.endpointURI;return n.requestBuilder=i.post(r),n}return Ts(t,o),t.prototype.open=function(){this.emit(bo.Connect)},t.prototype.report=function(e){try{if(this.errorCount<=t.MAX_RETRY_COUNT)this.requestBuilder.body(JSON.stringify(e)).build().send();else this.emit(bo.Disconnect);this.errorCount=0}catch(e){this.errorCount++,Is.error("Error Sending Message "+e)}},t.MAX_RETRY_COUNT=500,t}(ms),Rs=Ue.DiagnosticsProtocol,Cs=function(){function e(e,t){void 0===e&&(e=Ss),void 0===t&&(t=ws),this.postMessageHandlerType=e,this.httpMessageHandlerType=t}return e.prototype.getHandler=function(e){switch(e.getValue().diagnosticsSessionConfiguration.protocol){case Rs.PostMessage:return new this.postMessageHandlerType(e);case Rs.Http:return new this.httpMessageHandlerType(e);default:throw new Error("The selected diagnostics protocol is not implemented")}},e}(),Ps=_o.DiagnosticsSessionData,As=_o.EventType,Os=_o.FragmentType,Ns=function(){function e(){this.sessionDataMap={}}return e.prototype.setMap=function(e){I.isNullOrUndefined(this.sessionDataMap[e.telemetrySessionId])&&(this.sessionDataMap[e.telemetrySessionId]=new Ps);var t=this.sessionDataMap[e.telemetrySessionId];switch(t.lastUpdatedTimestamp=Date.now(),e.type){case As.PrepareAsinEvent:var i=e.payload;t.asin=i;break;case As.CDNSwitchEvent:var n=e.payload;t.cdn=n;break;case As.OriginSwitchEvent:var r=e.payload;t.origin=r;break;case As.ClientVersionReportedEvent:var o=e.payload;t.clientVersion=o;break;case As.StateChangedEvent:var s=e.payload.nextState;t.state=s;break;case As.QualityLevelChangedEvent:e.fragmentType===Os.Audio?t.audioQualityLevel=e:e.fragmentType===Os.Video&&(t.videoQualityLevel=e)}},e.prototype.getSessionData=function(e){return this.sessionDataMap[e]},e}(),Ms=or.UUID,Ls=_o.DiagnosticsSessionInformationEvent,ks=function(){function e(e,t,i,n){void 0===e&&(e=new Cs),void 0===t&&(t=[]),void 0===i&&(i=Ms.v4()),void 0===n&&(n=new Ns),this.handlerFactory=e,this.telemetrySessionId=i,this.reportQueue=t,this.isHandlerConnected=!1,this.sessionMap=n}return e.prototype.initialize=function(e){var t=this;this.reportHandler=this.handlerFactory.getHandler(e),this.reportHandler.on(bo.Connect,function(){t.isHandlerConnected=!0,t.fireQueuedEvents()}),this.reportHandler.on(bo.Disconnect,function(){t.isHandlerConnected=!1})},e.prototype.open=function(){I.exists(this.reportHandler)&&this.reportHandler.open()},e.prototype.report=function(e){e.telemetrySessionId=this.telemetrySessionId,this.sessionMap.setMap(e),this.isHandlerConnected?this.reportHandler.report(e):this.queueEvent(e)},e.prototype.queueEvent=function(e){500<this.reportQueue.length&&this.reportQueue.shift(),this.reportQueue.push(e)},e.prototype.fireQueuedEvents=function(){var e=this.sessionMap.getSessionData(this.telemetrySessionId),t=new Ls(e);for(this.report(t);0!==this.reportQueue.length;)this.report(this.reportQueue.shift())},e}(),xs=function(){function e(){}return e.getInstance=function(){return I.isNullOrUndefined(this.diagnosticsReporter)&&(this.diagnosticsReporter=new ks),this.diagnosticsReporter},e}(),Ds=function(){function e(e,t){void 0===e&&(e=Date),this.dateConstructor=e,this.performanceRef=void 0===t&&"undefined"!=typeof performance?performance:t}return e.prototype.getHighResRelativeTimeMs=function(){return void 0===this.performanceRef?(new this.dateConstructor).getTime():this.performanceRef.now()},e}(),Us=c.of("Time"),Fs={TimeProvider:Ds,millisecondsToHoursMinutesSeconds:function(e){if(e<=0)return{hours:0,minutes:0,seconds:0};if(e<=1e3)return{hours:0,minutes:0,seconds:1};var t=Math.floor(e/36e5),i=Math.floor(e%36e5/6e4),n=Math.round(e%6e4/1e3);return 60===n&&(n=0,60===++i&&(i=0,t++)),{hours:t,minutes:i,seconds:n}},unixTimestampToHoursMinutesSeconds:function(e){if(e<=0)return{hours:0,minutes:0,seconds:0};var t=new Date(e);return{hours:t.getHours(),minutes:t.getMinutes(),seconds:t.getSeconds()}},isoToMillis:function(e){if(Us(e,"isoString").exists(),Us(e).is.a.string(),Us(3<e.length,"length > 3").is.true(),!new RegExp("PT([0-9]*H)*([0-9]*M)*((?!0\\d)\\d*(\\.\\d+)?S)*").test(e))throw new Error("Invalid ISO Time String passed into isoToMillis");var t=(e=e.substring(2)).indexOf("H"),i=e.indexOf("M"),n=e.indexOf("S"),r=0<t?Number(e.substring(0,t)):0,o=0<i?Number(e.substring(t+1,i)):0,s=0<n?Number(e.substring(Math.max(t,i)+1,n)):0;return Math.round(1e3*(60*r*60+60*o+s))},formatTime:function(e,t){void 0===t&&(t=!1),Us(e,"hms").exists();var i=e.minutes<10?"0"+e.minutes:e.minutes.toString(),n=e.seconds<10?"0"+e.seconds:e.seconds.toString();return 0<e.hours||!0===t?e.hours+":"+i+":"+n:i+":"+n},dateTimeToString:function(e){var t=function(e,t){return(t+e).slice(-t.length)};return t(e.getFullYear(),"0000")+"-"+t(e.getMonth()+1,"00")+"-"+t(e.getDate(),"00")+" "+t(e.getHours(),"00")+":"+t(e.getMinutes(),"00")+":"+t(e.getSeconds(),"00")+"."+t(e.getMilliseconds(),"000")}},Hs=function(){function e(){}return e.downloadUint8=function(e,t){try{var i=new Blob([e],{type:"text/plain"}),n=window.URL.createObjectURL(i),r=document.createElement("a");r.setAttribute("download",t),r.setAttribute("href",n),r.setAttribute("target","_blank"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(e){}},e}(),Ws=function(){function e(e,t,i){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=Hs),this.bufferMaxBytes=2e5,this.viewIndex=0,this.autoFlush=!1,this.isEnabled=!0,this.isFullyWritten=!1;try{null===e||null===t?(this.logBuffer=new ArrayBuffer(2e5),this.bufferView=new Uint8Array(this.logBuffer)):(this.bufferMaxBytes=t.buffer.byteLength,this.logBuffer=e,this.bufferView=t),this.typedArrayDownloader=i}catch(e){this.isEnabled=!1}}return e.prototype.setAutoFlush=function(e){this.isEnabled&&(this.autoFlush=e)},e.prototype.log=function(e){if(this.isEnabled)for(var t=0;t<e.length;t++)this.bufferView.set([e.charCodeAt(t)],this.viewIndex),++this.viewIndex>=this.bufferMaxBytes&&(this.viewIndex%=this.bufferMaxBytes,this.isFullyWritten=!0,this.autoFlush&&this.flushLogs(!1))},e.prototype.manuallyDownloadLogs=function(){this.isEnabled&&this.flushLogs(!0)},e.prototype.flushLogs=function(e){var t,i;e?(t=this.formatManualView(),i="manualDownload.txt"):(t=this.bufferView,i=Fs.dateTimeToString(new Date)+".txt"),this.typedArrayDownloader.downloadUint8(t,i)},e.prototype.formatManualView=function(){var e=new Uint8Array(this.logBuffer,0,this.viewIndex);if(this.isFullyWritten){var t=new Uint8Array(this.logBuffer,this.viewIndex,this.logBuffer.byteLength-this.viewIndex),i=new Uint8Array(this.logBuffer.byteLength);return i.set(t),i.set(e,t.byteLength),i}return e},e}(),Vs=Ue.DiagnosticsState,Bs=_o.LogEvent,qs=_o.LogLevels,js=c.of("Logging"),zs=function(){function s(){}return s.parseLevel=function(e){js(e,"level").exists();var t=s.LEVELS[e.toLowerCase()];return I.isUndefined(t)?s.DEFAULT_LOG_LEVEL:t},s.setBufferFilter=function(e){s.bufferedLogFilterLevel=s.parseLevel(e)},s.createHandler=function(i,e,r,t){var n=this;void 0===e&&(e=Vs.Disabled),void 0===t&&(t=xs.getInstance()),I.isNullOrUndefined(r)&&"undefined"!=typeof console&&(r=console);var o=[];return e!==Vs.Disabled&&void 0!==r&&o.push(function(e,t){try{var i=[Fs.dateTimeToString(new Date)].concat(t),n=s.getConsoleMethodForLevel(e,r);Function.prototype.apply.call(n,r,i)}catch(e){}}),I.isNullOrUndefined(i)||o.push(function(e,t){try{i.log(e.name,t)}catch(e){}}),e!==Vs.Disabled&&(this.bufferedLogger=new Ws,o.push(function(e,t){try{var i=[Fs.dateTimeToString(new Date),e.name].concat(t).join(" ")+"\n";e.value>=s.bufferedLogFilterLevel.value&&n.bufferedLogger.log(i)}catch(e){}}),this.realTimeLogger=t,o.push(function(e,t){try{var i=[Fs.dateTimeToString(new Date),e.name].concat(t).join(" ")+"\n";n.realTimeLogger.report(new Bs(i,qs[e.name.toUpperCase()]))}catch(e){}})),0===o.length?function(e,t){}:function(e,t){if(0!==e.length){var i=Array.prototype.slice.call(e);I.isNullOrUndefined(t.name)||i.unshift("["+t.name+"]");for(var n=0;n<o.length;n++)o[n](t.level,i)}}},s.getConsoleMethodForLevel=function(e,t){var i=t[e.name.toLowerCase()];return I.isUndefined(i)?t.log:i},s.DEFAULT_LOG_LEVEL=Ve.INFO,s.bufferedLogger=null,s.bufferedLogFilterLevel=Ve.INFO,s.LEVELS={debug:Ve.DEBUG,info:Ve.INFO,warn:Ve.WARN,error:Ve.ERROR},s}(),Gs=n(function(e,t){function r(n,r){var o=[],s=[];return null==r&&(r=function(e,t){return o[0]===t?"[Circular ~]":"[Circular ~."+s.slice(0,o.indexOf(t)).join(".")+"]"}),function(e,t){if(0<o.length){var i=o.indexOf(this);~i?o.splice(i+1):o.push(this),~i?s.splice(i,1/0,e):s.push(e),~o.indexOf(t)&&(t=r.call(this,e,t))}else o.push(t);return null==n?t:n.call(this,e,t)}}(e.exports=function(e,t,i,n){return JSON.stringify(e,r(t,n),i)}).getSerialize=r}),Ys=(Gs.getSerialize,tt.MarketplaceID),Ks=function(){function i(){}return i.hasEndpoint=function(e){return!I.isNullOrUndefined(i.getEndpointForMarketplace(e))},i.getEmptyResponseBaseUrl=function(e,t){return i.getBaseUrl(e,t)+"OE"},i.getImageResponseBaseUrl=function(e,t){return i.getBaseUrl(e,t)+"OP"},i.getBaseUrl=function(e,t){return"https://"+i.getEndpointForMarketplace(e)+"/1/"+t+"/1/"},i.getEndpointForMarketplace=function(e){for(var t in i.ENDPOINTS)if(b.contains(i.ENDPOINTS[t],e))return t;return null},i.ENDPOINTS={"fls-eu.amazon.com":[Ys.DE,Ys.ROE_EU,Ys.ROW_EU,Ys.UK],"fls-fe.amazon.com":[Ys.JP,Ys.ROW_FE],"fls-na.amazon.com":[Ys.ROW_NA,Ys.US]},i}(),Xs=ji.HttpRequest;(Xo=Ko||(Ko={}))[Xo.DEBUG=0]="DEBUG",Xo[Xo.INFO=1]="INFO",Xo[Xo.WARN=2]="WARN",Xo[Xo.ERROR=3]="ERROR";var Qs,Js=c.of("LogPublisher"),Zs=function(){function o(e,t,i,n,r){void 0===n&&(n=0),void 0===r&&(r=Xs),Js(e,"marketplaceId").exists(),Js(Ks.hasEndpoint(e),"hasEndpoint(marketplaceId)").is.true(),this.customerId=Js(t,"customerId").exists(),this.sessionId=Js(i,"sessionId").exists(),this.url=Ks.getEmptyResponseBaseUrl(e,o.CHANNEL),this.batchSize=n,this.lines=[],this.httpRequest=r}return o.prototype.updateSessionId=function(e){this.flush(),this.sessionId=Js(e,"sessionId").exists()},o.isSupported=function(){return Xs.isSupported()&&void 0!==Array.isArray&&void 0!==Array.prototype.map&&void 0!==Date.prototype.toISOString&&"undefined"!=typeof JSON},o.prototype.log=function(e,t){var i=this;Js(e,"level").exists();var n=Ko[e.toUpperCase()];Js(n,"logLevel").exists(),Js(t,"message").is.not.empty();var r=t.map(function(e){return i.stringify(e)}),o=this.escapeNewlines(r.join(" ")),s="["+this.customerId+"] ["+this.sessionId+"] ["+this.getTime()+"] ["+Ko[n]+"] "+o+"\n";this.lines.push(s),(this.lines.length>=this.batchSize||n>=Ko.ERROR)&&this.flush()},o.prototype.flush=function(){if(!(this.lines.length<1)){var e=this.lines.join("");this.httpRequest.post(this.url).body(e).send(),this.lines=[]}},o.prototype.getTime=function(){return(new Date).toISOString()},o.prototype.stringify=function(e){var i=this;if("function"==typeof e)return"[function]";if("object"!=typeof e)return""+e;if(e instanceof Error){for(var t=e,n=[];t instanceof Error;){var r=t.toString();I.isNullOrUndefined(t.stack)||(r+=" ["+t.stack+"]"),n.push(r),t=t.cause}return n.join(" caused by: ")}return this.hasOverriddenToString(e)?e.toString():Gs(e,function(e,t){return i.hasOverriddenToString(t)?t.toString():t})},o.prototype.hasOverriddenToString=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&e.toString()!==o.DEFAULT_OBJECT_STRING},o.prototype.escapeNewlines=function(e){return e.replace(/\r?\n/g,"\\n")},o.CHANNEL="aiv-web-player",o.DEFAULT_OBJECT_STRING=(new Object).toString(),o}(),$s=tt.MarketplaceID,ea=ji.HttpRequest,ta=c.of("MetricsPublisher"),ia={LogPublisher:Zs,MetricsPublisher:function(){function l(e,t,i,n,r,o,s,a){void 0===r&&(r=0),void 0===o&&(o=l.FLUSH_TIMEOUT_MS),void 0===s&&(s=ea),void 0===a&&(a=Image),this.batchedMetrics=[],this.marketplaceId=ta(e,"marketplaceID").exists(),ta(Ks.hasEndpoint(e),"hasEndpoint(marketplaceID)").is.true(),this.sessionId=ta(t,"sessionId").exists(),this.client=ta(n,"client").exists(),this.clientId=ta(i,"clientId").exists(),l.MARKETPLACES[$s.DE]="de",l.MARKETPLACES[$s.JP]="jp",l.MARKETPLACES[$s.ROE_EU]="roe_eu",l.MARKETPLACES[$s.ROW_EU]="row_eu",l.MARKETPLACES[$s.ROW_FE]="row_fe",l.MARKETPLACES[$s.ROW_NA]="row_na",l.MARKETPLACES[$s.UK]="uk",l.MARKETPLACES[$s.US]="us",this.batchSize=r,this.flushTimeoutMs=o,s.isSupported()?(this.baseUrl=Ks.getEmptyResponseBaseUrl(e,l.CHANNEL)+"/aiv-web-player/action/",this.handler=this.putMetricXhr):(this.baseUrl=Ks.getImageResponseBaseUrl(e,l.CHANNEL)+"/aiv-web-player/action/",this.handler=this.putMetricImg),this.httpRequest=s,this.imageType=a}return l.prototype.updateSessionId=function(e){this.sessionId=ta(e,"sessionId").exists()},l.prototype.putMetric=function(e,t,i,n){var r=this;void 0===i&&(i=1),ta(e,"feature").exists(),ta(t,"resource").exists();var o=e+":"+t+"@v="+i;I.isNullOrUndefined(n)||(o=o+":u="+n),this.batchedMetrics.push(o),this.batchedMetrics.length>=this.batchSize?this.flush():(clearTimeout(this.flushTimeoutId),this.flushTimeoutId=setTimeout(function(){r.flush()},this.flushTimeoutMs))},l.prototype.flush=function(){if(!(this.batchedMetrics.length<1)){clearTimeout(this.flushTimeoutId);var e=this.baseUrl+this.batchedMetrics.join("/");this.handler(e,!0),this.handler(e,!1),this.batchedMetrics=[]}},l.prototype.putMetricImg=function(e,t){var i=this.createMetricParameters(t),n=b.map(i,function(e,t){return t+"="+e});(new this.imageType).src=e+"?"+n.join("&")},l.prototype.putMetricXhr=function(e,t){this.httpRequest.get(e).query(this.createMetricParameters(t)).send()},l.prototype.createMetricParameters=function(e){var t={instance:this.clientId,marketplace:l.MARKETPLACES[this.marketplaceId],marketplaceId:this.marketplaceId,requestId:1,service:l.SERVICE_NAME,session:this.sessionId};return e&&(t.client=this.client),t},l.CHANNEL="action-impressions",l.SERVICE_NAME="AIVWebPlayer",l.FLUSH_TIMEOUT_MS=3e4,l.MARKETPLACES={},l}()},na=function(){function e(){this.capturedLogs=[]}return e.prototype.getHandler=function(){var i=this;return function(e,t){i.capturedLogs.push({messages:e,context:t})}},e.prototype.flushTo=function(e,t){for(var i=0;i<this.capturedLogs.length;i++)(I.isNullOrUndefined(t)||this.capturedLogs[i].context.level.value>=t.value)&&e(this.capturedLogs[i].messages,this.capturedLogs[i].context);this.capturedLogs.length=0},e}(),ra=function(){function e(){this.capturedMetrics=[]}return e.prototype.getHandler=function(){var n=this;return function(e,t,i){n.capturedMetrics.push({name:e,value:t,unit:i})}},e.prototype.flushTo=function(e){for(var t=0;t<this.capturedMetrics.length;t++)e(this.capturedMetrics[t].name,this.capturedMetrics[t].value,this.capturedMetrics[t].unit);this.capturedMetrics.length=0},e}(),oa=ia.LogPublisher,sa=ia.MetricsPublisher,aa=zo.BrowserType,la=Ue.DiagnosticsState,ca=je.metrics,ua=c.of("Reporter"),pa=Ve.get("Reporter"),ha=function(){function a(e){void 0===e&&(e=window),this.isLoggingInitialized=!1,this.areMetricsPreInitialized=!1,this.areMetricsInitialized=!1,this.logCaptor=null,this.metricsCaptor=null,this.logPublisher=null,this.metricsFeature=null,this.metricsPublisher=null,this.flushLogs=null,this.flushMetrics=null,this._window=e}return a.prototype.preInitializeLogging=function(){this.isLoggingInitialized||(this.logCaptor=new na,Ve.setLevel(Ve.DEBUG),Ve.setHandler(this.logCaptor.getHandler()))},a.prototype.initializeLogging=function(e,t,i,n,r,o,s){var a=this;void 0===o&&(o=0),void 0===s&&(s=la.Disabled),ua(e,"marketplaceId").exists(),ua(t,"customerId").exists(),ua(i,"sessionId").exists();var l=zs.DEFAULT_LOG_LEVEL;s!==la.Disabled&&(l=Ve.INFO,xs.getInstance().initialize(n));if(I.isNullOrUndefined(r)||(l=zs.parseLevel(r)),Ve.setLevel(l),oa.isSupported()){this.logPublisher=new oa(e,t,i,o);var c=zs.createHandler(this.logPublisher,s);Ve.setHandler(c),this.flushLogs=function(){try{a.logPublisher.flush()}catch(e){}},this.addBeforeUnloadListener(this.flushLogs),null!==this.logCaptor&&(this.logCaptor.flushTo(c,l),this.logCaptor=null),this.isLoggingInitialized=!0}else Ve.setHandler(zs.createHandler(null,s))},a.prototype.updateLoggingSessionId=function(e){ua(e,"sessionId").exists(),null!==this.logPublisher&&this.logPublisher.updateSessionId(e)},a.prototype.preInitializeMetrics=function(e,t,i,n,r,o){void 0===o&&(o=0),ua(!this.areMetricsPreInitialized,"!this.areMetricsPreInitialized").is.true(),ua(e,"marketplaceId").exists(),ua(t,"sessionId").exists(),ua(n,"metricsFeature").exists(),ua(r,"browser").exists();var s=this.getClient(r);i=I.withDefault(i,a.DEFAULT_CLIENT_ID),this.metricsFeature=n,this.metricsPublisher=new sa(e,t,i,s,o),this.metricsCaptor=new ra,ca.setHandler(this.metricsCaptor.getHandler()),this.areMetricsPreInitialized=!0},a.prototype.initializeMetrics=function(e){ua(this.areMetricsPreInitialized,"this.areMetricsPreInitialized").is.true(),ua(e,"metricsFeature").exists(),this.metricsFeature=e,this.areMetricsInitialized=!0,this.setMetricsHandlerAndFlusher()},a.prototype.updateMetricsSessionId=function(e){ua(e,"sessionId").exists(),null!==this.metricsPublisher&&this.metricsPublisher.updateSessionId(e)},a.prototype.flush=function(){this.areMetricsPreInitialized&&!this.areMetricsInitialized&&this.setMetricsHandlerAndFlusher(),null!==this.flushLogs&&this.flushLogs(),null!==this.flushMetrics&&this.flushMetrics()},a.prototype.setMetricsHandlerAndFlusher=function(){var n=this,e=function(e,t,i){n.metricsPublisher.putMetric(n.metricsFeature,"."+e,t,i)};ca.setHandler(e),this.flushMetrics=function(){try{n.metricsPublisher.flush()}catch(e){pa.warn(e)}},ca.setFlusher(this.flushMetrics),this.addBeforeUnloadListener(this.flushMetrics),null!==this.metricsCaptor&&(this.metricsCaptor.flushTo(e),this.metricsCaptor=null)},a.prototype.addBeforeUnloadListener=function(e){void 0!==this._window.addEventListener?this._window.addEventListener("beforeunload",e):void 0!==this._window.attachEvent&&this._window.attachEvent("onbeforeunload",e)},a.prototype.removeBeforeUnloadListener=function(e){void 0!==this._window.addEventListener?this._window.removeEventListener("beforeunload",e):void 0!==this._window.attachEvent&&this._window.detachEvent("onbeforeunload",e)},a.prototype.getClient=function(e){return aa[e.getType()]},a.DEFAULT_CLIENT_ID="NONE",a}(),da={BlackHoleMetricsContext:Ct,ContentType:Nt,MetricsContextFactory:tr,Logging:zs,Reporter:ha,BufferedLogger:Ws},fa=function(){function e(e){this.languageCode=e}return e.prototype.getLanguageCode=function(){return this.languageCode},e.toString=function(){return"LANGUAGE_CHANGED_EVENT"},e}(),ya=c.of("LanguageCodes"),ga=function(){function n(){}return n.getIso639_1LanguageCode=function(e){for(var t=0;t<n.LANGUAGE_MAP.length;++t){var i=n.LANGUAGE_MAP[t];if(i["iso639-2t"]===e)return i["iso639-1"]}return null},n.getIso639_2tLanguageCode=function(e){for(var t=0;t<n.LANGUAGE_MAP.length;++t){var i=n.LANGUAGE_MAP[t];if(i["iso639-1"]===e)return i["iso639-2t"]}return null},n.getLanguageCodeFromLocale=function(e){return ya(e,"locale").exists(),(e=e.replace("_","-")).split("-")[0]},n.LANGUAGE_MAP=[{"iso639-1":"ab","iso639-2t":"abk"},{"iso639-1":"aa","iso639-2t":"aar"},{"iso639-1":"af","iso639-2t":"afr"},{"iso639-1":"ak","iso639-2t":"aka"},{"iso639-1":"sq","iso639-2t":"sqi"},{"iso639-1":"am","iso639-2t":"amh"},{"iso639-1":"ar","iso639-2t":"ara"},{"iso639-1":"an","iso639-2t":"arg"},{"iso639-1":"hy","iso639-2t":"hye"},{"iso639-1":"as","iso639-2t":"asm"},{"iso639-1":"av","iso639-2t":"ava"},{"iso639-1":"ae","iso639-2t":"ave"},{"iso639-1":"ay","iso639-2t":"aym"},{"iso639-1":"az","iso639-2t":"aze"},{"iso639-1":"bm","iso639-2t":"bam"},{"iso639-1":"ba","iso639-2t":"bak"},{"iso639-1":"eu","iso639-2t":"eus"},{"iso639-1":"be","iso639-2t":"bel"},{"iso639-1":"bn","iso639-2t":"ben"},{"iso639-1":"bh","iso639-2t":"bih"},{"iso639-1":"bi","iso639-2t":"bis"},{"iso639-1":"bs","iso639-2t":"bos"},{"iso639-1":"br","iso639-2t":"bre"},{"iso639-1":"bg","iso639-2t":"bul"},{"iso639-1":"my","iso639-2t":"mya"},{"iso639-1":"ca","iso639-2t":"cat"},{"iso639-1":"ch","iso639-2t":"cha"},{"iso639-1":"ce","iso639-2t":"che"},{"iso639-1":"ny","iso639-2t":"nya"},{"iso639-1":"zh","iso639-2t":"zho"},{"iso639-1":"cv","iso639-2t":"chv"},{"iso639-1":"kw","iso639-2t":"cor"},{"iso639-1":"co","iso639-2t":"cos"},{"iso639-1":"cr","iso639-2t":"cre"},{"iso639-1":"hr","iso639-2t":"hrv"},{"iso639-1":"cs","iso639-2t":"ces"},{"iso639-1":"da","iso639-2t":"dan"},{"iso639-1":"dv","iso639-2t":"div"},{"iso639-1":"nl","iso639-2t":"nld"},{"iso639-1":"dz","iso639-2t":"dzo"},{"iso639-1":"en","iso639-2t":"eng"},{"iso639-1":"eo","iso639-2t":"epo"},{"iso639-1":"et","iso639-2t":"est"},{"iso639-1":"ee","iso639-2t":"ewe"},{"iso639-1":"fo","iso639-2t":"fao"},{"iso639-1":"fj","iso639-2t":"fij"},{"iso639-1":"fi","iso639-2t":"fin"},{"iso639-1":"fr","iso639-2t":"fra"},{"iso639-1":"ff","iso639-2t":"ful"},{"iso639-1":"gl","iso639-2t":"glg"},{"iso639-1":"ka","iso639-2t":"kat"},{"iso639-1":"de","iso639-2t":"deu"},{"iso639-1":"el","iso639-2t":"ell"},{"iso639-1":"gn","iso639-2t":"grn"},{"iso639-1":"gu","iso639-2t":"guj"},{"iso639-1":"ht","iso639-2t":"hat"},{"iso639-1":"ha","iso639-2t":"hau"},{"iso639-1":"he","iso639-2t":"heb"},{"iso639-1":"hz","iso639-2t":"her"},{"iso639-1":"hi","iso639-2t":"hin"},{"iso639-1":"ho","iso639-2t":"hmo"},{"iso639-1":"hu","iso639-2t":"hun"},{"iso639-1":"ia","iso639-2t":"ina"},{"iso639-1":"id","iso639-2t":"ind"},{"iso639-1":"ie","iso639-2t":"ile"},{"iso639-1":"ga","iso639-2t":"gle"},{"iso639-1":"ig","iso639-2t":"ibo"},{"iso639-1":"ik","iso639-2t":"ipk"},{"iso639-1":"io","iso639-2t":"ido"},{"iso639-1":"is","iso639-2t":"isl"},{"iso639-1":"it","iso639-2t":"ita"},{"iso639-1":"iu","iso639-2t":"iku"},{"iso639-1":"ja","iso639-2t":"jpn"},{"iso639-1":"jv","iso639-2t":"jav"},{"iso639-1":"kl","iso639-2t":"kal"},{"iso639-1":"kn","iso639-2t":"kan"},{"iso639-1":"kr","iso639-2t":"kau"},{"iso639-1":"ks","iso639-2t":"kas"},{"iso639-1":"kk","iso639-2t":"kaz"},{"iso639-1":"km","iso639-2t":"khm"},{"iso639-1":"ki","iso639-2t":"kik"},{"iso639-1":"rw","iso639-2t":"kin"},{"iso639-1":"ky","iso639-2t":"kir"},{"iso639-1":"kv","iso639-2t":"kom"},{"iso639-1":"kg","iso639-2t":"kon"},{"iso639-1":"ko","iso639-2t":"kor"},{"iso639-1":"ku","iso639-2t":"kur"},{"iso639-1":"kj","iso639-2t":"kua"},{"iso639-1":"la","iso639-2t":"lat"},{"iso639-1":"lb","iso639-2t":"ltz"},{"iso639-1":"lg","iso639-2t":"lug"},{"iso639-1":"li","iso639-2t":"lim"},{"iso639-1":"ln","iso639-2t":"lin"},{"iso639-1":"lo","iso639-2t":"lao"},{"iso639-1":"lt","iso639-2t":"lit"},{"iso639-1":"lu","iso639-2t":"lub"},{"iso639-1":"lv","iso639-2t":"lav"},{"iso639-1":"gv","iso639-2t":"glv"},{"iso639-1":"mk","iso639-2t":"mkd"},{"iso639-1":"mg","iso639-2t":"mlg"},{"iso639-1":"ms","iso639-2t":"msa"},{"iso639-1":"ml","iso639-2t":"mal"},{"iso639-1":"mt","iso639-2t":"mlt"},{"iso639-1":"mi","iso639-2t":"mri"},{"iso639-1":"mr","iso639-2t":"mar"},{"iso639-1":"mh","iso639-2t":"mah"},{"iso639-1":"mn","iso639-2t":"mon"},{"iso639-1":"na","iso639-2t":"nau"},{"iso639-1":"nv","iso639-2t":"nav"},{"iso639-1":"nd","iso639-2t":"nde"},{"iso639-1":"ne","iso639-2t":"nep"},{"iso639-1":"ng","iso639-2t":"ndo"},{"iso639-1":"nb","iso639-2t":"nob"},{"iso639-1":"nn","iso639-2t":"nno"},{"iso639-1":"no","iso639-2t":"nor"},{"iso639-1":"ii","iso639-2t":"iii"},{"iso639-1":"nr","iso639-2t":"nbl"},{"iso639-1":"oc","iso639-2t":"oci"},{"iso639-1":"oj","iso639-2t":"oji"},{"iso639-1":"cu","iso639-2t":"chu"},{"iso639-1":"om","iso639-2t":"orm"},{"iso639-1":"or","iso639-2t":"ori"},{"iso639-1":"os","iso639-2t":"oss"},{"iso639-1":"pa","iso639-2t":"pan"},{"iso639-1":"pi","iso639-2t":"pli"},{"iso639-1":"fa","iso639-2t":"fas"},{"iso639-1":"pl","iso639-2t":"pol"},{"iso639-1":"ps","iso639-2t":"pus"},{"iso639-1":"pt","iso639-2t":"por"},{"iso639-1":"qu","iso639-2t":"que"},{"iso639-1":"rm","iso639-2t":"roh"},{"iso639-1":"rn","iso639-2t":"run"},{"iso639-1":"ro","iso639-2t":"ron"},{"iso639-1":"ru","iso639-2t":"rus"},{"iso639-1":"sa","iso639-2t":"san"},{"iso639-1":"sc","iso639-2t":"srd"},{"iso639-1":"sd","iso639-2t":"snd"},{"iso639-1":"se","iso639-2t":"sme"},{"iso639-1":"sm","iso639-2t":"smo"},{"iso639-1":"sg","iso639-2t":"sag"},{"iso639-1":"sr","iso639-2t":"srp"},{"iso639-1":"gd","iso639-2t":"gla"},{"iso639-1":"sn","iso639-2t":"sna"},{"iso639-1":"si","iso639-2t":"sin"},{"iso639-1":"sk","iso639-2t":"slk"},{"iso639-1":"sl","iso639-2t":"slv"},{"iso639-1":"so","iso639-2t":"som"},{"iso639-1":"st","iso639-2t":"sot"},{"iso639-1":"es","iso639-2t":"spa"},{"iso639-1":"su","iso639-2t":"sun"},{"iso639-1":"sw","iso639-2t":"swa"},{"iso639-1":"ss","iso639-2t":"ssw"},{"iso639-1":"sv","iso639-2t":"swe"},{"iso639-1":"ta","iso639-2t":"tam"},{"iso639-1":"te","iso639-2t":"tel"},{"iso639-1":"tg","iso639-2t":"tgk"},{"iso639-1":"th","iso639-2t":"tha"},{"iso639-1":"ti","iso639-2t":"tir"},{"iso639-1":"bo","iso639-2t":"bod"},{"iso639-1":"tk","iso639-2t":"tuk"},{"iso639-1":"tl","iso639-2t":"tgl"},{"iso639-1":"tn","iso639-2t":"tsn"},{"iso639-1":"to","iso639-2t":"ton"},{"iso639-1":"tr","iso639-2t":"tur"},{"iso639-1":"ts","iso639-2t":"tso"},{"iso639-1":"tt","iso639-2t":"tat"},{"iso639-1":"tw","iso639-2t":"twi"},{"iso639-1":"ty","iso639-2t":"tah"},{"iso639-1":"ug","iso639-2t":"uig"},{"iso639-1":"uk","iso639-2t":"ukr"},{"iso639-1":"ur","iso639-2t":"urd"},{"iso639-1":"uz","iso639-2t":"uzb"},{"iso639-1":"ve","iso639-2t":"ven"},{"iso639-1":"vi","iso639-2t":"vie"},{"iso639-1":"vo","iso639-2t":"vol"},{"iso639-1":"wa","iso639-2t":"wln"},{"iso639-1":"cy","iso639-2t":"cym"},{"iso639-1":"wo","iso639-2t":"wol"},{"iso639-1":"fy","iso639-2t":"fry"},{"iso639-1":"xh","iso639-2t":"xho"},{"iso639-1":"yi","iso639-2t":"yid"},{"iso639-1":"yo","iso639-2t":"yor"},{"iso639-1":"za","iso639-2t":"zha"},{"iso639-1":"zu","iso639-2t":"zul"}],n}(),ma=tt.MarketplaceID,va=c.of("Locales"),Ea=function(){function i(){}return i.getStandardizedLocale=function(e){if(I.isNullOrUndefined(e))return null;var t=i[e.replace("-","_").toUpperCase()];return I.withDefault(t,null)},i.getLocaleFromMarketplaceId=function(e){va(e,"marketplaceId").exists();var t=i.MARKETPLACE_LOCALE_MAP[e];return I.withDefault(t,null)},i.getClosestLocale=function(e,t){va(e,"requestedLocale").exists(),va(t,"availableLocales").exists(),va(t,"availableLocales").is.not.empty();for(var i=ga.getLanguageCodeFromLocale(e),n=null,r=0;r<t.length;++r){var o=t[r],s=ga.getLanguageCodeFromLocale(o);if(e===o)return o;null===n&&(n=i===s?o:null)}return n},i.AR_AE="ar-AE",i.CS_CZ="cs-CZ",i.DA_DK="da-DK",i.DE_DE="de-DE",i.EL_GR="el-GR",i.EN_GB="en-GB",i.EN_US="en-US",i.ES_ES="es-ES",i.ES_MX="es-MX",i.AvailableLocales=[i.AR_AE,i.CS_CZ,i.DA_DK,i.DE_DE,i.EL_GR,i.EN_GB,i.EN_US,i.ES_ES,i.ES_US="es-US",i.FI_FI="fi-FI",i.FIL_PH="fil-PH",i.FR_FR="fr-FR",i.HE_IL="he-IL",i.HI_IN="hi-IN",i.HU_HU="hu-HU",i.ID_ID="id-ID",i.IT_IT="it-IT",i.JA_JP="ja-JP",i.KO_KR="ko-KR",i.MS_MY="ms-MY",i.NB_NO="nb-NO",i.NL_NL="nl-NL",i.PL_PL="pl-PL",i.PT_BR="pt-BR",i.PT_PT="pt-PT",i.RO_RO="ro-RO",i.RU_RU="ru-RU",i.SV_SE="sv-SE",i.TA_IN="ta-IN",i.TE_IN="te-IN",i.TH_TH="th-TH",i.TR_TR="tr-TR",i.ZH_CN="zh-CN",i.ZH_TW="zh-TW"],i.MARKETPLACE_LOCALE_MAP=((Qs={})[ma.US]=i.EN_US,Qs[ma.UK]=i.EN_GB,Qs[ma.DE]=i.DE_DE,Qs[ma.JP]=i.JA_JP,Qs),i}(),_a=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=Ve.get("IndexedDBStorage"),i=function(){function e(e,t){void 0===t&&(t=window);var n=this;this.VERSION=1,this.dbOpenRequest=null,this.pendingDbOperations=[],this.database=null,this.onGetCallbackMap={},this.tryInitialize=function(e){n.database||!n.isSupported()?e():(n.pendingDbOperations.push(e),null==n.dbOpenRequest&&n.initialize(function(){for(var e=0,t=n.pendingDbOperations;e<t.length;e++){(0,t[e])()}n.dbOpenRequest=null,n.pendingDbOperations=[]}))},this.initialize=function(t){try{var i=n.windowRef.indexedDB.open(n.dbName,n.VERSION);(n.dbOpenRequest=i).onsuccess=function(e){try{n.database=e.target.result,n.attachDatabaseErrorListener()}catch(e){}t()},i.onupgradeneeded=function(e){e.oldVersion<1&&(n.database=e.target.result,n.attachDatabaseErrorListener(),n.database.createObjectStore(n.dbName))},i.onerror=function(e){s.error("IndexedDB open request error.",i.error),e.stopPropagation(),e.preventDefault(),t()}}catch(e){t()}},this.dbName=e,this.windowRef=t}return e.prototype.get=function(r,i){var o=this;this.onGetCallbackMap[r]=i,this.tryInitialize(function(){try{if(!o.database)return void o.tryInvokeCallback(r);var n=(new Date).getTime(),e=o.database.transaction([o.dbName],"readonly");o.attachTransactionErrorListener(e,"IndexedDB 'get' transaction error.",r);var t=e.objectStore(o.dbName).get(r);t.onsuccess=function(e){try{var t=e.target.result,i=o.onGetCallbackMap[r];null!=i&&(i(t,(new Date).getTime()-n),delete o.onGetCallbackMap[r])}catch(e){o.tryInvokeCallback(r)}},t.onerror=function(e){s.error("IndexedDB 'get' request error.",t.error),e.preventDefault(),e.stopPropagation(),o.tryInvokeCallback(r)}}catch(e){i()}})},e.prototype.set=function(t,i){var n=this;this.tryInitialize(function(){try{if(n.database){var e=n.database.transaction([n.dbName],"readwrite");n.attachTransactionErrorListener(e,"IndexedDB 'set' transaction error."),e.objectStore(n.dbName).put(i,t)}}catch(e){}})},e.prototype.clear=function(){var t=this;this.tryInitialize(function(){try{if(null!=t.database){var e=t.database.transaction([t.dbName],"readwrite");t.attachTransactionErrorListener(e,"IndexedDB 'clear' transaction error."),e.objectStore(t.dbName).clear()}}catch(e){}})},e.prototype.attachDatabaseErrorListener=function(){var i=this;null!=this.database&&(this.database.onerror=function(e){var t=e.target;s.error("IndexedDB Database error.",t.error),e.preventDefault(),e.stopPropagation(),Object.keys(i.onGetCallbackMap).forEach(function(e){return i.tryInvokeCallback(e)})})},e.prototype.attachTransactionErrorListener=function(t,i,n){var r=this;t.onerror=function(e){s.error(i,t.error),e.preventDefault(),e.stopPropagation(),null!=n&&r.tryInvokeCallback(n)}},e.prototype.tryInvokeCallback=function(e){var t=this.onGetCallbackMap[e];null!=t&&(t(),delete this.onGetCallbackMap[e])},e.prototype.isSupported=function(){return null!=this.windowRef.indexedDB},e}();t.IndexedDBStorage=i});e(_a);_a.IndexedDBStorage;var Sa=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBStorage=_a.IndexedDBStorage});e(Sa);Sa.IndexedDBStorage;var Ta=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,i){void 0===e&&(e=12e4),void 0===t&&(t=2),void 0===i&&(i=document);var n=this;this.scriptErrorCount=0,this.scriptLoaded=!1,this.onScriptError=function(e,t,i){e&&(e.onload=e.onerror=e.onreadystatechange=null),clearTimeout(n.scriptTimerId),n.objectExists(n.scriptInfo.name)||(++n.scriptErrorCount<n.maxAttempts?(n.onNonFatal(t),n.setScript(i)):n.onFatal(t))},this.scriptTimeoutMs=e,this.maxAttempts=t,this.documentInstance=i}return e.prototype.get=function(e,t,i,n,r){void 0===r&&(r=!1),this.scriptInfo=e,this.onLoad=t,this.onNonFatal=i,this.onFatal=n,this.scriptErrorCount=0,this.scriptLoaded=!1,this.bustCache=r,clearTimeout(this.scriptTimerId),this.setScript(this.scriptInfo.url)},e.prototype.setScript=function(t){var i=this,n=this.documentInstance.createElement("script");this.scriptTimerId=setTimeout(function(){i.onScriptError(n,new Error("Script load timed out. "+i.scriptInfo.name+" for "+t),t)},this.scriptTimeoutMs);var r=(new Date).getTime();n.setAttribute("crossorigin","anonymous"),n.onload=n.onreadystatechange=function(){if(!i.scriptLoaded&&(void 0===n.readyState||"loaded"===n.readyState||"complete"===n.readyState))if(i.objectExists(i.scriptInfo.name)){clearTimeout(i.scriptTimerId),i.scriptLoaded=!0;var e=(new Date).getTime()-r;n.onload=n.onerror=n.onreadystatechange=null,i.onLoad({cached:!1,downloadMs:e,totalMs:e})}else i.onScriptError(n,new Error("Script loaded but missing result object. Expected "+i.scriptInfo.name+" for "+t),t)},n.onerror=function(){i.onScriptError(n,new Error("Script onerror fired: "+i.scriptInfo.name+" for "+t),t)};var e=this.bustCache?"?t="+(new Date).getTime():"";n.src=t+e,this.documentInstance.getElementsByTagName("head")[0].appendChild(n)},e.prototype.objectExists=function(e){return void 0!==window[e]},e}();t.JavaScriptLoader=i});e(Ta);Ta.JavaScriptLoader;var ba=n(function(e,t){var i,n;Object.defineProperty(t,"__esModule",{value:!0}),(n=i||(i={}))[n.JavaScript=0]="JavaScript",n[n.JSON=1]="JSON",t.ScriptType=i});e(ba);ba.ScriptType;var Ia=n(function(e,t){var i;i=function(e){e.version='0.4.0';var s=function(){for(var e=0,t=new Array(256),i=0;256!=i;++i)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=i)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[i]=e;return'undefined'!=typeof Int32Array?new Int32Array(t):t}(),r='undefined'!=typeof Buffer;function o(e){for(var t=-1,i=0,n=e.length-7;i<n;)t=(t=(t=(t=(t=(t=(t=(t=t>>>8^s[255&(t^e[i++])])>>>8^s[255&(t^e[i++])])>>>8^s[255&(t^e[i++])])>>>8^s[255&(t^e[i++])])>>>8^s[255&(t^e[i++])])>>>8^s[255&(t^e[i++])])>>>8^s[255&(t^e[i++])])>>>8^s[255&(t^e[i++])];for(;i<n+7;)t=t>>>8^s[255&(t^e[i++])];return-1^t}e.table=s,e.bstr=function(e){if(32768<e.length&&r)return o(new Buffer(e));for(var t=-1,i=e.length-1,n=0;n<i;)t=s[255&(t^e.charCodeAt(n++))]^t>>>8,t=s[255&(t^e.charCodeAt(n++))]^t>>>8;return n===i&&(t=t>>>8^s[255&(t^e.charCodeAt(n))]),-1^t},e.buf=function(e){if(1e4<e.length)return o(e);for(var t=-1,i=0,n=e.length-3;i<n;)t=(t=(t=(t=t>>>8^s[255&(t^e[i++])])>>>8^s[255&(t^e[i++])])>>>8^s[255&(t^e[i++])])>>>8^s[255&(t^e[i++])];for(;i<n+3;)t=t>>>8^s[255&(t^e[i++])];return-1^t},e.str=function(e){for(var t,i,n=-1,r=0,o=e.length;r<o;)(t=e.charCodeAt(r++))<128?n=n>>>8^s[255&(n^t)]:t<2048?n=(n=n>>>8^s[255&(n^(192|t>>6&31))])>>>8^s[255&(n^(128|63&t))]:55296<=t&&t<57344?(t=64+(1023&t),i=1023&e.charCodeAt(r++),n=(n=(n=(n=n>>>8^s[255&(n^(240|t>>8&7))])>>>8^s[255&(n^(128|t>>2&63))])>>>8^s[255&(n^(128|i>>6&15|(3&t)<<4))])>>>8^s[255&(n^(128|63&i))]):n=(n=(n=n>>>8^s[255&(n^(224|t>>12&15))])>>>8^s[255&(n^(128|t>>6&63))])>>>8^s[255&(n^(128|63&t))];return-1^n}},'undefined'==typeof DO_NOT_EXPORT_CRC?i(t):i({})}),wa=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var m="X-Server-IP",i=function(){function e(e,t){void 0===e&&(e=XMLHttpRequest),void 0===t&&(t=Ia.str);var g=this;this.makeXHRRequest=function(n,l,r,o,c,s,a,u){void 0===u&&(u=0);var p=new g.XHR,h="",d=function(e){e||(e={type:"unknown error"});var t=new Error("XHR "+e.type+" for "+n+". Status: "+p.status+", readyState: "+p.readyState),i={attempt:u,cloudfrontRequestID:p.getResponseHeader("x-amz-cf-id"),contentHash:e.contentHash,contentLength:e.contentLength,contentLengthHeader:-1!==h.indexOf("Content-Length")?p.getResponseHeader("Content-Length"):null,serverIP:-1!==h.indexOf(m)?p.getResponseHeader(m):null};0<o?(s(t,i),g.makeXHRRequest(n,l,r,--o,c,s,a,u+1)):a(t,i)},f=g.now(),y=f;p.addEventListener("readystatechange",function(){2===p.readyState&&(y=g.now())}),p.addEventListener("load",function(){if(h=p.getAllResponseHeaders(),200===p.status){var e=p.responseText,t=g.now(),i=!0,n=null,r="(not checked)";if(l){var o=g.now();i=(r=""+g.toCRC32(e))===l,n=g.now()-o}if(i)c(e,{cached:!1,latencyMs:y-f,downloadMs:t-y,verifyMs:n,serverIP:-1!==h.indexOf(m)?p.getResponseHeader(m):null});else{var s=e?e.length:0,a=0<s?"["+e.substr(0,15)+"]":"(empty)";d({type:"verify failed "+a,contentLength:s,contentHash:r})}}else d({type:"bad response"})}),p.addEventListener("error",d),p.addEventListener("timeout",d);var e=0===u?"":"?t="+g.now();p.open("GET",n+e),p.timeout=r,p.send()},this.XHR=e,this.toCRC32=t}return e.prototype.isSupported=function(){return"withCredentials"in new this.XHR},e.prototype.get=function(e,t,i,n,r,o,s){this.makeXHRRequest(e,t,i,n,r,o,s)},e.prototype.now=function(){return(new Date).getTime()},e}();t.SimpleURLAcquirer=i});e(wa);wa.SimpleURLAcquirer;var Ra=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,i,n){void 0===e&&(e=new Ta.JavaScriptLoader),void 0===t&&(t=new wa.SimpleURLAcquirer),void 0===i&&(i=new Sa.IndexedDBStorage("ScriptStore"));var o=this;this.SCRIPT_TYPES_XHR_REQUIRED=[ba.ScriptType.JSON],this.XHR_TIMEOUT_MS=12e4,this.XHR_RETRIES=2,this.loadJsonFromString=function(t,e,i){try{var n=(new Date).getTime();i.payload=JSON.parse(e),i.parseMs=(new Date).getTime()-n,i.totalMs=o.calculateTotalLoadMs(i),t.onLoad(i)}catch(e){o.onError(t,e)}},this.loadJavaScriptFromString=function(t,e,i){try{var n=new Blob([e],{type:"application/javascript"}),r={url:o.createObjectURL(n),name:t.scriptInfo.name,type:t.scriptInfo.type,version:t.scriptInfo.version};o.javaScriptLoader.get(r,function(e){i.parseMs=e.downloadMs,i.totalMs=o.calculateTotalLoadMs(i),t.onLoad(i)},t.onNonFatal,function(e){return o.onError(t,e)})}catch(e){o.onError(t,e)}},this.loadJavaScriptFromOrigin=function(e){o.javaScriptLoader.get(e.scriptInfo,e.onLoad,e.onNonFatal,e.onFatal,!0)},this.loadJsonFromOrigin=function(i){o.urlAcquirer.get(i.scriptInfo.url,i.scriptInfo.crc32,o.XHR_TIMEOUT_MS,o.XHR_RETRIES,function(e,t){o.loadFromString(i,e,t)},function(e){i.onNonFatal(e)},function(e){i.onFatal(e)})},this.javaScriptLoader=e,this.urlAcquirer=t,this.offlineStorage=i,this.loadFromStringFunctions={},this.loadFromStringFunctions[ba.ScriptType.JavaScript]=this.loadJavaScriptFromString,this.loadFromStringFunctions[ba.ScriptType.JSON]=this.loadJsonFromString,this.loadFromOriginFunctions={},this.loadFromOriginFunctions[ba.ScriptType.JavaScript]=this.loadJavaScriptFromOrigin,this.loadFromOriginFunctions[ba.ScriptType.JSON]=this.loadJsonFromOrigin,!this.isDefined(n)&&this.isDefined(window.URL)?this.createObjectURL=URL.createObjectURL:this.createObjectURL=n}return e.prototype.getContent=function(e,t){var i=this.requiresUrlAcquirer(e.scriptInfo.type);i&&!this.urlAcquirer.isSupported()?e.onFatal(new Error("URLAcquirer not supported but "+ba.ScriptType[e.scriptInfo.type]+" requires it.")):!i&&this.onlySupportsOrigin()?this.loadFromOrigin(e):this.offlineStorage.get(e.scriptInfo.name,t)},e.prototype.loadFromString=function(e,t,i){var n=this.loadFromStringFunctions[e.scriptInfo.type];this.isDefined(n)?n(e,t,i):e.onFatal(new Error("No loadFromString function found for "+ba.ScriptType[e.scriptInfo.type]))},e.prototype.loadFromOrigin=function(e){var t=this.loadFromOriginFunctions[e.scriptInfo.type];this.isDefined(t)?t(e):e.onFatal(new Error("No loadFromOrigin function found for "+ba.ScriptType[e.scriptInfo.type]))},e.prototype.acquireNewAsset=function(i,n,r){var o=this;void 0===r&&(r=!0),this.urlAcquirer.get(i.scriptInfo.url,i.scriptInfo.crc32,this.XHR_TIMEOUT_MS,this.XHR_RETRIES,function(e,t){r&&o.offlineStorage.set(i.scriptInfo.name,{version:i.scriptInfo.version,data:e}),n&&o.loadFromString(i,e,t)},function(e,t){i.onNonFatal(e,t)},function(e,t){n&&o.onError(i,e,t)})},e.prototype.onError=function(e,t,i){e.onNonFatal(t,i),this.loadFromOrigin(e)},e.prototype.requiresUrlAcquirer=function(e){return-1!==this.SCRIPT_TYPES_XHR_REQUIRED.indexOf(e)},e.prototype.onlySupportsOrigin=function(){return!(this.isDefined(window.Blob)&&this.urlAcquirer.isSupported())},e.prototype.isDefined=function(e){return void 0!==e},e.prototype.nonNumberToZero=function(e){return"number"==typeof e?e:0},e.prototype.calculateTotalLoadMs=function(e){return this.nonNumberToZero(e.cacheLoadMs)+this.nonNumberToZero(e.latencyMs)+this.nonNumberToZero(e.downloadMs)+this.nonNumberToZero(e.verifyMs)+this.nonNumberToZero(e.parseMs)},e}();t.BaseCachingScriptLoader=i});e(Ra);Ra.BaseCachingScriptLoader;var Ca=n(function(e,t){var n,i=l&&l.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function e(e,t,i,n){return r.call(this,e,t,i,n)||this}return i(e,r),e.prototype.get=function(i,e,t,n){var r=this,o={scriptInfo:i,onLoad:e,onNonFatal:t,onFatal:n};this.getContent(o,function(e,t){e?(r.loadFromString(o,e.data,{cached:!0,cacheLoadMs:t}),e.version!==i.version&&r.acquireNewAsset(o,!1)):r.acquireNewAsset(o,!0)})},e}(Ra.BaseCachingScriptLoader);t.LazyCachingScriptLoader=r});e(Ca);Ca.LazyCachingScriptLoader;var Pa=n(function(e,t){var n,i=l&&l.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function e(e,t,i,n){return r.call(this,e,t,i,n)||this}return i(e,r),e.prototype.get=function(i,e,t,n,r){var o=this;void 0===r&&(r=!0);var s={scriptInfo:i,onLoad:e,onNonFatal:t,onFatal:n};r?this.getContent(s,function(e,t){e&&e.version===i.version?o.loadFromString(s,e.data,{cached:!0,cacheLoadMs:t}):o.acquireNewAsset(s,!0)}):this.onlySupportsOrigin()?this.loadFromOrigin(s):this.acquireNewAsset(s,!0,!1)},e}(Ra.BaseCachingScriptLoader);t.TransparentCachingScriptLoader=r});e(Pa);Pa.TransparentCachingScriptLoader;var Aa=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LazyCachingScriptLoader=Ca.LazyCachingScriptLoader,t.TransparentCachingScriptLoader=Pa.TransparentCachingScriptLoader,t.JavaScriptLoader=Ta.JavaScriptLoader,t.ScriptType=ba.ScriptType});e(Aa);Aa.LazyCachingScriptLoader,Aa.TransparentCachingScriptLoader,Aa.JavaScriptLoader,Aa.ScriptType;var Oa=Aa.ScriptType,Na=Aa.TransparentCachingScriptLoader,Ma=Ve.get("LocalizationAcquirer"),La=function(){function o(e){void 0===e&&(e=new Na),this.loader=e}return o.prototype.initialize=function(e,t,i,n){void 0===n&&(n=!0),this.version=e,this.name=t,this.sources=i,this.cacheEnabled=n,this.cacheEnabled||Ma.info("Localization caching disabled for "+this.name+".")},o.prototype.acquire=function(t,i,n){if(b.isEmpty(this.sources))n(new Error(o.NO_SOURCES_ERROR));else if(I.isNullOrUndefined(this.version))n(new Error(o.NO_VERSION_ERROR));else{var r=this.sources[t];if(I.isNullOrUndefined(r))n(new Error("URL not found for "+t));else{var e={url:r,name:this.name+"-"+t,type:Oa.JSON,version:this.version};this.loader.get(e,function(e){var t=e.payload;b.isEmpty(t)?n(new Error(o.EMPTY_LOCALIZATION_ERROR)):i(t,e.totalMs,e.cached)},function(e){Ma.warn("A non-fatal error occurred while trying to download "+t+" at "+r,e)},n,this.cacheEnabled)}}},o.EMPTY_LOCALIZATION_ERROR="Acquired localization object is empty.",o.NO_SOURCES_ERROR="No sources are defined. LocalizationAcquirer may not have been initialized.",o.NO_VERSION_ERROR="No version is defined. LocalizationAcquirer may not have been initialized.",o}(),ka=We.BasicEventEmitter,xa=Ve.get("LocalizationStore"),Da=function(){function e(e,t,i,n,r,o,s){void 0===r&&(r=!0),void 0===o&&(o=new La),void 0===s&&(s=new ka);var a=this;this.loadedLanguages={},this.localizationAcquirer=o,this.eventEmitter=s;var l={};b.chain(i).keys().forEach(function(e){b.isString(i[e])?l[e]=i[e]:a.loadedLanguages[e]=i[e]}),this.localizationAcquirer.initialize(e,t,l,r),xa.info("Pre-loaded languages: "+b.keys(this.loadedLanguages).join(", ")),xa.info("Not loaded languages: "+b.keys(l).join(", ")),b.isEmpty(n)||(b.contains(b.keys(this.loadedLanguages),n)?(this.defaultLanguageCode=n,xa.info("Default language code set to "+this.defaultLanguageCode+".")):xa.warn("Default language code set to "+n+" but will be ignored because its localization object was not provided."))}return e.prototype.setLanguage=function(n,r,t){var o=this;I.exists(this.loadedLanguages[n])?this.onAcquireSuccess(n,this.loadedLanguages[n],0,!0,r):this.localizationAcquirer.acquire(n,function(e,t,i){o.onAcquireSuccess(n,e,t,i,r)},function(e){o.onAcquireError(n,e,r,t)})},e.prototype.getLocalization=function(){return this.loadedLanguages[this.currentLanguageCode]},e.prototype.getCurrentLanguage=function(){return this.currentLanguageCode},e.prototype.onLanguageChanged=function(e){this.eventEmitter.on(fa,e)},e.prototype.offLanguageChanged=function(e){this.eventEmitter.off(fa,e)},e.prototype.onAcquireSuccess=function(e,t,i,n,r){xa.info("Acquired localization for "+e+" in "+i+"ms"+(n?" from cache":"")+"."),this.currentLanguageCode=e,this.loadedLanguages[this.currentLanguageCode]=t,this.eventEmitter.emit(fa,new fa(this.currentLanguageCode)),I.exists(r)&&r(t,i,n)},e.prototype.onAcquireError=function(e,t,i,n){xa.error("An error occurred while trying to acquire "+e+".",t),I.exists(n)&&n(t),I.isNullOrUndefined(this.currentLanguageCode)&&!b.isEmpty(this.defaultLanguageCode)&&(xa.info("Falling back to "+this.defaultLanguageCode+"."),this.setLanguage(this.defaultLanguageCode,i,n))},e}(),Ua={LanguageChangedEvent:fa,LanguageCodes:ga,Locales:Ea,LocalizationStore:Da},Fa=Ve.get("FiniteStateMachine"),Ha=function(){function e(e){this.currentState=e,this.states={},this.transitionCallbacks=[],this.transitionsInProgress=0,this.illegalTransitionCallbacks=[],this.stateCallbacks={}}return e.prototype.addTransition=function(e,t){this.states[t]=b.union(this.states[t],[e]),b.isUndefined(this.stateCallbacks[t])&&(this.stateCallbacks[t]=[])},e.prototype.onTransition=function(e){this.transitionCallbacks=b.union(this.transitionCallbacks,[e])},e.prototype.onIllegalTransition=function(e){this.illegalTransitionCallbacks=b.union(this.illegalTransitionCallbacks,[e])},e.prototype.onTransitionTo=function(e,t){this.stateCallbacks[e]=b.union(this.stateCallbacks[e],[t])},e.prototype.transitionTo=function(e,t,i,n){if(b.isUndefined(this.states[e])||!b.contains(this.states[e],this.currentState))return this.callCallbacks(this.illegalTransitionCallbacks,this.currentState,e),!1;if(0<this.transitionsInProgress&&Fa.warn("Requesting state transition to nextState: "+e+" while "+this.transitionsInProgress+" transitions are already in progress."),this.transitionsInProgress++,!b.isUndefined(i)&&!b.isNull(i)&&!i())return this.transitionsInProgress--,!1;var r=this.currentState;return this.currentState=e,b.isUndefined(n)||b.isNull(n)||n()?(this.callCallbacks(this.transitionCallbacks,r,e,t),this.callCallbacks(this.stateCallbacks[e],r,e,t),this.transitionsInProgress--,!0):(this.transitionsInProgress--,this.currentState=r,!1)},e.prototype.canTransitionTo=function(e){return!b.isUndefined(this.states[e])&&b.contains(this.states[e],this.currentState)},e.prototype.getCurrentState=function(){return this.currentState},e.prototype.callCallbacks=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];b.each(e,function(e){e.apply(null,t)})},e}(),Wa={},Va=Wa.toString,Ba=Wa.hasOwnProperty,qa={isFunction:function(e){return"function"===qa.type(e)},isArray:Array.isArray||function(e){return"array"===qa.type(e)},isWindow:function(e){return null!==e&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null===e?String(e):"object"==typeof e||"function"==typeof e?Wa[Va.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==qa.type(e)||e.nodeType||qa.isWindow(e))return!1;try{if(e.constructor&&!Ba.call(e,"constructor")&&!Ba.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var t;for(t in e)e.hasOwnProperty(t);return void 0===t||Ba.call(e,t)},each:function(e,t){var i,n=e.length;if(function(e){var t=e.length,i=qa.type(e);if(qa.isWindow(e))return!1;if(1===e.nodeType&&t)return!0;return"array"===i||"function"!==i&&(0===t||"number"==typeof t&&0<t&&t-1 in e)}(e))for(i=0;i<n&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(e.hasOwnProperty(i)&&!1===t.call(e[i],i,e[i]))break;return e}};qa.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Wa["[object "+t+"]"]=t.toLowerCase()});var ja,za,Ga,Ya,Ka,Xa,Qa,Ja,Za,$a=function e(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var r,o,s,a,l,c,u=t||{},p=1,h=arguments.length,d=!1;for("boolean"==typeof u&&(d=u,u=arguments[1]||{},p=2),"object"==typeof u||qa.isFunction(u)||(u={}),h===p&&(u=this,--p);p<h;p++)if(null!==(l=arguments[p]))for(a in l)if(l.hasOwnProperty(a)){if(r=u[a],u===(s=l[a]))continue;d&&s&&(qa.isPlainObject(s)||(o=qa.isArray(s)))?(o?(o=!1,c=r&&qa.isArray(r)?r:[]):c=r&&qa.isPlainObject(r)?r:{},u[a]=e(d,c,s)):void 0!==s&&(u[a]=s)}return u},el=n(function(o,e){!function(e){function t(e,t,i){var p=0,h=[0],d="",n=null;if("UTF8"!==(d=i||"UTF8")&&"UTF16"!==d)throw"encoding must be UTF8 or UTF16";if("HEX"===t){if(0!=e.length%2)throw"srcString of HEX type must be in byte increments";n=y(e),p=n.binLen,h=n.value}else if("ASCII"===t||"TEXT"===t)n=f(e,d),p=n.binLen,h=n.value;else{if("B64"!==t)throw"inputFormat must be HEX, TEXT, ASCII, or B64";n=g(e),p=n.binLen,h=n.value}this.getHash=function(e,t,i,n){var r,o=null,s=h.slice(),a=p;if(3===arguments.length?"number"!=typeof i&&(n=i,i=1):2===arguments.length&&(i=1),i!==parseInt(i,10)||i<1)throw"numRounds must a integer >= 1";switch(t){case"HEX":o=m;break;case"B64":o=v;break;default:throw"format must be HEX or B64"}if("SHA-1"===e)for(r=0;r<i;r++)s=T(s,a),a=160;else if("SHA-224"===e)for(r=0;r<i;r++)s=b(s,a,e),a=224;else if("SHA-256"===e)for(r=0;r<i;r++)s=b(s,a,e),a=256;else if("SHA-384"===e)for(r=0;r<i;r++)s=b(s,a,e),a=384;else{if("SHA-512"!==e)throw"Chosen SHA variant is not supported";for(r=0;r<i;r++)s=b(s,a,e),a=512}return o(s,E(n))},this.getHMAC=function(e,t,i,n,r){var o,s,a,l,c=[],u=[];switch(o=null,n){case"HEX":n=m;break;case"B64":n=v;break;default:throw"outputFormat must be HEX or B64"}if("SHA-1"===i)s=64,l=160;else if("SHA-224"===i)s=64,l=224;else if("SHA-256"===i)s=64,l=256;else if("SHA-384"===i)s=128,l=384;else{if("SHA-512"!==i)throw"Chosen SHA variant is not supported";s=128,l=512}if("HEX"===t)a=(o=y(e)).binLen,o=o.value;else if("ASCII"===t||"TEXT"===t)a=(o=f(e,d)).binLen,o=o.value;else{if("B64"!==t)throw"inputFormat must be HEX, TEXT, ASCII, or B64";a=(o=g(e)).binLen,o=o.value}for(e=8*s,t=s/4-1,s<a/8?(o="SHA-1"===i?T(o,a):b(o,a,i))[t]&=4294967040:a/8<s&&(o[t]&=4294967040),s=0;s<=t;s+=1)c[s]=909522486^o[s],u[s]=1549556828^o[s];return n(i="SHA-1"===i?T(u.concat(T(c.concat(h),e+p)),e+l):b(u.concat(b(c.concat(h),e+p,i)),e+l,i),E(r))}}function N(e,t){this.a=e,this.b=t}function f(e,t){var i,n,r=[],o=[],s=0;if("UTF8"===t)for(n=0;n<e.length;n+=1)for(o=[],2048<(i=e.charCodeAt(n))?(o[0]=224|(61440&i)>>>12,o[1]=128|(4032&i)>>>6,o[2]=128|63&i):128<i?(o[0]=192|(1984&i)>>>6,o[1]=128|63&i):o[0]=i,i=0;i<o.length;i+=1)r[s>>>2]|=o[i]<<24-s%4*8,s+=1;else if("UTF16"===t)for(n=0;n<e.length;n+=1)r[s>>>2]|=e.charCodeAt(n)<<16-s%4*8,s+=2;return{value:r,binLen:8*s}}function y(e){var t,i,n=[],r=e.length;if(0!=r%2)throw"String of HEX type must be in byte increments";for(t=0;t<r;t+=2){if(i=parseInt(e.substr(t,2),16),isNaN(i))throw"String of HEX type contains invalid characters";n[t>>>3]|=i<<24-t%8*4}return{value:n,binLen:4*r}}function g(e){var t,i,n,r,o,s=[],a=0;if(-1===e.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(t=e.indexOf("="),e=e.replace(/\=/g,""),-1!==t&&t<e.length)throw"Invalid '=' found in base-64 string";for(i=0;i<e.length;i+=4){for(o=e.substr(i,4),n=r=0;n<o.length;n+=1)r|=(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(o[n]))<<18-6*n;for(n=0;n<o.length-1;n+=1)s[a>>2]|=(r>>>16-8*n&255)<<24-a%4*8,a+=1}return{value:s,binLen:8*a}}function m(e,t){var i,n,r="",o=4*e.length;for(i=0;i<o;i+=1)n=e[i>>>2]>>>8*(3-i%4),r+="0123456789abcdef".charAt(n>>>4&15)+"0123456789abcdef".charAt(15&n);return t.outputUpper?r.toUpperCase():r}function v(e,t){var i,n,r,o="",s=4*e.length;for(i=0;i<s;i+=3)for(r=(e[i>>>2]>>>8*(3-i%4)&255)<<16|(e[i+1>>>2]>>>8*(3-(i+1)%4)&255)<<8|e[i+2>>>2]>>>8*(3-(i+2)%4)&255,n=0;n<4;n+=1)o=8*i+6*n<=32*e.length?o+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>6*(3-n)&63):o+t.b64Pad;return o}function E(e){var t={outputUpper:!1,b64Pad:"="};try{e.hasOwnProperty("outputUpper")&&(t.outputUpper=e.outputUpper),e.hasOwnProperty("b64Pad")&&(t.b64Pad=e.b64Pad)}catch(e){}if("boolean"!=typeof t.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof t.b64Pad)throw"Invalid b64Pad formatting option";return t}function _(e,t){return e<<t|e>>>32-t}function i(e,t){return e>>>t|e<<32-t}function n(e,t){var i=null;i=new N(e.a,e.b);return t<=32?new N(i.a>>>t|i.b<<32-t&4294967295,i.b>>>t|i.a<<32-t&4294967295):new N(i.b>>>t-32|i.a<<64-t&4294967295,i.a>>>t-32|i.b<<64-t&4294967295)}function r(e,t){return t<=32?new N(e.a>>>t,e.b>>>t|e.a<<32-t&4294967295):new N(0,e.a>>>t-32)}function S(e,t,i){return e^t^i}function M(e,t,i){return e&t^~e&i}function L(e,t,i){return new N(e.a&t.a^~e.a&i.a,e.b&t.b^~e.b&i.b)}function k(e,t,i){return e&t^e&i^t&i}function x(e,t,i){return new N(e.a&t.a^e.a&i.a^t.a&i.a,e.b&t.b^e.b&i.b^t.b&i.b)}function D(e){return i(e,2)^i(e,13)^i(e,22)}function U(e){var t=n(e,28),i=n(e,34);return e=n(e,39),new N(t.a^i.a^e.a,t.b^i.b^e.b)}function F(e){return i(e,6)^i(e,11)^i(e,25)}function H(e){var t=n(e,14),i=n(e,18);return e=n(e,41),new N(t.a^i.a^e.a,t.b^i.b^e.b)}function W(e){return i(e,7)^i(e,18)^e>>>3}function V(e){var t=n(e,1),i=n(e,8);return e=r(e,7),new N(t.a^i.a^e.a,t.b^i.b^e.b)}function B(e){return i(e,17)^i(e,19)^e>>>10}function q(e){var t=n(e,19),i=n(e,61);return e=r(e,6),new N(t.a^i.a^e.a,t.b^i.b^e.b)}function j(e,t){var i=(65535&e)+(65535&t);return((e>>>16)+(t>>>16)+(i>>>16)&65535)<<16|65535&i}function z(e,t,i,n){var r=(65535&e)+(65535&t)+(65535&i)+(65535&n);return((e>>>16)+(t>>>16)+(i>>>16)+(n>>>16)+(r>>>16)&65535)<<16|65535&r}function G(e,t,i,n,r){var o=(65535&e)+(65535&t)+(65535&i)+(65535&n)+(65535&r);return((e>>>16)+(t>>>16)+(i>>>16)+(n>>>16)+(r>>>16)+(o>>>16)&65535)<<16|65535&o}function Y(e,t){var i,n,r;return i=(65535&e.b)+(65535&t.b),r=(65535&(n=(e.b>>>16)+(t.b>>>16)+(i>>>16)))<<16|65535&i,i=(65535&e.a)+(65535&t.a)+(n>>>16),new N((65535&(n=(e.a>>>16)+(t.a>>>16)+(i>>>16)))<<16|65535&i,r)}function K(e,t,i,n){var r,o,s;return r=(65535&e.b)+(65535&t.b)+(65535&i.b)+(65535&n.b),s=(65535&(o=(e.b>>>16)+(t.b>>>16)+(i.b>>>16)+(n.b>>>16)+(r>>>16)))<<16|65535&r,r=(65535&e.a)+(65535&t.a)+(65535&i.a)+(65535&n.a)+(o>>>16),new N((65535&(o=(e.a>>>16)+(t.a>>>16)+(i.a>>>16)+(n.a>>>16)+(r>>>16)))<<16|65535&r,s)}function X(e,t,i,n,r){var o,s,a;return o=(65535&e.b)+(65535&t.b)+(65535&i.b)+(65535&n.b)+(65535&r.b),a=(65535&(s=(e.b>>>16)+(t.b>>>16)+(i.b>>>16)+(n.b>>>16)+(r.b>>>16)+(o>>>16)))<<16|65535&o,o=(65535&e.a)+(65535&t.a)+(65535&i.a)+(65535&n.a)+(65535&r.a)+(s>>>16),new N((65535&(s=(e.a>>>16)+(t.a>>>16)+(i.a>>>16)+(n.a>>>16)+(r.a>>>16)+(o>>>16)))<<16|65535&o,a)}function T(e,t){var i,n,r,o,s,a,l,c,u,p=[],h=M,d=S,f=k,y=_,g=j,m=G,v=[1732584193,4023233417,2562383102,271733878,3285377520];for(e[t>>>5]|=128<<24-t%32,e[15+(t+65>>>9<<4)]=t,u=e.length,l=0;l<u;l+=16){for(i=v[0],n=v[1],r=v[2],o=v[3],s=v[4],c=0;c<80;c+=1)p[c]=c<16?e[c+l]:y(p[c-3]^p[c-8]^p[c-14]^p[c-16],1),a=c<20?m(y(i,5),h(n,r,o),s,1518500249,p[c]):c<40?m(y(i,5),d(n,r,o),s,1859775393,p[c]):c<60?m(y(i,5),f(n,r,o),s,2400959708,p[c]):m(y(i,5),d(n,r,o),s,3395469782,p[c]),s=o,o=r,r=y(n,30),n=i,i=a;v[0]=g(i,v[0]),v[1]=g(n,v[1]),v[2]=g(r,v[2]),v[3]=g(o,v[3]),v[4]=g(s,v[4])}return v}function b(e,t,i){var n,r,o,s,a,l,c,u,p,h,d,f,y,g,m,v,E,_,S,T,b,I,w,R,C,P,A=[],O=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];if(h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],r=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],"SHA-224"===i||"SHA-256"===i)d=64,n=15+(t+65>>>9<<4),g=16,m=1,C=Number,v=j,E=z,_=G,S=W,T=B,b=D,I=F,R=k,w=M,h="SHA-224"===i?h:r;else{if("SHA-384"!==i&&"SHA-512"!==i)throw"Unexpected error in SHA-2 implementation";d=80,n=31+(t+128>>>10<<5),g=32,m=2,v=Y,E=K,_=X,S=V,T=q,b=U,I=H,R=x,w=L,O=[new(C=N)(O[0],3609767458),new C(O[1],602891725),new C(O[2],3964484399),new C(O[3],2173295548),new C(O[4],4081628472),new C(O[5],3053834265),new C(O[6],2937671579),new C(O[7],3664609560),new C(O[8],2734883394),new C(O[9],1164996542),new C(O[10],1323610764),new C(O[11],3590304994),new C(O[12],4068182383),new C(O[13],991336113),new C(O[14],633803317),new C(O[15],3479774868),new C(O[16],2666613458),new C(O[17],944711139),new C(O[18],2341262773),new C(O[19],2007800933),new C(O[20],1495990901),new C(O[21],1856431235),new C(O[22],3175218132),new C(O[23],2198950837),new C(O[24],3999719339),new C(O[25],766784016),new C(O[26],2566594879),new C(O[27],3203337956),new C(O[28],1034457026),new C(O[29],2466948901),new C(O[30],3758326383),new C(O[31],168717936),new C(O[32],1188179964),new C(O[33],1546045734),new C(O[34],1522805485),new C(O[35],2643833823),new C(O[36],2343527390),new C(O[37],1014477480),new C(O[38],1206759142),new C(O[39],344077627),new C(O[40],1290863460),new C(O[41],3158454273),new C(O[42],3505952657),new C(O[43],106217008),new C(O[44],3606008344),new C(O[45],1432725776),new C(O[46],1467031594),new C(O[47],851169720),new C(O[48],3100823752),new C(O[49],1363258195),new C(O[50],3750685593),new C(O[51],3785050280),new C(O[52],3318307427),new C(O[53],3812723403),new C(O[54],2003034995),new C(O[55],3602036899),new C(O[56],1575990012),new C(O[57],1125592928),new C(O[58],2716904306),new C(O[59],442776044),new C(O[60],593698344),new C(O[61],3733110249),new C(O[62],2999351573),new C(O[63],3815920427),new C(3391569614,3928383900),new C(3515267271,566280711),new C(3940187606,3454069534),new C(4118630271,4000239992),new C(116418474,1914138554),new C(174292421,2731055270),new C(289380356,3203993006),new C(460393269,320620315),new C(685471733,587496836),new C(852142971,1086792851),new C(1017036298,365543100),new C(1126000580,2618297676),new C(1288033470,3409855158),new C(1501505948,4234509866),new C(1607167915,987167468),new C(1816402316,1246189591)],h="SHA-384"===i?[new C(3418070365,h[0]),new C(1654270250,h[1]),new C(2438529370,h[2]),new C(355462360,h[3]),new C(1731405415,h[4]),new C(41048885895,h[5]),new C(3675008525,h[6]),new C(1203062813,h[7])]:[new C(r[0],4089235720),new C(r[1],2227873595),new C(r[2],4271175723),new C(r[3],1595750129),new C(r[4],2917565137),new C(r[5],725511199),new C(r[6],4215389547),new C(r[7],327033209)]}for(e[t>>>5]|=128<<24-t%32,e[n]=t,P=e.length,f=0;f<P;f+=g){for(t=h[0],n=h[1],r=h[2],o=h[3],s=h[4],a=h[5],l=h[6],c=h[7],y=0;y<d;y+=1)A[y]=y<16?new C(e[y*m+f],e[y*m+f+1]):E(T(A[y-2]),A[y-7],S(A[y-15]),A[y-16]),u=_(c,I(s),w(s,a,l),O[y],A[y]),p=v(b(t),R(t,n,r)),c=l,l=a,a=s,s=v(o,u),o=r,r=n,n=t,t=v(u,p);h[0]=v(t,h[0]),h[1]=v(n,h[1]),h[2]=v(r,h[2]),h[3]=v(o,h[3]),h[4]=v(s,h[4]),h[5]=v(a,h[5]),h[6]=v(l,h[6]),h[7]=v(c,h[7])}if("SHA-224"===i)e=[h[0],h[1],h[2],h[3],h[4],h[5],h[6]];else if("SHA-256"===i)e=h;else if("SHA-384"===i)e=[h[0].a,h[0].b,h[1].a,h[1].b,h[2].a,h[2].b,h[3].a,h[3].b,h[4].a,h[4].b,h[5].a,h[5].b];else{if("SHA-512"!==i)throw"Unexpected error in SHA-2 implementation";e=[h[0].a,h[0].b,h[1].a,h[1].b,h[2].a,h[2].b,h[3].a,h[3].b,h[4].a,h[4].b,h[5].a,h[5].b,h[6].a,h[6].b,h[7].a,h[7].b]}return e}o.exports?o.exports=t:t}()}),tl=bi.HTMLElementUtils,il=c.of("ErrorDisplayManager"),nl=function(){function o(e){void 0===e&&(e=document),this.parent=null,this.localizationStore=null,this.amazonUrlCreator=null,this.onClosePlayerClicked=null,this.documentRef=e}return o.prototype.initialize=function(e,t,i,n){this.parent=il(e,"parent").exists(),this.localizationStore=il(t,"localizationStore").exists(),this.amazonUrlCreator=il(i,"amazonUrlCreator").exists(),this.onClosePlayerClicked=il(n,"onClosePlayerClicked").is.a.function()},o.prototype.showError=function(e,t){void 0===t&&(t=!0),il(this.parent,"this.parent").exists(),il(e,"template").exists();var i=this.documentRef.createElement("div");i.style.height="100%",i.style.width="100%",i.innerHTML=e.renderString(this.localizationStore.getLocalization(),this.amazonUrlCreator),this.parent.appendChild(i);for(var n=tl.getElementsByClassName(i,o.CLOSE_PLAYER_BUTTON_CLASS),r=0;r<n.length;r++)t?n[r].onclick=this.onClosePlayerClicked:n[r].style.display="none"},o.CLOSE_PLAYER_BUTTON_CLASS="closePlayerButton",o}(),rl=n(function(e,n){!function(e,t){if(n)t(n);else{var i={};t(i),e.Mustache=i}}(l,function(v){var n=RegExp.prototype.test;var r=/\S/;function E(e){return t=r,i=e,!n.call(t,i);var t,i}var t=Object.prototype.toString,d=Array.isArray||function(e){return'[object Array]'===t.call(e)};function f(e){return'function'==typeof e}function _(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;',"/":'&#x2F;'};function S(e){if(!d(e)||2!==e.length)throw new Error('Invalid tags: '+e);return[new RegExp(_(e[0])+"\\s*"),new RegExp("\\s*"+_(e[1]))]}var T=/\s*/,b=/\s+/,I=/\s*=/,w=/\s*\}/,R=/#|\^|\/|>|\{|&|=|!/;function C(e){this.string=e,this.tail=e,this.pos=0}function o(e,t){this.view=null==e?{}:e,this.cache={'.':this.view},this.parent=t}function e(){this.cache={}}C.prototype.eos=function(){return""===this.tail},C.prototype.scan=function(e){var t=this.tail.match(e);if(t&&0===t.index){var i=t[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i}return""},C.prototype.scanUntil=function(e){var t,i=this.tail.search(e);switch(i){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,i),this.tail=this.tail.substring(i)}return this.pos+=t.length,t},o.prototype.push=function(e){return new o(e,this)},o.prototype.lookup=function(e){var t;if(e in this.cache)t=this.cache[e];else{for(var i=this;i;){if(0<e.indexOf('.')){t=i.view;for(var n=e.split('.'),r=0;null!=t&&r<n.length;)t=t[n[r++]]}else t=i.view[e];if(null!=t)break;i=i.parent}this.cache[e]=t}return f(t)&&(t=t.call(this.view)),t},e.prototype.clearCache=function(){this.cache={}},e.prototype.parse=function(e,t){var i=this.cache,n=i[e];return null==n&&(n=i[e]=function(e,t){e=e||'','string'==typeof(t=t||v.tags)&&(t=t.split(b));var i,n,r,o,s,a,l=S(t),c=new C(e),u=[],p=[],h=[],d=!1,f=!1;function y(){if(d&&!f)for(;h.length;)delete p[h.pop()];else h=[];f=d=!1}for(;!c.eos();){if(i=c.pos,r=c.scanUntil(l[0]))for(var g=0,m=r.length;g<m;++g)E(o=r.charAt(g))?h.push(p.length):f=!0,p.push(['text',o,i,i+1]),i+=1,'\n'===o&&y();if(!c.scan(l[0]))break;if(d=!0,n=c.scan(R)||'name',c.scan(T),'='===n?(r=c.scanUntil(I),c.scan(I),c.scanUntil(l[1])):'{'===n?(r=c.scanUntil(new RegExp('\\s*'+_('}'+t[1]))),c.scan(w),c.scanUntil(l[1]),n='&'):r=c.scanUntil(l[1]),!c.scan(l[1]))throw new Error('Unclosed tag at '+c.pos);if(s=[n,r,i,c.pos],p.push(s),'#'===n||'^'===n)u.push(s);else if('/'===n){if(!(a=u.pop()))throw new Error('Unopened section "'+r+'" at '+i);if(a[1]!==r)throw new Error('Unclosed section "'+a[1]+'" at '+i)}else'name'===n||'{'===n||'&'===n?f=!0:'='===n&&(l=S(t=r.split(b)))}if(a=u.pop())throw new Error('Unclosed section "'+a[1]+'" at '+c.pos);return function(e){for(var t,i=[],n=i,r=[],o=0,s=e.length;o<s;++o)switch((t=e[o])[0]){case'#':case'^':n.push(t),r.push(t),n=t[4]=[];break;case'/':r.pop()[5]=t[2],n=0<r.length?r[r.length-1][4]:i;break;default:n.push(t)}return i}(function(e){for(var t,i,n=[],r=0,o=e.length;r<o;++r)(t=e[r])&&('text'===t[0]&&i&&'text'===i[0]?(i[1]+=t[1],i[3]=t[3]):(n.push(t),i=t));return n}(p))}(e,t)),n},e.prototype.render=function(e,t,i){var n=this.parse(e),r=t instanceof o?t:new o(t);return this.renderTokens(n,r,i,e)},e.prototype.renderTokens=function(e,t,i,n){var r,o,s='',a=this;function l(e){return a.render(e,t,i)}for(var c=0,u=e.length;c<u;++c)switch((r=e[c])[0]){case'#':if(!(o=t.lookup(r[1])))continue;if(d(o))for(var p=0,h=o.length;p<h;++p)s+=this.renderTokens(r[4],t.push(o[p]),i,n);else if('object'==typeof o||'string'==typeof o)s+=this.renderTokens(r[4],t.push(o),i,n);else if(f(o)){if('string'!=typeof n)throw new Error('Cannot use higher-order sections without the original template');null!=(o=o.call(t.view,n.slice(r[3],r[5]),l))&&(s+=o)}else s+=this.renderTokens(r[4],t,i,n);break;case'^':(!(o=t.lookup(r[1]))||d(o)&&0===o.length)&&(s+=this.renderTokens(r[4],t,i,n));break;case'>':if(!i)continue;null!=(o=f(i)?i(r[1]):i[r[1]])&&(s+=this.renderTokens(this.parse(o),t,i,o));break;case'&':null!=(o=t.lookup(r[1]))&&(s+=o);break;case'name':null!=(o=t.lookup(r[1]))&&(s+=v.escape(o));break;case'text':s+=r[1]}return s},v.name="mustache.js",v.version="0.8.1",v.tags=["{{","}}"];var s=new e;v.clearCache=function(){return s.clearCache()},v.parse=function(e,t){return s.parse(e,t)},v.render=function(e,t,i){return s.render(e,t,i)},v.to_html=function(e,t,i,n){var r=v.render(e,t,i);if(!f(n))return r;n(r)},v.escape=function(e){return String(e).replace(/[&<>"'\/]/g,function(e){return i[e]})},v.Scanner=C,v.Context=o,v.Writer=e})}),ol=c.of("ModalTemplate"),sl=function(){function e(e){this.mustacheTemplate="<div class=\"table\"><div class=\"tableCell\"><div class=\"modal\">{{>contents}}</div></div></div>",this.key=ol(e,"key").is.a.string()}return e.prototype.renderString=function(e,t,i){ol(e,"localization").exists(),I.isNullOrUndefined(i)&&(i={contents:"{{{description}}}"});var n={contactUsDigitalUrl:t.createCSUrl("CONTACT_US_DIGITAL"),contactUsOrdersUrl:t.createCSUrl("CONTACT_US_ORDERS"),devicesAndFeatures:t.createCSUrl("DEVICES_AND_FEATURES"),systemRequirementsUrl:t.createCSUrl("SYSTEM_REQUIREMENTS"),avSettingsUrl:t.createCSUrl("AV_SETTINGS"),resetPinUrl:t.createCSUrl("RESET_PIN"),setupPinUrl:t.createCSUrl("SETUP_PIN"),videoHelpUrl:t.createCSUrl("VIDEO_HELP"),videoIssuesUrl:t.createCSUrl("VIDEO_ISSUES")},r=e[this.key];return r.description=rl.render(r.description,n),r.notes=rl.render(r.notes,n),r.footer=rl.render(r.footer,n),r.incorrectPin=rl.render(r.incorrectPin,n),r.troubleshoot=rl.render(r.troubleshoot,n),rl.render(this.mustacheTemplate,r,i)},e}(),al=l&&l.__extends||(ja=function(e,t){return(ja=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}ja(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ll=function(r){function o(e){return r.call(this,e)||this}return al(o,r),o.prototype.renderString=function(e,t,i){var n={closeButton:"<div class=\"closePlayerButton closePlayer html5\"></div>",contents:o.TEMPLATE,extraText:""};return I.isNullOrUndefined(i)||b.extend(n,i),r.prototype.renderString.call(this,e,t,n)},o.TEMPLATE="<div class='title'>{{{title}}}{{>closeButton}}</div><div class='description'>{{{description}}}{{>extraText}}</div>{{#footer}}<div class='footer'>{{{footer}}}</div>{{/footer}}",o}(sl),cl=l&&l.__extends||(za=function(e,t){return(za=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}za(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ul=function(i){function n(e){return i.call(this,e)||this}return cl(n,i),n.prototype.renderString=function(e,t){return i.prototype.renderString.call(this,e,t,{extraText:n.PIN_TEMPLATE})},n.PIN_TEMPLATE="<div class='pinFields'></div><div class='incorrectPINText'>{{{incorrectPin}}}</div><div class='notes'>{{{notes}}}</div>",n}(ll),pl=bi.Version,hl=zo.BrowserType,dl=Ue.PINAcceptedEvent,fl=Ue.PINDeclinedEvent,yl=Ue.PINErrorEvent,gl=Ue.PINRequiredEvent,ml=bi.HTMLElementUtils,vl=c.of("PINDisplayManager"),El=Ve.get("PINDisplayManager"),_l=function(){function o(e){if(I.isNullOrUndefined(e)){var t=zo.getBrowser();this.isIE9=t.getType()===hl.IE&&t.getVersion().compareTo(pl.fromNumber(10))<0}else this.isIE9=e}return o.prototype.initialize=function(e,t,i,n,r,o){this.webPlayer=vl(e,"webPlayer").exists(),this.eventEmitter=vl(t,"eventEmitter").exists(),this.parent=vl(i,"parent").exists(),this.localizationStore=vl(n,"localizationStore").exists(),this.amazonUrlCreator=vl(r,"amazonUrlCreator").exists(),this.onClosePlayerClicked=vl(o,"onClosePlayerClicked").is.a.function(),this.attachEventListeners(),this.createDOMElements(),this.validatingPIN=!1},o.prototype.requestPIN=function(e){var t=this;I.isNullOrUndefined(e)&&(e=this.pinLength),vl(this.parent,"this.parent").exists(),vl(0!==e,"pinLength !== 0").is.true();var i=ml.getElementsByClassName(this.pinWrapper,o.PIN_FIELDS_CLASS)[0];i.innerHTML="",this.pinFields=[],this.pinValues=[];for(var n=0;n<e;n++){var r=document.createElement("input");r.type="text",r.maxLength=1,r.className=o.PIN_FIELD_CLASS,this.isIE9&&(r.className+=" ie9"),i.appendChild(r),this.pinFields.push(r),r.onkeydown=function(e){t.onKeyDown(e)},r.onkeyup=function(){t.onKeyUp()},this.pinValues.push("")}0===ml.getElementsByClassName(this.parent,o.PIN_WRAPPER_CLASS).length&&this.parent.appendChild(this.pinWrapper),this.pinWrapper.style.display="block",this.pinFields[0].focus()},o.prototype.hideModal=function(){this.toggleVisibility(o.INCORRECT_PIN_TEXT_CLASS,!1),this.pinWrapper.style.display=""},o.prototype.onPINRequired=function(e){this.pinLength=e.getPINLength()},o.prototype.onPINAccepted=function(){El.info("PIN on playback was accepted."),this.validatingPIN=!1,this.toggleVisibility(o.INCORRECT_PIN_TEXT_CLASS,!1),this.hideModal()},o.prototype.onPINDeclined=function(){El.info("PIN on playback was declined."),this.validatingPIN=!1,this.toggleVisibility(o.INCORRECT_PIN_TEXT_CLASS,!0);for(var e=0;e<this.pinFields.length;e++)this.pinFields[e].value="",this.pinValues[e]="";this.pinFields[0].focus()},o.prototype.onPINError=function(){El.error("Error returned by ValidatePin API."),this.validatingPIN=!1,this.toggleVisibility(o.INCORRECT_PIN_TEXT_CLASS,!1),this.hideModal()},o.prototype.toggleVisibility=function(e,t){ml.getElementsByClassName(this.pinWrapper,e)[0].style.display=t?"block":"none"},o.prototype.keyCodeIsNumber=function(e){return o.START_OF_NUMBER_KEYCODES<=e&&e<=o.END_OF_NUMBER_KEYCODES||o.START_OF_NUMPAD_KEYCODES<=e&&e<=o.END_OF_NUMPAD_KEYCODES},o.prototype.pinIsEntered=function(){for(var e=0;e<this.pinValues.length;e++)if(""===this.pinValues[e])return!1;return!0},o.prototype.onKeyDown=function(e){var t=(e=e||event).target||e.srcElement,i=b.indexOf(this.pinFields,t),n=window.event?e.keyCode:e.which;if(n===o.DELETE_KEYCODE||n===o.BACKSPACE_KEYCODE){this.preventDefault(e);var r=i;0<i&&""===this.pinFields[i].value&&(r=i-1),this.pinFields[r].focus(),this.pinFields[r].value="",this.pinValues[r]=""}else this.keyCodeIsNumber(n)?(this.preventDefault(e),o.END_OF_NUMBER_KEYCODES<n&&(n-=o.START_OF_NUMBER_KEYCODES),this.pinFields[i].value="",this.pinValues[i]=String.fromCharCode(n),i!==this.pinFields.length-1&&this.pinFields[i+1].focus()):n===o.ESCAPE_KEYCODE?this.onCancelPIN():n!==o.TAB_KEYCODE&&n!==o.SHIFT_KEYCODE&&this.preventDefault(e)},o.prototype.preventDefault=function(e){I.isNullOrUndefined(e.preventDefault)?e.returnValue=!1:e.preventDefault()},o.prototype.onKeyUp=function(){this.onSubmitPIN()},o.prototype.getPINString=function(){for(var e="",t=0;t<this.pinValues.length;t++)e+=this.pinValues[t];return e},o.prototype.onCancelPIN=function(){El.info("PIN on playback was cancelled."),this.hideModal(),this.onClosePlayerClicked()},o.prototype.onSubmitPIN=function(){this.pinIsEntered()&&!this.validatingPIN&&(El.info("PIN on playback was submitted."),this.validatingPIN=!0,this.webPlayer.validatePIN(this.getPINString()))},o.prototype.attachEventListeners=function(){var t=this;this.webPlayer.on(dl,function(){t.onPINAccepted()}),this.webPlayer.on(fl,function(){t.onPINDeclined()}),this.webPlayer.on(yl,function(){t.onPINError()}),this.webPlayer.on(gl,function(e){t.onPINRequired(e)})},o.prototype.createDOMElements=function(){var e=this;this.pinModalTemplate=new ul(o.LOCALIZATION_KEY),this.pinWrapper=document.createElement("div"),this.pinWrapper.className=o.PIN_WRAPPER_CLASS,this.pinWrapper.style.display="none",this.pinWrapper.innerHTML=this.pinModalTemplate.renderString(this.localizationStore.getLocalization(),this.amazonUrlCreator);for(var t=ml.getElementsByClassName(this.pinWrapper,o.CLOSE_PLAYER_BUTTON_CLASS),i=0;i<t.length;i++)t[i].onclick=function(){e.onCancelPIN()}},o.LOCALIZATION_KEY="pinModal",o.CLOSE_PLAYER_BUTTON_CLASS="closePlayerButton",o.INCORRECT_PIN_TEXT_CLASS="incorrectPINText",o.PIN_FIELD_CLASS="pinField",o.PIN_FIELDS_CLASS="pinFields",o.PIN_WRAPPER_CLASS="pinWrapper",o.START_OF_NUMBER_KEYCODES=48,o.END_OF_NUMBER_KEYCODES=57,o.START_OF_NUMPAD_KEYCODES=96,o.END_OF_NUMPAD_KEYCODES=105,o.BACKSPACE_KEYCODE=8,o.DELETE_KEYCODE=46,o.ESCAPE_KEYCODE=27,o.SHIFT_KEYCODE=16,o.TAB_KEYCODE=9,o}(),Sl=l&&l.__assign||function(){return(Sl=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Tl=tt.MarketplaceID,bl=Rn.TokenType,Il=ji.HttpRequest,wl=Ue.ErrorSeverity,Rl=at.timer,Cl=c.of("QosReporter"),Pl=Ve.get("QosReporter"),Al=function(){function s(){this.initialized=!1,this.flushTimeout=null,this.eventQueue=[]}return s.prototype.preInitialize=function(e,t,i,n,r,o,s,a,l,c){this.partnerServiceUrl=Cl(e,"partnerServiceUrl").is.a.string(),this.clientVersion=Cl(t,"version").is.a.string(),this.marketplaceId=Cl(i,"marketplaceId").is.a.string(),this.deviceTypeId=Cl(n,"deviceTypeId").is.a.string(),this.deviceId=Cl(r,"deviceId").is.a.string(),this.primitiveSessionId=Cl(o,"primitiveSessionId").is.a.string(),this.operatingSystem=Cl(s,"operatingSystem").is.a.string(),this.browser=Cl(a,"browser").is.a.string(),this.clientId=l,this.tokenClient=c},s.prototype.initialize=function(e,t){this.clientVersion=Cl(e,"version").is.a.string(),this.deviceTypeId=Cl(t,"deviceTypeId").is.a.string(),this.initialized=!0,this.tryFlush()},s.prototype.updateSessionIds=function(e,t){this.userWatchSessionId=e,this.primitiveSessionId=t},s.prototype.setAsin=function(e){this.asin=e},s.prototype.setTokenClient=function(e){this.tokenClient=e},s.prototype.reportError=function(e,t,i,n){var r={eventType:"Error",eventSubtype:e,errorSeverity:Math.min(5,Math.max(1,t)).toString(),httpCode:i,note:n};this.enqueueEvent(r),t<=s.DO_NOT_QUEUE_SEVERITY&&this.flush()},s.prototype.reportInformation=function(e,t,i){var n={eventType:"Information",eventSubtype:e,note:t,duration:i};this.enqueueEvent(n)},s.prototype.flush=function(){var t=this;I.isNullOrUndefined(this.partnerServiceUrl)||0!==this.eventQueue.length&&(I.exists(this.tokenClient)?this.tokenClient.getToken(function(e){t.sendEventBatch(e)},function(){Pl.warn("Could not get auth token, reporting without token."),t.sendEventBatch(null)}):this.sendEventBatch(null),clearTimeout(this.flushTimeout),this.flushTimeout=null)},s.prototype.enqueueEvent=function(e){var t=this.requestParamsToReportEventInput(Sl({},e,{enqueueTime:(new Date).getTime()}));this.eventQueue.push(t),this.tryFlush()},s.prototype.tryFlush=function(){var e=this;this.initialized&&(this.eventQueue.length>=s.MAX_QUEUE_SIZE?this.flush():I.isNullOrUndefined(this.flushTimeout)&&(this.flushTimeout=Rl.setTimeout(function(){return e.flush()},s.FLUSH_TIMEOUT_MS)))},s.prototype.sendEventBatch=function(e){var t=this,i=this.partnerServiceUrl.replace(/\/$/,"")+s.ENDPOINT,n=Il.post(i).withCredentials(),r=this.removeMissingParameters({gascEnabled:(!Tl.isClassic(this.marketplaceId)).toString(),firmware:s.FIRMWARE,version:s.VERSION,client_version:this.clientVersion,marketplaceId:this.marketplaceId,deviceTypeID:this.deviceTypeId,sourceSystem:this.deviceTypeId,deviceID:this.deviceId,operatingSystem:this.operatingSystem,browser:this.browser});I.exists(e)&&e.type===bl.OAUTH&&n.bearerToken(e.token);var o=b.map(this.eventQueue,function(e){return t.prepareEventForReporting(e)});try{n.field("metrics",JSON.stringify(o)).query(r).send()}catch(e){Pl.error(e)}this.eventQueue.length=0},s.prototype.requestParamsToReportEventInput=function(e){return this.removeMissingParameters(Sl({asin:this.asin,clientId:this.clientId,primitiveSessionId:this.primitiveSessionId,streamingSessionId:this.primitiveSessionId,userWatchSessionId:this.userWatchSessionId},e))},s.prototype.prepareEventForReporting=function(e){var t=this.requestParamsToReportEventInput(e);return null!=t.enqueueTime&&(t.eventAge=(new Date).getTime()-t.enqueueTime,delete t.enqueueTime),t},s.prototype.removeMissingParameters=function(t){var e=b.chain(t).keys().filter(function(e){return I.isNullOrUndefined(t[e])}).value();return b.omit(t,e)},s.ENDPOINT="/cdp/usage/ReportEvent",s.FIRMWARE="1",s.VERSION="1",s.MAX_QUEUE_SIZE=5,s.DO_NOT_QUEUE_SEVERITY=wl.Fatal,s.FLUSH_TIMEOUT_MS=1e4,s}(),Ol=c.of("NotificationManager"),Nl={NotificationManager:function(){function e(){this.initialized=!1}return e.prototype.initialize=function(e,t,i){void 0===i&&(i=1),Ol(!this.initialized,"!this.initialized").is.true(),this.onShowNotification=Ol(e,"onShowNotification").exists(),this.onCloseNotification=Ol(t,"onCloseNotification").exists(),this.currentNotifications=[],this.maxNotificationsAtOnce=i,this.queuedNotifications=[],this.initialized=!0},e.prototype.addNotification=function(e,t){void 0===t&&(t=!0),Ol(this.initialized,"this.initialized").is.true(),Ol(e,"notification").exists(),this.queuedNotifications.push(e),t&&this.runNotification()},e.prototype.hasQueuedNotifications=function(){return 0!==this.queuedNotifications.length},e.prototype.showQueuedNotifications=function(){this.runNotification()},e.prototype.cancelNotification=function(i){var n=this;Ol(this.initialized,"this.initialized").is.true(),Ol(i,"notification").exists(),b.some(this.currentNotifications,function(e){if(e.notification===i)return n.closeNotification(i),!0})||b.some(this.queuedNotifications,function(e,t){if(e===i)return n.queuedNotifications.splice(t,1),!0})},e.prototype.closeNotification=function(t){b.some(this.currentNotifications,function(e){if(e.notification===t&&!I.isNullOrUndefined(e.timeoutID))return clearTimeout(e.timeoutID),!0}),this.runNextNotification(t)},e.prototype.runNotification=function(){var e=this;if(this.currentNotifications.length!==this.maxNotificationsAtOnce){var t={notification:this.queuedNotifications.shift()};I.isNullOrUndefined(t.notification)||(this.currentNotifications.push(t),this.onShowNotification(t.notification),I.exists(t.notification.getDisplayTimeSeconds())&&(t.timeoutID=setTimeout(function(){e.runNextNotification(t.notification)},1e3*t.notification.getDisplayTimeSeconds())))}},e.prototype.runNextNotification=function(i){var n=this;this.onCloseNotification(i),b.some(this.currentNotifications,function(e,t){if(e.notification===i)return n.currentNotifications.splice(t,1),!0}),0<this.queuedNotifications.length&&this.runNotification()},e}()}.NotificationManager,Ml=bi.HTMLElementUtils,Ll=c.of("NotificationDisplayManager"),kl=Ve.get("NotificationDisplayManager"),xl=function(){function s(e,t,i){void 0===e&&(e=new Nl),void 0===t&&(t=window),void 0===i&&(i=document);var n=this;this.localizationStore=null,this.amazonUrlCreator=null,this.notificationContainerElement=null,this.currentNotification=null,this.hidingNotification=!1,this.notificationHiddenCallback=null,this.onWindowResize=function(){0<n.notificationContainerElement.offsetHeight&&n.setNotificationAndPlayerHeight()},this.notificationManager=e,this.windowRef=t,this.documentRef=i}return s.prototype.initialize=function(e,t,i,n){var r=this;this.parent=Ll(e,"parent").exists(),this.playerElement=Ll(t,"player").exists(),this.localizationStore=Ll(i,"localizationStore").exists(),this.amazonUrlCreator=Ll(n,"amazonUrlCreator").exists(),this.notificationManager.initialize(function(e){r.hidingNotification?null===r.notificationHiddenCallback?r.notificationHiddenCallback=function(){r.onShowNotification(e)}:kl.error("Attempted to show a notification while another notification is waiting to be shown"):r.onShowNotification(e)},function(e){r.onCloseNotification(e)})},s.prototype.addNotification=function(e,t){void 0===t&&(t=!0),Ll(e,"event").exists(),this.tryInitializeContainer(),this.notificationManager.addNotification(e,t)},s.prototype.cancelNotification=function(e){Ll(e,"event").exists(),this.notificationManager.cancelNotification(e)},s.prototype.showQueuedNotifications=function(){this.notificationManager.hasQueuedNotifications()&&(this.setNotificationAndPlayerHeight(),this.notificationManager.showQueuedNotifications())},s.prototype.onShowNotification=function(e){this.tryInitializeContainer(),this.currentNotification=e;var t=this.localizationStore.getLocalization(),i={contactUsDigitalUrl:this.amazonUrlCreator.createCSUrl("CONTACT_US_DIGITAL"),contactUsOrdersUrl:this.amazonUrlCreator.createCSUrl("CONTACT_US_ORDERS"),devicesAndFeatures:this.amazonUrlCreator.createCSUrl("DEVICES_AND_FEATURES"),systemRequirementsUrl:this.amazonUrlCreator.createCSUrl("SYSTEM_REQUIREMENTS"),avSettingsUrl:this.amazonUrlCreator.createCSUrl("AV_SETTINGS"),resetPinUrl:this.amazonUrlCreator.createCSUrl("RESET_PIN"),setupPinUrl:this.amazonUrlCreator.createCSUrl("SETUP_PIN"),videoHelpUrl:this.amazonUrlCreator.createCSUrl("VIDEO_HELP"),videoIssuesUrl:this.amazonUrlCreator.createCSUrl("VIDEO_ISSUES")};this.messageTextElement.innerHTML=this.currentNotification.getMessageTemplate().renderString(t,i)+" ",this.expandedMessageElement.innerHTML="";var n=this.currentNotification.getClosable(),r=I.exists(this.currentNotification.getOnDontShowAgain()),o=!1;I.exists(this.currentNotification.getExpandedMessageTemplate())&&(this.expandedMessageElement.innerHTML=this.currentNotification.getExpandedMessageTemplate().renderString(t,i),o=!0),this.addWindowListeners(),Ml.addClass(this.playerElement,s.PLAYER_HEIGHT_TRANSITION_CSS_CLASS),this.messageIsExpanded=!1,this.showMoreButton.innerHTML=t.notification.showMore,this.showMoreButton.style.display=o?"":"none",this.showMoreDivider.style.display=o&&(n||r)?"":"none",this.dismissButton.style.display=n?"":"none",this.dismissDivider.style.display=n&&r?"":"none",this.dontShowAgainButton.style.display=r?"":"none",this.setNotificationAndPlayerHeight()},s.prototype.onCloseNotification=function(e){e===this.currentNotification&&this.hideNotification()},s.prototype.tryInitializeContainer=function(){var t=this;if(!this.notificationInitialized){this.messageIsExpanded=!1,this.notificationContainerElement=this.documentRef.createElement("div"),this.notificationContainerElement.className=s.CONTAINER_CSS_CLASS;var e=this.localizationStore.getLocalization(),i={dismiss:e.notification.dismiss,dismiss_button_css_class:s.DISMISS_BUTTON_CSS_CLASS,dismiss_divider_css_class:s.DISMISS_DIVIDER_CSS_CLASS,dont_show_again:e.notification.dontShowAgain,dont_show_again_css_class:s.DONT_SHOW_AGAIN_BUTTON_CSS_CLASS,expanded_message_css_class:s.EXPANDED_MESSAGE_CSS_CLASS,message_css_class:s.MESSAGE_CSS_CLASS,message_text_css_class:s.MESSAGE_TEXT_CSS_CLASS,show_more:e.notification.showMore,show_more_button_css_class:s.SHOW_MORE_BUTTON_CSS_CLASS,show_more_divider_css_class:s.SHOW_MORE_DIVIDER_CSS_CLASS};this.notificationContainerElement.innerHTML=rl.render(s.MUSTACHE_TEMPLATE,i),this.parent.insertBefore(this.notificationContainerElement,this.parent.firstChild),this.messageElement=Ml.getElementsByClassName(this.notificationContainerElement,s.MESSAGE_CSS_CLASS)[0],this.messageTextElement=Ml.getElementsByClassName(this.notificationContainerElement,s.MESSAGE_TEXT_CSS_CLASS)[0],this.expandedMessageElement=Ml.getElementsByClassName(this.notificationContainerElement,s.EXPANDED_MESSAGE_CSS_CLASS)[0],this.showMoreButton=Ml.getElementsByClassName(this.notificationContainerElement,s.SHOW_MORE_BUTTON_CSS_CLASS)[0],this.showMoreButton.onclick=function(){t.toggleExpandedMessage()},this.dismissButton=Ml.getElementsByClassName(this.notificationContainerElement,s.DISMISS_BUTTON_CSS_CLASS)[0],this.dismissButton.onclick=function(){t.cancelNotification(t.currentNotification)},this.dontShowAgainButton=Ml.getElementsByClassName(this.notificationContainerElement,s.DONT_SHOW_AGAIN_BUTTON_CSS_CLASS)[0],this.dontShowAgainButton.onclick=function(){if(I.exists(t.currentNotification)){var e=t.currentNotification.getOnDontShowAgain();I.exists(e)&&e(),t.cancelNotification(t.currentNotification)}else t.hideNotification()},this.dismissDivider=Ml.getElementsByClassName(this.notificationContainerElement,s.DISMISS_DIVIDER_CSS_CLASS)[0],this.showMoreDivider=Ml.getElementsByClassName(this.notificationContainerElement,s.SHOW_MORE_DIVIDER_CSS_CLASS)[0],this.hideNotification(),this.notificationInitialized=!0}},s.prototype.hideNotification=function(){var e=this;this.removeWindowListeners(),this.messageIsExpanded=!1,this.notificationContainerElement.style.height="0px",this.playerElement.style.height="100%",null!==this.currentNotification?(this.hidingNotification=!0,setTimeout(function(){e.onNotificationHidden()},s.NOTIFICATION_CLOSE_TIME)):this.onNotificationHidden()},s.prototype.onNotificationHidden=function(){this.hidingNotification=!1,Ml.removeClass(this.playerElement,s.PLAYER_HEIGHT_TRANSITION_CSS_CLASS),this.expandedMessageElement.innerHTML="",this.messageTextElement.innerHTML="",this.showMoreButton.innerHTML="",this.dismissButton.style.display="none",this.dismissDivider.style.display="none",this.dontShowAgainButton.style.display="none",this.showMoreButton.style.display="none",this.showMoreDivider.style.display="none",(this.currentNotification=null)!==this.notificationHiddenCallback&&(this.notificationHiddenCallback(),this.notificationHiddenCallback=null)},s.prototype.toggleExpandedMessage=function(){var e=this.localizationStore.getLocalization();this.messageIsExpanded=!this.messageIsExpanded,this.showMoreButton.innerHTML=this.messageIsExpanded?e.notification.showLess:e.notification.showMore,this.setNotificationAndPlayerHeight()},s.prototype.addWindowListeners=function(){this.windowRef.addEventListener?this.windowRef.addEventListener("resize",this.onWindowResize,!0):this.windowRef.attachEvent&&this.windowRef.attachEvent("onresize",this.onWindowResize)},s.prototype.removeWindowListeners=function(){this.windowRef.removeEventListener?this.windowRef.removeEventListener("resize",this.onWindowResize):this.windowRef.detachEvent&&this.windowRef.detachEvent("onresize",this.onWindowResize)},s.prototype.setNotificationAndPlayerHeight=function(){this.messageIsExpanded?(this.notificationContainerElement.style.height=this.messageElement.offsetHeight+this.expandedMessageElement.offsetHeight+"px",this.playerElement.style.height=this.parent.offsetHeight-this.messageElement.offsetHeight-this.expandedMessageElement.offsetHeight+"px"):(this.notificationContainerElement.style.height=this.messageElement.offsetHeight+"px",this.playerElement.style.height=this.parent.offsetHeight-this.messageElement.offsetHeight+"px")},s.CONTAINER_CSS_CLASS="notificationContainer",s.DISMISS_BUTTON_CSS_CLASS="dismissButton",s.DISMISS_DIVIDER_CSS_CLASS="dismissDivider",s.DONT_SHOW_AGAIN_BUTTON_CSS_CLASS="dontShowAgainButton",s.EXPANDED_MESSAGE_CSS_CLASS="notificationExpandedMessage",s.MESSAGE_CSS_CLASS="notificationMessage",s.MESSAGE_TEXT_CSS_CLASS="notificationMessageText",s.PLAYER_HEIGHT_TRANSITION_CSS_CLASS="heightTransition",s.SHOW_MORE_BUTTON_CSS_CLASS="showMoreButton",s.SHOW_MORE_DIVIDER_CSS_CLASS="showMoreDivider",s.MUSTACHE_TEMPLATE="<div class='{{{message_css_class}}}'>\n            <span class='{{{message_text_css_class}}}'></span>\n            <a style='display:none;' class='{{{show_more_button_css_class}}}'>{{{show_more}}}</a>\n            <span style='display:none;' class='{{{show_more_divider_css_class}}}'> | </span>\n            <a style='display:none;' class='{{{dismiss_button_css_class}}}'>{{{dismiss}}}</a>\n            <span style='display:none;' class='{{{dismiss_divider_css_class}}}'> | </span>\n            <a style='display:none;' class='{{{dont_show_again_css_class}}}'>{{{dont_show_again}}}</a>\n        </div>\n        <div class='{{{expanded_message_css_class}}}'></div>",s.NOTIFICATION_CLOSE_TIME=200,s}(),Dl=Ue.NotificationEvent,Ul=bi.LocalStorage,Fl=function(){function e(e,t){void 0===t&&(t=new Ul);var i=this;this.getTemplate=function(){var t=i.browserUpdateKey;return{renderString:function(e){return e[t]}}},this.browserUpdateKey=e,this.storage=t}return e.prototype.createNotification=function(){var e=this;return new Dl(this.getTemplate(),null,!0,null,function(){return e.setDontShowAgain()})},e.prototype.setDontShowAgain=function(){this.storage.set(e.DONT_SHOW_AGAIN_KEY,"true")},e.DONT_SHOW_AGAIN_KEY="dont_show_update_browser",e}(),Hl=Ve.get("SpinnerPanel"),Wl=c.of("SpinnerPanel"),Vl=function(){function t(){}return t.prototype.initialize=function(e,t,i,n){this.parent=Wl(e,"parent").exists(),this.assetsRoot=Wl(t,"assetsRoot").is.a.string(),this.contents=n,this.createHTMLElements(i)},t.prototype.uninitialize=function(){if(I.exists(this.parent)&&I.exists(this.spinner)&&this.spinner.parentNode===this.parent)try{this.parent.removeChild(this.spinner)}catch(e){Hl.error("Failed to remove spinner from parent",e)}},t.prototype.createHTMLElements=function(e){this.spinner=document.createElement("div"),this.spinner.className="playerLoadingOverlay",this.spinner.style.width="100%",this.spinner.style.height="100%",this.spinner.innerHTML=e?"<div style=\"width:100%; height:44%\"></div><div style=\"width:100%; height:11.36%\"><img class=\"spinning orangeSpinner\" src=\""+this.assetsRoot+"/"+t.SPINNER_PNG_PATH+"\"/></div><div style=\"width:100%; height:4.5%\"></div>":'<div class="spinning whiteSpinner"></div>',this.parent.appendChild(this.spinner),this.show()},t.prototype.show=function(){this.spinner.style.display="",I.isNullOrUndefined(this.contents)||(this.contents.style.width="1px",this.contents.style.height="1px")},t.prototype.hide=function(){this.spinner.style.display="none",I.isNullOrUndefined(this.contents)||(this.contents.style.width="",this.contents.style.height="")},t.SPINNER_PNG_PATH="img/orange_spinner.png",t}(),Bl=l&&l.__extends||(Ga=function(e,t){return(Ga=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ga(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ql=function(e){function t(){return e.call(this,t.KEY)||this}return Bl(t,e),t.KEY="genericError",t}(ll),jl=l&&l.__extends||(Ya=function(e,t){return(Ya=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ya(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),zl=function(e){function t(){return e.call(this,t.KEY)||this}return jl(t,e),t.KEY="pinAgeVerificationRequired",t}(ll),Gl=l&&l.__extends||(Ka=function(e,t){return(Ka=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Ka(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Yl=function(e){function t(){return e.call(this,t.KEY)||this}return Gl(t,e),t.KEY="pinLookupErrorFsk18",t}(ll),Kl=l&&l.__extends||(Xa=function(e,t){return(Xa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Xa(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Xl=function(e){function t(){return e.call(this,t.KEY)||this}return Kl(t,e),t.KEY="pinSetupRequired",t}(ll),Ql=l&&l.__extends||(Qa=function(e,t){return(Qa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Qa(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),Jl=function(e){function t(){return e.call(this,t.KEY)||this}return Ql(t,e),t.KEY="pinValidationError",t}(ll);(Za=Ja||(Ja={}))[Za.UNINITIALIZED=0]="UNINITIALIZED",Za[Za.INITIALIZING=1]="INITIALIZING",Za[Za.INITIALIZED=2]="INITIALIZED",Za[Za.PREPARING=3]="PREPARING",Za[Za.PREPARED=4]="PREPARED",Za[Za.PLAYING=5]="PLAYING",Za[Za.STOPPING=6]="STOPPING",Za[Za.ABORTED=7]="ABORTED";var Zl=Ja,$l=n(function(e,t){var i;i=function(){var a=!1;try{throw new Error}catch(e){a=!!e.stack}var r,o=_(),t=function(){},u=function(){var i={task:void 0,next:null},t=i,n=!1,r=void 0,o=!1,s=[];function a(){for(var e,t;i.next;)e=(i=i.next).task,i.task=void 0,(t=i.domain)&&(i.domain=void 0,t.enter()),l(e,t);for(;s.length;)l(e=s.pop());n=!1}function l(e,t){try{e()}catch(e){if(o)throw t&&t.exit(),setTimeout(a,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}if(u=function(e){t=t.next={task:e,domain:o&&process.domain,next:null},n||(n=!0,r())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)o=!0,r=function(){process.nextTick(a)};else if("function"==typeof setImmediate)r="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var e=new MessageChannel;e.port1.onmessage=function(){r=c,(e.port1.onmessage=a)()};var c=function(){e.port2.postMessage(0)};r=function(){setTimeout(a,0),c()}}else r=function(){setTimeout(a,0)};return u.runAfter=function(e){s.push(e),n||(n=!0,r())},u}(),i=Function.call;function e(e){return function(){return i.apply(e,arguments)}}var l,c=e(Array.prototype.slice),p=e(Array.prototype.reduce||function(e,t){var i=0,n=this.length;if(1===arguments.length)for(;;){if(i in this){t=this[i++];break}if(++i>=n)throw new TypeError}for(;i<n;i++)i in this&&(t=e(t,this[i],i));return t}),s=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),n=e(Array.prototype.map||function(n,r){var o=this,s=[];return p(o,function(e,t,i){s.push(n.call(r,t,i,o))},void 0),s}),h=Object.create||function(e){function t(){}return t.prototype=e,new t},d=e(Object.prototype.hasOwnProperty),f=Object.keys||function(e){var t=[];for(var i in e)d(e,i)&&t.push(i);return t},y=e(Object.prototype.toString);l="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var g="From previous event:";function m(e,t){if(a&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(g)){for(var i=[],n=t;n;n=n.source)n.stack&&i.unshift(n.stack);i.unshift(e.stack);var r=i.join("\n"+g+"\n");e.stack=function(e){for(var t=e.split("\n"),i=[],n=0;n<t.length;++n){var r=t[n];!E(r)&&(-1===(o=r).indexOf("(module.js:")&&-1===o.indexOf("(node.js:"))&&r&&i.push(r)}var o;return i.join("\n")}(r)}}function v(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var i=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(i)return[i[1],Number(i[2])];var n=/.*@(.+):(\d+)$/.exec(e);return n?[n[1],Number(n[2])]:void 0}function E(e){var t=v(e);if(!t)return!1;var i=t[0],n=t[1];return i===r&&o<=n&&n<=z}function _(){if(a)try{throw new Error}catch(e){var t=e.stack.split("\n"),i=v(0<t[0].indexOf("@")?t[1]:t[2]);if(!i)return;return r=i[0],i[1]}}function S(e){return e instanceof w?e:A(e)?(t=e,i=T(),S.nextTick(function(){try{t.then(i.resolve,i.reject,i.notify)}catch(e){i.reject(e)}}),i.promise):H(e);var t,i}function T(){var r,o=[],s=[],e=h(T.prototype),t=h(w.prototype);if(t.promiseDispatch=function(e,t,i){var n=c(arguments);o?(o.push(n),"when"===t&&i[1]&&s.push(i[1])):S.nextTick(function(){r.promiseDispatch.apply(r,n)})},t.valueOf=function(){if(o)return t;var e=C(r);return P(e)&&(r=e),e},t.inspect=function(){return r?r.inspect():{state:"pending"}},S.longStackSupport&&a)try{throw new Error}catch(e){t.stack=e.stack.substring(e.stack.indexOf("\n")+1)}function i(i){r=i,t.source=i,p(o,function(e,t){S.nextTick(function(){i.promiseDispatch.apply(i,t)})},void 0),s=o=void 0}return e.promise=t,e.resolve=function(e){r||i(S(e))},e.fulfill=function(e){r||i(H(e))},e.reject=function(e){r||i(F(e))},e.notify=function(i){r||p(s,function(e,t){S.nextTick(function(){t(i)})},void 0)},e}function b(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=T();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function I(r){return b(function(e,t){for(var i=0,n=r.length;i<n;i++)S(r[i]).then(e,t)})}function w(r,o,t){void 0===o&&(o=function(e){return F(new Error("Promise does not support operation: "+e))}),void 0===t&&(t=function(){return{state:"unknown"}});var s=h(w.prototype);if(s.promiseDispatch=function(e,t,i){var n;try{n=r[t]?r[t].apply(s,i):o.call(s,t,i)}catch(e){n=F(e)}e&&e(n)},s.inspect=t){var e=t();"rejected"===e.state&&(s.exception=e.reason),s.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?s:e.value}}return s}function R(e,t,i,n){return S(e).then(t,i,n)}function C(e){if(P(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function P(e){return e instanceof w}function A(e){return(t=e)===Object(t)&&"function"==typeof e.then;var t}(S.resolve=S).nextTick=u,S.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(S.longStackSupport=!0),(S.defer=T).prototype.makeNodeResolver=function(){var i=this;return function(e,t){e?i.reject(e):2<arguments.length?i.resolve(c(arguments,1)):i.resolve(t)}},S.Promise=b,(S.promise=b).race=I,b.all=B,b.reject=F,(b.resolve=S).passByCopy=function(e){return e},w.prototype.passByCopy=function(){return this},S.join=function(e,t){return S(e).join(t)},w.prototype.join=function(e){return S([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},S.race=I,w.prototype.race=function(){return this.then(S.race)},(S.makePromise=w).prototype.toString=function(){return"[object Promise]"},w.prototype.then=function(t,i,r){var n=this,o=T(),s=!1;return S.nextTick(function(){n.promiseDispatch(function(e){s||(s=!0,o.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(e){return F(e)}}(e)))},"when",[function(e){s||(s=!0,o.resolve(function(e){if("function"==typeof i){m(e,n);try{return i(e)}catch(e){return F(e)}}return F(e)}(e)))}])}),n.promiseDispatch(void 0,"when",[void 0,function(e){var t,i,n=!1;try{i=e,t="function"==typeof r?r(i):i}catch(e){if(n=!0,!S.onerror)throw e;S.onerror(e)}n||o.notify(t)}]),o.promise},S.tap=function(e,t){return S(e).tap(t)},w.prototype.tap=function(t){return t=S(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},S.when=R,w.prototype.thenResolve=function(e){return this.then(function(){return e})},S.thenResolve=function(e,t){return S(e).thenResolve(t)},w.prototype.thenReject=function(e){return this.then(function(){throw e})},S.thenReject=function(e,t){return S(e).thenReject(t)},S.nearer=C,S.isPromise=P,S.isPromiseAlike=A,S.isPending=function(e){return P(e)&&"pending"===e.inspect().state},w.prototype.isPending=function(){return"pending"===this.inspect().state},S.isFulfilled=function(e){return!P(e)||"fulfilled"===e.inspect().state},w.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},S.isRejected=function(e){return P(e)&&"rejected"===e.inspect().state},w.prototype.isRejected=function(){return"rejected"===this.inspect().state};var O,N,M,L=[],k=[],x=[],D=!0;function U(){L.length=0,k.length=0,D||(D=!0)}function F(t){var e,i,n=w({when:function(e){return e&&function(t){if(D){var i=s(k,t);-1!==i&&("object"==typeof process&&"function"==typeof process.emit&&S.nextTick.runAfter(function(){var e=s(x,t);-1!==e&&(process.emit("rejectionHandled",L[i],t),x.splice(e,1))}),k.splice(i,1),L.splice(i,1))}}(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return e=n,i=t,D&&("object"==typeof process&&"function"==typeof process.emit&&S.nextTick.runAfter(function(){-1!==s(k,e)&&(process.emit("unhandledRejection",i,e),x.push(e))}),k.push(e),i&&void 0!==i.stack?L.push(i.stack):L.push("(no stack) "+i)),n}function H(i){return w({when:function(){return i},get:function(e){return i[e]},set:function(e,t){i[e]=t},delete:function(e){delete i[e]},post:function(e,t){return null==e?i.apply(void 0,t):i[e].apply(i,t)},apply:function(e,t){return i.apply(e,t)},keys:function(){return f(i)}},void 0,function(){return{state:"fulfilled",value:i}})}function W(e,t,i){return S(e).spread(t,i)}function V(e,t,i){return S(e).dispatch(t,i)}function B(e){return R(e,function(r){var o=0,s=T();return p(r,function(e,t,i){var n;P(t)&&"fulfilled"===(n=t.inspect()).state?r[i]=n.value:(++o,R(t,function(e){r[i]=e,0==--o&&s.resolve(r)},s.reject,function(e){s.notify({index:i,value:e})}))},void 0),0===o&&s.resolve(r),s.promise})}function q(r){if(0===r.length)return S.resolve();var o=S.defer(),s=0;return p(r,function(e,t,i){var n=r[i];s++,R(n,function(e){o.resolve(e)},function(){0==--s&&o.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))},function(e){o.notify({index:i,value:e})})},void 0),o.promise}function j(e){return R(e,function(e){return e=n(e,S),R(B(n(e,function(e){return R(e,t,t)})),function(){return e})})}S.resetUnhandledRejections=U,S.getUnhandledReasons=function(){return L.slice()},S.stopUnhandledRejectionTracking=function(){U(),D=!1},U(),S.reject=F,S.fulfill=H,S.master=function(i){return w({isDef:function(){}},function(e,t){return V(i,e,t)},function(){return S(i).inspect()})},S.spread=W,w.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},S.async=function(t){return function(){function e(e,t){var i,n;if("undefined"==typeof StopIteration){try{i=r[e](t)}catch(e){return F(e)}return i.done?S(i.value):R(i.value,o,s)}try{i=r[e](t)}catch(e){return"[object StopIteration]"===y(n=e)||n instanceof l?S(e.value):F(e)}return R(i,o,s)}var r=t.apply(this,arguments),o=e.bind(e,"next"),s=e.bind(e,"throw");return o()}},S.spawn=function(e){S.done(S.async(e)())},S.return=function(e){throw new l(e)},S.promised=function(i){return function(){return W([this,B(arguments)],function(e,t){return i.apply(e,t)})}},S.dispatch=V,w.prototype.dispatch=function(e,t){var i=this,n=T();return S.nextTick(function(){i.promiseDispatch(n.resolve,e,t)}),n.promise},S.get=function(e,t){return S(e).dispatch("get",[t])},w.prototype.get=function(e){return this.dispatch("get",[e])},S.set=function(e,t,i){return S(e).dispatch("set",[t,i])},w.prototype.set=function(e,t){return this.dispatch("set",[e,t])},S.del=S.delete=function(e,t){return S(e).dispatch("delete",[t])},w.prototype.del=w.prototype.delete=function(e){return this.dispatch("delete",[e])},S.mapply=S.post=function(e,t,i){return S(e).dispatch("post",[t,i])},w.prototype.mapply=w.prototype.post=function(e,t){return this.dispatch("post",[e,t])},S.send=S.mcall=S.invoke=function(e,t){return S(e).dispatch("post",[t,c(arguments,2)])},w.prototype.send=w.prototype.mcall=w.prototype.invoke=function(e){return this.dispatch("post",[e,c(arguments,1)])},S.fapply=function(e,t){return S(e).dispatch("apply",[void 0,t])},w.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},S.try=S.fcall=function(e){return S(e).dispatch("apply",[void 0,c(arguments,1)])},w.prototype.fcall=function(){return this.dispatch("apply",[void 0,c(arguments)])},S.fbind=function(e){var t=S(e),i=c(arguments,1);return function(){return t.dispatch("apply",[this,i.concat(c(arguments))])}},w.prototype.fbind=function(){var e=this,t=c(arguments);return function(){return e.dispatch("apply",[this,t.concat(c(arguments))])}},S.keys=function(e){return S(e).dispatch("keys",[])},w.prototype.keys=function(){return this.dispatch("keys",[])},S.all=B,w.prototype.all=function(){return B(this)},S.any=q,w.prototype.any=function(){return q(this)},S.allResolved=(O=j,N="allResolved",M="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(N+" is deprecated, use "+M+" instead.",new Error("").stack),O.apply(O,arguments)}),w.prototype.allResolved=function(){return j(this)},S.allSettled=function(e){return S(e).allSettled()},w.prototype.allSettled=function(){return this.then(function(e){return B(n(e,function(e){function t(){return e.inspect()}return(e=S(e)).then(t,t)}))})},S.fail=S.catch=function(e,t){return S(e).then(void 0,t)},w.prototype.fail=w.prototype.catch=function(e){return this.then(void 0,e)},S.progress=function(e,t){return S(e).then(void 0,void 0,t)},w.prototype.progress=function(e){return this.then(void 0,void 0,e)},S.fin=S.finally=function(e,t){return S(e).finally(t)},w.prototype.fin=w.prototype.finally=function(t){return t=S(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},S.done=function(e,t,i,n){return S(e).done(t,i,n)},w.prototype.done=function(e,t,i){var n=function(e){S.nextTick(function(){if(m(e,r),!S.onerror)throw e;S.onerror(e)})},r=e||t||i?this.then(e,t,i):this;"object"==typeof process&&process&&process.domain&&(n=process.domain.bind(n)),r.then(void 0,n)},S.timeout=function(e,t,i){return S(e).timeout(t,i)},w.prototype.timeout=function(e,t){var i=T(),n=setTimeout(function(){t&&"string"!=typeof t||((t=new Error(t||"Timed out after "+e+" ms")).code="ETIMEDOUT"),i.reject(t)},e);return this.then(function(e){clearTimeout(n),i.resolve(e)},function(e){clearTimeout(n),i.reject(e)},i.notify),i.promise},S.delay=function(e,t){return void 0===t&&(t=e,e=void 0),S(e).delay(t)},w.prototype.delay=function(i){return this.then(function(e){var t=T();return setTimeout(function(){t.resolve(e)},i),t.promise})},S.nfapply=function(e,t){return S(e).nfapply(t)},w.prototype.nfapply=function(e){var t=T(),i=c(e);return i.push(t.makeNodeResolver()),this.fapply(i).fail(t.reject),t.promise},S.nfcall=function(e){var t=c(arguments,1);return S(e).nfapply(t)},w.prototype.nfcall=function(){var e=c(arguments),t=T();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},S.nfbind=S.denodeify=function(i){var n=c(arguments,1);return function(){var e=n.concat(c(arguments)),t=T();return e.push(t.makeNodeResolver()),S(i).fapply(e).fail(t.reject),t.promise}},w.prototype.nfbind=w.prototype.denodeify=function(){var e=c(arguments);return e.unshift(this),S.denodeify.apply(void 0,e)},S.nbind=function(i,n){var r=c(arguments,2);return function(){var e=r.concat(c(arguments)),t=T();return e.push(t.makeNodeResolver()),S(function(){return i.apply(n,arguments)}).fapply(e).fail(t.reject),t.promise}},w.prototype.nbind=function(){var e=c(arguments,0);return e.unshift(this),S.nbind.apply(void 0,e)},S.nmapply=S.npost=function(e,t,i){return S(e).npost(t,i)},w.prototype.nmapply=w.prototype.npost=function(e,t){var i=c(t||[]),n=T();return i.push(n.makeNodeResolver()),this.dispatch("post",[e,i]).fail(n.reject),n.promise},S.nsend=S.nmcall=S.ninvoke=function(e,t){var i=c(arguments,2),n=T();return i.push(n.makeNodeResolver()),S(e).dispatch("post",[t,i]).fail(n.reject),n.promise},w.prototype.nsend=w.prototype.nmcall=w.prototype.ninvoke=function(e){var t=c(arguments,1),i=T();return t.push(i.makeNodeResolver()),this.dispatch("post",[e,t]).fail(i.reject),i.promise},S.nodeify=function(e,t){return S(e).nodeify(t)},w.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){S.nextTick(function(){t(null,e)})},function(e){S.nextTick(function(){t(e)})})},S.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var z=_();return S},"function"==typeof bootstrap?bootstrap("promise",i):e.exports=i()}),ec=Rn.OAuthTokenClient,tc=tt.Weblabs,ic=tt.WeblabTreatment,nc=je.metrics,rc="ms",oc="ATVWebPlayer",sc="OAuthTokenTime";function ac(e){var t,i,n,r=e.config.authToken;return I.exists(r)&&e.config.playerConfig.weblabs[tc.ATV_WEB_PLAYER_OAUTH]===ic.T1?(i=r,n={appVersion:(t=e).config.loaderConfig.dependencies.ATVWebPlayer.version,appName:oc,marketplaceId:t.config.playerConfig.marketplaceId,token:{access:i.access,expireTime:i.expireTime,refresh:i.refresh}},new ec(n,function(e){t.config.qosReporter.reportInformation(sc,null,e),nc.putMetric(sc,e,rc)},function(e){nc.putMetric(e.name)})):null}var lc=function(e){return I.isNullOrUndefined(e.config.playerConfig.customerId)||(e.config.playerConfig.tokenClient=ac(e),e.config.qosReporter.setTokenClient(e.config.playerConfig.tokenClient)),e},cc=function(){function e(e,t,i,n){this.name=e,this.message=t,this.severity=i,this.template=n}return e.ERROR_NAME="InitializeAbortedError",e}(),uc=yn.Errors;var pc=function(r){var o=$l.defer();return r.factory.createWebPlayer(function(e){r.webPlayer=e,o.resolve(r)},function(e,t,i,n){r.abortReason=new cc(e,t,i,n),o.reject(uc.newError(cc.ERROR_NAME,r.abortReason.message))},r.config.playerConfig.loaderConfig.assetsRoot),o.promise},hc=Ve.get("CacheAuthToken");var dc=function(e){var t=e.config.playerConfig.tokenClient;return I.exists(t)&&t.getToken(function(e){hc.info("Auth token cache succeeded.")},function(e){hc.warn("Auth token cache failed.")}),e},fc=je.metrics,yc=Ve.get("DownloadLocalization");var gc=function(n,r){void 0===r&&(r=fc);var o="{{locale}}",t="LanguageDownload.Error."+o,s="LanguageDownload.Time."+o,a=$l.defer(),l=n.config.playerConfig.locale;return n.config.localizationStore.setLanguage(l,function(e,t,i){r.putMetric(s.replace(o,l),t,"ms"),r.putMetric(i?"LanguageDownloadCacheHit":"LanguageDownloadCacheMiss"),yc.info("Localization download successful."),a.resolve(n)},function(e){r.putMetric(t.replace(o,l)),yc.warn("Localization download failed. Falling back to en-US."),a.resolve(n)}),a.promise},mc=bi.LocalStorage,vc="html5_web_player_weblab_cache",Ec=function(){function e(e,t){void 0===e&&(e=new mc),void 0===t&&(t=b.now),this.localStorage=e,this.now=t}return e.prototype.cacheWeblabs=function(e){var t={weblabs:e,cacheTimeMs:this.now()};this.localStorage.set(vc,JSON.stringify(t))},e.prototype.getCachedWeblabs=function(){var e=this.localStorage.get(vc),t=JSON.parse(e);return this.isValidCache(t)?t.weblabs:(this.localStorage.remove(vc),null)},e.prototype.isValidCache=function(e){return I.exists(e)&&e.cacheTimeMs+6e5>this.now()},e}(),_c=Rn.TokenType,Sc=tt.MarketplaceID,Tc=tt.WeblabTreatment,bc=ji.HttpRequest,Ic=c.of("WeblabClient"),wc=Ve.get("WeblabClient"),Rc={WeblabClient:function(){function c(e,t){void 0===e&&(e=bc),void 0===t&&(t=new Ec),this.httpRequest=e,this.weblabCache=t}return c.prototype.initialize=function(e,t,i,n,r,o){this.deviceId=Ic(n,"deviceId").exists(),this.deviceTypeId=Ic(i,"deviceTypeId").exists(),this.marketplaceId=Ic(t,"marketplaceId").exists(),this.authContext=o,this.sessionId=r,this.url=Ic(e,"partnerServiceUrl").exists().replace(/\/$/,"")+c.SERVICE_ENDPOINT,this.initialized=!0},c.prototype.getWeblabs=function(e,o,s){var a=this;Ic(this.initialized,"initialized").is.true(),Ic(e,"weblabs").exists(),Ic(o,"onSuccess").exists(),Ic(s,"onError").exists();var t=this.weblabCache.getCachedWeblabs();if(I.exists(t))return wc.info("Using cached weblabs: ",t),void o(t);if(0!==e.length&&this.httpRequest.isSupported()){var i=this.url,n={},r={gascEnabled:Sc.isClassic(this.marketplaceId)?"false":"true",firmware:"1",deviceId:this.deviceId,deviceTypeId:this.deviceTypeId,marketplaceId:this.marketplaceId};I.exists(this.sessionId)&&(n[c.SESSION_ID_HEADER]=this.sessionId);var l=this.httpRequest.post(i).accept("application/json").timeout(c.HTTP_REQUEST_TIMEOUT_MS).headers(n).body(this.createBody(e)).onError(function(e,t){I.exists(t)?s(e,t.getLatencyMs()):s(e)}).onLoad(function(t){var i={},e=t.getText();if(I.exists(e)){var n=void 0;try{n=JSON.parse(e)}catch(e){return void s(e,t.getLatencyMs())}if(I.exists(n)&&I.exists(n.TreatmentList)){var r=n.TreatmentList;wc.info("Received Weblabs.",r),b.forEach(r,function(e){var t=a.getTreatmentFromName(e.treatmentName);I.exists(t)&&(i[e.weblabName]=t)})}}a.weblabCache.cacheWeblabs(i),o(i,t.getLatencyMs())}).withCredentials();I.exists(this.authContext)&&I.exists(this.authContext.tokenClient)?this.authContext.tokenClient.getToken(function(e){e.type===_c.OAUTH&&l.bearerToken(e.token),l.query(r).send()},function(e){s(e)}):l.query(r).send()}else o({})},c.prototype.createBody=function(e){var t="<WeblabTreatmentRequest><WeblabList>";return b.forEach(e,function(e){t+="<member>"+e+"</member>"}),t+"</WeblabList></WeblabTreatmentRequest>"},c.prototype.getTreatmentFromName=function(e){return I.withDefault(Tc[e],null)},c.SESSION_ID_HEADER="x-atv-session-id",c.SERVICE_ENDPOINT="/cdp/usage/GetWeblabTreatment",c.HTTP_REQUEST_TIMEOUT_MS=4e3,c}()}.WeblabClient,Cc=tt.DeviceTypeId,Pc=je.metrics,Ac=Ve.get("getWeblabs"),Oc="GetWeblabTreatmentTime";var Nc=function(i,e){void 0===e&&(e=new Rc);var n=$l.defer(),t=null;return I.exists(i.config.playerConfig.customerId)&&(t={customerId:i.config.playerConfig.customerId,tokenClient:i.config.playerConfig.tokenClient}),e.initialize(i.config.playerConfig.partnerServiceEndpoint,i.config.playerConfig.marketplaceId,Cc.HTML5,i.config.playerConfig.deviceId,i.config.playerConfig.sessionId,t),e.getWeblabs(i.config.weblabNames,function(e,t){I.exists(t)&&(Pc.putMetric(Oc,t,"ms"),i.config.qosReporter.reportInformation(Oc,null,t)),Ac.info("Acquired weblabs: ",e),i.config.playerConfig.weblabs=b.defaults(i.config.weblabOverrides,e),Ac.info("Final weblabs: ",i.config.playerConfig.weblabs);try{i.config.qosReporter.reportInformation("Weblabs",JSON.stringify(i.config.playerConfig.weblabs))}catch(e){Ac.error(e)}n.resolve(i)},function(e,t){Ac.error("Unable to receive weblabs.",e),Pc.putMetric("GetWeblabTreatmentError"),I.exists(t)&&Pc.putMetric(Oc,t,"ms"),i.config.playerConfig.weblabs=i.config.weblabOverrides,n.resolve(i)}),n.promise},Mc=Ue.DiagnosticsState;var Lc=function(e){var t=e.config.playerConfig;e.config.reporter.initializeLogging(t.marketplaceId,I.withDefault(t.customerId,"UNAUTHENTICATED"),t.configurationStore.getValue().userWatchSessionId,t.configurationStore,t.logLevel,10,t.diagnostics),e.config.reporter.initializeMetrics(e.factory.getMetricsFeature()),e.config.qosReporter.initialize(e.factory.getPlayerVersion(),e.factory.getDeviceTypeId());var i=xs.getInstance();return t.diagnostics===Mc.Auto&&i.open(),e};var kc,xc,Dc=function(e,t,i,n){void 0===t&&(t=zo.getOperatingSystem()),void 0===i&&(i=zo.getBrowser()),void 0===n&&(n=navigator);var r=i.toString();I.exists(n.buildID)&&(r=r+" build:"+n.buildID);var o=e.config.playerConfig.configurationStore.getValue();return e.config.reporter.preInitializeMetrics(e.config.playerConfig.marketplaceId,o.userWatchSessionId,e.config.playerConfig.clientId,"HTML5Player",i),e.config.qosReporter.preInitialize(e.config.playerConfig.partnerServiceEndpoint,e.config.loaderConfig.dependencies.ATVWebPlayer.version,e.config.playerConfig.marketplaceId,tt.DeviceTypeId.HTML5,e.config.playerConfig.deviceId,o.primitiveSessionId,t.toString(),r,e.config.playerConfig.clientId),e.config.qosReporter.updateSessionIds(o.userWatchSessionId,o.primitiveSessionId),e},Uc=function(){function e(){}return e.PLAYER_OVERRIDE="PlayerOverride",e.WEBLAB="Weblab",e.MISSING_WIDEVINE_CDM="MissingWidevineCDM",e.MISSING_PLAYREADY_CDM="MissingPlayReadyCDM",e.MISSING_FAIRPLAY_CDM="MissingFairplayCDM",e.MISSING_CODEC_IN_PLAYREADY_CDM="MissingCodecInPlayReadyCDM",e.UNKNOWN="UNKNOWN",e.UNSUPPORTED_BROWSER="UnsupportedBrowser",e.UNSUPPORTED_OS="UnsupportedOperatingSystem",e.MISSING_MEDIA_SOURCE="MissingMediaSource",e}();(xc=kc||(kc={}))[xc.BROWSER_OUT_OF_DATE=0]="BROWSER_OUT_OF_DATE",xc[xc.MISSING_CODEC=1]="MISSING_CODEC",xc[xc.MISSING_CDM=2]="MISSING_CDM",xc[xc.UNSUPPORTED_BROWSER=3]="UNSUPPORTED_BROWSER",xc[xc.UNSUPPORTED_OS=4]="UNSUPPORTED_OS";var Fc,Hc,Wc,Vc,Bc=kc,qc=l&&l.__extends||(Fc=function(e,t){return(Fc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Fc(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),jc=zo.BrowserType,zc=zo.OperatingSystemFamily,Gc=bi.Version,Yc=function(r){function o(e,t,i){var n=I.exists(o.KEYS[i])?o.KEYS[i][jc[t.getType()]]:null;return o.isChromeAndroid(t,e)?n=o.MISSING_CDM_KEYS.Android:e.getFamily()===zc.Mac&&e.getVersion().compareTo(Gc.fromString("10.9"))<0&&(n=o.MAC_LESS_THAN_10_9_UNSUPPORTED_BROWSER),I.isNullOrUndefined(n)&&(n=i===Bc.UNSUPPORTED_OS?o.GENERIC_UNSUPPORTED_OS:o.UNSUPPORTED_BROWSER_OS_KEYS[zc[e.getFamily()]]),n=I.withDefault(n,o.GENERIC_UNSUPPORTED_BROWSER),r.call(this,n)||this}return qc(o,r),o.isChromeAndroid=function(e,t){return e.getType()===jc.Chrome&&(t.getFamily()===zc.Linux||t.getFamily()===zc.Android)&&I.exists(navigator.connection)},o.GENERIC_UNSUPPORTED_BROWSER="genericUnsupportedBrowser",o.GENERIC_UNSUPPORTED_OS="genericUnsupportedOs",o.MAC_LESS_THAN_10_9_UNSUPPORTED_BROWSER="macLessThan10Point9UnsupportedBrowser",o.UPDATE_BROWSER_KEYS={Chrome:"chromeOutOfDate",Firefox:"firefoxOutOfDate",Firefox64:"firefoxOutOfDate",Opera:"operaOutOfDate"},o.MISSING_CDM_KEYS={Android:"androidMissingCdm",Chrome:"chromeMissingCdm",Firefox:"firefoxMissingCdm",Firefox64:"firefoxMissingCdm",Opera:"operaMissingCdm"},o.UNSUPPORTED_BROWSER_KEYS={},o.UNSUPPORTED_BROWSER_OS_KEYS={Linux:"linuxUnsupportedBrowser",Mac:"macUnsupportedBrowser",Windows:"windowsUnsupportedBrowser",Android:o.GENERIC_UNSUPPORTED_OS},o.UNSUPPORTED_OS_KEYS={},o.KEYS=((Hc={})[Bc.BROWSER_OUT_OF_DATE]=o.UPDATE_BROWSER_KEYS,Hc[Bc.MISSING_CDM]=o.MISSING_CDM_KEYS,Hc[Bc.UNSUPPORTED_BROWSER]=o.UNSUPPORTED_BROWSER_KEYS,Hc[Bc.UNSUPPORTED_OS]=o.UNSUPPORTED_OS_KEYS,Hc),o}(ll),Kc=c.of("WebPlayerFactorySelector"),Xc=Ve.get("WebPlayerFactorySelector"),Qc=function(){function e(){this.sortedPlayerFactories=null}return e.prototype.initialize=function(e,t,i,n,r,o){this.sortedPlayerFactories=Kc(e,"factoryList").exists(),Kc(i,"weblabs").exists(),b.forEach(this.sortedPlayerFactories,function(e){e.initialize(t,i,n,r,o)})},e.prototype.reset=function(){this.sortedPlayerFactories=null},e.prototype.selectFactory=function(e,t,i){Kc(this.sortedPlayerFactories,"this.sortedPlayerFactories").exists();var n=b.clone(this.sortedPlayerFactories);if(!I.isNullOrUndefined(i)){var r=i.toLowerCase(),o=b.findIndex(n,function(e){return e.getPlayerName()===r});if(-1===o)Xc.warn("Cannot find preferred player factory.");else{var s=n.splice(o,1);n.splice(0,0,s[0])}}this.findPlayerFactory(n,0,e,t)},e.prototype.findPlayerFactory=function(o,s,a,l,c,u){var p=this;void 0===c&&(c=""),void 0===u&&(u=null),this.isFactorySupported(o[s],function(e,t,i,n){void 0===i&&(i="");var r=c+i;null===u&&(u=n),e?a(o[s],t,r):s!==o.length-1?p.findPlayerFactory(o,s+1,a,l,r,u):a(null,null,r,u)},l)},e.prototype.selectFactoryWithOverride=function(i,n){Kc(n,"override").is.a.string(),Kc(this.sortedPlayerFactories,"this.sortedPlayerFactories").exists();var t=n.toLowerCase(),r=b.find(this.sortedPlayerFactories,function(e){return e.getPlayerName()===t});if(b.isUndefined(r))return Xc.error("Overridden player '"+n+"' does not exist."),void i(null);this.isFactorySupported(r,function(e,t){e||Xc.warn("Overridden player '"+n+"' is not supported on this platform. Playback may not function."),i(r,t)})},e.prototype.isFactorySupported=function(e,n,t){e.getPlayerCapabilities(function(e,t,i){n(e.supportsWebPlayback||e.supportsNativePlayback,e,t,i)},t)},e}(),Jc=Ue.ErrorSeverity,Zc=je.metrics,$c=Aa.JavaScriptLoader,eu=Aa.LazyCachingScriptLoader,tu=Aa.TransparentCachingScriptLoader,iu=Aa.ScriptType,nu=c.of("HTML5WebPlayerLoader"),ru=Ve.get("HTML5WebPlayerLoader"),ou="HTML5JavaScriptDownloadError",su=function(){function e(e,t,i,n,r){void 0===i&&(i=new $c),void 0===n&&(n=new eu),void 0===r&&(r=new tu),this.loaderConfig=nu(e,"loaderConfig").exists(),this.qosReporter=nu(t,"qosReporter").exists(),this.html5LoaderConfig=e.dependencies.ATVWebCascadesPlayer,this.javaScriptLoader=i,this.lazyScriptLoader=n,this.transparentScriptLoader=r}return e.prototype.createWebPlayer=function(e,i,n){var t,r=this,o=function(e){var t=e&&b.isFunction(e.toString)?e.toString():"Unknown Error";n(ou,t,Jc.Fatal)},s=this.loaderConfig.assetsRoot+"/"+this.html5LoaderConfig.name+"/"+this.html5LoaderConfig.version+"/js/"+this.html5LoaderConfig.name+".js";t=!1===e?this.javaScriptLoader:this.html5LoaderConfig.forceUpdate?this.transparentScriptLoader:this.lazyScriptLoader;var a=s;if(t){var l={crc32:this.html5LoaderConfig.crc32,url:s,name:this.html5LoaderConfig.name,type:iu.JavaScript,version:this.html5LoaderConfig.version};t.get(l,function(e){var t;a=JSON.stringify(e),Zc.putMetric("HTML5JavaScriptDownloadTime",e.totalMs,"ms"),Zc.putMetric(e.cached?"HTML5JavaScriptCacheHit":"HTML5JavaScriptCacheMiss",1),r.qosReporter.reportInformation("HTML5JavaScriptDownloadInfo",a,e.totalMs);try{t=new window.ATVWebCascadesPlayer}catch(e){return void o(e)}i(t)},function(e,t){var i=e&&b.isFunction(e.toString)?e.toString():"Unknown Error",n=JSON.stringify(t);ru.error(i),r.qosReporter.reportError(ou,Jc.NonFatal,i,n)},o)}},e}();(Vc=Wc||(Wc={})).Unloaded="Unloaded",Vc.Waiting="Waiting",Vc.Ready="Ready",Vc.Error="Error";var au,lu,cu=Wc;(lu=au||(au={})).Paused="Paused",lu.Playing="Playing";var uu,pu,hu,du,fu,yu,gu,mu,vu,Eu,_u,Su,Tu,bu,Iu,wu,Ru,Cu,Pu,Au,Ou,Nu,Mu,Lu,ku,xu,Du,Uu,Fu,Hu,Wu,Vu,Bu,qu=au,ju=l&&l.__assign||function(){return(ju=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},zu=tt.DeviceTypeId,Gu=We.BasicEventEmitter,Yu=Ue.DiagnosticsState,Ku=Ue.ErrorSeverity,Xu=Ue.Features,Qu=Ue.AbortEvent,Ju=Ue.AbortedEvent,Zu=Ue.AsinChangedEvent,$u=Ue.CloseEvent,ep=Ue.EndOfContentEvent,tp=Ue.InitializedEvent,ip=Ue.PausedEvent,np=Ue.PlayingEvent,rp=Ue.PreparedEvent,op=Ue.StoppingEvent,sp=c.of("WrappedXpPlayer"),ap=Ve.get("WrappedXpPlayer"),lp=function(){function e(e,t){void 0===t&&(t=new Gu);var i=this;this.Features=Xu,this.pendingFeatureRequests=[],this.currentTitleId=null,this.notifyPlaybackInitiatedOnInitialized=!1,this.onContentStateChange=function(e){e===cu.Unloaded?i.eventEmitter.emit(tp):e===cu.Ready&&i.eventEmitter.emit(rp)},this.onPlaybackStateChange=function(e){e===qu.Paused?i.eventEmitter.emit(ip):e===qu.Playing&&i.eventEmitter.emit(np)},this.onTimeDataChange=function(e){var t=i.player.timeline.contentInfos[i.player.timeline.items[e.currentTimelineItemIndex].contentId];null!==i.currentTitleId&&i.currentTitleId!==t.titleId&&"Live"!==i.sdkContentConfig.videoMaterialType&&i.eventEmitter.emit(Zu,new Zu(t.titleId)),i.currentTitleId=t.titleId},this.onTimelineEnded=function(){i.eventEmitter.emit(ep)},this.onError=function(e){i.emitError(e)},this.onContentError=function(e){i.emitError(e)},this.onPlayerClose=function(){i.eventEmitter.emit($u)},this.webPlayerSdkType=e,this.eventEmitter=t}return e.prototype.initialize=function(e){var t=this;if(I.isNullOrUndefined(this.webPlayerSdk)){var i={marketplaceId:e.marketplaceId,clientId:e.clientId,deviceId:e.deviceId,debug:e.diagnostics===Yu.Enabled||e.diagnostics===Yu.Auto,weblabs:e.weblabs,sessionId:e.sessionId,applicationIdentity:null!=e.applicationIdentity?e.applicationIdentity:void 0};this.webPlayerSdk=new this.webPlayerSdkType(i)}var n={container:e.domElement,locale:e.locale,titleDecorationScheme:"primary-content"};this.webPlayerSdk.getFeature(this.webPlayerSdk.Features.AmazonVideoPlayer,n).then(function(e){t.player=e,t.notifyPlaybackInitiatedOnInitialized&&t.player.playbackInitiated(),t.attachEventListeners(t.player),t.attachPendingFeatureRequests(),t.eventEmitter.emit(tp)}).catch(function(e){ap.error("Couldn't load player.",e),t.eventEmitter.emit(Qu,new Qu("WebPlayerSDKInitializeError",e,Ku.Fatal))})},e.prototype.prepare=function(e){sp(this.player,"player").exists(),this.sdkContentConfig={titleId:e.asin,videoMaterialType:e.videoType},I.exists(e.position)&&(this.sdkContentConfig.position=this.convertToMilliseconds(e.position)),I.exists(e.playbackEnvelope)&&(this.sdkContentConfig.playbackEnvelope=e.playbackEnvelope),this.player.load(this.sdkContentConfig)},e.prototype.prepareCache=function(e){},e.prototype.play=function(e){sp(this.player,"player").exists(),this.sdkContentConfig=ju({},this.sdkContentConfig,{clickstreamRefMarker:e.clickstreamRefMarker}),this.player.start(this.sdkContentConfig)},e.prototype.playbackInitiated=function(){I.exists(this.player)?this.player.playbackInitiated():this.notifyPlaybackInitiatedOnInitialized=!0},e.prototype.stop=function(){sp(this.player,"player").exists(),this.player.unload(),this.eventEmitter.emit(op),this.notifyPlaybackInitiatedOnInitialized=!1},e.prototype.seek=function(e){sp(this.player,"player").exists(),this.player.seek(this.convertToMilliseconds(e))},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.getPosition=function(){return sp(this.player,"player").exists(),this.convertToSeconds(this.player.currentTime.currentPosition)},e.prototype.getDuration=function(){sp(this.player,"player").exists();var e=this.player.timeline.items[this.player.currentTime.currentTimelineItemIndex];return null===e.startTime||null===e.endTime?0:this.convertToSeconds(e.endTime-e.startTime)},e.prototype.getDeviceTypeId=function(){return zu.HTML5},e.prototype.validatePIN=function(e){throw new Error("WrappedXpPlayer doesn't implement validatePIN.")},e.prototype.getFeature=function(e,t,i){I.exists(this.player)?e!==Xu.volume?i(new Error("WrappedXpPlayer doesn't support the requested feature.")):this.player.getFeature(this.player.Features.Volume).then(t).catch(i):this.pendingFeatureRequests.push({feature:e,onAvailable:t,onError:i})},e.prototype.convertToMilliseconds=function(e){return 1e3*e},e.prototype.convertToSeconds=function(e){return e/1e3},e.prototype.emitError=function(e){this.eventEmitter.emit(Ju,new Ju)},e.prototype.attachEventListeners=function(e){e.on(e.Events.ContentError,this.onContentError),e.on(e.Events.ContentStateChange,this.onContentStateChange),e.on(e.Events.Error,this.onError),e.on(e.Events.PlaybackStateChange,this.onPlaybackStateChange),e.on(e.Events.TimeDataChange,this.onTimeDataChange),e.on(e.Events.TimelineEnded,this.onTimelineEnded),e.on(e.Events.Close,this.onPlayerClose)},e.prototype.attachPendingFeatureRequests=function(){for(;0<this.pendingFeatureRequests.length;){var e=this.pendingFeatureRequests.shift();this.getFeature(e.feature,e.onAvailable,e.onError)}},e}(),cp=Ue.ErrorSeverity,up=je.metrics,pp=Aa.JavaScriptLoader,hp=Aa.ScriptType,dp=Aa.TransparentCachingScriptLoader,fp=c.of("WrappedXpPlayerLoader"),yp=Ve.get("WrappedXpPlayerLoader"),gp={cloudfront:"cloudfront",limelight:"limelight",lvlt:"level3"},mp="XpLoaderJavaScriptDownloadTime",vp="XpLoaderJavaScriptDownloadError",Ep=["https://cloudfront.xp-assets.aiv-cdn.net/packages/ATVWebPlayerSDK-1.0/gamma/WebPlayerSDK.js","https://lvlt.xp-assets.aiv-cdn.net/packages/ATVWebPlayerSDK-1.0/gamma/WebPlayerSDK.js","https://limelight.xp-assets.aiv-cdn.net/packages/ATVWebPlayerSDK-1.0/gamma/WebPlayerSDK.js"],_p=["https://cloudfront.xp-assets.aiv-cdn.net/packages/ATVWebPlayerSDK-1.0/prod/WebPlayerSDK.js","https://lvlt.xp-assets.aiv-cdn.net/packages/ATVWebPlayerSDK-1.0/prod/WebPlayerSDK.js","https://limelight.xp-assets.aiv-cdn.net/packages/ATVWebPlayerSDK-1.0/prod/WebPlayerSDK.js"],Sp=function(){function e(e,t,i,n){void 0===t&&(t=new dp),void 0===i&&(i=new pp),void 0===n&&(n=lp),this.qosReporter=fp(e,"qosReporter").exists(),this.blobScriptLoader=t,this.scriptTagScriptLoader=i,this.wrappedXpPlayerType=n}return e.prototype.createWebPlayer=function(e,t,i,n){this.acquirePlayer(e,t,i,n)},e.prototype.acquirePlayer=function(n,r,o,s,a){var l=this;void 0===a&&(a=0);var c=r?Ep[a]:_p[a],e={crc32:null,url:c,name:"WebPlayerSDK",type:hp.JavaScript,version:"0.0.0.0"},u=function(e,t){l.tryReportWithCDN(vp,1,c);var i=l.getErrorString(e);if(i+=l.getAdditionalErrorInfo(t),yp.error(vp+": "+i),(r?Ep:_p).length-1<=a)return s(vp,i,cp.Fatal);up.putMetric(vp,1),l.acquirePlayer(n,r,o,s,a+1)},t=function(e){var t,i=JSON.stringify(e);up.putMetric(mp,e.totalMs,"ms"),l.tryReportWithCDN(mp,e.totalMs,c,"ms"),up.putMetric(e.cached?"XpLoaderJavaScriptCacheHit":"XpLoaderJavaScriptCacheMiss",1),l.qosReporter.reportInformation("XpLoaderJavaScriptDownloadInfo",i,e.totalMs);try{t=new l.wrappedXpPlayerType(window.WebPlayerSDK)}catch(e){return void u(e)}o(t)},i=function(e,t){var i=l.getErrorString(e),n=JSON.stringify(t);yp.error(i+", note: "+n),l.qosReporter.reportError(vp,cp.NonFatal,i,n)};!1===n?this.scriptTagScriptLoader.get(e,t,i,u):this.blobScriptLoader.get(e,t,i,u,!1)},e.prototype.getAdditionalErrorInfo=function(e){var t="";if(null!=e)for(var i=0,n=["attempt","contentHash","contentLength","contentLengthHeader","serverIP","cloudfrontRequestID"];i<n.length;i++){var r=n[i];null!=e[r]&&(t+=", "+r+": "+e[r])}return t},e.prototype.getErrorString=function(e){return e&&b.isFunction(e.toString)?e.toString():"Unknown Error"},e.prototype.tryReportWithCDN=function(e,t,i,n){var r=this.getCDN(i);null!=r&&up.putMetric(e+"."+r,t,n)},e.prototype.getCDN=function(e){var t=this.getSubdomain(e);return null!=t&&this.isValidCDN(t)?gp[t]:null},e.prototype.getSubdomain=function(e){var t=e.match("https?://([^.]+)?\\.");return null==t||null==t[1]?null:t[1]},e.prototype.isValidCDN=function(e){return-1!==Object.keys(gp).indexOf(e)},e}(),Tp="cenc",bp=function(){function e(){}return e.prototype.getDrmSystems=function(){return[{keySystem:"com.microsoft.playready",configurations:[[{initDataTypes:[Tp],audioCapabilities:[{contentType:"audio/mp4; codecs=\"mp4a.40.2\""}],videoCapabilities:[{contentType:"video/mp4; codecs=\"avc1.4D401E\"",robustness:"HW_SECURE_DECODE"},{contentType:"video/mp4; codecs=\"avc1.4D401E\"",robustness:"SW_SECURE_DECODE"}]}]]},{keySystem:"com.widevine.alpha",configurations:[[{initDataTypes:[Tp],videoCapabilities:[{contentType:"video/mp4; codecs=\"avc1.4D401E\"",robustness:"HW_SECURE_DECODE"},{contentType:"video/mp4; codecs=\"avc1.4D401E\"",robustness:"SW_SECURE_DECODE"}]}],[{initDataTypes:[Tp],videoCapabilities:[{contentType:"video/mp4; codecs=\"avc1.640028\""}]}],[{initDataTypes:[Tp]}]]}]},e}(),Ip=zo.BrowserType,wp=zo.OperatingSystemFamily,Rp=zo.WindowsVersion,Cp=bi.Version,Pp=(Ve.get("HTML5DeviceInformationDenylist"),"2c3c3654-ac62-46a9-a36e-76e1ff64a679"),Ap=((uu={})[Ip.Chrome]=((pu={})["DRM:YES"]=[{browserRange:{min:Cp.fromNumber(69)},osFamily:wp.Windows,osVersion:{min:Rp.WINDOWS_7}},{browserRange:{min:Cp.fromNumber(69)},osFamily:wp.Android,osVersion:{min:Cp.fromString("4.4.3")}}],pu[Pp+"|DRM:NO"]=[{browserRange:{min:Cp.fromNumber(42)}}],pu),uu[Ip.Chromium]=((hu={})["DRM:YES"]=[{browserRange:{min:Cp.fromNumber(69)},osFamily:wp.Windows,osVersion:{min:Rp.WINDOWS_7}},{browserRange:{min:Cp.fromNumber(69)},osFamily:wp.Android,osVersion:{min:Cp.fromString("4.4.3")}}],hu[Pp+"|DRM:NO"]=[{browserRange:{min:Cp.fromNumber(42)}}],hu),uu[Ip.Firefox]=((du={})["DRM:YES"]=[{browserRange:{min:Cp.fromNumber(60)},osFamily:wp.Windows,osVersion:{min:Rp.WINDOWS_7}},{browserRange:{min:Cp.fromNumber(60)},osFamily:wp.Android,osVersion:{min:Cp.fromString("4.4.3")}}],du[Pp+"|DRM:NO"]=[{browserRange:{min:Cp.fromNumber(53)},osFamily:wp.Android,osVersion:{min:Cp.fromString("4.4.3")}},{browserRange:{min:Cp.fromNumber(42)}}],du),uu[Ip.Firefox64]=((fu={})["DRM:YES"]=[{browserRange:{min:Cp.fromNumber(60)},osFamily:wp.Windows,osVersion:{min:Rp.WINDOWS_7}},{browserRange:{min:Cp.fromNumber(60)},osFamily:wp.Android,osVersion:{min:Cp.fromString("4.4.3")}}],fu[Pp+"|DRM:NO"]=[{browserRange:{min:Cp.fromNumber(53)},osFamily:wp.Android,osVersion:{min:Cp.fromString("4.4.3")}},{browserRange:{min:Cp.fromNumber(42)}}],fu),uu[Ip.Opera]=((yu={})["DRM:YES"]=[{browserRange:{min:Cp.fromNumber(37)},osFamily:wp.Windows,osVersion:{min:Rp.WINDOWS_7}},{browserRange:{min:Cp.fromNumber(37)},osFamily:wp.Android,osVersion:{min:Cp.fromString("4.4.3")}}],yu[Pp+"|DRM:NO"]=[{browserRange:{min:Cp.fromNumber(32)}}],yu),uu[Ip.IE]=((gu={})["DRM:YES"]=[{browserRange:{min:Cp.fromNumber(11)}}],gu),uu[Ip.Safari]=((mu={})["DRM:YES"]=[{browserRange:{min:Cp.fromNumber(10)},osFamily:wp.Mac,osVersion:{min:Cp.fromString("10.12.1")}}],mu["DRM:NO"]=[{browserRange:{min:Cp.fromNumber(8)}}],mu),uu[Ip.Silk]=((vu={})["DRM:YES"]=[{browserRange:!1}],vu),uu[Ip.AmazonWebView]={},uu[Ip.Edge]=((Eu={})["DRM:YES"]=[{browserRange:{min:Cp.fromNumber(15)}}],Eu["DRM:NO"]=[{browserRange:{min:Cp.fromNumber(15)}}],Eu),uu[Ip.EdgeNext]=((_u={})["DRM:YES"]=[{browserRange:{min:Cp.fromNumber(64)}}],_u["DRM:NO"]=[{browserRange:{min:Cp.fromNumber(64)}}],_u),uu),Op=function(){function e(e){this.deviceInformation=e}return e.prototype.getSupport=function(e,t,i,n){var r=this.deviceInformation.browser,o=this.deviceInformation.operatingSystem,s=r.getType(),a={supportsWebPlayback:!0,supportsLive:!0,supportsDrm:!0};if(!I.exists(Ap[s]))return a.supportsWebPlayback=!1,a.note=Uc.UNSUPPORTED_BROWSER,a.notSupportedReason=Bc.UNSUPPORTED_BROWSER,a;var l=this.getDenylistEntry(s,o,t,n);if(I.exists(l)){if(this.isDenylistedOs(l,o))return a.supportsWebPlayback=!1,a.notSupportedReason=Bc.UNSUPPORTED_OS,a.note=Uc.UNSUPPORTED_OS,a;if(this.isDenylistedBrowser(l,r))return a.supportsWebPlayback=!1,a.notSupportedReason=Bc.BROWSER_OUT_OF_DATE,a.note=Uc.UNSUPPORTED_BROWSER,a}return a},e.prototype.isInRange=function(e,t){return!!(I.exists(t.min)&&0<t.min.compareTo(e))||!!(I.exists(t.max)&&t.max.compareTo(e)<0)},e.prototype.isDenylistedOs=function(e,t){return!!I.exists(e.osFamily)&&(!1===e.osVersion||this.isInRange(t.getVersion(),e.osVersion))},e.prototype.isDenylistedBrowser=function(e,t){return!1===e.browserRange||this.isInRange(t.getVersion(),e.browserRange)},e.prototype.keyString=function(e){return(I.exists(e.clientId)?e.clientId+"|":"")+"DRM:"+(e.requiresDrm?"YES":"NO")},e.prototype.getFirst=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var n=0,r=t;n<r.length;n++){var o=r[n];if(I.exists(e[o]))return e[o]}return null},e.prototype.getDenylistEntry=function(e,t,i,n){if(!I.exists(Ap[e]))return null;var r=Ap[e],o=this.getFirst(r,this.keyString({clientId:n,requiresDrm:i}),this.keyString({clientId:n,requiresDrm:!0}),this.keyString({requiresDrm:i}),this.keyString({requiresDrm:!0})),s=b.max(o,function(e){return e.osFamily===t.getFamily()?2:I.exists(e.osFamily)?-1/0:1});return b.isObject(s)?s:null},e}(),Np=It.QueryString,Mp=zo.BrowserType,Lp=zo.OperatingSystemFamily,kp=zo.WindowsVersion,xp=tt.Weblabs,Dp=tt.WeblabTreatment,Up=We.BasicEventEmitter,Fp=bi.Version,Hp=c.of("HTML5WebPlayerFactory"),Wp=Ve.get("HTML5WebPlayerFactory"),Vp=["367349ae-26ce-4e87-8324-99c337ebac9b","511cc9af-3ecb-48fe-9825-886ebfbb6503"],Bp=function(){function m(e,t,i,n,r,o,s,a,l,c){void 0===i&&(i=!1),void 0===n&&(n=navigator),void 0===r&&(r=ys.getInstance()),void 0===o&&(o=su),void 0===s&&(s=Sp),void 0===a&&(a=Op),void 0===l&&(l=new Up),void 0===c&&(c=Np),this.loaderConfig=Hp(e,"loaderConfig").exists(),this.qosReporter=Hp(t,"qosReporter").exists(),this.playerBeta=i,this.navigator=n,this.deviceInformation=r,this.html5WebPlayerLoader=new o(this.loaderConfig,this.qosReporter),this.wrappedXpPlayerLoader=new s(this.qosReporter),this.deviceInformationDenylist=new a(r),this.eventEmitter=l,this.queryString=c}return m.prototype.initialize=function(e,t,i,n,r){this.cacheOverride=i,this.clientId=r,this.weblabs=t},m.prototype.getPlayerName=function(){return m.PLAYER_NAME},m.prototype.getPlayerVersion=function(){return this.loaderConfig.dependencies.ATVWebCascadesPlayer.version},m.prototype.getMetricsFeature=function(){return m.METRICS_FEATURE},m.prototype.getDeviceTypeId=function(){return tt.DeviceTypeId.HTML5},m.prototype.getPlayerCapabilities=function(i,e){void 0===e&&(e={});var t=this.deviceInformation.browser,n=this.deviceInformation.operatingSystem,r=n.getVersion(),o=t.getType(),s=t.getVersion(),a={supportsDrm:!1,supportsNativePlayback:!1,supportsWebPlayback:!1,supportsAVOD:!1,supportsMidStreamMTA:!1,supportsHDMovies:b.contains(m.HD_MOVIE_SUPPORTED_OSES,n.getFamily()),supportsHDTVShows:!0,supportsLive:!0},l=I.withDefault(e.supportsDrm,!0),c=this.deviceInformationDenylist.getSupport(this.weblabs,l,I.withDefault(e.supportsLive,!1),this.clientId);if(a.supportsDrm=c.supportsDrm,a.supportsLive=c.supportsLive,c.supportsWebPlayback){var u=Uc.UNSUPPORTED_BROWSER,p=Bc.UNSUPPORTED_BROWSER,h=this.clientId===m.TNF_GATEWAY_CLIENT_ID,d=!1;if(h&&(o===Mp.Safari&&(d=!0),this.isFirefoxBrowser(o)&&(n.getFamily()===Lp.Mac&&0<=r.compareTo(Fp.fromString("10.12"))&&r.compareTo(Fp.fromString("10.14"))<0&&0<=s.compareTo(Fp.fromNumber(60))&&s.compareTo(Fp.fromNumber(62))<0&&(d=!0),n.getFamily()===Lp.Windows&&(n.getVersion().equals(kp.WINDOWS_7)||n.getVersion().equals(kp.WINDOWS_10))&&o===Mp.Firefox64&&(d=!0)),n.getVersion().equals(kp.WINDOWS_8_1)&&o===Mp.IE&&0<=s.compareTo(Fp.fromNumber(11))&&s.compareTo(Fp.fromNumber(12))<0&&(d=!0),n.getVersion().equals(kp.WINDOWS_10)&&o===Mp.Edge&&0<=s.compareTo(Fp.fromNumber(14))&&s.compareTo(Fp.fromNumber(16))<0&&(d=!0)),d)return a.supportsWebPlayback=!1,void i(a,u,p);if((h||e.supportsLive)&&this.isFirefoxBrowser(o)&&s.equals(Fp.fromNumber(55))&&n.getFamily()===Lp.Mac&&r.equals(Fp.fromString("10.13")))return a.supportsWebPlayback=!1,void i(a,u,p);if(h&&(!a.supportsLive||!a.supportsDrm))return a.supportsWebPlayback=!1,u=Uc.UNSUPPORTED_BROWSER,p=Bc.UNSUPPORTED_BROWSER,void i(a,u,p);if(I.isNullOrUndefined(window.MediaSource)&&n.getFamily()===Lp.iOS&&!l&&this.isHLSCapable())Wp.info("HLS non-DRM support detected."),a.supportsWebPlayback=!0,p=null,u="";else if(I.isNullOrUndefined(window.MediaSource))a.supportsWebPlayback=!1,p=Bc.UNSUPPORTED_BROWSER,u=Uc.MISSING_MEDIA_SOURCE;else if(l){if(this.isSupportedWebkitBrowser(o)){if(I.exists(this.navigator.requestMediaKeySystemAccess))return Wp.info("navigator.requestMediaKeySystemAccess support detected."),void this.supportsUnprefixedEme(function(e,t){u=e?"":o===Mp.EdgeNext?Uc.MISSING_PLAYREADY_CDM:Uc.MISSING_WIDEVINE_CDM,I.exists(t)&&(u+=": "+t),a.supportsDrm=e,a.supportsWebPlayback=e,p=e?null:Bc.MISSING_CDM,i(a,u,p)})}else if(o===Mp.IE||o===Mp.Edge)if(I.exists(window.MSMediaKeys))try{window.MSMediaKeys.isTypeSupported(m.PLAY_READY_KEY_SYSTEM,m.VIDEO_CONTENT_TYPE)&&window.MSMediaKeys.isTypeSupported(m.PLAY_READY_KEY_SYSTEM,m.AUDIO_CONTENT_TYPE)?(Wp.info("PlayReady support detected."),a.supportsWebPlayback=!0,a.supportsDrm=!0,p=null,u=""):(u=Uc.MISSING_CODEC_IN_PLAYREADY_CDM,p=Bc.MISSING_CODEC,Wp.info("Audio/Video types not supported by MSMediaKeys"))}catch(e){u=Uc.MISSING_PLAYREADY_CDM,p=Bc.MISSING_CDM,Wp.error("An error occurred when checking MSMediaKeys",e)}else u=Uc.MISSING_PLAYREADY_CDM,p=Bc.MISSING_CDM,Wp.info("No MSMediaKeys object detected. PlayReady not supported");else if(o===Mp.Safari)this.isFairplaySupported()?(a.supportsWebPlayback=!0,a.supportsDrm=!0,a.supportsLive=!0,u="",p=null,Wp.info("Safari MP2T+MSE support detected.")):(a.supportsWebPlayback=!1,u=Uc.MISSING_FAIRPLAY_CDM,p=Bc.MISSING_CDM,Wp.info("Detected Safari version "+s.toString()+" on MacOS version "+r.toString()+", but WebKitMediaKeys.canPlayType returned false"));else if(this.isFirefoxBrowser(o)){if(I.exists(this.navigator.requestMediaKeySystemAccess))return Wp.info("navigator.requestMediaKeySystemAccess support detected."),void this.supportsUnprefixedEme(function(e,t){u=e?"":Uc.MISSING_WIDEVINE_CDM,I.exists(t)&&(u+=": "+t),a.supportsDrm=e,a.supportsWebPlayback=e,p=e?null:Bc.MISSING_CDM,i(a,u,p)});a.supportsWebPlayback=!1,u=Uc.UNSUPPORTED_BROWSER,p=Bc.UNSUPPORTED_BROWSER,Wp.info("Firefox not supported because DRM is required.")}}else{Wp.info("No DRM required, not checking DRM support.");var f=MediaSource.isTypeSupported(m.VIDEO_CONTENT_TYPE),y=MediaSource.isTypeSupported(m.AUDIO_CONTENT_TYPE);Wp.info("\""+m.VIDEO_CONTENT_TYPE+"\" supported: "+f),Wp.info("\""+m.AUDIO_CONTENT_TYPE+"\" supported: "+y);var g=y&&f;a.supportsWebPlayback=g,p=g?null:Bc.MISSING_CODEC,u=""}i(a,u,p)}else i(a,c.note,c.notSupportedReason)},m.prototype.createWebPlayer=function(e,t){this.supportsWrappedXpPlayer()?this.wrappedXpPlayerLoader.createWebPlayer(this.cacheOverride,this.playerBeta,e,t):this.html5WebPlayerLoader.createWebPlayer(this.cacheOverride,e,t)},m.prototype.on=function(e,t){this.eventEmitter.on(e,t)},m.prototype.once=function(e,t){this.eventEmitter.once(e,t)},m.prototype.off=function(e,t){this.eventEmitter.off(e,t)},m.prototype.supportsWrappedXpPlayer=function(){var e=!b.contains(Vp,this.clientId);return!0===this.queryString.getParameter("xpBeta")||this.browserSupportsWrappedXpPlayer()&&this.osSupportsWrappedXpPlayer()&&e},m.prototype.browserSupportsWrappedXpPlayer=function(){switch(this.deviceInformation.browser.getType()){case Mp.AmazonWebView:case Mp.Chrome:case Mp.EdgeNext:case Mp.Firefox:case Mp.Firefox64:case Mp.Opera:return!0;case Mp.Chromium:return this.weblabs[xp.HASTUR_CHROMIUM]===Dp.T1;case Mp.Edge:return this.weblabs[xp.HASTUR_EDGE]===Dp.T1;case Mp.IE:return this.weblabs[xp.HASTUR_IE]===Dp.T1;case Mp.Safari:return this.weblabs[xp.HASTUR_SAFARI]===Dp.T1;default:return!1}},m.prototype.osSupportsWrappedXpPlayer=function(){switch(this.deviceInformation.operatingSystem.getFamily()){case Lp.ChromeOS:return this.weblabs[xp.HASTUR_CHROMEOS]===Dp.T1;case Lp.Linux:return this.weblabs[xp.HASTUR_LINUX]===Dp.T1;default:return!0}},m.prototype.isFirefoxBrowser=function(e){return e===Mp.Firefox||e===Mp.Firefox64},m.prototype.isFairplaySupported=function(){return void 0!==window.WebKitMediaKeys&&window.WebKitMediaKeys.isTypeSupported(m.SAFARI_KEY_SYSTEM,m.MP2TS_CONTENT_TYPE)},m.prototype.isSupportedWebkitBrowser=function(e){return e===Mp.EdgeNext||e===Mp.Chrome||e===Mp.Silk||e===Mp.Opera||e===Mp.AmazonWebView||e===Mp.Chromium},m.prototype.isHLSCapable=function(){var e=document.createElement("video");return I.exists(e.canPlayType)&&""!==e.canPlayType(m.HLS_CONTENT_TYPE)},m.prototype.supportsUnprefixedEme=function(i){var n=this,e=(new bp).getDrmSystems(),r=function(e,t){return n.navigator.requestMediaKeySystemAccess(e.keySystem,t).then(function(){Wp.info(e.keySystem+", "+m.INIT_DATA_TYPE+", \""+m.VIDEO_CONTENT_TYPE+"\", and \""+m.AUDIO_CONTENT_TYPE+"\" support detected."),i(!0)})};e.reduce(function(e,i){return i.configurations.reduce(function(e,t){return I.exists(e)?e.catch(function(e){return r(i,t)}):r(i,t)},e)},null).catch(function(e){Wp.info("No supported keySystem, "+m.INIT_DATA_TYPE+", \""+m.VIDEO_CONTENT_TYPE+"\", and/or \""+m.AUDIO_CONTENT_TYPE+"\" support detected."),i(!1,e)})},m.HTML5_NOT_USED_ERROR_NAME="HTML5PlayerNotUsedWarning",m.PLAYER_NAME="html5",m.TNF_GATEWAY_CLIENT_ID="511cc9af-3ecb-48fe-9825-886ebfbb6503",m.VIDEO_CONTENT_TYPE="video/mp4; codecs=\"avc1.640028\"",m.AUDIO_CONTENT_TYPE="audio/mp4; codecs=\"mp4a.40.2\"",m.HLS_CONTENT_TYPE="application/vnd.apple.mpegURL",m.MP2TS_CONTENT_TYPE="video/mp2t",m.INIT_DATA_TYPE="cenc",m.PLAY_READY_KEY_SYSTEM="com.microsoft.playready",m.SAFARI_KEY_SYSTEM="com.apple.fps.2_0",m.METRICS_FEATURE="HTML5Player",m.HD_MOVIE_SUPPORTED_OSES=[Lp.Windows,Lp.WindowsPhone,Lp.ChromeOS,Lp.Mac],m}(),qp=l&&l.__extends||(Su=function(e,t){return(Su=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Su(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),jp=function(r){function e(e,t){var i=r.call(this,e)||this;return i.extraText=t,i}return qp(e,r),e.prototype.renderString=function(e,t,i){var n={extraText:this.extraText};return I.isNullOrUndefined(i)||b.extend(n,i),r.prototype.renderString.call(this,e,t,n)},e.ACTIVEX_KEY="silverlightActiveX",e.INSTALL_KEY="silverlightInstall",e.INSTALL_SAFARI_KEY="silverlightInstallSafari",e.UPGRADE_KEY="silverlightUpgrade",e.BUTTON_TEMPLATE="<div class='buttonWrapper'>{{{button}}}</div>",e.ACTIVEX_EXTRA_TEXT="<ol>{{#steps}}<li>{{{.}}}</li>{{/steps}}</ol>",e}(ll),zp=c.of("SilverlightModalTemplate"),Gp=function(){function e(){}return e.createModalTemplate=function(e,t){return void 0===t&&(t=""),zp(e,"key").exists(),new jp(e,t)},e}(),Yp=bi.Version,Kp=Ue.ErrorSeverity,Xp=zo.BrowserType,Qp=zo.OperatingSystemFamily,Jp=zo.WindowsVersion,Zp=c.of("SilverlightWebPlayerOption"),$p=Ve.get("SilverlightWebPlayerOption"),eh=function(){function n(e,t,i,n){void 0===n&&(n=navigator),this.os=Zp(e,"os").exists(),this.browser=Zp(t,"browser").exists(),this.createModalTemplate=Zp(i,"createModalTemplate").exists(),this.navigatorRef=n}return n.prototype.isCompatible=function(){if(this.os.getFamily()!==Qp.Windows&&this.os.getFamily()!==Qp.Mac)return $p.info("Silverlight is not supported on non-Win/Mac operating systems."),!1;if(b.contains(n.UNSUPPORTED_BROWSERS,this.browser.getType())||this.isUnsupportedFirefoxVersion(this.browser))return $p.info("Silverlight is not supported on "+Xp[this.browser.getType()]+"."),!1;if(this.browser.getType()===Xp.IE){if(Jp.WINDOWS_8.compareTo(this.os.getVersion())<=0&&!this.isActiveXEnabled())return $p.info("Silverlight is not supported on Internet Explorer Metro."),!1;if(0<Yp.fromNumber(n.MIN_IE_VERSION).compareTo(this.browser.getVersion()))return $p.info("Silverlight is only supported on Internet Explorer version "+this.browser.getVersion()+"."),!1}return $p.info("Silverlight is supported on "+this.browser+" on "+this.os),!0},n.prototype.checkAvailability=function(e,t){this.os.getFamily()===Qp.Windows&&0<Jp.WINDOWS_8.compareTo(this.os.getVersion())&&this.browser.getType()===Xp.IE&&!this.isActiveXEnabled()?t(n.ACTIVEX_DISABLED_ERROR,"ActiveX is not enabled",Kp.NonFatal,this.createModalTemplate(jp.ACTIVEX_KEY,jp.ACTIVEX_EXTRA_TEXT)):this.isAvailable()?this.isUpToDate()?e():t(n.UPGRADE_REQUIRED_ERROR,"Silverlight needs to be upgraded",Kp.NonFatal,this.createModalTemplate(jp.UPGRADE_KEY,jp.BUTTON_TEMPLATE)):t(n.NOT_INSTALLED_ERROR,"Silverlight is not installed",Kp.NonFatal,this.createModalTemplate(this.getBrowserInstallKey(),jp.BUTTON_TEMPLATE))},n.prototype.isUnsupportedFirefoxVersion=function(e){return this.isFirefoxBrowser(e.getType())&&0<=this.browser.getVersion().compareTo(Yp.fromNumber(n.FIREFOX_NPAPI_REMOVED_VERSION))},n.prototype.isFirefoxBrowser=function(e){return e===Xp.Firefox||e===Xp.Firefox64},n.prototype.isAvailable=function(){if(this.isSafari10OrHigher())return!0;var e=this.navigatorRef.plugins[n.SILVERLIGHT_NSAPI_ID];if(!I.isNullOrUndefined(e))return!0;try{return new ActiveXObject(n.SILVERLIGHT_ACTIVEX_ID),!0}catch(e){return!1}},n.prototype.isUpToDate=function(){var e=this.navigatorRef.plugins[n.SILVERLIGHT_NSAPI_ID];if(!I.isNullOrUndefined(e)){var t=e.description,i=parseFloat(t);return n.MIN_SILVERLIGHT_VERSION<=i}if(this.isSafari10OrHigher())return!0;try{return(e=new ActiveXObject(n.SILVERLIGHT_ACTIVEX_ID)).IsVersionSupported(""+n.MIN_SILVERLIGHT_VERSION)}catch(e){$p.info("Silverlight ActiveX plugin not found.")}return!1},n.prototype.getBrowserInstallKey=function(){return this.browser.getType()===Xp.Safari?jp.INSTALL_SAFARI_KEY:jp.INSTALL_KEY},n.prototype.isActiveXEnabled=function(){try{return!!new ActiveXObject("htmlfile")}catch(e){return!1}},n.prototype.isSafari10OrHigher=function(){return this.browser.getType()===Xp.Safari&&0<=this.browser.getVersion().compareTo(Yp.fromNumber(n.SAFARI_10_VERSION))},n.MIN_SILVERLIGHT_VERSION=5.1,n.FIREFOX_NPAPI_REMOVED_VERSION=52,n.MIN_IE_VERSION=10,n.SAFARI_10_VERSION=10,n.UNSUPPORTED_BROWSERS=[Xp.Chrome,Xp.Edge,Xp.Opera,Xp.Unknown],n.SILVERLIGHT_NSAPI_ID="Silverlight Plug-In",n.SILVERLIGHT_ACTIVEX_ID="AgControl.AgControl",n.ACTIVEX_DISABLED_ERROR="SilverlightActiveXDisabledError",n.NOT_INSTALLED_ERROR="SilverlightNotInstalledError",n.UPGRADE_REQUIRED_ERROR="SilverlightUpgradeRequiredError",n}(),th=tt.WeblabTreatment,ih=c.of("WeblabStringifier"),nh=function(){function e(){}return e.stringify=function(e){ih(e,"weblabs").exists();var t=[];for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=I.isNullOrUndefined(n)?"C":th[n];t.push(i+":"+r)}return t.join(" ")},e}(),rh=Ue.NotificationEvent,oh=bi.LocalStorage,sh=function(){function i(e){void 0===e&&(e=new oh);var t=this;this.setDontShowAgain=function(){t.storage.set(i.DONT_SHOW_AGAIN_KEY,"true")},this.storage=e}return i.prototype.createNotification=function(){return new rh(this.getTemplate(),null,!0,null,this.setDontShowAgain)},i.prototype.shouldShowNotification=function(){return"true"!==this.storage.get(i.DONT_SHOW_AGAIN_KEY)},i.prototype.getTemplate=function(){return{renderString:function(e,t){return e[i.MESSAGE_KEY]}}},i.MESSAGE_KEY="silverlightForcedNarratives",i.DONT_SHOW_AGAIN_KEY="dont_show_forced_narratives",i}(),ah=l&&l.__extends||(Tu=function(e,t){return(Tu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}Tu(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),lh=bi.Version,ch=zo.BrowserType,uh=function(n){function l(e){void 0===e&&(e=zo.getBrowser());var t=null,i=!1;return l.isSafari10OrHigher(e)||(t=l.getDetailsTemplate(e),i=!0),n.call(this,l.getSubjectTemplate(e),t,i,null)||this}return ah(l,n),l.getSubjectTemplate=function(i){return{renderString:function(e,t){if(l.isSafari10OrHigher(i))return rl.render(e[l.SAFARI_10_KEY],t);return rl.render("{{{message}}}",e[l.MESSAGE_KEY])}}},l.getDetailsTemplate=function(e){var a=l.isChrome(e.getType());return{renderString:function(e,t){var i,n=e[l.MESSAGE_KEY],r=n[l.CHROME_UNBLOCK_KEY],o=rl.render(n[l.TROUBLESHOOT_KEY],t),s="{{#isChrome}}{{{"+l.CHROME_UNBLOCK_KEY+"}}}<br />{{/isChrome}}{{{"+l.TROUBLESHOOT_KEY+"}}}";return rl.render(s,((i={isChrome:a})[l.CHROME_UNBLOCK_KEY]=r,i[l.TROUBLESHOOT_KEY]=o,i))}}},l.isChrome=function(e){return e===ch.Chrome||e===ch.Chromium},l.isSafari10OrHigher=function(e){return e.getType()===ch.Safari&&0<=e.getVersion().compareTo(lh.fromNumber(l.SAFARI_10_VERSION))},l.CHROME_UNBLOCK_KEY="chromeUnblock",l.MESSAGE_KEY="silverlightBlocked",l.SAFARI_10_KEY="silverlightBlockedSafari10",l.TROUBLESHOOT_KEY="troubleshoot",l.SAFARI_10_VERSION=10,l}(Ue.NotificationEvent),ph={_silverlightCount:0,createObject:function(e,t,i,n,r,o,s){var a=new Object,l=n,c=r;for(var u in a.version=l.version,l.source=e,a.alt=l.alt,o&&(l.initParams=o),l.isWindowless&&!l.windowless&&(l.windowless=l.isWindowless),l.framerate&&!l.maxFramerate&&(l.maxFramerate=l.framerate),i&&!l.id&&(l.id=i),delete l.ignoreBrowserVer,delete l.inplaceInstallPrompt,delete l.version,delete l.isWindowless,delete l.framerate,delete l.data,delete l.src,delete l.alt,c)if(c[u]){if("onLoad"===u&&"function"==typeof c[u]&&1!==c[u].length){var p=c[u];c[u]=function(e){return p(document.getElementById(i),s,e)}}var h=ph.__getHandlerName(c[u]);if(null===h)throw"typeof events."+u+" must be 'function' or 'string'";l[u]=h,c[u]=null}var d=ph.buildHTML(l);if(!t)return d;t.innerHTML=d},buildHTML:function(e){var t=[];for(var i in t.push("<object type=\"application/x-silverlight\" data=\"data:application/x-silverlight,\""),null!==e.id&&t.push(" id=\""+ph.HtmlAttributeEncode(e.id)+"\""),null!==e.width&&t.push(" width=\""+e.width+"\""),null!==e.height&&t.push(" height=\""+e.height+"\""),t.push(" >"),delete e.id,delete e.width,delete e.height,e)e[i]&&t.push("<param name=\""+ph.HtmlAttributeEncode(i)+"\" value=\""+ph.HtmlAttributeEncode(e[i])+"\" />");return t.push("</object>"),t.join("")},createObjectEx:function(e){var t=e,i=ph.createObject(t.source,t.parentElement,t.id,t.properties,t.events,t.initParams,t.context);if(null===t.parentElement)return i},HtmlAttributeEncode:function(e){var t,i="";if(null===e)return null;for(var n=0;n<e.length;n++)96<(t=e.charCodeAt(n))&&t<123||64<t&&t<91||43<t&&t<58&&47!==t||95===t?i+=String.fromCharCode(t):i=i+"&#"+t+";";return i},__cleanup:function(){for(var e=ph._silverlightCount-1;0<=e;e--)window["__slEvent"+e]=null;ph._silverlightCount=0,window.removeEventListener?window.removeEventListener("unload",ph.__cleanup,!1):window.detachEvent("onunload",ph.__cleanup)},__getHandlerName:function(e){var t="";if("string"==typeof e)t=e;else if("function"==typeof e){0===ph._silverlightCount&&(window.addEventListener?window.addEventListener("unload",ph.__cleanup,!1):window.attachEvent("onunload",ph.__cleanup)),t="__slEvent"+ph._silverlightCount++,window[t]=e}else t=null;return t}},hh=ph,dh=function(){function e(){}return e.toString=function(){return"silverlightPluginLoaded"},e}(),fh=function(){function e(){}return e.toString=function(){return"silverlightPlayerLoaded"},e}(),yh=function(){function e(e,t,i){this.errorCode=e,this.errorType=t,this.errorMessage=i}return e.toString=function(){return"silverlightPlayerLoadError"},e.prototype.getErrorCode=function(){return this.errorCode},e.prototype.getErrorType=function(){return this.errorType},e.prototype.getErrorMessage=function(){return this.errorMessage},e.prototype.isCorruptionError=function(){return b.contains([2103,2104,2105,2150,2152,2153,e.LOAD_TIMEOUT_ERROR_CODE],this.errorCode)},e.LOAD_TIMEOUT_ERROR_CODE="sl_timeout",e}(),gh=c.of("SilverlightInitializer"),mh=Ve.get("SilverlightInitializer"),vh=function(){function a(){var i=this;this.monitoringTimer=null,this.pluginId=null,this.complete=!1,this.onMonitorCheck=function(){i.isSilverlightPluginLoaded()&&(i.clearMonitor(),i.eventEmitter.emit(dh,new dh),i.monitoringTimer=setTimeout(i.onXapLoadTimeout,a.PLAYER_LOAD_TIMEOUT))},this.onPlayerLoad=function(){i.clearMonitor(),i.complete=!0,mh.info("The XAP has successfully loaded"),i.eventEmitter.emit(fh,new fh)},this.onPlayerError=function(e,t){mh.info("A fatal error has occurred during XAP initialization",t),i.complete||(i.clearMonitor(),i.complete=!0,i.eventEmitter.emit(yh,new yh(t.errorCode,t.errorType,t.errorMessage)))},this.onXapLoadTimeout=function(){i.onPlayerError(null,{errorCode:yh.LOAD_TIMEOUT_ERROR_CODE})},gh(hh,"Silverlight").exists(),this.eventEmitter=new We.BasicEventEmitter}return a.prototype.initialize=function(e,t,i,n,r,o){gh(e,"parentElement").exists(),gh(t,"id").exists(),gh(i,"xapUrl").exists(),gh(n,"minVersion").exists(),gh(r,"windowless").exists(),this.pluginId=t,this.complete=!1,this.clearMonitor();var s=this.generateInitParamString(o);this.monitoringTimer=setInterval(this.onMonitorCheck,a.SILVERLIGHT_PLUGIN_LOAD_POLL_INTERVAL),hh.createObjectEx({source:i,parentElement:e,id:t,properties:{windowless:""+r,width:"100%",height:"100%",minRuntimeVersion:n,enableGPUAcceleration:"true",background:"#000000",enableHtmlAccess:"true"},initParams:s,events:{onLoad:this.onPlayerLoad,onError:this.onPlayerError}})},a.prototype.on=function(e,t){this.eventEmitter.on(e,t)},a.prototype.once=function(e,t){this.eventEmitter.once(e,t)},a.prototype.off=function(e,t){this.eventEmitter.off(e,t)},a.prototype.stop=function(){this.clearMonitor()},a.prototype.clearMonitor=function(){clearInterval(this.monitoringTimer),clearTimeout(this.monitoringTimer),this.monitoringTimer=null},a.prototype.isSilverlightPluginLoaded=function(){var e=document.getElementById(this.pluginId);return null!==e&&void 0!==e.isVersionSupported},a.prototype.generateInitParamString=function(e){var t=new Array;for(var i in e)e.hasOwnProperty(i)&&"string"==typeof e[i]&&null!==e[i]&&t.push(i+"="+e[i]);return t.join(",")},a.SILVERLIGHT_PLUGIN_LOAD_POLL_INTERVAL=500,a.PLAYER_LOAD_TIMEOUT=6e4,a}();(Iu=bu||(bu={}))[Iu.Streaming=0]="Streaming",Iu[Iu.Download=1]="Download",(Ru=wu||(wu={}))[Ru.Stereo=0]="Stereo",Ru[Ru.AC3=1]="AC3",(Pu=Cu||(Cu={}))[Pu.CBR=0]="CBR",Pu[Pu.CVBR=1]="CVBR",(Ou=Au||(Au={}))[Ou.SINGLE_KEY=0]="SINGLE_KEY",Ou[Ou.DUAL_KEY=1]="DUAL_KEY",(Mu=Nu||(Nu={}))[Mu.PlayReady=0]="PlayReady",Mu[Mu.Widevine2=1]="Widevine2",Mu[Mu.NONE=2]="NONE",Mu[Mu.WMRM=3]="WMRM",Mu[Mu.Marlin=4]="Marlin",Mu[Mu.FairPlay=5]="FairPlay",Mu[Mu.CENC=6]="CENC",(ku=Lu||(Lu={}))[ku.Http=0]="Http",ku[ku.Https=1]="Https",ku[ku.Rtmpe=2]="Rtmpe",(Du=xu||(xu={}))[Du.H264=0]="H264",Du[Du.H265=1]="H265",(Fu=Uu||(Uu={}))[Fu.UHD=0]="UHD",Fu[Fu.HD=1]="HD",Fu[Fu.SD=2]="SD",(Wu=Hu||(Hu={}))[Wu.DASH=0]="DASH",Wu[Wu.SmoothStreaming=1]="SmoothStreaming",Wu[Wu.HLS=2]="HLS",Wu[Wu.MP4=3]="MP4",Wu[Wu.WMV=4]="WMV",Wu[Wu.MPEGPS=5]="MPEGPS",Wu[Wu.MPEGTS=6]="MPEGTS",(Bu=Vu||(Vu={})).Accumulating="accumulating",Bu.Live="live";var Eh={AudioQuality:wu,BitrateAdaptation:Cu,ConsumptionType:bu,ContentProtection:Nu,DrmKeyScheme:Au,LiveManifestType:Vu,Protocol:Lu,StreamingTechnology:Hu,VideoCodec:xu,VideoQuality:Uu},_h=function(){function e(){}return e.prototype.convert=function(e){for(var t=e.avCdnUrlSets,i={},n=b.isEmpty(t)?null:t[0].urlSetId,r=b.isEmpty(t)?null:t[0].avUrlInfoList[0].cacheKey,o=0;o<t.length;o++){var s=t[o],a=s.urlSetId,l=I.withDefault(t[o+1],t[0]).urlSetId;i[a]={urlSetId:a,urls:{manifest:{url:s.avUrlInfoList[0].url,audioFormat:null,videoQuality:s.avUrlInfoList[0].videoQuality,audioTrackId:s.audioTrackId,cdn:s.cdn,origin:s.avUrlInfoList[0].origin,drm:s.drm,dynamicRange:s.hdrFormat,compressionStandard:s.encode,streamingTechnology:s.streamingTechnology},adsTrackingEndpoint:s.avUrlInfoList[0].adsTrackingEndpoint},failover:{cdn:{urlSetId:l,mode:"seamless"},default:{urlSetId:l,mode:"seamless"}}}}return{audioTracks:e.audioTrackMetadata,cacheKey:r,defaultAudioTrackId:e.defaultAudioTrackId,defaultUrlSetId:n,urlSets:i}},e}(),Sh=function(){function e(){}return e.AD_SUPPORTED="AD_SUPPORTED",e.PRIME_SUBSCRIPTION="PRIME_SUBSCRIPTION",e.THIRD_PARTY_SUBSCRIPTION="THIRD_PARTY_SUBSCRIPTION",e}(),Th=function(){function e(){}return e.NONE="HDCP_NONE",e.V1="HDCP_V1",e.V2="HDCP_V2",e.V2_1="HDCP_V2_1",e.V2_2="HDCP_V2_2",e}(),bh=function(){function e(){}return e.CONTENT="CONTENT",e.HDCP_TEST="HDCP_TEST",e.SERVICE_CERTIFICATE="SERVICE_CERTIFICATE",e}(),Ih=n(function(e,t){var i,n,r,o,s,a,l;Object.defineProperty(t,"__esModule",{value:!0}),(i=t.QueryStringParameter||(t.QueryStringParameter={}))[i.asin=0]="asin",i[i.audioTrackId=1]="audioTrackId",i[i.clientId=2]="clientId",i[i.consumptionType=3]="consumptionType",i[i.customerID=4]="customerID",i[i.desiredAudioQuality=5]="desiredAudioQuality",i[i.desiredResources=6]="desiredResources",i[i.deviceAudioQualityOverride=7]="deviceAudioQualityOverride",i[i.deviceBitrateAdaptationsOverride=8]="deviceBitrateAdaptationsOverride",i[i.deviceDrmOverride=9]="deviceDrmOverride",i[i.deviceID=10]="deviceID",i[i.deviceProtocolOverride=11]="deviceProtocolOverride",i[i.deviceStreamingTechnologyOverride=12]="deviceStreamingTechnologyOverride",i[i.deviceTypeID=13]="deviceTypeID",i[i.deviceVideoCodecOverride=14]="deviceVideoCodecOverride",i[i.deviceVideoQualityOverride=15]="deviceVideoQualityOverride",i[i.firmware=16]="firmware",i[i.gascEnabled=17]="gascEnabled",i[i.languageFeature=18]="languageFeature",i[i.linearRestrictionEnd=19]="linearRestrictionEnd",i[i.linearRestrictionStart=20]="linearRestrictionStart",i[i.liveManifestType=21]="liveManifestType",i[i.liveScheduleConfigToken=22]="liveScheduleConfigToken",i[i.marketplaceID=23]="marketplaceID",i[i.operatingSystemName=24]="operatingSystemName",i[i.operatingSystemVersion=25]="operatingSystemVersion",i[i.playbackSettingsFormatVersion=26]="playbackSettingsFormatVersion",i[i.playerAttributes=27]="playerAttributes",i[i.playerType=28]="playerType",i[i.resourceUsage=29]="resourceUsage",i[i.siteSectionId=30]="siteSectionId",i[i.subtitleFormat=31]="subtitleFormat",i[i.supportedDRMKeyScheme=32]="supportedDRMKeyScheme",i[i.titleDecorationScheme=33]="titleDecorationScheme",i[i.token=34]="token",i[i.userWatchSessionId=35]="userWatchSessionId",i[i.uxLocale=36]="uxLocale",i[i.videoMaterialType=37]="videoMaterialType",i[i.videoMinBitrate=38]="videoMinBitrate",i[i.xrayDeviceClass=39]="xrayDeviceClass",i[i.xrayPlaybackMode=40]="xrayPlaybackMode",i[i.xrayToken=41]="xrayToken",(n=t.PostBodyParameter||(t.PostBodyParameter={}))[n.playReadyChallenge=0]="playReadyChallenge",n[n.playReadyKeyId=1]="playReadyKeyId",n[n.fairPlayChallenge=2]="fairPlayChallenge",n[n.fairPlayKeyId=3]="fairPlayKeyId",n[n.widevine2Challenge=4]="widevine2Challenge",n[n.includeHdcpTestKeyInLicense=5]="includeHdcpTestKeyInLicense",(r=t.DesiredResources||(t.DesiredResources={}))[r.AudioVideoUrls=0]="AudioVideoUrls",r[r.CatalogMetadata=1]="CatalogMetadata",r[r.CuepointPlaylist=2]="CuepointPlaylist",r[r.DevicePlaybackConfiguration=3]="DevicePlaybackConfiguration",r[r.FairPlayApplicationCertificate=4]="FairPlayApplicationCertificate",r[r.FairPlayLicense=5]="FairPlayLicense",r[r.ForcedNarratives=6]="ForcedNarratives",r[r.LinearRestrictions=7]="LinearRestrictions",r[r.LiveSchedule=8]="LiveSchedule",r[r.PlaybackSettings=9]="PlaybackSettings",r[r.PlaybackUrls=10]="PlaybackUrls",r[r.PlayReadyLicense=11]="PlayReadyLicense",r[r.SubtitlePresets=12]="SubtitlePresets",r[r.SubtitleUrls=13]="SubtitleUrls",r[r.TransitionTimecodes=14]="TransitionTimecodes",r[r.TrickplayUrls=15]="TrickplayUrls",r[r.Widevine2License=16]="Widevine2License",r[r.WhisperSyncBookmark=17]="WhisperSyncBookmark",r[r.XRayMetadata=18]="XRayMetadata",(o=t.ResourceUsage||(t.ResourceUsage={}))[o.ImmediateConsumption=0]="ImmediateConsumption",o[o.CacheResources=1]="CacheResources",o[o.OptimisticFulfillment=2]="OptimisticFulfillment",(s=t.VideoMaterialType||(t.VideoMaterialType={}))[s.Feature=0]="Feature",s[s.Trailer=1]="Trailer",s[s.LiveStreaming=2]="LiveStreaming",s[s.External=3]="External",s[s.VideoAds=4]="VideoAds",(a=t.SubtitleFormat||(t.SubtitleFormat={}))[a.TTML=0]="TTML",a[a.TTMLv2=1]="TTMLv2",(l=t.LanguageFeature||(t.LanguageFeature={}))[l.MLFv2=0]="MLFv2"});e(Ih);var wh,Rh;Ih.QueryStringParameter,Ih.PostBodyParameter,Ih.DesiredResources,Ih.ResourceUsage,Ih.VideoMaterialType,Ih.SubtitleFormat,Ih.LanguageFeature;(Rh=wh||(wh={}))[Rh.PRSError=0]="PRSError",Rh[Rh.PRSConcurrencyError=1]="PRSConcurrencyError",Rh[Rh.PRSGeoIpError=2]="PRSGeoIpError",Rh[Rh.PRSHttpProxyError=3]="PRSHttpProxyError",Rh[Rh.PRSOwnershipError=4]="PRSOwnershipError";var Ch=wh,Ph=yn.Errors,Ah=function(){function o(){}return o.createError=function(e){var t=Ch.PRSError,i=o.ERROR_MAPPING[e.type];I.isNullOrUndefined(i)||(t=i);var n=o.ERROR_CODE_MAPPING[e.errorCode];I.isNullOrUndefined(n)||(t=n);var r=Ph.newError(Ch[t],e.message);return r.errorCode=e.errorCode,I.exists(e.downstreamReason)&&(r.downstreamReason=e.downstreamReason),r},o.createPRSError=function(e,t){return Ph.newError(Ch[Ch.PRSError],e,t)},o.convertResourceExceptions=function(e){return I.isNullOrUndefined(e)?e:b.object(b.map(e,function(e,t){return[t,o.createError(e)]}))},o.convertRightsException=function(e){if(I.isNullOrUndefined(e))return e;var t=I.nestedValue(e,"selectedEntitlement.rightsException");return null!==t&&(e.selectedEntitlement.rightsException=o.createError(t)),e},o.ERROR_MAPPING={PRSConcurrencyException:Ch.PRSConcurrencyError,PRSGeoIpException:Ch.PRSGeoIpError,PRSOwnershipException:Ch.PRSOwnershipError,PRSException:Ch.PRSError,PRSDependencyException:Ch.PRSError,PRSInvalidRequestException:Ch.PRSError,PRSRightsAndPoliciesException:Ch.PRSError,PRSWidevine2LicenseDeniedException:Ch.PRSError},o.ERROR_CODE_MAPPING={"PRS.NoRights.AnonymizerIP":Ch.PRSHttpProxyError},o}(),Oh=Rn.TokenType,Nh=ji.HttpRequest,Mh=hn.ExponentialBackoffRetry,Lh=yn.Errors,kh=Eh.AudioQuality,xh=Eh.BitrateAdaptation,Dh=Eh.ConsumptionType,Uh=Eh.ContentProtection,Fh=Eh.DrmKeyScheme,Hh=Eh.Protocol,Wh=Eh.StreamingTechnology,Vh=Eh.VideoCodec,Bh=Eh.VideoQuality,qh=tt.MarketplaceID,jh=Ih.DesiredResources,zh=Ih.LanguageFeature,Gh=Ih.PostBodyParameter,Yh=Ih.QueryStringParameter,Kh=Ih.ResourceUsage,Xh=Ih.SubtitleFormat,Qh=Ih.VideoMaterialType,Jh=c.of("PlaybackResourceRequest"),Zh=function(){function c(e,t,i,n,r,o,s){void 0===r&&(r=Nh),void 0===o&&(o=Mh),void 0===s&&(s=zo.getOperatingSystem()),this.playerAttributes={},this.retry=null,this.request=null,Jh(e,"options").exists(),Jh(t,"url").exists(),I.exists(i)&&(Jh(i.customerId,"customerId").exists(),this.authContext=i),this.httpRequest=r,this.retryType=o,this.url=t,this.formFields=null,this.queryParams={},this.addQueryParam(Yh.asin,e.asin),this.addQueryParam(Yh.consumptionType,Dh[e.consumptionType]),this.addQueryParam(Yh.desiredResources,e.desiredResources.map(function(e){return jh[e]}).join()),this.addQueryParam(Yh.deviceID,e.deviceId),this.addQueryParam(Yh.deviceTypeID,e.deviceTypeId),this.addQueryParam(Yh.firmware,"1"),this.addQueryParam(Yh.gascEnabled,!qh.isClassic(e.marketplaceId)),this.addQueryParam(Yh.marketplaceID,e.marketplaceId),this.addQueryParam(Yh.resourceUsage,Kh[e.resourceUsage]),this.addQueryParam(Yh.userWatchSessionId,e.userWatchSessionId),this.addQueryParam(Yh.videoMaterialType,Qh[e.videoMaterialType]),this.addQueryParam(Yh.playerType,"html5"),I.exists(n)&&this.addQueryParam(Yh.clientId,n);var a=s.getFamilyName();null!==a&&this.addQueryParam(Yh.operatingSystemName,a);var l=s.getKernelVersion();null!==l&&this.addQueryParam(Yh.operatingSystemVersion,l),this.resourceUsage=e.resourceUsage}return c.prototype.withAudioTrackId=function(e){return Jh(e,"trackId").exists(),this.addQueryParam(Yh.audioTrackId,e),this},c.prototype.withDesiredAudioQuality=function(e){return Jh(e,"audioQuality").exists(),this.addQueryParam(Yh.desiredAudioQuality,kh[e]),this},c.prototype.withDeviceAudioQualityOverride=function(e){return Jh(e,"deviceAudioQuality").exists(),this.addQueryParam(Yh.deviceAudioQualityOverride,kh[e]),this},c.prototype.withDeviceBitrateAdaptationsOverride=function(e){Jh(e,"deviceBitrateAdaptations").exists(),Jh(0<e.length,"deviceBitrateAdaptations").is.true();var t=e.map(function(e){return xh[e]});return this.addQueryParam(Yh.deviceBitrateAdaptationsOverride,t.join(",")),this},c.prototype.withDeviceDrmOverride=function(e){return Jh(e,"deviceDrm").exists(),this.addQueryParam(Yh.deviceDrmOverride,Uh[e]),this},c.prototype.withDeviceProtocolOverride=function(e){return Jh(e,"deviceProtocol").exists(),this.addQueryParam(Yh.deviceProtocolOverride,Hh[e]),this},c.prototype.withDeviceStreamingTechnologyOverride=function(e){return Jh(e,"streamingTechnology").exists(),this.addQueryParam(Yh.deviceStreamingTechnologyOverride,Wh[e]),this},c.prototype.withDeviceVideoCodecOverride=function(e){Jh(e,"videoCodecs").exists(),Jh(0<e.length,"videoCodecs must").is.true();var t=e.map(function(e){return Vh[e]});return this.addQueryParam(Yh.deviceVideoCodecOverride,t.join(",")),this},c.prototype.withDeviceVideoQualityOverride=function(e){return Jh(e,"deviceVideoQuality").exists(),this.addQueryParam(Yh.deviceVideoQualityOverride,Bh[e]),this},c.prototype.withLiveScheduleConfigToken=function(e){return Jh(e,"token").exists(),this.addQueryParam(Yh.liveScheduleConfigToken,e),this},c.prototype.withPlayReadyChallenge=function(e,t){return Jh(e,"challenge").exists(),this.addPostBodyParam(Gh.playReadyChallenge,e),I.isNullOrUndefined(t)||this.addPostBodyParam(Gh.playReadyKeyId,t),this},c.prototype.withFairPlayChallenge=function(e,t){return Jh(e,"challenge").exists(),Jh(t,"keyId").exists(),this.addPostBodyParam(Gh.fairPlayChallenge,e),this.addPostBodyParam(Gh.fairPlayKeyId,t),this},c.prototype.withWidevine2Challenge=function(e,t){return void 0===t&&(t=!1),Jh(e,"challenge").exists(),this.addPostBodyParam(Gh.widevine2Challenge,e),this.addPostBodyParam(Gh.includeHdcpTestKeyInLicense,t),this},c.prototype.withTitleDecorationScheme=function(e){return Jh(e,"titleDecorationScheme").exists(),this.addQueryParam(Yh.titleDecorationScheme,e),this},c.prototype.withUserWatchSessionId=function(e){return Jh(e,"userWatchSessionId").exists(),this.addQueryParam(Yh.userWatchSessionId,e),this},c.prototype.withVideoMinBitrate=function(e){return Jh(e,"bitrate").exists(),this.addQueryParam(Yh.videoMinBitrate,e),this},c.prototype.withSubtitleFormat=function(e){return Jh(e,"format").exists(),e!==Xh.TTML&&this.addQueryParam(Yh.subtitleFormat,Xh[e]),this},c.prototype.withLanguageFeature=function(e){return Jh(e,"languageFeature").exists(),this.addQueryParam(Yh.languageFeature,zh[e]),this},c.prototype.withSiteSectionId=function(e){return Jh(e,"siteSectionId").exists(),this.addQueryParam(Yh.siteSectionId,e),this},c.prototype.withPlaybackSettingsFormatVersion=function(e){return Jh(e,"formatVersion").exists(),this.addQueryParam(Yh.playbackSettingsFormatVersion,e),this},c.prototype.withSupportedDrmKeyScheme=function(e){return Jh(e,"drmKeyScheme").exists(),this.addQueryParam(Yh.supportedDRMKeyScheme,Fh[e]),this},c.prototype.withUxLocale=function(e){return Jh(e,"uxLocale").exists(),this.addQueryParam(Yh.uxLocale,e.replace("-","_")),this},c.prototype.withXrayParameters=function(e,t,i){return Jh(e,"xrayDeviceClass").exists(),Jh(t,"xrayPlaybackMode").exists(),Jh(i,"xrayToken").exists(),this.addQueryParam(Yh.xrayDeviceClass,e),this.addQueryParam(Yh.xrayPlaybackMode,t),this.addQueryParam(Yh.xrayToken,i),this},c.prototype.withLinearRestrictionsWindow=function(e,t){return Jh(this.hasDesiredResource(jh.LinearRestrictions),"request has LinearRestrictions").is.true(),Jh(e,"startTimeMins").exists(),Jh(t,"endTimeMins").exists(),Jh(e<t,"startTimeMins < endTimeMins").is.true(),this.addQueryParam(Yh.linearRestrictionStart,e),this.addQueryParam(Yh.linearRestrictionEnd,t),this},c.prototype.withLiveManifestTypes=function(e){return Jh(e,"liveManifestTypes").is.not.empty(),this.addQueryParam(Yh.liveManifestType,e.join(",")),this},c.prototype.withPlayerAttributes=function(e,t){return Jh(e,"name").exists(),Jh(t,"playerAttributesValue").exists(),b.isArray(t)&&(t=t.join()),this.playerAttributes[e]=t,this},c.prototype.send=function(e,t,r){var o=this;Jh(e,"onSuccess").exists(),Jh(t,"onError").exists(),Jh(this.request,"request").is.null(),this.retry=(new this.retryType).withMaxAttempts(c.MAX_ATTEMPTS).withInitialIntervalMs(c.BASE_RETRY).withExponentialFactor(2).withRandomizationFactor(c.JITTER).onSuccess(e).onError(t).onAttempt(function(e,t,i,n){o.sendRequest(e,t,i,n,r)}).execute()},c.prototype.abort=function(){null!==this.retry&&(this.retry.abort(),this.retry=null),null!==this.request&&(this.request.abort(),this.request=null)},c.prototype.sendRequest=function(e,r,o,s,a){var l=this,t=this.resourceUsage===Kh.ImmediateConsumption?c.PRIORITY_CRITICAL:c.PRIORITY_BACKGROUND;b.isEmpty(this.playerAttributes)||this.addQueryParam(Yh.playerAttributes,JSON.stringify(this.playerAttributes)),this.request=this.httpRequest.post(this.url).accept("application/json").timeout(c.HTTP_REQUEST_TIMEOUT_MS).onError(function(e,t){l.request=null;var i="Error executing playback resource request.",n=Ah.createPRSError(i,e);I.isNullOrUndefined(t)||!b.contains(c.UNRETRIABLE_HTTP_ERRORS,t.getStatus())?(l.provideMetrics(t,a),r(n)):(I.exists(t)&&403===t.getStatus()&&(n=Lh.newAuthenticationError(i)),s(n))}).onLoad(function(e){l.request=null,l.provideMetrics(e,a);var t=e.getText();if(I.isNullOrUndefined(t))r(Ah.createPRSError("PlaybackResourceResponse is null or undefined."));else{var i;try{if(i=JSON.parse(t),I.exists(i.error)){var n=Ah.createError(i.error);return void(b.contains(c.RETRIABLE_PRS_ERRORS,i.error.type)?r(n):s(n))}i.errorsByResource=Ah.convertResourceExceptions(i.errorsByResource),i.returnedTitleRendition=Ah.convertRightsException(i.returnedTitleRendition)}catch(e){return void r(Ah.createPRSError("Error parsing json response",e))}o(i)}}).onAbort(function(e){l.request=null}).withCredentials(),0!==e&&this.request.header(c.RETRY_COUNT_HEADER,""+e).header(c.REQUEST_PRIORITY_HEADER,t),null!==this.formFields&&this.request.fields(this.formFields),I.exists(this.authContext)&&I.exists(this.authContext.tokenClient)?this.authContext.tokenClient.getToken(function(e){e.type===Oh.OAUTH&&l.request.bearerToken(e.token),l.request.query(l.queryParams).send()},s):this.request.query(this.queryParams).send()},c.prototype.provideMetrics=function(e,t){I.isNullOrUndefined(e)||I.isNullOrUndefined(t)||t({downloadMs:e.getDownloadMs(),latencyMs:e.getLatencyMs(),totalMs:e.getTotalMs()})},c.prototype.addQueryParam=function(e,t){this.queryParams[Yh[e]]=t},c.prototype.addPostBodyParam=function(e,t){null===this.formFields&&(this.formFields={}),this.formFields[Gh[e]]=t},c.prototype.hasDesiredResource=function(e){var t=I.withDefault(this.queryParams[Yh[Yh.desiredResources]],"");return I.exists(t.match("(^|,)"+jh[e]+"($|,)"))},c.MAX_ATTEMPTS=4,c.JITTER=200,c.BASE_RETRY=500,c.UNRETRIABLE_HTTP_ERRORS=[400,401,403],c.RETRIABLE_PRS_ERRORS=["PRSDependencyException"],c.RETRY_COUNT_HEADER="x-retry-count",c.REQUEST_PRIORITY_HEADER="x-request-priority",c.PRIORITY_CRITICAL="CRITICAL",c.PRIORITY_BACKGROUND="BACKGROUND",c.HTTP_REQUEST_TIMEOUT_MS=6e3,c}(),$h=c.of("PlaybackResourceClient"),ed=function(){function a(e,t,i,n,r,o,s){void 0===s&&(s=Zh),this.deviceId=$h(e,"deviceId").exists(),this.deviceTypeId=$h(t,"deviceTypeId").exists(),this.marketplaceId=$h(i,"marketplaceId").exists(),$h(n,"partnerServiceUrl").exists(),I.exists(r)&&($h(r.customerId).exists(),this.authContext=r),I.exists(o)&&(this.clientId=o),this.url=n.replace(/\/$/,"")+a.SERVICE_ENDPOINT,this.playbackResourceRequestType=s}return a.prototype.createRequest=function(e,t,i,n,r,o){$h(e,"asin").exists(),$h(t,"consumptionType").exists(),$h(i,"desiredResources").exists(),$h(0<i.length,"desiredResources.length > 0").is.true(),$h(n,"resourceUsage").exists(),$h(r,"videoMaterialType").exists(),$h(o,"userWatchSessionId").exists();var s={asin:e,consumptionType:t,desiredResources:i,deviceId:this.deviceId,deviceTypeId:this.deviceTypeId,marketplaceId:this.marketplaceId,resourceUsage:n,userWatchSessionId:o,videoMaterialType:r};return new this.playbackResourceRequestType(s,this.url,this.authContext,this.clientId)},a.SERVICE_ENDPOINT="/cdp/catalog/GetPlaybackResources",a}(),td=function(){function e(){}return e.AD_SUPPORTED_ENTITLEMENT_TYPE_ERROR="AdSupportedEntitlementTypeError",e.MISSING_PLAYBACK_RESOURCE_ERROR="MissingPlaybackResourceError",e.NO_URL_SET_ERROR="NoUrlSetError",e.PAYMENT_FAILURE_ERROR="PaymentFailureError",e.UNHANDLED_PLAYBACK_RESOURCE_ERROR="UnhandledPlaybackResourceError",e}(),id=yn.Errors,nd=Ve.get("PRSResponseValidator"),rd=function(){function n(){}return n.prototype.validateResponse=function(e){var t=this.validateTitleRendition(e);if(null!==t)return t;var i=this.validateAudioVideoUrls(e);return null!==i?i:(this.logNonFatalErrorsByResource(e.errorsByResource),null)},n.prototype.validateTitleRendition=function(e){var t=I.nestedValue(e,"returnedTitleRendition.selectedEntitlement");if(null===t)return id.newError(td.MISSING_PLAYBACK_RESOURCE_ERROR,"selectedEntitlement does not exist.");var i=t.rightsException;return I.isNullOrUndefined(i)?null:i.downstreamReason===n.PAYMENT_FAILURE_DOWNSTREAM_REASON?id.newError(td.PAYMENT_FAILURE_ERROR,"Payment failed.",i):i},n.prototype.validateAudioVideoUrls=function(e){var t=I.nestedValue(e,"errorsByResource.AudioVideoUrls");return null===t&&(t=I.nestedValue(e,"errorsByResource.PlaybackUrls")),null!==t?-1<t.message.indexOf("UrlVendingService has no urls")?id.newError(td.NO_URL_SET_ERROR,"No url sets returned from PRS.",t):t.downstreamReason===n.PAYMENT_FAILURE_DOWNSTREAM_REASON?id.newError(td.PAYMENT_FAILURE_ERROR,"Payment failed.",t):t:null===I.nestedValue(e,"audioVideoUrls.avCdnUrlSets")&&null===I.nestedValue(e,"playbackUrls.urlSets")?id.newError(td.MISSING_PLAYBACK_RESOURCE_ERROR,"neither avCdnUrlSets nor urlSets exist."):null},n.prototype.logNonFatalErrorsByResource=function(e){I.isNullOrUndefined(e)||b.each(e,function(e,t){nd.error(t+" resource error occurred with name: "+e.name+", errorCode: "+e.errorCode+", message: "+e.message+", downstreamReason: "+e.downstreamReason)})},n.PAYMENT_FAILURE_DOWNSTREAM_REASON="PAYMENT_FAILURE",n}(),od={AudioVideoUrlsConverter:_h,DesiredResources:Ih.DesiredResources,EntitlementTypes:Sh,HdcpVersions:Th,KeyTypes:bh,LanguageFeature:Ih.LanguageFeature,PlaybackResourceClient:ed,PlaybackResourceRequest:Zh,PRSErrors:td,PRSResponseValidator:rd,ResourceUsage:Ih.ResourceUsage,SubtitleFormat:Ih.SubtitleFormat,VideoMaterialType:Ih.VideoMaterialType},sd=Eh.ConsumptionType,ad=Eh.Protocol,ld=od.DesiredResources,cd=od.LanguageFeature,ud=od.PRSResponseValidator,pd=od.ResourceUsage,hd=od.VideoMaterialType,dd=yn.Errors,fd=c.of("SilverlightResourceAcquirer"),yd=Ve.get("SilverlightResourceAcquirer"),gd=function(){function o(e,t,i,n){void 0===i&&(i=function(e){return btoa(e)}),void 0===n&&(n=new ud),this.encodeB64=null,this.playbackResourceClient=fd(e,"playbackResourceClient").exists(),this.configurationStore=fd(t,"configurationStore").exists(),this.encodeB64=i,this.prsResponseValidator=n}return o.prototype.acquireLicense=function(e,t,i,n){var r=this;fd(e,"licenseChallenge").exists(),fd(t,"asin").exists(),fd(i,"onSuccess").exists(),fd(n,"onError").exists();var o=this.encodeB64(e);this.request=this.playbackResourceClient.createRequest(t,sd.Streaming,[ld.PlayReadyLicense],pd.ImmediateConsumption,hd.Feature,this.configurationStore.getValue().userWatchSessionId).withPlayReadyChallenge(o),yd.info("Requesting PlayReady license from PRS."),this.request.send(function(e){yd.info("Got license from PRS."),r.request=null;var t=r.validateLicenseResponse(e);if(null!==t)return yd.error("Bad license response.",t),void n(JSON.stringify(t));i(e.playReadyLicense.encodedLicenseResponse)},function(e){yd.error("Failed to retrieve license.",e),r.request=null,n(JSON.stringify(e))})},o.prototype.acquireResources=function(e,t,i,n){var r=this;fd(e,"asin").exists(),fd(t,"videoMaterialType").exists(),fd(i,"onSuccess").exists(),fd(n,"onError").exists(),this.request=this.playbackResourceClient.createRequest(e,sd.Streaming,o.DESIRED_RESOURCES,pd.ImmediateConsumption,t,this.configurationStore.getValue().userWatchSessionId).withAudioTrackId(o.AUDIO_TRACK_ALL).withDeviceProtocolOverride(ad.Https).withLanguageFeature(cd.MLFv2).withTitleDecorationScheme(o.PLAYER_TITLE_DECORATION_SCHEME),yd.info("Requesting playback resources from PRS."),this.request.send(function(e){yd.info("Got desired playback resources from PRS."),r.request=null;var t=r.prsResponseValidator.validateResponse(e);null===t?i(JSON.stringify(e),!b.isEmpty(e.forcedNarratives)):n(JSON.stringify(t))},function(e){yd.error("Failed to retrieve playback resources from PRS.",e),r.request=null,n(JSON.stringify(e))})},o.prototype.acquireNextEpisodeResources=function(e,t,i,n){var r=this;fd(e,"asin").exists(),fd(t,"videoMaterialType").exists(),fd(i,"onSuccess").exists(),fd(n,"onError").exists(),this.request=this.playbackResourceClient.createRequest(e,sd.Streaming,[ld.CatalogMetadata],pd.ImmediateConsumption,t,this.configurationStore.getValue().userWatchSessionId).withDeviceProtocolOverride(ad.Https).withTitleDecorationScheme(o.PLAYER_TITLE_DECORATION_SCHEME),yd.info("Requesting playback resources for next episode from PRS."),this.request.send(function(e){yd.info("Got desired playback resources for next episode from PRS."),r.request=null,i(JSON.stringify(e))},function(e){yd.error("Failed to retrieve playback resources for next episode from PRS.",e),r.request=null,n(JSON.stringify(e))})},o.prototype.abort=function(){I.isNullOrUndefined(this.request)||this.request.abort()},o.prototype.validateLicenseResponse=function(e){var t=I.nestedValue(e,"errorsByResource.PlayReadyLicense");if(null!==t)return dd.newError(o.DRM_ERROR,JSON.stringify(t));if(null===I.nestedValue(e,"playReadyLicense.encodedLicenseResponse")||""===e.playReadyLicense.encodedLicenseResponse){var i=I.nestedValue(e,"playReadyLicense.asinResponse.message");return null===i?dd.newError(o.DRM_ERROR,"PlayReady license is missing from PRS response"):dd.newError(o.DRM_ERROR,i)}return null},o.AUDIO_TRACK_ALL="all",o.DESIRED_RESOURCES=[ld.AudioVideoUrls,ld.CatalogMetadata,ld.CuepointPlaylist,ld.ForcedNarratives,ld.SubtitlePresets,ld.SubtitleUrls],o.DRM_ERROR="DrmError",o.PLAYER_TITLE_DECORATION_SCHEME="primary-content",o}(),md=Ue.NotificationEvent,vd=zo.BrowserType,Ed=zo.OperatingSystem,_d=zo.OperatingSystemFamily,Sd=function(){function n(e){void 0===e&&(e=ys.getInstance()),this.deviceInformation=e,this.isFirefoxAvailable=this.isFirefoxHTML5Available(this.deviceInformation)}return n.prototype.createNotification=function(){return new md(this.getTemplate(this.isFirefoxAvailable),null,!0,null,null)},n.prototype.shouldShow=function(e){var t=this.deviceInformation.operatingSystem;return!e&&!t.equals(Ed.WINDOWS_XP)&&!t.equals(Ed.WINDOWS_VISTA)},n.prototype.getTemplate=function(i){return{renderString:function(e,t){return e[i?n.FIREFOX_MESSAGE_KEY:n.MESSAGE_KEY]}}},n.prototype.isFirefoxHTML5Available=function(e){var t=e.browser,i=e.operatingSystem;return!(i.getFamily()!==_d.Windows&&i.getFamily()!==_d.Mac||t.getType()!==vd.Firefox&&t.getType()!==vd.Firefox64)},n.MESSAGE_KEY="switchToHtml5",n.FIREFOX_MESSAGE_KEY="updateFirefox",n}(),Td=c.of("GetSectionsResponse"),bd=function(){function e(e){var i=this;this.asin=null,this.episodeImageURL=null,this.episodeNumber=null,this._hasCaptions=!1,this._isPlayable=!1,this.regulatoryRating=null,this.seasonNumber=null,this.seriesTitle=null,this.title=null,this.autoplayEnabled=!1,this.numTitlesToAutoplay=null,this.showAutoplayCard=!1,this.preferredImageName=null,this.inSameSeries=!0,this.recommendationStrategy=null,Td(e,"getSectionsJson").exists();var t=I.nestedValue(e,"sections.bottom.collections.collectionList.0.items.itemList.0"),n=I.nestedValue(t,"decoratedTitle"),r=I.nestedValue(e,"sections.bottom.collections.collectionList.0.autoplayConfig"),o=I.nestedValue(t,"metadata");if(this.asin=I.nestedValue(t,"titleId"),this.autoplayEnabled=!0===I.nestedValue(r,"autoplayEnabled"),this.numTitlesToAutoplay=I.nestedValue(r,"numTitlesToAutoplay"),this.showAutoplayCard=!0===I.nestedValue(r,"showAutoplayCard"),this.preferredImageName=I.nestedValue(r,"autoplayCardPreferredImage"),I.exists(o)&&(this.recommendationStrategy=I.withDefault(b.find(Object.keys(o),function(e){return 0===e.indexOf("source.")}),null),this.inSameSeries="source.OtherEpisodes"===this.recommendationStrategy),null!==n){this.episodeImageURL=I.nestedValue(n,"images.imageUrls.next_up"),this.episodeNumber=I.nestedValue(n,"catalog.episodeNumber"),this._hasCaptions=!0===I.nestedValue(n,"computed.simple.CLOSED_CAPTION_BADGE"),this._isPlayable=!0===I.nestedValue(n,"playback.summary.isPlayable"),this.regulatoryRating=I.nestedValue(n,"catalog.regulatoryRating"),this.title=I.nestedValue(n,"catalog.title");var s=I.nestedValue(n,"family.tvAncestors");I.isNullOrUndefined(s)||s.forEach(function(e){var t=I.nestedValue(e,"catalog.type");"SEASON"===t?i.seasonNumber=I.nestedValue(e,"catalog.seasonNumber"):"SHOW"===t&&(i.seriesTitle=I.nestedValue(e,"catalog.title"))})}}return e.prototype.getAsin=function(){return this.asin},e.prototype.getEpisodeImageURL=function(){return this.episodeImageURL},e.prototype.getEpisodeNumber=function(){return this.episodeNumber},e.prototype.getRegulatoryRating=function(){return this.regulatoryRating},e.prototype.getSeasonNumber=function(){return this.seasonNumber},e.prototype.getSeriesTitle=function(){return this.seriesTitle},e.prototype.getTitle=function(){return this.title},e.prototype.hasCaptions=function(){return this._hasCaptions},e.prototype.isPlayable=function(){return this._isPlayable},e.prototype.isAutoplayEnabled=function(){return this.autoplayEnabled},e.prototype.getNumTitlesToAutoplay=function(){return this.numTitlesToAutoplay},e.prototype.getShowAutoplayCard=function(){return this.showAutoplayCard},e.prototype.isInSameSeries=function(){return this.inSameSeries},e.prototype.getPreferredImageName=function(){return this.preferredImageName},e.prototype.getRecommendationStrategy=function(){return this.recommendationStrategy},e}(),Id=tt.MarketplaceID,wd=Rn.TokenType,Rd=hn.ExponentialBackoffRetry,Cd=ji.HttpRequest,Pd=yn.Errors,Ad=c.of("GetSectionsClient"),Od={GetSectionsClient:function(){function u(e,t,i,n,r,o,s){void 0===o&&(o=Cd),void 0===s&&(s=Rd),this.authContext=Ad(r,"authContext").exists(),this.deviceId=Ad(e,"deviceId").exists(),this.deviceTypeId=Ad(t,"deviceTypeId").exists(),this.marketplaceId=Ad(i,"marketplaceId").exists(),this.url=Ad(n,"partnerServiceUrl").exists().replace(/\/$/,"")+u.SERVICE_ENDPOINT,this.requestType=o,this.retryType=s}return u.prototype.getSections=function(i,n,r,o){var s,a=this;Ad(i,"asin").exists(),Ad(n,"decorationScheme").exists(),Ad(r,"onSuccess").exists(),Ad(o,"onError").exists();var e=(new this.retryType).withMaxAttempts(u.MAX_ATTEMPTS).withInitialIntervalMs(u.BASE_RETRY).withExponentialFactor(2).withRandomizationFactor(u.JITTER).onError(function(e){return a.onFail(o,e)}).onAttempt(function(e,t){s=a.sendRequest(i,n,e,t,r,o)}).execute();return function(){e.abort(),I.exists(s)&&s.abort()}},u.prototype.sendRequest=function(e,t,i,r,n,o){var s=this,a=this.requestType.get(this.url),l={deviceID:this.deviceId,deviceTypeID:this.deviceTypeId,marketplaceId:this.marketplaceId,pageId:e,firmware:"1",format:"json",gascEnabled:!Id.isClassic(this.marketplaceId),version:"default",sectionTypes:"bottom",pageType:"player",decorationScheme:t};return a.accept("application/json").withCredentials().header(u.RETRY_COUNT_HEADER,""+i).header(u.REQUEST_PRIORITY_HEADER,u.PRIORITY_CRITICAL).onLoad(function(e){s.onLoad(e,r,n,o)}).onError(function(e,t){var i="An error occurred while sending GetSections request: "+e,n=Pd.newError(u.ERROR,i,e);I.isNullOrUndefined(t)||!b.contains(u.UNRETRIABLE_HTTP_ERRORS,t.getStatus())?r(n,t):s.onFail(o,n,t)}),I.exists(this.authContext.tokenClient)?this.authContext.tokenClient.getToken(function(e){e.type===wd.OAUTH&&a.bearerToken(e.token),a.query(l).send()},o):a.query(l).send(),a},u.prototype.onLoad=function(t,i,e,n){var r=t.getText(),o=t.getLatencyMs();if(null!==r){var s;try{s=JSON.parse(r)}catch(e){var a="An error occurred while parsing the GetSections JSON response: "+e;return void i(Pd.newError(u.ERROR,a,e),t)}var l=I.nestedValue(s,"sections"),c=null;b.isEmpty(l)||(c=new bd(s)),e(c,o)}else i(Pd.newError(u.ERROR,"GetSections response is null."),t)},u.prototype.onFail=function(e,t,i){var n;I.exists(i)&&(n=i.getLatencyMs()),e(t,n)},u.MAX_ATTEMPTS=4,u.JITTER=200,u.BASE_RETRY=500,u.UNRETRIABLE_HTTP_ERRORS=[400,401,403],u.RETRY_COUNT_HEADER="x-retry-count",u.REQUEST_PRIORITY_HEADER="x-request-priority",u.PRIORITY_CRITICAL="CRITICAL",u.ERROR="GetSectionsError",u.SERVICE_ENDPOINT="/cdp/discovery/GetSections",u}(),GetSectionsResponse:bd},Nd=Rn.TokenType,Md=Ue.AbortEvent,Ld=Ue.AsinChangedEvent,kd=Ue.CloseEvent,xd=Ue.DiagnosticsState,Dd=Ue.ErrorSeverity,Ud=Ue.Features,Fd=Ue.FirstFrameEvent,Hd=Ue.InitializedEvent,Wd=Ue.PINAcceptedEvent,Vd=Ue.PINDeclinedEvent,Bd=Ue.PINErrorEvent,qd=Ue.PINRequiredEvent,jd=Ue.PlayingEvent,zd=Ue.PreparedEvent,Gd=Ue.NotificationCancelEvent,Yd=Ue.NotificationEvent,Kd=Ue.VideoType,Xd=da.MetricsContextFactory,Qd=je.metrics,Jd=zo.OperatingSystemFamily,Zd=or.UUID,$d=tt.DeviceTypeId,ef=bi.LocalStorage,tf=od.PlaybackResourceClient,nf=od.VideoMaterialType,rf=Od.GetSectionsClient,of=c.of("SilverlightWebPlayer"),sf=Ve.get("SilverlightWebPlayer"),af="SilverlightStartupError",lf="GetPlaybackResourcesError",cf="GetPlaybackResourcesTime",uf="GetSectionsTime",pf=function(){function e(e,t,i,n,r,o,s,a,l){void 0===r&&(r=new vh),void 0===o&&(o=new Xd),void 0===s&&(s=rf),void 0===a&&(a=new ef),void 0===l&&(l=document),this.Features=Ud,this.playerConfig=null,this.customerId=null,this.partnerServiceUrl=null,this.domElement=null,this.xapUrl=null,this.diagnostics=null,this.asin=null,this.startPosition=null,this.playTrailer=null,this.pinRequired=null,this.pinVerified=null,this.pluginBridge=null,this.currentPosition=0,this.contentDuration=1,this.spinnerPanel=null,this.getSectionsClient=null,this.playbackResourceClient=null,this.resourceAcquirer=null,this.tokenClient=null,this.loaderConfig=of(e,"loaderConfig").exists(),this.qosReporter=of(t,"qosReporter").exists(),this.spinnerPanel=i,this.createModalTemplate=n,this.initializer=r,this.metricsContextFactory=o,this.getSectionsClientType=s,this.eventEmitter=new We.BasicEventEmitter,this.storage=a,this.documentRef=l,this.os=zo.getOperatingSystem(),this.browser=zo.getBrowser(),this.isInitialized=!1,this.isPrepared=!1,this.isPluginLoading=!1,this.pluginBlockedNotification=null,this.silverlightWaitTimer=null,this.pluginLoadedCallback=null,this.playerLoadedCallback=null,this.playerLoadErrorCallback=null}return e.prototype.initialize=function(e){this.playerConfig=of(e,"playerConfig").exists(),of(e.marketplaceId,"playerConfig.marketplaceId").exists(),of(e.partnerServiceEndpoint,"playerConfig.partnerServiceEndpoint").exists(),of(e.domElement,"playerConfig.domElement").exists(),of(e.domElement.id,"playerConfig.domElement.id").exists(),of(e.locale,"playerConfig.locale").exists(),of(e.deviceId,"playerConfig.deviceId").exists(),of(e.weblabs,"playerConfig.weblabs").exists(),this.customerId=I.withDefault(e.customerId,null),this.tokenClient=I.withDefault(e.tokenClient,null),this.partnerServiceUrl=e.partnerServiceEndpoint.replace(/\/$/,"")+"/cdp/",this.domElement=this.documentRef.createElement("div"),this.domElement.className="webPlayerElement",this.diagnostics=e.diagnostics!==xd.Disabled;var t=this.loaderConfig.dependencies.ATVWebPlayer,i=this.loaderConfig.assetsRoot+"/"+t.name+"/"+t.version,n=this.loaderConfig.dependencies.DVWebGlobalPlayer;this.xapUrl=this.loaderConfig.assetsRoot+"/"+n.name+"/"+n.version+"/xap/ATVSilverlightWebPlayer.xap",0===location.protocol.indexOf("http:")&&(this.xapUrl=this.xapUrl.replace("https:","http:")),e.domElement.innerHTML="",e.domElement.appendChild(this.domElement),this.spinnerPanel.initialize(e.domElement,i,!0,this.domElement),this.metricsContext=this.metricsContextFactory.createMetricsContext(e.partnerServiceEndpoint,e.deviceId,this.getDeviceTypeId(),e.marketplaceId,e.customerId,this.tokenClient),this.getSectionsClient=this.createGetSectionsClient(e),this.playbackResourceClient=new tf(e.deviceId,this.getDeviceTypeId(),e.marketplaceId,e.partnerServiceEndpoint,this.createAuthenticationContext(e)),this.resourceAcquirer=new gd(this.playbackResourceClient,e.configurationStore),this.isInitialized=!0,this.pinRequired=!1,this.pinVerified=!1,this.eventEmitter.emit(Hd)},e.prototype.prepareCache=function(e){},e.prototype.prepare=function(e){of(this.isInitialized,"this.isInitialized").is.true(),of(e,"contentConfig").exists(),of(e.asin,"contentConfig.asin").exists(),this.asin=e.asin,this.startPosition="number"==typeof e.position?e.position:0,this.playTrailer=e.videoType===Kd[Kd.Trailer],this.isPrepared=!0,this.qosReporter.setAsin(e.asin),this.metricsContext.contentPreparationStarted(this.asin,this.playTrailer),this.metricsContext.contentPreparationSucceeded(),this.eventEmitter.emit(zd,new zd)},e.prototype.play=function(e){of(e,"playbackConfig").exists(),of(e.playbackInitiatedTime,"playbackConfig.playbackInitiatedTime").exists(),this.isPrepared?null!==this.pluginBridge||this.isPluginLoading?sf.warn("Ignoring call to play: play has already been called"):(this.metricsContext.prepareClickstream(this.playerConfig.sessionId,e.clickstreamRefMarker),this.metricsContext.playbackInitiated(e.playbackInitiatedTime),e=I.exists(e)?e:{},this.loadPlugin(e.audioTrackId)):sf.warn("Ignoring call to play: SilverlightWebPlayer has not been prepared")},e.prototype.playbackInitiated=function(){},e.prototype.stop=function(){this.isPluginLoading&&(this.stopWaitingForSilverlight(),this.initializer.stop(),this.isPluginLoading=!1),null!==this.pluginBridge&&("function"==typeof this.pluginBridge.exitVideoPlayer&&this.pluginBridge.exitVideoPlayer(),this.pluginBridge=null),null!==this.pluginLoadedCallback&&(this.initializer.off(dh,this.pluginLoadedCallback),this.pluginLoadedCallback=null),null!==this.playerLoadedCallback&&(this.initializer.off(fh,this.playerLoadedCallback),this.playerLoadedCallback=null),null!==this.playerLoadErrorCallback&&(this.initializer.off(yh,this.playerLoadErrorCallback),this.playerLoadErrorCallback=null),null!==this.domElement&&(this.domElement.innerHTML=""),this.asin=null,this.startPosition=null,this.playTrailer=null,this.isPrepared=!1,this.pinRequired=!1,this.pinVerified=!1,this.eventEmitter.emit(Hd)},e.prototype.seek=function(e){of(e,"position").exists(),of(0<=e,"position >= 0").is.true(),null===this.pluginBridge?this.isPrepared?this.startPosition=e:sf.warn("Player is not initialized, ignoring call to Seek"):this.pluginBridge.PositionSyncRequest(e+"")},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.getPosition=function(){return this.currentPosition},e.prototype.getDuration=function(){return this.contentDuration},e.prototype.getDeviceTypeId=function(){return this.os.getFamily()===Jd.Mac?$d.SILVERLIGHT_MAC:$d.SILVERLIGHT_PC},e.prototype.validatePIN=function(e){void 0!==this.pluginBridge?(this.metricsContext.pinSubmitted(),this.pluginBridge.ValidatePIN(e)):sf.warn("Player is not initialized, ignoring call to ValidatePin")},e.prototype.getFeature=function(e,t,i){i(new Error("The Silverlight player does not support any features."))},e.prototype.generateInitParameters=function(e){var t={host:"amazon"};return t.customer=this.customerId,t.marketplace=this.playerConfig.marketplaceId,t.culture=this.playerConfig.locale,t.deviceId=this.playerConfig.deviceId,t.partnerService=this.partnerServiceUrl,t.diag=""+this.diagnostics,t.auto_play="false",t.userAgent=this.browser.toString(),t.asin=this.asin,t.v2api="true",t.playTrailer=this.playTrailer?"1":"0",t.timeCode=""+this.startPosition,t.clientVersion=this.loaderConfig.dependencies.DVWebGlobalPlayer.version,t.weblabs=nh.stringify(this.playerConfig.weblabs),t.userWatchSessionId=this.playerConfig.configurationStore.getValue().userWatchSessionId,t.primitiveSessionId=this.playerConfig.configurationStore.getValue().primitiveSessionId,t.amazonSessionId=this.playerConfig.sessionId,"string"==typeof e&&(t.audiotrackid=e),t},e.prototype.createPluginEventListeners=function(){var n=this;this.pluginBridge.OnAcquireLicense=function(e,t,i){n.onAcquireLicense(e,t,i)},this.pluginBridge.OnChangeASIN=function(e){n.onASINChange(e)},this.pluginBridge.OnClosePlayer=function(){n.onPlayerClose()},this.pluginBridge.OnContentPrepared=function(e,t){n.onContentPrepared(e,t)},this.pluginBridge.OnFirstFrame=function(){return n.onFirstFrame()},this.pluginBridge.OnGetNextEpisodePlaybackResources=function(e,t,i){n.onGetNextPlaybackResources(e,t,i)},this.pluginBridge.OnGetPlaybackResources=function(e,t,i){n.onGetPlaybackResources(e,t,i)},this.pluginBridge.OnGetSections=function(e,t,i){n.onGetSections(e,t,i)},this.pluginBridge.OnMediaStateChanged=function(e){n.onMediaStateChanged(e)},this.pluginBridge.OnPINRequired=function(e,t,i){n.onPINRequired(e,t,i)},this.pluginBridge.OnPINAccepted=function(){n.onPINAccepted()},this.pluginBridge.OnPINDeclined=function(){n.onPINDeclined()},this.pluginBridge.OnPINError=function(){n.onPINError()},this.pluginBridge.OnPlayerEvent=function(e,t){n.onPlayerEvent(e,t)},this.pluginBridge.OnTokenRequired=function(e){n.onTokenRequired(e)},this.pluginBridge.OnReloadPlayer=function(){document.location.reload(!0)}},e.prototype.onTokenRequired=function(t){var i=this;sf.info("The Silverlight player emitted a TokenRequired event"),I.isNullOrUndefined(this.tokenClient)?t(null,null):this.tokenClient.getToken(function(e){t(e.token,e.type===Nd.OAUTH?"oauth":"website")},function(e){i.abort("SilverlightAuthError","An error occurred while trying to acquire an auth token: "+e,Dd.Fatal)})},e.prototype.onPINError=function(){sf.info("Emitted a PINError event"),this.eventEmitter.emit(Bd)},e.prototype.onPINRequired=function(e,t,i){sf.info("Emitted a PINRequired event"),this.pinVerified?sf.info("Ignoring PINRequired event as the PIN has already been verified"):(this.pluginBridge.HideLoadingScreen(),this.pinRequired=!0,this.metricsContext.pinDialogDisplayed(),this.eventEmitter.emit(qd,new qd(e,t,i,!0)))},e.prototype.onPINAccepted=function(){sf.info("Emitted a PINAccepted event"),this.metricsContext.pinAccepted(),this.pinRequired=!1,this.pinVerified=!0,this.pluginBridge.Play(),this.eventEmitter.emit(Wd),this.pluginBridge.ShowLoadingScreen()},e.prototype.onPINDeclined=function(){sf.info("Emitted a PINDeclined event"),this.metricsContext.pinDeclined(),this.eventEmitter.emit(Vd)},e.prototype.onPlayerEvent=function(e,t){"position"===e&&"number"==typeof t?this.currentPosition=t:"loaded"===e&&void 0!==t&&"number"==typeof t.duration&&(this.contentDuration=t.duration)},e.prototype.onMediaStateChanged=function(e){switch(sf.info("Changed state to "+e),e){case"Playing":this.eventEmitter.emit(jd);break;case"Buffering":case"Paused":break;case"Ended":this.eventEmitter.emit(kd)}},e.prototype.onASINChange=function(e){sf.info("Changed ASIN to "+e),"string"==typeof e&&0<e.length&&null!==this.pluginBridge?(this.metricsContext.nextTitlePlaybackInitiated(b.now()),this.metricsContext.clickstreamNextTitle(),this.metricsContext.contentPreparationStarted(e,!1),this.metricsContext.contentPreparationSucceeded(),this.asin=e,this.eventEmitter.emit(Ld,new Ld(e))):sf.error("Unable to change to asin: "+e)},e.prototype.onPlayerClose=function(){sf.info("Emitted a Close event"),this.eventEmitter.emit(kd)},e.prototype.loadPlugin=function(e){var t=this;this.isPluginLoading=!0;var i=this.generateInitParameters(e);sf.info("Initialization parameters:",i);var n="silverlight_player_"+Math.floor(1e4*Math.random());this.silverlightWaitTimer=setTimeout(function(){return t.notifySilverlightNotLoaded()},2e3),this.pluginLoadedCallback=function(){t.onSilverlightLoaded()},this.playerLoadedCallback=function(){t.onPluginLoaded(n)},this.playerLoadErrorCallback=function(e){t.onPluginError(e)},this.initializer.on(dh,this.pluginLoadedCallback),this.initializer.on(fh,this.playerLoadedCallback),this.initializer.on(yh,this.playerLoadErrorCallback),this.hideSpinner(),this.metricsContext.appLoadStarted(),this.initializer.initialize(this.domElement,n,this.xapUrl,"5.1",!1,i)},e.prototype.showSpinner=function(){this.spinnerPanel.show()},e.prototype.hideSpinner=function(){this.spinnerPanel.hide()},e.prototype.notifySilverlightNotLoaded=function(){this.isPluginLoading&&(this.pluginBlockedNotification=new uh,this.eventEmitter.emit(Yd,this.pluginBlockedNotification),this.qosReporter.reportError("PluginLoadBlocked",Dd.NonFatal,"Silverlight plugin blocked or possibly corrupted"))},e.prototype.stopWaitingForSilverlight=function(){null!==this.pluginBlockedNotification&&(this.eventEmitter.emit(Gd,new Gd(this.pluginBlockedNotification)),this.pluginBlockedNotification=null),null!==this.silverlightWaitTimer&&(clearInterval(this.silverlightWaitTimer),this.silverlightWaitTimer=null)},e.prototype.onSilverlightLoaded=function(){this.isPluginLoading&&(this.stopWaitingForSilverlight(),this.showSpinner())},e.prototype.onPluginLoaded=function(e){this.isPluginLoading=!1;var t=this.metricsContext.appLoadCompleted();this.stopWaitingForSilverlight(),this.hideSpinner();var i=document.getElementById(e);if(I.isNullOrUndefined(i))this.abort(af,"Unable to access the Silverlight plugin through the JavaScript bridge",Dd.Fatal);else{var n=i.content;if(I.isNullOrUndefined(n)||I.isNullOrUndefined(n.Bridge))this.abort(af,"Unable to access the Silverlight plugin through the JavaScript bridge",Dd.Fatal);else{var r=new Sd;r.shouldShow(this.playTrailer)&&this.eventEmitter.emit(Yd,r.createNotification()),sf.info("Successfully initialized"),this.pluginBridge=n.Bridge,this.createPluginEventListeners(),I.exists(t)?this.pluginBridge.Prepare("{\"playerLoadTime\": "+t+" }",!0):this.pluginBridge.Prepare()}}},e.prototype.onContentPrepared=function(e,t){sf.info("Prepared ASIN "+e+" and is ready to play it."),this.pinRequired&&!this.pinVerified||this.pluginBridge.Play()},e.prototype.onPluginError=function(e){var t;if(this.stopWaitingForSilverlight(),e.isCorruptionError()){t="Unable to load Silverlight plugin: code: "+e.getErrorCode()+", type: "+e.getErrorType()+", message: "+e.getErrorMessage();var i=void 0,n=void 0;this.os.getFamily()===Jd.Mac?(i="silverlightCorruptionMac",n="<ol>{{#steps}}<li>{{{.}}}</li>{{/steps}}</ol>"):(i="silverlightCorruptionWindows",n=this.createWindowsExtraText()),this.abort("SilverlightCorruptionError",t,Dd.Fatal,this.createModalTemplate(i,n))}else t="Unable to load Silverlight plugin: code: "+e.getErrorCode()+", type: "+e.getErrorType()+", message: "+e.getErrorMessage(),this.abort(af,t,Dd.Fatal)},e.prototype.createWindowsExtraText=function(){var e="manual_repair_steps_"+Zd.v4().replace(/-/g,"");return"<ol>{{#fixItToolSteps}}<li>{{{.}}}</li>{{/fixItToolSteps}}</ol>{{#manualRepairSteps}}{{{preLinkText}}}<a href=\"javascript:"+("(function () {const e = document.getElementById('"+e+"');e.style.display = e.style.display === 'none' ? '' : 'none';})();")+"\">{{{linkText}}}</a>{{{postLinkText}}}<ol id=\""+e+"\" style=\"display:none;\">{{#steps}}<li>{{{.}}}</li>{{/steps}}</ol>{{/manualRepairSteps}}"},e.prototype.onFirstFrame=function(){sf.info("Emitted a FirstFrame event"),this.metricsContext.clickstreamPlaybackStarted();var e=this.metricsContext.playbackStarted(!0);return this.eventEmitter.emit(Fd),{ttff:e}},e.prototype.onAcquireLicense=function(e,t,i){sf.info("Acquiring DRM license"),this.resourceAcquirer.acquireLicense(e,this.asin,function(e){t(e)},function(e){i(e)})},e.prototype.onGetNextPlaybackResources=function(e,t,i){var n=this;sf.info("Acquiring playback resources for the next episode"),this.acquireResourcesTimer=Qd.startTimer(cf),this.resourceAcquirer.acquireNextEpisodeResources(e,nf.Feature,function(e){n.qosReporter.reportInformation(cf,null,n.acquireResourcesTimer.end()),t(e)},function(e){Qd.putMetric(lf),i(e)})},e.prototype.hasUnsupportedFeature=function(e){var t={};try{t=JSON.parse(e)}catch(e){}var i=I.nestedValue(t,"returnedTitleRendition.timeShift"),n=I.nestedValue(t,"cuepointPlaylist.encodedManifest");return"THIRD_PARTY_SUBSCRIPTION"===I.nestedValue(t,"returnedTitleRendition.selectedEntitlement").entitlementType&&I.exists(n)||b.some(i,function(e){return!1===e.enabled})},e.prototype.onGetPlaybackResources=function(e,n,t){var r=this;sf.info("Acquiring playback resources"),this.acquireResourcesTimer=Qd.startTimer(cf),this.resourceAcquirer.acquireResources(e,this.playTrailer?nf.Trailer:nf.Feature,function(e,t){if(r.qosReporter.reportInformation(cf,null,r.acquireResourcesTimer.end()),r.hasUnsupportedFeature(e))r.abort("SilverlightUnsupportedFeatureError","Title requires a feature which Silverlight doesn't support.",Dd.NonFatal);else{if(t){r.pluginBridge.ToggleCaptions(!0);var i=new sh;i.shouldShowNotification()&&r.eventEmitter.emit(Yd,i.createNotification())}n(e)}},function(e){Qd.putMetric(lf),t(e)})},e.prototype.onGetSections=function(e,i,n){sf.info("Calling GetSections"),this.getSectionsClient.getSections(e,"none",function(e,t){Qd.putMetric(uf,t,"ms"),i(JSON.stringify(e))},function(e,t){Qd.putMetric("GetSectionsError"),I.exists(t)&&Qd.putMetric(uf,t,"ms"),n(JSON.stringify(e))})},e.prototype.abort=function(e,t,i,n){this.eventEmitter.emit(Md,new Md(e,t,i,n))},e.prototype.createAuthenticationContext=function(e){return I.isNullOrUndefined(e.customerId)?null:{customerId:e.customerId,tokenClient:e.tokenClient}},e.prototype.createGetSectionsClient=function(e){return I.isNullOrUndefined(e.customerId)?null:new this.getSectionsClientType(e.deviceId,this.getDeviceTypeId(),e.marketplaceId,e.partnerServiceEndpoint,{customerId:e.customerId,tokenClient:e.tokenClient})},e}(),hf=tt.Weblabs,df=tt.WeblabTreatment,ff=zo.OperatingSystemFamily,yf={SilverlightWebPlayer:pf}.SilverlightWebPlayer,gf=c.of("SilverlightWebPlayerFactory"),mf=function(){function r(e,t,i,n,r){void 0===r&&(r=new eh(e,t,Gp.createModalTemplate)),this.silverlightDisabled=!1,this.os=gf(e,"os").exists(),this.browser=gf(t,"browser").exists(),this.loaderConfig=gf(i,"loaderConfig").exists(),this.qosReporter=gf(n,"qosReporter").exists(),this.playerOption=r}return r.prototype.initialize=function(e,t,i,n,r){this.silverlightDisabled=t[hf.DISABLE_SILVERLIGHT]===df.T1,this.clientId=r},r.getPlayerName=function(){return r.PLAYER_NAME},r.prototype.getPlayerName=function(){return r.PLAYER_NAME},r.prototype.getPlayerVersion=function(){return this.loaderConfig.dependencies.DVWebGlobalPlayer.version},r.prototype.getMetricsFeature=function(){return r.METRICS_FEATURE},r.prototype.getDeviceTypeId=function(){return this.os.getFamily()===ff.Mac?tt.DeviceTypeId.SILVERLIGHT_MAC:tt.DeviceTypeId.SILVERLIGHT_PC},r.prototype.getPlayerCapabilities=function(e,t,i){void 0===t&&(t={});var n=this.clientId===r.TNF_GATEWAY_CLIENT_ID;e({supportsDrm:!0,supportsNativePlayback:!1,supportsWebPlayback:!(this.silverlightDisabled||!0===t.supportsLive||n)&&this.playerOption.isCompatible(),supportsAVOD:!0,supportsMidStreamMTA:!0,supportsHDMovies:this.os.getFamily()===ff.Windows,supportsHDTVShows:!0,supportsLive:!1})},r.prototype.createWebPlayer=function(e,t){var i=this;this.playerOption.checkAvailability(function(){e(new yf(i.loaderConfig,i.qosReporter,new Vl,Gp.createModalTemplate))},t)},r.prototype.on=function(e,t){},r.prototype.once=function(e,t){},r.prototype.off=function(e,t){},r.PLAYER_NAME="silverlight",r.METRICS_FEATURE="SilverlightPlayer",r.TNF_GATEWAY_CLIENT_ID="511cc9af-3ecb-48fe-9825-886ebfbb6503",r}(),vf=function(){function e(){}return e.toString=function(){return"FACTORY_NOTIFICATION_EVENT"},e}(),Ef=yn.Errors,_f=Ue.ErrorSeverity,Sf=Ve.get("selectFactory"),Tf="html5";function bf(e,t){void 0===t&&(t=""),I.isNullOrUndefined(e.config.playerOverride)||(t=Uc.PLAYER_OVERRIDE),e.config.qosReporter.reportInformation(Bp.HTML5_NOT_USED_ERROR_NAME,t),Sf.warn("HTML5 player is not used because of "+t)}var If={cacheAuthToken:dc,createTokenClient:lc,createWebPlayer:pc,downloadLocalization:gc,getWeblabs:Nc,initializeReporting:Lc,preinitializeReporting:Dc,selectFactory:function(s,e,a,l,c){var t;void 0===e&&(e=new Qc),void 0===a&&(a=zo.getOperatingSystem()),void 0===l&&(l=zo.getBrowser()),void 0===c&&(c=Yc),t=I.isNullOrUndefined(s.config.playerFactories)?[new Bp(s.config.loaderConfig,s.config.qosReporter,s.config.playerBeta),new mf(a,l,s.config.loaderConfig,s.config.qosReporter)]:s.config.playerFactories,e.initialize(t,s.config.playerConfig.marketplaceId,s.config.playerConfig.weblabs,s.config.playerCacheEnabled,s.config.localizationStore.getCurrentLanguage(),s.config.playerConfig.clientId);var u=$l.defer(),i=function(e,t,i,n){if(null===e)return bf(s,i),s.abortReason=new cc("UnsupportedPlatformError","No player is supported on this platform.",_f.NonFatal,new c(a,l,n)),void u.reject(Ef.newError(cc.ERROR_NAME,s.abortReason.message));e.getPlayerName()!==Tf&&bf(s,i),s.factory=e,s.factory.on(vf,function(e){s.eventEmitter.emit(vf,e)}),s.config.onPlayerCapabilities(t);var r=s.config.loaderConfig.dependencies.ATVWebPlayer,o=s.config.loaderConfig.assetsRoot+"/"+r.name+"/"+r.version;s.config.spinnerPanel.initialize(s.config.playerElement,o,e.getPlayerName()!==Tf),u.resolve(s)};return I.isNullOrUndefined(s.config.playerOverride)?e.selectFactory(i,s.config.playerConfig.requiredCapabilities,Tf):e.selectFactoryWithOverride(i,s.config.playerOverride),u.promise}},wf=We.BasicEventEmitter,Rf=Ue.ErrorSeverity,Cf=c.of("InitializePipeline"),Pf=Ve.get("InitializePipeline"),Af=function(){function r(e,t){void 0===e&&(e=If),void 0===t&&(t=new wf),this.eventEmitter=t,this.stages=e}return r.prototype.initialize=function(e,t,i){Cf(e,"config").exists(),Cf(t,"onInitialized").is.a.function(),Cf(i,"onError").is.a.function();var n={config:e,eventEmitter:this.eventEmitter,factory:null,playerCapabilities:null,webPlayer:null};return $l(n).then(this.stages.preinitializeReporting).then(this.stages.downloadLocalization).then(this.stages.getWeblabs).then(this.stages.createTokenClient).then(this.stages.cacheAuthToken).then(this.stages.selectFactory).then(this.stages.initializeReporting).then(this.stages.createWebPlayer).done(function(e){t(e.factory,e.webPlayer)},function(e){e.name!==cc.ERROR_NAME||I.isNullOrUndefined(n.abortReason)?(Pf.error("Unhandled initialize error",e),i(r.UNHANDLED_INITIALIZE_ERROR,e.message,Rf.Fatal)):(Pf.error("Initialization aborted",n.abortReason),i(n.abortReason.name,n.abortReason.message,n.abortReason.severity,n.abortReason.template))})},r.prototype.on=function(e,t){this.eventEmitter.on(e,t)},r.prototype.once=function(e,t){this.eventEmitter.once(e,t)},r.prototype.off=function(e,t){this.eventEmitter.off(e,t)},r.UNHANDLED_INITIALIZE_ERROR="UnhandledInitializeError",r}(),Of=tt.AmazonFQDN,Nf=tt.MarketplaceID,Mf=[Nf.ROE_EU,Nf.ROW_EU,Nf.ROW_FE,Nf.ROW_NA,Of.PRIME_VIDEO],Lf={contactUs:"/help/contact-us",devicesAndFeatures:"/help?nodeId=202064920",pin:"/settings/parental-controls",systemRequirements:"/help?nodeId=202064950",videoHelp:"/help",videoIssues:"/help?nodeId=202065190"};function kf(t,e,i){i=I.isNullOrUndefined(i)?"":"?ref="+i,b.chain(t).keys().forEach(function(e){t[e]+=i});for(var n=0,r=Mf;n<r.length;n++){t[r[n]]=Lf[e]+i}return t}var xf={CONTACT_US_DIGITAL:kf({"*":"/gp/help/contact-us/digital-video.html"},"contactUs","aiv_ply_sl_gen_err_help"),CONTACT_US_ORDERS:kf({"*":"/gp/help/customer/contact-us"},"contactUs"),SYSTEM_REQUIREMENTS:kf({"*":"/gp/help/customer/display.html?nodeId=201422810"},"systemRequirements"),VIDEO_ISSUES:kf({"*":"/gp/help/customer/display.html?nodeId=201460940"},"videoIssues"),AV_SETTINGS:kf({"*":"/pin"},"pin","dp_pct_pin_chg"),RESET_PIN:kf({"*":"/pin"},"pin","dp_pct_pin_forg"),VIDEO_HELP:kf({"*":"/videohelp"},"videoHelp"),SETUP_PIN:kf({"*":"/pin"},"pin"),DEVICES_AND_FEATURES:kf({"*":"/gp/help/customer/display.html?nodeId=201460880"},"devicesAndFeatures")},Df=It.QueryString,Uf=bi.LocalStorage,Ff=function(){function n(e,t){void 0===e&&(e=new Uf),void 0===t&&(t=Df);var i=this;this.storage=e,this.queryString=t,b.chain(n.flagStorageKeys).keys().each(function(e){i.handleFlagStorage(e,n.flagStorageKeys[e])})}return n.prototype.isActiveFlag=function(e){return"true"===this.storage.get(e)},n.prototype.handleFlagStorage=function(e,t){var i=this.queryString.getParameter(e);!0===i?this.storage.set(t,"true"):!1===i&&this.storage.remove(t)},n.flagStorageKeys={playerDebug:n.HTML5_DIAGNOSTICS_STORAGE_KEY="html5_web_player_diagnostics",hevcTest:n.HTML5_HEVC_TEST_STORAGE_KEY="html5_web_player_hevc_test",xrayBeta:n.HTML5_XRAY_BETA_STORAGE_KEY="html5_web_player_xray_beta"},n}(),Hf={genericError:{title:"Video Error",description:"We're experiencing a problem playing this video. Please try again. For further assistance, <a href=\"//{{contactUsDigitalUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">contact Amazon Customer Service</a>."},genericUnsupportedBrowser:{title:"Unsupported Browser",description:"This web browser isn't compatible with Prime Video. Please use one of the following web browsers:<ul><li>Chrome (latest version)</li><li>Firefox (latest version)</li><li>Microsoft Edge (version 15 or newer)</li><li>Internet Explorer (version 10 or newer)</li><li>Apple Safari (latest version)</li><li>Opera (latest version)</li></ul>",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},linuxUnsupportedBrowser:{title:"Unsupported Browser",description:"This web browser isn't compatible with Prime Video. Please use one of the following web browsers:<ul><li>Chrome (latest version)</li></ul>",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},macUnsupportedBrowser:{title:"Unsupported Browser",description:"This web browser isn't compatible with Prime Video. Please use one of the following web browsers:<ul><li>Chrome (latest version)</li><li>Firefox (latest version)</li><li>Safari (latest version)</li><li>Opera (latest version)</li></ul>",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},macLessThan10Point9UnsupportedBrowser:{title:"Unsupported Browser",description:"This web browser isn't compatible with Prime Video. Please use one of the following web browsers:<ul><li>Safari</li></ul>",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},chromeIos10NotSupported:{title:"Unsupported Browser",description:"Chrome on iOS 10 is currently not supported. Please try again using Safari."},windowsUnsupportedBrowser:{title:"Unsupported Browser",description:"This web browser isn't compatible with Prime Video. Please use one of the following web browsers:<ul><li>Chrome (latest version)</li><li>Firefox (latest version)</li><li>Microsoft Edge (version 15 or newer)</li><li>Internet Explorer (version 10 or newer)</li><li>Opera (latest version)</li></ul>",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},genericUnsupportedOs:{title:"Unsupported Operating System",description:"Prime Video titles can't be watched on this device because the operating system isn't supported. For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},firefoxOutOfDate:{title:"Mozilla Firefox Update Required",description:"A later version of Mozilla Firefox is required for Prime Video. To update, click the menu button (three horizontal stripes) on the web browser toolbar, click <b>About Firefox</b>, and then click <b>Restart to update Firefox</b>.",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},chromeOutOfDate:{title:"Google Chrome Update Required",description:"A later version of Google Chrome is required for Prime Video. To update, click the Chrome menu (three horizontal stripes) on the browser toolbar, click <b>About Google Chrome</b>, and then click <b>Relaunch</b>.",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},operaOutOfDate:{title:"Opera Update Required",description:"A later version of Opera is required for Prime Video. To check for updates, click the <b>Opera</b> menu, click <b>About Opera</b>, and then click <b>Relaunch Now</b>.",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},firefoxMissingCdm:{title:"Digital Rights Error",description:"Your web browser is missing a digital rights component.<br/><br/>In your web browser's address bar, type <b>about:addons</b>, press Enter, and then on the left, click <b>Plugins</b>. For the <b>Widevine Content Decryption Module</b>, select <b>Always Activate</b>, and then refresh the video's page and try watching the video.<br/><br/>If the video doesn't play, go back to <b>Plugins</b>, click the gear icon at the top of the page, and then click <b>Check for Updates</b>. When the plugins have updated, refresh the video's page, and then try watching the video.<br/><br/>",footer:"For further assistance, please contact Amazon Customer Service at <a href=\"//{{videoHelpUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">{{videoHelpUrl}}</a> and refer to error 7235."},chromeMissingCdm:{title:"Digital Rights Error",description:"Your web browser is missing a digital rights component. Go to <b>chrome://components</b> and under <b>WidevineCdm</b>, click <b>Check for update</b>.",footer:"For further assistance, please contact Amazon Customer Service at <a href=\"//{{videoHelpUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">{{videoHelpUrl}}</a> and refer to error 7235."},androidMissingCdm:{title:"Protected Content Error",description:"To watch protected content, in the top right of Chrome, click the three dots icon, and then tap <b>Settings</b> > <b>Site settings</b> > <b>Protected content</b>. Under <b>Blocked</b>, tap <b>Amazon.com</b> > <b>Clear and Reset</b>. Refresh or reload the video's detail page, and then tap <b>Watch Now</b>.",footer:"For further assistance, please contact Amazon Customer Service at <a href=\"//{{videoHelpUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">{{videoHelpUrl}}</a> and refer to error 7218."},operaMissingCdm:{title:"Digital Rights Error",description:"A later version of Opera is required for Prime Video. To check for updates, click the <b>Opera</b> menu, click <b>About Opera</b>, and then click <b>Relaunch Now</b>.",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},pinLookupError:{title:"PIN Lookup Problem",description:"We're having a problem checking your account's PIN restrictions which is preventing your video from playing. Please try again later, or you can <a href=\"//{{avSettingsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">turn off PIN restrictions</a> to watch your video immediately."},pinLookupErrorFsk18:{title:"PIN Lookup Problem",description:"We're having a problem checking your account's PIN restrictions which is preventing your video from playing. Please try again later. If this problem continues, contact Amazon Customer Service and refer to error 5016."},pinValidationError:{title:"PIN Validation Problem",description:"We're having a problem validating your PIN. Please try again. If this problem continues, please <a href=\"//{{contactUsOrdersUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">contact Amazon Customer Service</a>and refer to error 5014."},pinModal:{cancelButton:"Cancel",submitButton:"Continue",title:"Viewing Restrictions Enabled",description:"Please enter your Prime Video PIN:",notes:"<a href=\"//{{resetPinUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Reset your PIN</a> or <a href=\"//{{avSettingsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">change viewing restrictions</a>",incorrectPin:"We don't recognize the PIN you entered. Please try again or <a href=\"//{{resetPinUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">reset your PIN.</a>"},pinSetupRequired:{title:"Viewing Restrictions Enabled",description:"To view this video, a PIN is required. To update your PIN, go to the Prime Video <a href=\"//{{setupPinUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Settings page</a>."},pinAgeVerificationRequired:{title:"Viewing Restrictions Enabled",description:"To view this video, age verification is required."},silverlightInstall:{title:"Microsoft Silverlight is not installed",description:"Install the free Silverlight plug-in; it will just take a minute. Please refresh this page when the installation completes.<p>If you have issues after installing, restart your browser and try again. If the issue persists, try using our new HTML5 video player on Chrome, Internet Explorer 11 on Windows 8.1 or later, Microsoft Edge or Opera.</p>",button:"<a href=\"http://go2.microsoft.com/fwlink/?LinkID=149156\" target=\"_blank\" rel=\"noopener noreferrer\">Install Silverlight</a>",footer:"Already installed Silverlight? <a href=\"//{{videoIssuesUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Get Silverlight plug-in help</a>."},silverlightInstallSafari:{title:"Microsoft Silverlight not installed or enabled",description:"<b>To install:</b> Install for free by tapping <b><a href=\"http://go2.microsoft.com/fwlink/?LinkID=149156\" target=\"_blank\" rel=\"noopener noreferrer\">Install Silverlight</a></b>. Refresh this page when installation completes.<br/><br/><b>To enable:</b> In Safari preferences, <b>Security</b> > <b>Plugins</b> > <b>Silverlight</b>, select <b>Enable</b> and then refresh this page.<br/><br/>If it still doesn't work, we recommend using the HTML5 video player for better performance and more features. The HTML5 video player is available in Chrome, Internet Explorer 11 on Windows 8.1 and later, Edge or Opera.",footer:"Already installed Silverlight? <a href=\"//{{videoIssuesUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Get Silverlight plug-in help</a>."},silverlightUpgrade:{title:"Your Microsoft Silverlight is out of date",description:"Upgrade your Silverlight plug-in&mdash;it will just take a minute.",button:"<a href=\"http://go2.microsoft.com/fwlink/?LinkID=149156\" target=\"_blank\" rel=\"noopener noreferrer\">Install Silverlight</a>",footer:"If you're experiencing problems with Silverlight, please see our <a href=\"//{{videoIssuesUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">troubleshooting tips</a>."},silverlightActiveX:{title:"ActiveX Not Enabled",description:"To watch your video in Internet Explorer, ActiveX controls must be enabled.",steps:["In Internet Explorer, press the <b>Alt</b> key, and then on <b>Tools</b> menu, click <b>Internet options</b>.","On the <b>Security</b> tab, click <b>Custom level</b>.","Scroll down to the <b>ActiveX controls and plug-ins</b> section.","Click <b>Enable</b> for <b>Run ActiveX controls and plug-ins</b> and <b>Script ActiveX controls marked safe for scripting</b>.","Click <b>OK</b>, and then restart Internet Explorer."],footer:"For further assistance, <a href=\"//{{contactUsDigitalUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">contact Amazon Customer Service</a>."},silverlightCorruptionWindows:{title:"Silverlight Problem",description:"There's a problem with the installation of Microsoft Silverlight on your computer. Microsoft provides a tool that can often fix this problem.",fixItToolSteps:["<a href=\"https://download.microsoft.com/download/6/C/9/6C970550-32AB-4235-9CDD-7FC9DD848BBB/silverlight.diagcab\" target=\"_blank\" rel=\"noopener noreferrer\">Run the Fix It tool</a>","After the tool has completed, refresh this page."],manualRepairSteps:{preLinkText:"If the Microsoft Fix It tool fails to fix the problem, try the ",linkText:"Manual Repair Steps",postLinkText:".",steps:["Close all web browser windows, including this one.","Click the Start button, type <b>Uninstall a program</b>, and then press <b>Enter</b>.<br/>Windows 8: Swipe in from the right edge of the screen, then tap <b>Settings</b>. You can also press Windows key+I. Select <b>Control Panel</b>, and then select <b>Uninstall a program</b>.","Click <b>Microsoft Silverlight</b>, and then click <b>Uninstall</b>.","Return to this page to install Silverlight."]},footer:"For further assistance, <a href=\"//{{contactUsDigitalUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">contact Amazon Customer Service</a>."},silverlightCorruptionMac:{title:"Silverlight Problem",description:"There's a problem with the installation of Microsoft Silverlight on your computer. Often, this can be fixed by uninstalling, and then reinstalling Silverlight.",steps:["Close all web browser windows, including this one.","Click on the Desktop, or open Finder.","Click <span class=\"highlight\">Go > Computer</span>.","Double-click <span class=\"highlight\">Macintosh HD > Library > Internet Plugins</span>.","Drag <span class=\"highlight\">Silverlight.plugin</span> to the Trash.","Return to this page to install Silverlight."],footer:"For further assistance, <a href=\"//{{contactUsDigitalUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">contact Amazon Customer Service</a>."},notification:{showMore:"Show More",showLess:"Show Less",dismiss:"Dismiss",dontShowAgain:"Don't show again"},silverlightBlocked:{message:"The Silverlight plugin isn't loading and might be blocked by your browser.",chromeUnblock:"To enable Silverlight, click this icon <span class=\"chromePluginBlockerIcon\"></span> inside the right edge of the address bar, select <b>\"Always allow plug-ins on www.amazon.com\"</b>, and then click <b>\"Done\"</b>.",troubleshoot:"Please see the <a href=\"//{{videoIssuesUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon website</a> for additional troubleshooting help. Error: 7303."},silverlightBlockedSafari10:"Silverlight is disabled by default in this version of Safari. To re-enable and watch Prime Video, click <b>Use Silverlight</b>.<br/><br/>\n                            If Silverlight isn't installed on your Mac, click <b>Missing Plugin</b>, and then click <b>More Info</b> to go to the Silverlight installation page.<br/><br/>\n                            For additional troubleshooting help, go to the <a href=\"//{{videoIssuesUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Amazon website</a>. Error: 7304`",silverlightForcedNarratives:"The Silverlight player doesn't support forced narratives. Subtitles will be automatically enabled. Forced narratives translate dialogue or text that doesn't match the primary language of the video. For example, a scene with sailors speaking Russian, but the video is for English audiences.",updateChrome:{title:"Chrome Update Available",message:"An updated version of Chrome is available which enables an improved HTML5 video web player.",instructions:"To update, click the Chrome menu (three horizontal stripes) on the browser toolbar, click <b>About Google Chrome</b>, and then click <b>Relaunch</b>."},safariBetterWatchExperience:"For the best streaming experience, we recommend using Chrome or Edge.",switchToHtml5:"For more features and less buffering, we recommend using the HTML5 video player on Google Chrome, Internet Explorer 11 on Windows 8.1 or later, Microsoft Edge, Firefox 60 or later, or Opera.",updateFirefox:"Update to <a href=\"https://support.mozilla.org/kb/update-firefox-latest-version\" target=\"_blank\" rel=\"noopener noreferrer\">Firefox 60</a> or later to access our HTML5 video player with better performance and features like X-Ray, Auto-play, Live streaming, and more.",SilverlightUnsupportedFeatureError:{title:"Video Unavailable",description:"This video requires an HTML5 video player which provides a better viewing experience and more features. <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Learn more</a> about web browsers that support the HTML5 player and the benefits."}},Wf=l&&l.__assign||function(){return(Wf=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Vf=je.metrics,Bf=tt.PartnerServiceEndpoint,qf=tt.StorageKeys,jf=tt.Weblabs,zf=tt.WeblabTreatment,Gf=_t.BasicStore,Yf=Ue.AbortedEvent,Kf=Ue.AbortEvent,Xf=Ue.AsinChangedEvent,Qf=Ue.CachePriority,Jf=Ue.CloseEvent,Zf=Ue.DiagnosticsState,$f=Ue.DiagnosticsProtocol,ey=Ue.EndOfContentEvent,ty=Ue.ErrorSeverity,iy=Ue.Features,ny=Ue.InitializedEvent,ry=Ue.NotificationCancelEvent,oy=Ue.NotificationEvent,sy=Ue.PINAcceptedEvent,ay=Ue.PINErrorEvent,ly=Ue.PINRequiredEvent,cy=Ue.PlayerCapabilitiesEvent,uy=Ue.PlayingEvent,py=Ue.PreparedEvent,hy=Ue.StoppingEvent,dy=Ue.VideoType,fy=It.QueryString,yy=da.Reporter,gy=zo.BrowserType,my=zo.OperatingSystemFamily,vy=Ua.Locales,Ey=Ua.LocalizationStore,_y=bi.AmazonUrlCreator,Sy=bi.CookieStorage,Ty=bi.EnumUtils,by=bi.LocalStorage,Iy=bi.SessionStorage,wy=bi.ResourceAcquirer,Ry=bi.Version,Cy=or.UUID,Py=c.of("DelegatingWebPlayer"),Ay=Ve.get("DelegatingWebPlayer");function Oy(e,t){return"envelope"===e&&null!=t?"<REDACTED>":t}var Ny=function(){function T(e,t,i,n,r,o,s,a,l,c,u,p,h,d,f,y,g,m,v,E,_){void 0===i&&(i=new yy),void 0===n&&(n=new nl),void 0===r&&(r=new wy),void 0===o&&(o=new xl),void 0===s&&(s=new Al),void 0===a&&(a=new Vl),void 0===l&&(l=new Ff),void 0===c&&(c=new Iy),void 0===u&&(u=new Sy),void 0===p&&(p=b.now),void 0===h&&(h=window.navigator),void 0===d&&(d=window.location),void 0===f&&(f=new Af),void 0===y&&(y=new _l),void 0===g&&(g=new by),void 0===m&&(m=vy),void 0===v&&(v=Ey),void 0===E&&(E=Gf),void 0===_&&(_=ys.getInstance());var S=this;this.featureConfig=null,this.playerCacheEnabled=!0,this.onPlayerCreated=function(e,t){try{S.webPlayerFactory=e,S.webPlayer=t,S.attachEventListeners(S.webPlayer),S.tryNotifyPlaybackInitiated(),S.pinDisplayManager.initialize(S.webPlayer,S.eventEmitter,S.uiElement,S.localizationStore,S.amazonUrlCreator,function(){S.onClosePlayerClicked()});var i=$a(!0,S.playerConfig,{domElement:S.playerElement});S.webPlayer.once(ny,function(){I.exists(S.spinnerPanel)&&S.spinnerPanel.uninitialize(),S.spinnerPanel=null,S.fsm.transitionTo(Zl.INITIALIZED),S.eventEmitter.emit(ny)}),S.initializeTimer.end(),S.webPlayer.initialize(i)}catch(e){Ay.error(e),S.abort(T.UNHANDLED_INITIALIZE_ERROR,e.message,ty.Fatal)}},this.abort=function(e,t,i,n){I.isNullOrUndefined(S.playerCapabilities)&&(S.playerCapabilities={supportsDrm:!1,supportsNativePlayback:!1,supportsWebPlayback:!1,supportsAVOD:!1,supportsMidStreamMTA:!1,supportsHDMovies:!1,supportsHDTVShows:!1,supportsLive:!1},S.eventEmitter.emit(cy,new cy(S.getPlayerCapabilities()))),S.reportFatalError(e,t,i),S.showErrorMessage(n,e),Ay.error("The player has terminated due to a Fatal error: "+e+": "+t),S.reporter.flush(),S.qosReporter.flush(),S.transitionToAborted()},this.onNotificationEvent=function(e){S.notificationManager.addNotification(e,!1)},this.onNotificationCancelEvent=function(e){S.notificationManager.cancelNotification(e.getNotification())},this.fsm=this.createFiniteStateMachine(),this.loaderConfig=e,this.flagManager=l,this.sessionStorage=c,this.cookieStorage=u,this.localStorage=g,this.localesRef=m,this.hasPlaybackInitiated=!1,this.notifyPlaybackInitiatedOnInitialized=!1,this.sortedPlayerFactories=t,this.reporter=i,this.reporter.preInitializeLogging(),this.errorDisplayManager=n,this.resourceAcquirer=r,this.notificationManager=o,this.qosReporter=s,this.spinnerPanel=a,this.now=p,this.navigator=h,this.locationRef=d,this.initializePipeline=f,this.deviceInformation=_,this.eventEmitter=new We.BasicEventEmitter,this.pinDisplayManager=y,this.webPlayer=null,this.webPlayerFactory=null,this.localizationStoreType=v,this.configurationStore=new E}return T.prototype.getState=function(){return this.fsm.getCurrentState()},T.prototype.initialize=function(e){var t=this;if(Py(e,"playerConfig").is.an.object(),Py(b.isElement(e.domElement),"playerConfig.domElement has to be a dom element").is.true(),Py(e.marketplaceId,"playerConfig.marketplaceId").is.a.string(),Py(e.marketplaceId,"playerConfig.marketplaceId").is.not.empty(),!this.fsm.transitionTo(Zl.INITIALIZING))throw new Error("Unable to initialize player while in the "+Zl[this.fsm.getCurrentState()]+" state");this.initializeTimer=Vf.startTimer(T.INITIALIZE_TIME),this.webPlayerFactory=null;var i=this.sanitizePlayerConfig(e);I.isNullOrUndefined(i.deviceId)&&(i.deviceId=this.createDeviceId(i.customerId));var n=this.flagManager.isActiveFlag(Ff.HTML5_DIAGNOSTICS_STORAGE_KEY)?Zf.Enabled:Zf.Disabled,r=fy.getParameter(T.PLAYER_DEBUG_QUERY_PARAM);I.exists(r)&&(n=I.withDefault(Zf[r],n)),this.diagnosticsSessionConfiguration=this.createDiagnosticsConfig();var o=this.flagManager.isActiveFlag(Ff.HTML5_HEVC_TEST_STORAGE_KEY),s=fy.getParameter(T.PLAYER_CACHE_QUERY_PARAM);this.isLinuxFirefox52()&&(Ay.warn("Firefox 52 on Linux detected, disabling player asset caching."),this.playerCacheEnabled=!1),null!=s&&(this.playerCacheEnabled=s);var a=this.getStoredOverrides(),l=I.nestedValue(a,"userWatchSessionId",Cy.v4());this.configurationStore.setValue({userWatchSessionId:l,primitiveSessionId:l+this.now(),diagnosticsSessionConfiguration:this.diagnosticsSessionConfiguration}).commit(),this.playerConfig=$a(!0,{loaderConfig:this.loaderConfig,partnerServiceEndpoint:Bf.fromMarketplaceId(i.marketplaceId),locale:vy.EN_US,diagnostics:n,enableAvod:!0,enableHEVC:o,sessionId:this.cookieStorage.get(T.SESSION_ID_KEY),tokenClient:null,clientId:null,configurationStore:this.configurationStore},i);var c=[vy.EN_US,this.localesRef.getLocaleFromMarketplaceId(this.playerConfig.marketplaceId),this.localesRef.getClosestLocale(this.playerConfig.locale,vy.AvailableLocales),this.localesRef.getStandardizedLocale(this.playerConfig.locale)];this.playerConfig.locale=b.reduce(c,function(e,t){return I.withDefault(t,e)});var u={},p=fy.getParameter("playerBeta"),h=i.playerBeta;if(null!=p&&(b.isBoolean(p)?h=p:b.isNumber(p)&&(h=1===p)),I.exists(a.weblabs)){var d=b.map(a.weblabs.split("&"),function(e){return e.split(":")});b.each(d,function(e){var t=e[1];b.isString(t)&&(u[e[0]]="C"===t?null:zf[t])})}this.featureConfig=$a(!0,T.DEFAULT_FEATURE_CONFIG,this.playerConfig.features),this.qosReporter.reportInformation(T.CLIENT_ID,I.exists(this.playerConfig.clientId)?this.playerConfig.clientId:"NONE"),Ay.info("Using web player version "+this.loaderConfig.dependencies.ATVWebPlayer.version),Ay.info("Player config parameter:",e),Ay.info("Final player config:",this.playerConfig),Ay.info("User Agent: "+this.navigator.userAgent),Ay.info("Detected operating system: "+this.deviceInformation.operatingSystem),Ay.info("Detected browser: "+this.deviceInformation.browser),Ay.info("Page URL: "+(b.isUndefined(this.locationRef)?"":this.locationRef.href)),this.createHTMLElements();var f=this.loaderConfig.assetsRoot+"/"+this.loaderConfig.dependencies.ATVWebPlayer.name+"/"+this.loaderConfig.dependencies.ATVWebPlayer.version+"/"+T.CSS_ASSET_PATH;document.querySelector("link[href='"+f+"']")||this.resourceAcquirer.acquire(f),this.localizationStore=this.createLocalizationStore(),this.amazonUrlCreator=new _y(this.playerConfig.marketplaceId,xf),this.localizationStore.setLanguage(vy.EN_US,function(){},function(){}),this.notificationManager.initialize(this.playerElementWrapper,this.playerElement,this.localizationStore,this.amazonUrlCreator),this.errorDisplayManager.initialize(this.uiElement,this.localizationStore,this.amazonUrlCreator,function(){t.onClosePlayerClicked()});try{this.initializePipeline.on(vf,this.onNotificationEvent),this.initializePipeline.initialize({onPlayerCapabilities:function(e){t.playerCapabilities=e,t.eventEmitter.emit(cy,new cy(e))},authToken:i.authToken,loaderConfig:this.loaderConfig,playerFactories:this.sortedPlayerFactories,playerElement:this.playerElement,weblabNames:jf.getActiveWeblabs(),weblabOverrides:u,playerBeta:h,playerCacheEnabled:this.playerCacheEnabled,playerConfig:this.playerConfig,playerOverride:I.nestedValue(a,"playerOverride"),qosReporter:this.qosReporter,reporter:this.reporter,spinnerPanel:this.spinnerPanel,localizationStore:this.localizationStore},this.onPlayerCreated,this.abort)}catch(e){Ay.error(e),this.abort(T.UNHANDLED_INITIALIZE_ERROR,e.message,ty.Fatal)}},T.prototype.prepareCache=function(e){Py(e,"contentConfig").is.an.object(),Py(e.asin,"contentConfig.asin").is.a.string(),Py(e.asin,"contentConfig.asin").is.not.empty(),Py(e.cachePriority,"contentConfig.cachePriority").is.a.number(),Py(Qf[e.cachePriority]).exists(),Ay.info("Prepare cache with "+e.asin+" at "+e.cachePriority+" priority")},T.prototype.prepare=function(e){var t=this;if(Py(e,"contentConfig").is.an.object(),Py(e.asin,"contentConfig.asin").is.a.string(),Py(e.asin,"contentConfig.asin").is.not.empty(),!this.fsm.canTransitionTo(Zl.PREPARING))throw new Error("Unable to prepare player while in the "+Zl[this.fsm.getCurrentState()]+" state");var i=this.sanitizeContentConfig(e);try{var n=$a(!0,{cachePriority:Qf.High,isAVOD:!1,trailer:!1,immediateConsumption:!0},i);if(this.ignorePrepare(n))return;I.exists(e.features)&&(this.featureConfig=$a(!0,T.DEFAULT_FEATURE_CONFIG,e.features)),this.fsm.transitionTo(Zl.PREPARING);var r=this.getStoredOverrides();b.each(T.ALLOWED_CONTENT_OVERRIDES,function(e){n[e]=I.nestedValue(r,e,n[e])}),n.asin===T.EVENT_HACK_LCID&&(n.videoType="External");var o=JSON.stringify(e,Oy);Ay.info("Content config parameter: "+o);var s=JSON.stringify(n,Oy);if(Ay.info("Final content config: "+s),this.qosReporter.setAsin(n.asin),b.isEmpty(n.clientMetadata)||this.qosReporter.reportInformation(T.CLIENT_METADATA,n.clientMetadata),this.preparedListener=function(){t.webPlayer.once(hy,t.stoppingListener),t.webPlayer.off(ny,t.initializedListener),t.fsm.transitionTo(Zl.PREPARED),t.eventEmitter.emit(py)},this.stoppingListener=function(){t.webPlayer.once(ny,t.initializedListener),t.fsm.transitionTo(Zl.STOPPING),t.eventEmitter.emit(hy)},this.initializedListener=function(){t.webPlayer.off(py,t.preparedListener),t.fsm.transitionTo(Zl.INITIALIZED),t.eventEmitter.emit(ny)},this.webPlayer.once(py,this.preparedListener),this.webPlayer.once(ny,this.initializedListener),dy[n.videoType]===dy.Live&&this.deviceInformation.browser.getType()===gy.Safari&&"true"!==this.localStorage.get(Fl.DONT_SHOW_AGAIN_KEY)){var a=new Fl("safariBetterWatchExperience");this.notificationManager.addNotification(a.createNotification(),!1)}this.webPlayer.prepare(n)}catch(e){if(Ay.error(e),e.name===T.PLAYER_DESTROYED_ERROR)return void this.abort(T.PLAYER_DESTROYED_ERROR,e.message,ty.NonFatal);this.abort(T.UNHANDLED_PREPARE_ERROR,e.message,ty.Fatal)}},T.prototype.play=function(e){if(Py(e,"playbackConfig").is.an.object(),!this.fsm.transitionTo(Zl.PLAYING))throw new Error("Unable to prepare player while in the "+Zl[this.fsm.getCurrentState()]+" state");try{var t=this.sanitizePlaybackConfig(e),i=$a(!0,{},t);Ay.info("Playback config parameter:",e),Ay.info("Final playback config:",i),this.webPlayer.play(i),this.notificationManager.showQueuedNotifications()}catch(e){Ay.error(e),this.abort(T.UNHANDLED_PLAY_ERROR,e.message,ty.Fatal)}},T.prototype.playbackInitiated=function(e){this.hasPlaybackInitiated=!0,e||b.contains([Zl.INITIALIZED,Zl.INITIALIZING],this.fsm.getCurrentState())?(this.tryReportPlaybackInitiated(),this.tryNotifyPlaybackInitiated()):this.notifyPlaybackInitiatedOnInitialized=!0},T.prototype.stop=function(){var i=this;if(this.fsm.transitionTo(Zl.STOPPING))try{this.hasPlaybackInitiated=!1,this.webPlayer.off(ny,this.initializedListener),this.webPlayer.off(py,this.preparedListener),this.webPlayer.off(hy,this.stoppingListener),this.initializePipeline.off(vf,this.onNotificationEvent),this.initializedListener=function(){i.fsm.transitionTo(Zl.INITIALIZED),i.reporter.flush(),i.qosReporter.flush();var e=Cy.v4(),t=e+i.now();i.configurationStore.setValue({userWatchSessionId:e,primitiveSessionId:t,diagnosticsSessionConfiguration:i.diagnosticsSessionConfiguration}).commit(),i.qosReporter.updateSessionIds(e,t),i.reporter.updateLoggingSessionId(e),i.reporter.updateMetricsSessionId(e),i.notifyPlaybackInitiatedOnInitialized&&(i.notifyPlaybackInitiatedOnInitialized=!1,i.playbackInitiated(!0)),i.eventEmitter.emit(ny)},this.webPlayer.once(ny,this.initializedListener),this.pinDisplayManager.hideModal(),this.webPlayer.stop()}catch(e){Ay.error(e),this.abort(T.UNHANDLED_STOP_ERROR,e.message,ty.Fatal)}},T.prototype.seek=function(e){Py(e,"position").is.a.number(),Py(0<=e,"position >= 0").is.true();var t=this.fsm.getCurrentState();t===Zl.PREPARED||t===Zl.PLAYING?(Ay.info("Seeking to position: "+e),this.webPlayer.seek(e)):Ay.warn("The player has not started playback; ignoring call to seek")},T.prototype.on=function(e,t){this.eventEmitter.on(e,t)},T.prototype.once=function(e,t){this.eventEmitter.once(e,t)},T.prototype.off=function(e,t){this.eventEmitter.off(e,t)},T.prototype.getFeature=function(e,t,i){var n=iy[iy[e]];I.exists(n)?I.exists(this.webPlayer)?this.webPlayer.getFeature(n,t,i):i(new Error("Cannot acquire the requested feature because the player is not initialized yet.")):i(new Error("The requested feature does not exist."))},T.prototype.getPosition=function(){var e=this.fsm.getCurrentState();return e!==Zl.PREPARED&&e!==Zl.PLAYING?(Ay.warn("The player has not been prepared; ignoring call to getPosition"),0):this.webPlayer.getPosition()},T.prototype.getDuration=function(){var e=this.fsm.getCurrentState();return e!==Zl.PREPARED&&e!==Zl.PLAYING?(Ay.warn("The player has not been prepared; ignoring call to getDuration"),0):this.webPlayer.getDuration()},T.prototype.getPlayerCapabilities=function(){return Py(this.fsm.getCurrentState()!==Zl.UNINITIALIZED,"currentState !== UNINITIALIZED").is.true(),b.clone(this.playerCapabilities)},T.prototype.sanitizePlayerConfig=function(e){var t={authToken:e.authToken,domElement:e.domElement,marketplaceId:e.marketplaceId,requiredCapabilities:e.requiredCapabilities,loaderConfig:this.loaderConfig,clientId:e.clientId,deviceId:e.deviceId};return b.isObject(e.applicationIdentity)&&(t.applicationIdentity=e.applicationIdentity),this.isConfigString(e.customerId,"PlayerConfig","customerId")&&(t.customerId=e.customerId),this.isConfigString(e.locale,"PlayerConfig","locale")&&(t.locale=e.locale),this.isConfigString(e.sessionId,"PlayerConfig","sessionId")&&(t.sessionId=e.sessionId),b.isObject(e.features)&&(t.features=e.features),b.isObject(e.featuresSettings)&&(t.featuresSettings=e.featuresSettings),this.isConfigString(e.siteSectionId,"PlayerConfig","siteSectionId")&&(t.siteSectionId=e.siteSectionId),this.isConfigBoolean(e.playerBeta,"PlayerConfig","playerBeta")&&(t.playerBeta=e.playerBeta),b.each(b.difference(b.keys(e),T.PLAYER_CONFIG_PROPERTIES),function(e){Ay.warn("PlayerConfig has unsupported property: "+e)}),t},T.prototype.sanitizeContentConfig=function(e){var t={asin:e.asin};this.isConfigBoolean(e.isAVOD,"ContentConfig","isAVOD")&&(t.isAVOD=e.isAVOD),this.isConfigNumber(e.position,"ContentConfig","position")&&(t.position=e.position),b.isObject(e.features)&&(t.features=e.features),b.isObject(e.playbackEnvelope)&&(t.playbackEnvelope=e.playbackEnvelope);var i=this.getEnumValue(e.videoType,"ContentConfig","videoType",dy);return I.exists(i)||(i=dy.Feature,this.isConfigBoolean(e.trailer,"ContentConfig","trailer")&&e.trailer&&(i=dy.Trailer),this.isConfigBoolean(e.live,"ContentConfig","live")&&e.live&&(Py(i===dy.Feature,"videoType is consistent").is.true(),i=dy.Live)),t.videoType=dy[i],this.isConfigBoolean(e.immediateConsumption,"ContentConfig","immediateConsumption")&&(t.immediateConsumption=e.immediateConsumption),this.isConfigString(e.clientMetadata,"ContentConfig","clientMetadata")&&(t.clientMetadata=e.clientMetadata),b.each(b.difference(b.keys(e),T.CONTENT_CONFIG_PROPERTIES),function(e){Ay.warn("ContentConfig has unsupported property: "+e)}),t},T.prototype.sanitizePlaybackConfig=function(e){var t={playbackInitiatedTime:e.playbackInitiatedTime};return this.isConfigNumber(e.cacheType,"PlaybackConfig","cacheType")&&(t.cacheType=e.cacheType),this.isConfigString(e.audioTrackId,"PlaybackConfig","audioTrackId")&&(t.audioTrackId=e.audioTrackId),this.isConfigString(e.clickstreamRefMarker,"PlaybackConfig","clickstreamRefMarker")&&(t.clickstreamRefMarker=e.clickstreamRefMarker),b.each(b.difference(b.keys(e),T.PLAYBACK_CONFIG_PROPERTIES),function(e){Ay.warn("PlaybackConfig has unsupported property: "+e)}),t},T.prototype.isConfigBoolean=function(e,t,i){return!I.isNullOrUndefined(e)&&(!!b.isBoolean(e)||(Ay.warn(t+" property '"+i+"' must be a boolean but was "+e),!1))},T.prototype.isConfigNumber=function(e,t,i){return!I.isNullOrUndefined(e)&&(b.isNumber(e)?!(e<0)||(Ay.warn(t+" property '"+i+"' cannot be a negative but was "+e),!1):(Ay.warn(t+" property '"+i+"' must be a number but was "+e),!1))},T.prototype.isConfigString=function(e,t,i){return!I.isNullOrUndefined(e)&&(b.isString(e)?!b.isEmpty(e)||(Ay.warn(t+" property '"+i+"' cannot be an empty string"),!1):(Ay.warn(t+" property '"+i+"' must be a string but was "+e),!1))},T.prototype.getEnumValue=function(e,t,i,n){if(I.isNullOrUndefined(e))return null;if(!b.isString(e))return Ay.warn(t+" property '"+i+"' must be a string but was "+e),null;if(b.isEmpty(e))return Ay.warn(t+" property '"+i+"' cannot be an empty string"),null;var r=Ty.getEnumValue(e,n);return I.isNullOrUndefined(r)?(Ay.warn(t+" property '"+i+"' did not receive a valid enum value for the given type. Value received "+e+". "),null):r},T.prototype.ignorePrepare=function(e){return!e.immediateConsumption&&(I.exists(this.navigator.connection)&&"cellular"===this.navigator.connection.type?(Ay.warn("Pre-cache disabled on Cellular connections, ignoring calls to prepare."),!0):e.videoType===dy[dy.Live]&&(Ay.warn("Pre-cache disabled for Live streams, ignoring calls to prepare."),!0))},T.prototype.createHTMLElements=function(){this.playerElementWrapper=document.createElement("div"),this.playerElementWrapper.style.height="100%",this.playerElementWrapper.style.width="100%",this.playerElement=document.createElement("div"),this.playerElement.className="webPlayerElement",this.playerElementWrapper.appendChild(this.playerElement),this.uiElement=document.createElement("div"),this.uiElement.className="uiElement",this.parentElement=document.createElement("div"),this.parentElement.className="webPlayerContainer",this.parentElement.appendChild(this.playerElementWrapper),this.parentElement.appendChild(this.uiElement),this.playerConfig.domElement.innerHTML="",this.playerConfig.domElement.appendChild(this.parentElement)},T.prototype.createDiagnosticsConfig=function(){var e,t=fy.getParameter(T.PLAYER_DIAGNOSTICS_TYPE_PARAM),i=Ty.getEnumValue(t,$f);if(i===$f.Http)e=this.localStorage.get(qf.DiagnosticsEndpointKey);else{var n=this.loaderConfig.dependencies.ATVWebDiagnosticsRenderer;i=$f.PostMessage,e=this.loaderConfig.assetsRoot+"/"+n.name+"/"+n.version+"/html/HTML5Diagnostics.html"}return{protocol:i,endpointURI:e}},T.prototype.transitionToAborted=function(){this.fsm.transitionTo(Zl.ABORTED),this.eventEmitter.emit(Yf)},T.prototype.reportFatalError=function(e,t,i){this.qosReporter.reportError(e,i,t),Vf.putMetric(e),i!==ty.Crash&&i!==ty.Fatal||Vf.putMetric(T.FATAL_ERROR_METRIC)},T.prototype.showErrorMessage=function(e,t){var i=this.localizationStore.getLocalization();this.playerElementWrapper.innerHTML="",this.playerElement=null,this.playerElementWrapper=null,I.exists(e)?this.errorDisplayManager.showError(e,this.featureConfig.playerCloseable):I.exists(t)&&I.exists(i[t])?this.errorDisplayManager.showError(new ll(t),this.featureConfig.playerCloseable):this.errorDisplayManager.showError(new ql,this.featureConfig.playerCloseable)},T.prototype.hidePlayer=function(){this.playerElementWrapper.style.height="1px",this.playerElementWrapper.style.width="1px"},T.prototype.showPlayer=function(){I.exists(this.playerElementWrapper)&&(this.playerElementWrapper.style.height="100%",this.playerElementWrapper.style.width="100%")},T.prototype.proxyEvent=function(e,t){var i=this;e.on(t,function(e){i.eventEmitter.emit(t,e)})},T.prototype.attachEventListeners=function(e){var t=this;e.on(Kf,function(e){null!==e.getError()&&Ay.error(e.getError()),t.abort(e.getErrorName(),e.getErrorMessage(),e.getErrorSeverity(),e.getTemplate())}),e.on(Yf,function(){t.transitionToAborted()}),e.on(ry,this.onNotificationCancelEvent),e.on(oy,this.onNotificationEvent),e.on(ly,function(e){t.onPINRequired(e)}),e.on(sy,function(){t.showPlayer()}),e.on(ay,function(){t.abort(T.PIN_VALIDATION_ERROR,"An error occurred while attempting to validate the customer's PIN",ty.Fatal,new Jl)}),this.proxyEvent(e,Xf),this.proxyEvent(e,Jf),this.proxyEvent(e,ey),this.proxyEvent(e,uy)},T.prototype.onPINRequired=function(e){e.getRequiresPINSetup()?this.abort(T.PIN_SETUP_REQUIRED_ERROR,"PIN on playback is required but the customer does not have a PIN set up",ty.NonFatal,new Xl):e.getRequiresAgeVerification()?this.abort(T.PIN_AGE_VERIFICATION_ERROR,"Age verification on playback is required but the customer does not have age verified",ty.NonFatal,new zl):this.showPINModal(e.getPINLength(),e.getHidePlayer())},T.prototype.onClosePlayerClicked=function(){this.showPlayer(),this.eventEmitter.emit(Jf)},T.prototype.createLocalizationStore=function(){var e=this.loaderConfig.dependencies.ATVWebPlayer,n=this.loaderConfig.assetsRoot+"/"+e.name+"/"+e.version,t=vy.AvailableLocales.reduce(function(e,t){var i;return Wf({},e,((i={})[t]=t===vy.EN_US?Hf:n+"/languages/"+t+".json",i))},{});return new this.localizationStoreType(e.version,e.name,t,vy.EN_US,this.playerCacheEnabled)},T.prototype.createDeviceId=function(e){var t=this.localStorage.get(T.DEVICE_ID_KEY);I.isNullOrUndefined(t)&&(t=new el(e+Cy.v4(),"TEXT").getHash("SHA-224","HEX"),this.localStorage.set(T.DEVICE_ID_KEY,t));return t},T.prototype.showPINModal=function(e,t){t&&this.hidePlayer();try{this.pinDisplayManager.requestPIN(e)}catch(e){this.abort(T.PIN_LOOKUP_ERROR,"An error occurred while attempting to validate the customer's PIN",ty.Fatal,new Yl)}},T.prototype.tryNotifyPlaybackInitiated=function(){null!==this.webPlayer&&this.hasPlaybackInitiated&&this.webPlayer.playbackInitiated()},T.prototype.tryReportPlaybackInitiated=function(){this.hasPlaybackInitiated&&this.qosReporter.reportInformation(T.PLAYBACK_INITIATED)},T.prototype.getStoredOverrides=function(){try{var e=this.sessionStorage.get(T.OVERRIDES_STORAGE_KEY),t=JSON.parse(e);return b.isObject(t)?t:{}}catch(e){return{}}},T.prototype.createFiniteStateMachine=function(){var e=new Ha(Zl.UNINITIALIZED);return e.addTransition(Zl.UNINITIALIZED,Zl.INITIALIZING),e.addTransition(Zl.INITIALIZING,Zl.INITIALIZED),e.addTransition(Zl.INITIALIZING,Zl.ABORTED),e.addTransition(Zl.INITIALIZED,Zl.PREPARING),e.addTransition(Zl.PREPARING,Zl.PREPARED),e.addTransition(Zl.PREPARING,Zl.INITIALIZED),e.addTransition(Zl.PREPARING,Zl.STOPPING),e.addTransition(Zl.PREPARING,Zl.ABORTED),e.addTransition(Zl.PREPARED,Zl.STOPPING),e.addTransition(Zl.PREPARED,Zl.ABORTED),e.addTransition(Zl.PREPARED,Zl.PLAYING),e.addTransition(Zl.PLAYING,Zl.STOPPING),e.addTransition(Zl.PLAYING,Zl.ABORTED),e.addTransition(Zl.STOPPING,Zl.INITIALIZED),e.addTransition(Zl.STOPPING,Zl.ABORTED),e.onTransition(function(e,t){Ay.info("Transitioned from "+Zl[e]+" to "+Zl[t])}),e.onIllegalTransition(function(e,t){Ay.warn("Attempted illegal state transition from "+Zl[e]+" to "+Zl[t])}),e},T.prototype.isLinuxFirefox52=function(){var e=this.deviceInformation.browser,t=e.getType();return this.deviceInformation.operatingSystem.getFamily()===my.Linux&&(t===gy.Firefox||t===gy.Firefox64)&&e.getVersion().equals(Ry.fromNumber(52))},T.EVENT_HACK_LCID="amzn1.dv.lcid.Ext73509-2ae9-4b43-a957-236304d15be1",T.CSS_ASSET_PATH="css/ATVWebPlayer.css",T.PLAYER_CACHE_QUERY_PARAM="playerCache",T.PLAYER_DEBUG_QUERY_PARAM="playerDebug",T.PLAYER_DIAGNOSTICS_TYPE_PARAM="debugType",T.OVERRIDES_STORAGE_KEY="playerOverrides",T.DEVICE_ID_KEY="atvwebplayer_deviceid",T.SESSION_ID_KEY="session-id",T.PLAYER_CONFIG_PROPERTIES=["sessionId","authToken","applicationIdentity","clientId","customerId","domElement","features","featuresSettings","marketplaceId","locale","requiredCapabilities","siteSectionId"],T.CONTENT_CONFIG_PROPERTIES=["asin","cachePriority","clientMetadata","features","immediateConsumption","isAVOD","live","playbackEnvelope","position","trailer","videoType"],T.ALLOWED_CONTENT_OVERRIDES=["position"],T.PLAYBACK_CONFIG_PROPERTIES=["audioTrackId","clickstreamRefMarker","playbackInitiatedTime","cacheType"],T.INITIALIZE_TIME="DelegatorInitializeTime",T.FATAL_ERROR_METRIC="FatalError",T.CLIENT_METADATA="ClientMetadata",T.CLIENT_ID="ClientID",T.PIN_AGE_VERIFICATION_ERROR="PINAgeVerificationError",T.PIN_LOOKUP_ERROR="PINLookupError",T.PIN_SETUP_REQUIRED_ERROR="PINSetupRequiredError",T.PIN_VALIDATION_ERROR="PINValidationError",T.PLAYER_DESTROYED_ERROR="PlayerDestroyedError",T.UNHANDLED_INITIALIZE_ERROR="UnhandledInitializeError",T.UNHANDLED_PREPARE_ERROR="UnhandledPrepareError",T.UNHANDLED_PLAY_ERROR="UnhandledPlayError",T.UNHANDLED_STOP_ERROR="UnhandledStopError",T.PLAYBACK_INITIATED="PlaybackInitiated",T.DEFAULT_FEATURE_CONFIG={enableHdIndicator:!0,enableLiveContentWarning:!0,enableMta:!0,enableNextUp:!0,enablePause:!0,enableSeek:!0,enableUpdateStream:!0,enableXray:!0,enableOptions:!0,heroImageUrl:null,playerCloseable:!0},T}(),My=Ue.AbortedEvent,Ly=Ue.CloseEvent,ky=Ue.Features,xy=Ue.InitializedEvent,Dy=Ue.PreparedEvent,Uy=Ue.PlayingEvent,Fy=Ue.StoppingEvent,Hy=Ue.EndOfContentEvent,Wy=Ue.AsinChangedEvent,Vy=Ue.PlayerCapabilitiesEvent,By=Ue.CachePriority,qy=Ue.CacheType,jy=c.of("StatelessWebPlayer"),zy=Ve.get("StatelessWebPlayer"),Gy=function(){function e(e,t,i,n){void 0===t&&(t=Ny),void 0===i&&(i=b.now),void 0===n&&(n=!0);var r=this;this.Features=ky,this.webPlayer=null,this.playerConfig=null,this.contentConfig=null,this.playbackConfig=null,this.newPlayerConfig=null,this.newContentConfig=null,this.newPlaybackConfig=null,this.playerCapabilities=null,this.isWaiting=!1,this.canPrepareOnInitialize=!0,this.shouldEmitClosed=!1,this.lastPosition=null,this.cacheType=qy.CacheMiss,this.playInvokedTime=null,this.eventEmitter=new We.BasicEventEmitter,this.featureListeners=[],this.onStateChanged=function(){r.isWaiting=!1;var e=r.getPlayerState();switch(zy.info("Changed state to: "+Zl[e]),e){case Zl.UNINITIALIZED:r.onUninitialized();break;case Zl.INITIALIZED:r.onInitialized();break;case Zl.PREPARING:r.onPreparing();break;case Zl.PREPARED:r.onPrepared();break;case Zl.PLAYING:r.onPlaying();break;case Zl.STOPPING:r.onStopping();break;case Zl.ABORTED:r.onAborted();break;default:throw new Error("Unable to transition at invalid state: "+e)}},this.onPlayerCapabilities=function(e){var t=e.capabilities;b.isEqual(r.playerCapabilities,t)||(r.playerCapabilities=$a(!0,{},t),r.emitEvent(s,{capabilities:r.playerCapabilities}))},this.onPlayerClose=function(){r.shouldEmitClosed=!0;var e=r.getPlayerState();e!==Zl.PREPARED&&e!==Zl.PLAYING||(r.lastPosition=r.webPlayer.getPosition()),r.newContentConfig=null,r.newPlaybackConfig=null,r.onStateChanged()},this.reportPlaying=function(e){r.emitEvent(a,e)},this.reportAsinChanged=function(e){r.emitEvent(o,e)},this.loaderConfig=e,this.webPlayerClass=t,this.now=i,this.preInitEnabled=n}return e.prototype.initialize=function(e){if(this.preInitEnabled){this.setConfigs(e);try{zy.info("Initialize called."),this.updateStateFromConfig()}catch(e){throw zy.error("Unhandled exception in initialize.",e),e}}else zy.info("Pre-init disabled, ignoring call to initialize.")},e.prototype.prepare=function(e,t){if(this.preInitEnabled)if(I.isNullOrUndefined(this.newPlaybackConfig))if(this.setConfigs(e,t),I.isNullOrUndefined(this.webPlayer)||this.newContentConfig.cachePriority===By.High)try{if(zy.info("Prepare called."),this.isEqualWithoutPosition(this.newContentConfig,this.contentConfig)&&null!==this.newPlaybackConfig)return void zy.info("Content config matches previous call to play, ignoring call to prepare.");this.updateStateFromConfig()}catch(e){throw zy.error("Unhandled exception in prepare.",e),e}else this.webPlayer.prepareCache(this.newContentConfig);else zy.warn("Pre-init disabled while already playing content, ignoring calls to prepare.");else zy.warn("Pre-init disabled, ignoring call to prepare.")},e.prototype.play=function(e,t,i){try{if(this.setConfigs(e,t,i),zy.info("Play called."),this.newContentConfig.cachePriority=By.High,!(null!==this.playInvokedTime||b.isEqual(this.contentConfig,this.newContentConfig)&&b.isEqual(this.playbackConfig,this.newPlaybackConfig))){switch(this.playInvokedTime=this.now(),this.getPlayerState()){case Zl.PREPARED:this.cacheType=qy.CacheHit;break;case Zl.PREPARING:this.cacheType=qy.CachePartialHit;break;default:this.cacheType=qy.CacheMiss}null!==this.webPlayer&&this.webPlayer.playbackInitiated(this.isEqualWithoutPosition(this.contentConfig,this.newContentConfig))}b.isEqual(this.contentConfig,this.newContentConfig)||(this.cacheType=qy.CacheMiss),this.updateStateFromConfig()}catch(e){throw zy.error("Unhandled exception in play.",e),e}},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.getFeature=function(e,t,i){I.isNullOrUndefined(this.webPlayer)?this.featureListeners.push({feature:e,onAvailable:t,onError:i}):this.webPlayer.getFeature(e,t,i)},e.prototype.updateStateFromConfig=function(){null!==this.newContentConfig&&(this.canPrepareOnInitialize=!0),this.shouldEmitClosed&&(this.shouldEmitClosed=!1),this.isWaiting||this.onStateChanged()},e.prototype.setConfigs=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null),jy(null===this.playerConfig||b.isEqual(this.playerConfig,e),"The playerConfig cannot be changed after initialization.").is.true(),this.newPlayerConfig=$a(!0,{},e),null!==t&&(t.cachePriority=I.withDefault(t.cachePriority,By.High)),this.newContentConfig=null!==t?$a(!0,{},t):null,this.newPlaybackConfig=null!==i?$a(!0,{},i):null},e.prototype.onUninitialized=function(){this.playerConfig=this.newPlayerConfig,null!==this.webPlayer&&(this.webPlayer.off(xy,this.onStateChanged),this.webPlayer.off(Dy,this.onStateChanged),this.webPlayer.off(Uy,this.onStateChanged),this.webPlayer.off(Uy,this.reportPlaying),this.webPlayer.off(Wy,this.reportAsinChanged),this.webPlayer.off(Ly,this.onPlayerClose),this.webPlayer.off(Hy,this.onPlayerClose),this.webPlayer.off(Vy,this.onPlayerCapabilities),this.webPlayer.off(My,this.onStateChanged)),this.webPlayer=new this.webPlayerClass(this.loaderConfig),this.webPlayer.on(xy,this.onStateChanged),this.webPlayer.on(Dy,this.onStateChanged),this.webPlayer.on(Uy,this.onStateChanged),this.webPlayer.on(Uy,this.reportPlaying),this.webPlayer.on(Fy,this.onStateChanged),this.webPlayer.on(Wy,this.reportAsinChanged),this.webPlayer.on(Ly,this.onPlayerClose),this.webPlayer.on(Hy,this.onPlayerClose),this.webPlayer.once(Vy,this.onPlayerCapabilities),this.webPlayer.once(My,this.onStateChanged),this.isWaiting=!0,this.webPlayer.initialize(this.playerConfig),null!==this.newPlaybackConfig&&this.webPlayer.playbackInitiated(!0)},e.prototype.onInitialized=function(){if(this.reportClosedEvent(),!this.canPrepareOnInitialize)return this.canPrepareOnInitialize=!0,this.contentConfig=null,void(this.playbackConfig=null);if(b.isEqual(this.playerConfig,this.newPlayerConfig)){for(var e=0,t=this.featureListeners;e<t.length;e++){var i=t[e];this.webPlayer.getFeature(i.feature,i.onAvailable,i.onError)}if(this.featureListeners=[],!b.isEqual(this.contentConfig,this.newContentConfig)||!b.isEqual(this.playbackConfig,this.newPlaybackConfig))if(this.contentConfig=this.newContentConfig,null!==this.contentConfig){var n=!I.isNullOrUndefined(this.newPlaybackConfig);this.canPrepareOnInitialize=!1,this.contentConfig.cachePriority===By.High?this.webPlayer.prepare(b.extend({immediateConsumption:n},this.contentConfig)):this.webPlayer.prepareCache(this.contentConfig)}else this.playbackConfig=null}else this.onUninitialized()},e.prototype.onPreparing=function(){var e=this.isEqualWithoutPosition(this.contentConfig,this.newContentConfig);b.isEqual(this.playerConfig,this.newPlayerConfig)&&e||(this.isWaiting=!0,this.webPlayer.stop())},e.prototype.onPrepared=function(){this.canPrepareOnInitialize=!0;var e=this.isEqualWithoutPosition(this.contentConfig,this.newContentConfig);if(!b.isEqual(this.playerConfig,this.newPlayerConfig)||!e)return this.isWaiting=!0,void this.webPlayer.stop();b.isNumber(this.newContentConfig.position)&&this.contentConfig.position!==this.newContentConfig.position&&(this.contentConfig.position=this.newContentConfig.position,this.webPlayer.seek(this.contentConfig.position)),this.playbackConfig=this.newPlaybackConfig,null!==this.playbackConfig&&(this.webPlayer.play($a({},this.playbackConfig,{playbackInitiatedTime:this.playInvokedTime,cacheType:this.cacheType})),this.playInvokedTime=null)},e.prototype.onPlaying=function(){var e=this.isEqualWithoutPosition(this.contentConfig,this.newContentConfig);if(!b.isEqual(this.playerConfig,this.newPlayerConfig)||!e||!b.isEqual(this.playbackConfig,this.newPlaybackConfig))return this.isWaiting=!0,void this.webPlayer.stop();if(null!==this.contentConfig&&b.isNumber(this.newContentConfig.position)&&this.contentConfig.position!==this.newContentConfig.position){var t=this.newContentConfig.position;this.webPlayer.seek(t)}this.newContentConfig.position=null,this.contentConfig=this.newContentConfig},e.prototype.onStopping=function(){this.newContentConfig=null,this.newPlaybackConfig=null},e.prototype.onAborted=function(){this.reportClosedEvent(),this.emitEvent(t,new t)},e.prototype.reportClosedEvent=function(){this.shouldEmitClosed&&(this.emitEvent(i,new i(this.lastPosition)),this.lastPosition=null,this.shouldEmitClosed=!1)},e.prototype.emitEvent=function(t,e){try{this.eventEmitter.emit(t,e)}catch(e){zy.error("An exception was thrown in a StatelessWebPlayer callback for event: "+t,e)}},e.prototype.getPlayerState=function(){return null===this.webPlayer?Zl.UNINITIALIZED:this.webPlayer.getState()},e.prototype.isEqualWithoutPosition=function(e,t){return b.isEqual(b.omit(e,"position"),b.omit(t,"position"))},e}();function Yy(e){var n=new Gy(e);this.Features=n.Features,this.initialize=function(e){n.initialize(e)},this.prepare=function(e,t){n.prepare(e,t)},this.play=function(e,t,i){n.play(e,t,i)},this.on=function(e,t){n.on(e,t)},this.once=function(e,t){n.once(e,t)},this.off=function(e,t){n.off(e,t)},this.getFeature=function(e,t,i){n.getFeature(e,t,i)}}return"undefined"!=typeof window&&null!==window&&(window.ATVWebPlayer=Yy),Yy}();